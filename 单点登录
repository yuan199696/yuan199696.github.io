<!-- build time:Sat Dec 25 2021 15:31:09 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN,en,default"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="书院十四先生" href="https://baiyezi.vip/rss.xml"><link rel="alternate" type="application/atom+xml" title="书院十四先生" href="https://baiyezi.vip/atom.xml"><link rel="alternate" type="application/json" title="书院十四先生" href="https://baiyezi.vip/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Java,Shiro,权限"><link rel="canonical" href="https://baiyezi.vip/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95"><title>单点登录 - Java | 书院十四先生</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">单点登录</h1><div class="meta"><span class="item" title="创建时间：2021-02-14 21:15:56"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-02-14T21:15:56+08:00">2021-02-14</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>22k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>20 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">书院十四先生</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105008.png"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105423.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105420.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225104957.png"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105418.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105422.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/java/" itemprop="item" rel="index" title="分类于 Java"><span itemprop="name">Java</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://baiyezi.vip/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="fanfanfan"><meta itemprop="description" content=", 花有重开日，人无再少年"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="书院十四先生"></span><div class="body md" itemprop="articleBody"><h2 id="单点登录原理"><a class="anchor" href="#单点登录原理">#</a> 单点登录原理</h2><h3 id="单点登录"><a class="anchor" href="#单点登录">#</a> 单点登录</h3><p>当多个客户端使用同一个浏览器打开时，只要其中一个客户端登陆过，那么其他客户端就不需要再次登录（解决了不同客户端 cookie 不能跨域的问题），同时一个客户端退出，那么其他客户端也会强制退出。这就需要多个客户端之间用于联系的 session 由一个统一的服务器进行管理，使得 session 可以共享</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210310134600679.png" alt="image-20210310134600679"></p><p>以下主要是思想以及核心代码</p><p>1、登录首先请求认证系统（服务端，相对于应用系统），认证系统通过后，给用户返回一个 ticket，并重定向到应用系统</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 登录首先请求认证系统，认证系统通过后，拿到登录信息，同时给用户返回一个 ticket</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> redirectUrl<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"redirectUrl"</span><span class="token punctuation">,</span> redirectUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"system"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"111111"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>			<span class="token comment">// 给用户创建一个 token，唯一，落库</span></pre></td></tr><tr><td data-num="8"></td><td><pre>			<span class="token comment">// 如果登陆成功，服务器端需要保存</span></pre></td></tr><tr><td data-num="9"></td><td><pre>			<span class="token class-name">String</span> ticket <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>			<span class="token comment">// 应该保存 --redis，数据库，</span></pre></td></tr><tr><td data-num="12"></td><td><pre>			<span class="token class-name">MockDb</span><span class="token punctuation">.</span>TICKET<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ticket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>			<span class="token comment">//2, 服务器上存在会话信息</span></pre></td></tr><tr><td data-num="14"></td><td><pre>			session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"ticket"</span><span class="token punctuation">,</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>			<span class="token comment">//3 返回给客户。重定向到应用系统，会被应用系统的拦截器拦截</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>redirectUrl <span class="token operator">+</span> <span class="token string">"?ticket="</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"用户名密码不正确"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token keyword">return</span> mv<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>2、应用系统拦截器拦截认证系统认证通过后的重定向，并再次去认证系统验证拿到的 ticket</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>fan<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>sso</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span>JSON<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fan<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">HttpUtil</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fan<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fan<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">SsoClientUtil</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">Session</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">HandlerInterceptor</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSession</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="18"></td><td><pre> * &lt;p>&lt;/p></pre></td></tr><tr><td data-num="19"></td><td><pre> */</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SsoInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token comment">//1 判断用户是否存在会话</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token class-name">Boolean</span> isLogin <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token class-name">Object</span> isLogin1 <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"isLogin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token comment">// 首次重定向该应用系统是没登录的，但是有 ticket</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isLogin1 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            isLogin <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">)</span> isLogin1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token comment">//2 - 登陆成功</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isLogin <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> isLogin<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token comment">//3 - 判断 token。首次重定向该应用系统后直接执行这里</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token class-name">String</span> ticket <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"ticket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>ticket<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"检测到服务器端的token信息"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token comment">// 防止伪造，拿到服务器端验证，第二次要去 sso-server 段验证，</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token comment">// 服务器端的地址</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token comment">//http://www.sso.com:9001/verify?ticket=123&amp;logoutUrl=</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token class-name">String</span> httpUrl <span class="token operator">=</span> <span class="token class-name">SsoClientUtil</span><span class="token punctuation">.</span>SERVER_URL_PREFIX <span class="token operator">+</span> <span class="token string">"/verify"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ticket"</span><span class="token punctuation">,</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"logoutUrl"</span><span class="token punctuation">,</span> <span class="token class-name">SsoClientUtil</span><span class="token punctuation">.</span><span class="token function">getClientLogOutUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"jsessionId"</span><span class="token punctuation">,</span> session<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>                <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token class-name">HttpUtil</span><span class="token punctuation">.</span><span class="token function">sendHttpRequest</span><span class="token punctuation">(</span>httpUrl<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                <span class="token class-name">R</span> r <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"服务器端校验通过"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                    <span class="token comment">// 如果 sso-server 端验证通过，保存各自服务器登录信息，此时才代表本应用，验证通过了。</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                    session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"isLogin"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"验证异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token comment">// 服务器端</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token comment">// 跳转到统一认证中心，检测系统是否登录</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token comment">//http://www.sso.com:9001/checkLogin?redirectUrl=http://www.tb.com:9002</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token comment">// 浏览器访问应用服务器第一次跳转</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token class-name">SsoClientUtil</span><span class="token punctuation">.</span><span class="token function">redirectToSsoUrl</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>3、认证系统检查 ticket</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	 * 验证 token 是否正确</pre></td></tr><tr><td data-num="3"></td><td><pre>	 */</pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/verify"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">String</span> ticket<span class="token punctuation">,</span> <span class="token class-name">String</span> logoutUrl<span class="token punctuation">,</span> <span class="token class-name">String</span> jsessionId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MockDb</span><span class="token punctuation">.</span>TICKET<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>ticket<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"服务器端校验成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>			<span class="token comment">// 保存用户的登出和 session 信息</span></pre></td></tr><tr><td data-num="9"></td><td><pre>			<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ClientInfo</span><span class="token punctuation">></span></span> clientInfos <span class="token operator">=</span> <span class="token class-name">MockDb</span><span class="token punctuation">.</span>CLIENT_TOKEN_SESSIONID<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ticket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>			<span class="token comment">// 第一次一定是空的</span></pre></td></tr><tr><td data-num="11"></td><td><pre>			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> clientInfos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>				clientInfos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>				<span class="token comment">// 将用户信息放入</span></pre></td></tr><tr><td data-num="14"></td><td><pre>				<span class="token class-name">MockDb</span><span class="token punctuation">.</span>CLIENT_TOKEN_SESSIONID<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span> clientInfos<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			<span class="token class-name">ClientInfo</span> clientInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>			clientInfo<span class="token punctuation">.</span><span class="token function">setLogoutUrl</span><span class="token punctuation">(</span>logoutUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>			clientInfo<span class="token punctuation">.</span><span class="token function">setJsessionId</span><span class="token punctuation">(</span>jsessionId<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>			clientInfos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>clientInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>			<span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>			<span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>4、认证系统验证通过 ticket 后检查是否登录</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/checkLogin"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">checkLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> redirectUrl<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>		<span class="token comment">// 第一次从淘宝跳转过来，ticket 肯定是 null</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token comment">// 第二次天猫来了，ticket 能不能拿到？？？，如果不是 cookiea，是参数传过来的呢？</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token comment">// 也如果 sso-server 它本身能是一台机器么？？？？</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token comment">// 点击退出的时候，ticket 没了</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token class-name">String</span> ticket <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"ticket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>		<span class="token comment">//1- 判断这个用户是否登录，是否拥有全局的会话</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>ticket<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>			<span class="token comment">// 没有全局就会话，去登陆页面，我从哪里来不能丢</span></pre></td></tr><tr><td data-num="13"></td><td><pre>			<span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>			<span class="token comment">//sso-server 验证不通过，跳转到验证中心（自己的）登陆页面</span></pre></td></tr><tr><td data-num="15"></td><td><pre>			mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"redirectUrl"</span><span class="token punctuation">,</span> redirectUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			<span class="token keyword">return</span> mv<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>			<span class="token comment">// 存在全局会话，哪里那里去？？？简单么？如何做？？？</span></pre></td></tr><tr><td data-num="19"></td><td><pre>			response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>redirectUrl <span class="token operator">+</span> <span class="token string">"?ticket="</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>5、如果登录就重定向到主页</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>fan<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>sso</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fan<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">SsoClientUtil</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSession</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token annotation punctuation">@Slf4j</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token annotation punctuation">@RestController</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token comment">// 后台主页</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"访问主页1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		<span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"logoutUrl"</span><span class="token punctuation">,</span> <span class="token class-name">SsoClientUtil</span><span class="token punctuation">.</span><span class="token function">getServerLogOutUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"?redirectUrl="</span><span class="token operator">+</span><span class="token class-name">SsoClientUtil</span><span class="token punctuation">.</span><span class="token function">getRedirectUrl</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		<span class="token keyword">return</span> mv<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>		session<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>hosts 配置</p><pre><code class="language-cmd">#sso
127.0.0.1 www.tb.com #客户端一
127.0.0.1 www.tm.com #客户端二
127.0.0.1 www.sso.com #服务端
</code></pre><p>浏览器访问：<span class="exturl" data-url="aHR0cDovL3d3dy50Yi5jb206OTAwMi8lRUYlQkMlOEMlRTglODclQUElRTUlOEElQTglRTglQjclQjMlRTglQkQlQUMlRTUlODglQjA=">http://www.tb.com:9002/，自动跳转到</span> <span class="exturl" data-url="aHR0cDovL3d3dy5zc28uY29tOjkwMDEvY2hlY2tMb2dpbj9yZWRpcmVjdFVybD1odHRwOi8vd3d3LnRiLmNvbTo5MDAyLyVFRiVCQyU4QyVFNyU5OSVCQiVFNSVCRCU5NSVFNSU5MCU4RSVFRiVCQyU4QyVFNiU5NiVCMCVFNSVCQyU4MCVFNCVCOCU4MCVFNCVCOCVBQSVFNiVCNSU4RiVFOCVBNyU4OCVFNSU5OSVBOCVFOSVBMSVCNSVFOSU5RCVBMiVFOCVBRSVCRiVFOSU5NyVBRSVFRiVCQyU5QWh0dHA6Ly93d3cudG0uY29tOjkwMDMvJUVGJUJDJThDJUU1JThGJUFGJUU0JUJCJUE1JUU3JTlDJThCJUU1JTg4JUIwJUU0JUI4JThEJUU5JTlDJTgwJUU4JUE2JTgxJUU3JTk5JUJCJUU1JUJEJTk1JUU1JThEJUIzJUU1JThGJUFGJUU4JUFFJUJGJUU5JTk3JUFF">http://www.sso.com:9001/checkLogin?redirectUrl=http://www.tb.com:9002/，登录后，新开一个浏览器页面访问：http://www.tm.com:9003/，可以看到不需要登录即可访问</span></p><h3 id="单点登出"><a class="anchor" href="#单点登出">#</a> 单点登出</h3><p>一个客户端退出，其他客户端也都退出</p><p>思路：清空缓存和存储的 sessionId</p><p>那么如何触发呢？</p><p>1、主动点击客户端的突出按钮</p><p>2、session 超时无效，session.invalidate ();</p><p>服务端：以上两种情况都可以使用以下代码来使得服务端的 session 无效</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	 * &lt;p > 注销请求，只有点击注销按钮才会注销 session&lt;/p></pre></td></tr><tr><td data-num="3"></td><td><pre>	 * @param session</pre></td></tr><tr><td data-num="4"></td><td><pre>	 * @throws IOException</pre></td></tr><tr><td data-num="5"></td><td><pre>	 */</pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span><span class="token class-name">String</span> redirectUrl<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		session<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>		<span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>		mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"redirectUrl"</span><span class="token punctuation">,</span> redirectUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token keyword">return</span> mv<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>客户端：服务端的 session 无效后，同时应该及时清除客户端的 session，所以，需要有一个功能来实时监听服务端的 session 是否有效，如果无效，那么就及时清除客户端的 session，该功能可以通过拦截器来实现</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>fan<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>sso</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fan<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">HttpUtil</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebListener</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSession</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSessionEvent</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpSessionListener</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="12"></td><td><pre> * &lt;p>&lt;/p></pre></td></tr><tr><td data-num="13"></td><td><pre> *</pre></td></tr><tr><td data-num="14"></td><td><pre> */</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token annotation punctuation">@WebListener</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySessionListener</span> <span class="token keyword">implements</span> <span class="token class-name">HttpSessionListener</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionCreated</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> se<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionDestroyed</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> se<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> se<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token class-name">String</span> ticket <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"ticket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token comment">// 销毁用户信息</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token class-name">MockDb</span><span class="token punctuation">.</span>TICKET<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>ticket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token comment">// 这里应该有啥？sessionId 用于维护各个应用的 session，logoutUrl 用于各个应用的退出</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ClientInfo</span><span class="token punctuation">></span></span> clientInfos <span class="token operator">=</span> <span class="token class-name">MockDb</span><span class="token punctuation">.</span>CLIENT_TOKEN_SESSIONID<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>ticket<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ClientInfo</span> clientInfo <span class="token operator">:</span> clientInfos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token comment">// 遍历通知客户端销毁，调用客户端的 logout</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token class-name">HttpUtil</span><span class="token punctuation">.</span><span class="token function">sendHttpRequest</span><span class="token punctuation">(</span>clientInfo<span class="token punctuation">.</span><span class="token function">getLogoutUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> clientInfo<span class="token punctuation">.</span><span class="token function">getJsessionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>		session<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="cas"><a class="anchor" href="#cas">#</a> CAS</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYXBlcmVvLm9yZy9wcm9qZWN0cy9jYXM=">CAS</span> 全称为 Central Authentication Service 即中央认证服务，是一个企业多语言单点登录的解决方案，并努力去成为一个身份验证和授权需求的综合平台。CAS 是由 Yale 大学发起的一个企业级的、开源的项目，旨在为 Web 应用系统提供一种可靠的单点登录解决方法（属于 Web SSO ）。CAS 协议至少涉及三方：客户端 Web 浏览器，请求身份验证的 Web 应用程序和 CAS 服务器。 CAS 实现了单点登录，即解决了 cookie 在不同客户端之间无法跨域的问题（在 server 端存放了用户凭证的 cookie，即 TGC，然后各个客户端登陆时获取 server 获取该 cookie，如果该 cookie 存在，那么就证明该用户登录过，那么就不需要再次登录，前提是在一个浏览器下）。</p><p>CAS 源码：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwZXJlby9jYXM=">https://github.com/apereo/cas</span><br>CAS overlay 地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwZXJlby9jYXMtb3ZlcmxheS10ZW1wbGF0ZS5naXQ=">https://github.com/apereo/cas-overlay-template.git</span></p><h3 id="环境搭建"><a class="anchor" href="#环境搭建">#</a> 环境搭建</h3><ul><li>配置 application.properties</li></ul><figure class="highlight properties"><figcaption data-lang=".properties"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">##</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># CAS Server Context Configuration</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token attr-name">server.context-path</span><span class="token punctuation">=</span><span class="token attr-value">/cas</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8443</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#server.ssl.key-store=classpath:/thekeystore</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">#server.ssl.key-store-password=changeit</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">#server.ssl.key-password=changeit</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token attr-name">cas.tgc.secure</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token attr-name">cas.serviceRegistry.initFromJson</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="12"></td><td><pre>配置单点登出</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">#配置允许登出后跳转到指定页面</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token attr-name">cas.logout.followServiceRedirects</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">#跳转到指定页面需要的参数名为 service</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token attr-name">cas.logout.redirectParameter</span><span class="token punctuation">=</span><span class="token attr-value">service</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">#是否移除子系统的票据</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token attr-name">cas.logout.removeDescendantTickets</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token attr-name">cas.authn.rest.uri</span><span class="token punctuation">=</span><span class="token attr-value">https://sso.com:8443/cas/v1</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># ticket 过期设置</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token attr-name">cas.ticket.st.numberOfUses</span><span class="token punctuation">=</span><span class="token attr-value">1</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token attr-name">cas.ticket.st.timeToKillInSeconds</span><span class="token punctuation">=</span><span class="token attr-value">60</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token attr-name">server.max-http-header-size</span><span class="token punctuation">=</span><span class="token attr-value">2097152</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token attr-name">server.use-forward-headers</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token attr-name">server.connection-timeout</span><span class="token punctuation">=</span><span class="token attr-value">20000</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token attr-name">server.error.include-stacktrace</span><span class="token punctuation">=</span><span class="token attr-value">ALWAYS</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token attr-name">server.compression.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token attr-name">server.compression.mime-types</span><span class="token punctuation">=</span><span class="token attr-value">application/javascript,application/json,application/xml,text/html,text/xml,text/plain</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token attr-name">server.tomcat.max-http-post-size</span><span class="token punctuation">=</span><span class="token attr-value">2097152</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token attr-name">server.tomcat.basedir</span><span class="token punctuation">=</span><span class="token attr-value">build/tomcat</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token attr-name">server.tomcat.accesslog.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token attr-name">server.tomcat.accesslog.pattern</span><span class="token punctuation">=</span><span class="token attr-value">%t %a "%r" %s (%D ms)</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token attr-name">server.tomcat.accesslog.suffix</span><span class="token punctuation">=</span><span class="token attr-value">.log</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token attr-name">server.tomcat.min-spare-threads</span><span class="token punctuation">=</span><span class="token attr-value">10</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token attr-name">server.tomcat.max-threads</span><span class="token punctuation">=</span><span class="token attr-value">200</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token attr-name">server.tomcat.port-header</span><span class="token punctuation">=</span><span class="token attr-value">X-Forwarded-Port</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token attr-name">server.tomcat.protocol-header</span><span class="token punctuation">=</span><span class="token attr-value">X-Forwarded-Proto</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token attr-name">server.tomcat.protocol-header-https-value</span><span class="token punctuation">=</span><span class="token attr-value">https</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token attr-name">server.tomcat.remote-ip-header</span><span class="token punctuation">=</span><span class="token attr-value">X-FORWARDED-FOR</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token attr-name">server.tomcat.uri-encoding</span><span class="token punctuation">=</span><span class="token attr-value">UTF-8</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token attr-name">spring.http.encoding.charset</span><span class="token punctuation">=</span><span class="token attr-value">UTF-8</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token attr-name">spring.http.encoding.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token attr-name">spring.http.encoding.force</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token comment">##</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token comment"># CAS Cloud Bus Configuration</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token attr-name">spring.cloud.bus.enabled</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token comment"># Indicates that systemPropertiesOverride can be used.</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment"># Set to false to prevent users from changing the default accidentally. Default true.</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token attr-name">spring.cloud.config.allow-override</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token comment"># External properties should override system properties.</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token attr-name">spring.cloud.config.override-system-properties</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token comment"># When allowOverride is true, external properties should take lowest priority, and not override any</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment"># existing property sources (including local config files).</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token attr-name">spring.cloud.config.override-none</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token comment"># spring.cloud.bus.refresh.enabled=true</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token comment"># spring.cloud.bus.env.enabled=true</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token comment"># spring.cloud.bus.destination=CasCloudBus</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token comment"># spring.cloud.bus.ack.enabled=true</span></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token attr-name">endpoints.enabled</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token attr-name">endpoints.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="75"></td><td><pre></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token attr-name">endpoints.restart.enabled</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token attr-name">endpoints.shutdown.enabled</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token comment"># Control the security of the management/actuator endpoints</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token comment"># The 'enabled' flag below here controls the rendering of details for the health endpoint amongst other things.</span></pre></td></tr><tr><td data-num="81"></td><td><pre></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token attr-name">management.security.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token attr-name">management.security.roles</span><span class="token punctuation">=</span><span class="token attr-value">ACTUATOR,ADMIN</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token attr-name">management.security.sessions</span><span class="token punctuation">=</span><span class="token attr-value">if_required</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token attr-name">management.context-path</span><span class="token punctuation">=</span><span class="token attr-value">/status</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token attr-name">management.add-application-context-header</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="87"></td><td><pre></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token attr-name">security.basic.enabled</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="89"></td><td><pre></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token attr-name">cas.adminPagesSecurity.ip</span><span class="token punctuation">=</span><span class="token attr-value">.+</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.dashboard.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.dashboard.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.discovery.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.discovery.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="97"></td><td><pre></pre></td></tr><tr><td data-num="98"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.auditEvents.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.auditEvents.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="100"></td><td><pre></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.authenticationEvents.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.authenticationEvents.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="103"></td><td><pre></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.configurationState.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="105"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.configurationState.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="106"></td><td><pre></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.healthCheck.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="108"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.healthCheck.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="109"></td><td><pre></pre></td></tr><tr><td data-num="110"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.loggingConfig.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.loggingConfig.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="112"></td><td><pre></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.metrics.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.metrics.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="115"></td><td><pre></pre></td></tr><tr><td data-num="116"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.attributeResolution.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="117"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.attributeResolution.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="118"></td><td><pre></pre></td></tr><tr><td data-num="119"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.singleSignOnReport.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.singleSignOnReport.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="121"></td><td><pre></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.statistics.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="123"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.statistics.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="124"></td><td><pre></pre></td></tr><tr><td data-num="125"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.trustedDevices.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="126"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.trustedDevices.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="127"></td><td><pre></pre></td></tr><tr><td data-num="128"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.status.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="129"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.status.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="130"></td><td><pre></pre></td></tr><tr><td data-num="131"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.singleSignOnStatus.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="132"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.singleSignOnStatus.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="133"></td><td><pre></pre></td></tr><tr><td data-num="134"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.springWebflowReport.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="135"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.springWebflowReport.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="136"></td><td><pre></pre></td></tr><tr><td data-num="137"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.registeredServicesReport.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="138"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.registeredServicesReport.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="139"></td><td><pre></pre></td></tr><tr><td data-num="140"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.configurationMetadata.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true </span></pre></td></tr><tr><td data-num="141"></td><td><pre><span class="token attr-name">cas.monitor.endpoints.configurationMetadata.sensitive</span><span class="token punctuation">=</span><span class="token attr-value">false</span></pre></td></tr><tr><td data-num="142"></td><td><pre></pre></td></tr><tr><td data-num="143"></td><td><pre><span class="token comment"># Define a CAS-specific "WARN" status code and its order</span></pre></td></tr><tr><td data-num="144"></td><td><pre><span class="token attr-name">management.health.status.order</span><span class="token punctuation">=</span><span class="token attr-value">WARN, DOWN, OUT_OF_SERVICE, UNKNOWN, UP</span></pre></td></tr><tr><td data-num="145"></td><td><pre></pre></td></tr><tr><td data-num="146"></td><td><pre><span class="token comment"># Control the security of the management/actuator endpoints</span></pre></td></tr><tr><td data-num="147"></td><td><pre><span class="token comment"># With basic authentication, assuming Spring Security and/or relevant modules are on the classpath.</span></pre></td></tr><tr><td data-num="148"></td><td><pre><span class="token attr-name">security.basic.authorize-mode</span><span class="token punctuation">=</span><span class="token attr-value">role</span></pre></td></tr><tr><td data-num="149"></td><td><pre><span class="token attr-name">security.basic.path</span><span class="token punctuation">=</span><span class="token attr-value">/cas/status/**</span></pre></td></tr><tr><td data-num="150"></td><td><pre><span class="token comment"># security.basic.enabled=true</span></pre></td></tr><tr><td data-num="151"></td><td><pre><span class="token comment"># security.user.name=casuser</span></pre></td></tr><tr><td data-num="152"></td><td><pre><span class="token comment"># security.user.password=</span></pre></td></tr><tr><td data-num="153"></td><td><pre></pre></td></tr><tr><td data-num="154"></td><td><pre><span class="token comment">##</span></pre></td></tr><tr><td data-num="155"></td><td><pre><span class="token comment"># CAS Web Application Session Configuration</span></pre></td></tr><tr><td data-num="156"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="157"></td><td><pre><span class="token attr-name">server.session.timeout</span><span class="token punctuation">=</span><span class="token attr-value">300</span></pre></td></tr><tr><td data-num="158"></td><td><pre><span class="token attr-name">server.session.cookie.http-only</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="159"></td><td><pre><span class="token attr-name">server.session.tracking-modes</span><span class="token punctuation">=</span><span class="token attr-value">COOKIE</span></pre></td></tr><tr><td data-num="160"></td><td><pre></pre></td></tr><tr><td data-num="161"></td><td><pre><span class="token comment">##</span></pre></td></tr><tr><td data-num="162"></td><td><pre><span class="token comment"># CAS Thymeleaf View Configuration</span></pre></td></tr><tr><td data-num="163"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="164"></td><td><pre><span class="token attr-name">spring.thymeleaf.encoding</span><span class="token punctuation">=</span><span class="token attr-value">UTF-8</span></pre></td></tr><tr><td data-num="165"></td><td><pre><span class="token attr-name">spring.thymeleaf.cache</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="166"></td><td><pre><span class="token attr-name">spring.thymeleaf.mode</span><span class="token punctuation">=</span><span class="token attr-value">HTML</span></pre></td></tr><tr><td data-num="167"></td><td><pre><span class="token attr-name">spring.thymeleaf.template-resolver-order</span><span class="token punctuation">=</span><span class="token attr-value">100</span></pre></td></tr><tr><td data-num="168"></td><td><pre><span class="token comment">##</span></pre></td></tr><tr><td data-num="169"></td><td><pre><span class="token comment"># CAS Log4j Configuration</span></pre></td></tr><tr><td data-num="170"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="171"></td><td><pre><span class="token comment"># logging.config=file:/etc/cas/log4j2.xml</span></pre></td></tr><tr><td data-num="172"></td><td><pre><span class="token attr-name">server.context-parameters.isLog4jAutoInitializationDisabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="173"></td><td><pre></pre></td></tr><tr><td data-num="174"></td><td><pre><span class="token comment">##</span></pre></td></tr><tr><td data-num="175"></td><td><pre><span class="token comment"># CAS AspectJ Configuration</span></pre></td></tr><tr><td data-num="176"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="177"></td><td><pre><span class="token attr-name">spring.aop.auto</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="178"></td><td><pre><span class="token attr-name">spring.aop.proxy-target-class</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="179"></td><td><pre></pre></td></tr><tr><td data-num="180"></td><td><pre><span class="token comment">##</span></pre></td></tr><tr><td data-num="181"></td><td><pre><span class="token comment"># CAS Authentication Credentials</span></pre></td></tr><tr><td data-num="182"></td><td><pre><span class="token comment">#</span></pre></td></tr><tr><td data-num="183"></td><td><pre><span class="token comment">#cas.authn.accept.users=casuser::Mellon</span></pre></td></tr><tr><td data-num="184"></td><td><pre></pre></td></tr><tr><td data-num="185"></td><td><pre><span class="token comment">#添加 jdbc 认证</span></pre></td></tr><tr><td data-num="186"></td><td><pre><span class="token attr-name">cas.authn.jdbc.query[0].sql</span><span class="token punctuation">=</span><span class="token attr-value">SELECT * FROM sys_user WHERE username =?</span></pre></td></tr><tr><td data-num="187"></td><td><pre><span class="token comment">#那一个字段作为密码字段</span></pre></td></tr><tr><td data-num="188"></td><td><pre><span class="token attr-name">cas.authn.jdbc.query[0].fieldPassword</span><span class="token punctuation">=</span><span class="token attr-value">password</span></pre></td></tr><tr><td data-num="189"></td><td><pre><span class="token comment">#配置数据库连接</span></pre></td></tr><tr><td data-num="190"></td><td><pre><span class="token attr-name">cas.authn.jdbc.query[0].url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/db_shiro?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;useSSL=false&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num="191"></td><td><pre><span class="token attr-name">cas.authn.jdbc.query[0].dialect</span><span class="token punctuation">=</span><span class="token attr-value">org.hibernate.dialect.MySQLDialect</span></pre></td></tr><tr><td data-num="192"></td><td><pre><span class="token comment">#数据库用户名</span></pre></td></tr><tr><td data-num="193"></td><td><pre><span class="token attr-name">cas.authn.jdbc.query[0].user</span><span class="token punctuation">=</span><span class="token attr-value">root</span></pre></td></tr><tr><td data-num="194"></td><td><pre><span class="token comment">#数据库密码</span></pre></td></tr><tr><td data-num="195"></td><td><pre><span class="token attr-name">cas.authn.jdbc.query[0].password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span></pre></td></tr><tr><td data-num="196"></td><td><pre><span class="token comment">#mysql 驱动</span></pre></td></tr><tr><td data-num="197"></td><td><pre><span class="token attr-name">cas.authn.jdbc.query[0].driverClass</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span></pre></td></tr><tr><td data-num="198"></td><td><pre></pre></td></tr><tr><td data-num="199"></td><td><pre></pre></td></tr><tr><td data-num="200"></td><td><pre><span class="token comment">#配置加密策略</span></pre></td></tr><tr><td data-num="201"></td><td><pre><span class="token attr-name">cas.authn.jdbc.query[0].passwordEncoder.type</span><span class="token punctuation">=</span><span class="token attr-value">DEFAULT</span></pre></td></tr><tr><td data-num="202"></td><td><pre><span class="token attr-name">cas.authn.jdbc.query[0].passwordEncoder.characterEncoding</span><span class="token punctuation">=</span><span class="token attr-value">UTF-8</span></pre></td></tr><tr><td data-num="203"></td><td><pre><span class="token attr-name">cas.authn.jdbc.query[0].passwordEncoder.encodingAlgorithm</span><span class="token punctuation">=</span><span class="token attr-value">MD5</span></pre></td></tr><tr><td data-num="204"></td><td><pre></pre></td></tr><tr><td data-num="205"></td><td><pre><span class="token comment">#加密迭代次数</span></pre></td></tr><tr><td data-num="206"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].numberOfIterations</span><span class="token punctuation">=</span><span class="token attr-value">1</span></pre></td></tr><tr><td data-num="207"></td><td><pre><span class="token comment">#该列名的值可替代上面的值，但对密码加密时必须取该值进行处理</span></pre></td></tr><tr><td data-num="208"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].numberOfIterationsFieldName</span><span class="token punctuation">=</span></pre></td></tr><tr><td data-num="209"></td><td><pre><span class="token comment">#盐值固定列</span></pre></td></tr><tr><td data-num="210"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].saltFieldName</span><span class="token punctuation">=</span><span class="token attr-value">secretkey</span></pre></td></tr><tr><td data-num="211"></td><td><pre><span class="token comment">#静态盐值</span></pre></td></tr><tr><td data-num="212"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].staticSalt</span><span class="token punctuation">=</span></pre></td></tr><tr><td data-num="213"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].sql</span><span class="token punctuation">=</span><span class="token attr-value">SELECT * FROM sys_user WHERE username =?</span></pre></td></tr><tr><td data-num="214"></td><td><pre><span class="token comment">#对处理盐值后的算法</span></pre></td></tr><tr><td data-num="215"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].algorithmName</span><span class="token punctuation">=</span><span class="token attr-value">MD5</span></pre></td></tr><tr><td data-num="216"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].passwordFieldName</span><span class="token punctuation">=</span><span class="token attr-value">password</span></pre></td></tr><tr><td data-num="217"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].expiredFieldName</span><span class="token punctuation">=</span><span class="token attr-value">expired</span></pre></td></tr><tr><td data-num="218"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].disabledFieldName</span><span class="token punctuation">=</span><span class="token attr-value">disabled</span></pre></td></tr><tr><td data-num="219"></td><td><pre><span class="token comment">#数据库连接</span></pre></td></tr><tr><td data-num="220"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://127.0.0.1:3306/db_shiro?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;useSSL=false&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num="221"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].dialect</span><span class="token punctuation">=</span><span class="token attr-value">org.hibernate.dialect.MySQL5Dialect</span></pre></td></tr><tr><td data-num="222"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].driverClass</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.cj.jdbc.Driver</span></pre></td></tr><tr><td data-num="223"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].user</span><span class="token punctuation">=</span><span class="token attr-value">root</span></pre></td></tr><tr><td data-num="224"></td><td><pre><span class="token attr-name">cas.authn.jdbc.encode[0].password</span><span class="token punctuation">=</span><span class="token attr-value">admin</span></pre></td></tr></table></figure><ul><li><p>开启 http 支持</p><p>resource 下新建 services 复制 HTTPSandIMAPS-10000001.json</p></li></ul><p>应用服务器需要启用 https 支持，利用 jdk 自带的 keytool 生成证书，导入证书：</p><p>1、keytool -genkey -keyalg RSA -alias thekeystore -keystore thekeystore -storepass changeit -validity 360 -keysize 2048</p><p>2、keytool -export -alias thekeystore -file thekeystore.crt -keystore thekeystore</p><p>3、keytool -import -alias thekeystore -storepass changeit -file thekeystore.crt -keystore &quot;C:\Program Files\Java\jdk1.8.0_221\jre\lib\security\cacerts&quot;</p><p>4、keytool -import -alias thekeystore -storepass changeit -file thekeystore.crt -keystore &quot;C:\Program Files\Java\jre1.8.0_221\lib\security\cacerts&quot;</p><h3 id="原理"><a class="anchor" href="#原理">#</a> 原理</h3><ul><li><p>TGT</p><p>TGT 是 CAS 为用户签发的登录票据，拥有了 TGT，用户就可以证明自己在 CAS 成功登录过。TGT 封装了 Cookie 值以及此 Cookie 值对应的用户信息。用户在 CAS 认证成功后，CAS 生成 cookie，写入浏览器，同时生成一个 TGT 对象，放入自己的缓存，TGT 对象的 ID 就是 cookie 的值。当 HTTP 再次请求到来时，如果传过来的有 CAS 生成的 cookie，则 CAS 以此 cookie 值为 key 查询缓存中有无 TGT ，如果有的话，则说明用户之前登录过，如果没有，则用户需要重新登录。</p></li><li><p>TGC</p><p>存放用户身份认证凭证的 cookie，在浏览器和 CAS Server 间通讯时使用，并且只能基于安全通道传输（Https），是 CAS Server 用来明确用户身份的凭证。</p></li><li><p>ST</p><p>ST（可以是 cookie、token、ticket 等凭证）是 CAS 为用户签发的访问某一 service（应用客户端）的票据。用户访问 service 时，service 发现用户没有 ST，则要求用户去 CAS 获取 ST。用户向 CAS 发出获取 ST 的请求，如果用户的请求中包含 cookie，则 CAS 会以此 cookie 值为 key 查询缓存中有无 TGT，如果存在 TGT，则用此 TGT 签发一个 ST，返回给用户。用户凭借 ST 去访问 service，service 拿 ST 去 CAS 验证，验证通过后，允许用户访问资源。</p><p>从以下流程图可以看出，用户登录经过 CAS 服务端认证后，CAS 服务端会给浏览器设置一个 TGC（cookie，即 CAS 颁发的 ST，包含了用户登录的信息，用于维护浏览器于服务器之间的状态），同时生成一个 ticket，然后浏览器带着该 ticket 向应用客户端发送请求，客户端通过验证后给浏览器设置一个 cookie（JSESSIONID），用于维持客户端于浏览器之间的状态。当再次有用户在同一个浏览器去访问应用客户端时，会拿着服务端先前在浏览器中设置的 TGC 去服务端验证，如果验证成功，那么就直接登录成功，不用二次登录。</p></li></ul><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/cas_flow_jwt_diagram.png" alt=""></p><h2 id="vuespringboot分层开发"><a class="anchor" href="#vuespringboot分层开发">#</a> vue+springboot 分层开发</h2><h3 id="springboot"><a class="anchor" href="#springboot">#</a> SpringBoot</h3><ol><li><p>解决跨域</p></li><li><p>token 维护 session 状态</p><ol><li>存库</li><li>redis</li></ol></li><li><p>验证码保存</p></li></ol><h3 id="vue"><a class="anchor" href="#vue">#</a> Vue</h3><ol><li><p>路由拦截</p><p>beforeEnter 中判断是否本地 cookie、是否有 token，有放行，没有跳转到登录页面</p><pre><code class="language-vue">beforeEnter (to, from, next) &#123;
    let token = Vue.cookie.get('token')
    if (!token || !/\S/.test(token)) &#123;
      clearLoginInfo()
      next(&#123; name: 'login' &#125;)
    &#125;
    next()
  &#125;
</code></pre></li><li><p>vuex 拦截器</p><p>每个请求过滤都添加 token</p><pre><code class="language-vue">/**
 * 请求拦截
 */
http.interceptors.request.use(config =&gt; &#123;
  config.headers['token'] = Vue.cookie.get('token') // 请求头带上token
  return config
&#125;, error =&gt; &#123;
  return Promise.reject(error)
&#125;)
</code></pre></li><li><p>登录页面</p><p>收集信息，提交表单，设置 cookie，跳转</p><pre><code class="language-vue">methods: &#123;
      // 提交表单
      dataFormSubmit () &#123;
        this.$refs['dataForm'].validate((valid) =&gt; &#123;
          if (valid) &#123;
            this.$http(&#123;
              url: this.$http.adornUrl('/sys/login'),
              method: 'post',
              data: this.$http.adornData(&#123;
                'username': this.dataForm.userName,
                'password': this.dataForm.password,
                'uuid': this.dataForm.uuid,
                'captcha': this.dataForm.captcha
              &#125;)
            &#125;).then((&#123;data&#125;) =&gt; &#123;
              if (data &amp;&amp; data.code === 0) &#123;
                this.$cookie.set('token', data.token)
                //一般不这么跳转--哪里来，那里去
                this.$router.replace(&#123; name: 'home' &#125;)
              &#125; else &#123;
                this.getCaptcha()
                this.$message.error(data.info)
              &#125;
            &#125;)
          &#125;
        &#125;)
      &#125;,
      // 获取验证码
      getCaptcha () &#123;
        this.dataForm.uuid = getUUID()
        this.captchaPath = this.$http.adornUrl(`/captcha.jpg?uuid=$&#123;this.dataForm.uuid&#125;`)
      &#125;
    &#125;
</code></pre></li><li><p>退出</p><p>清除本地 cookie</p></li></ol><h3 id="shiro"><a class="anchor" href="#shiro">#</a> shiro</h3><ol><li><p>固定的配置</p></li><li><p>自己实现 realm</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>fan<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>shiro</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>mgt<span class="token punctuation">.</span></span><span class="token class-name">SecurityManager</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>session<span class="token punctuation">.</span>mgt<span class="token punctuation">.</span></span><span class="token class-name">SessionManager</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">LifecycleBeanPostProcessor</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>security<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">AuthorizationAttributeSourceAdvisor</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>web<span class="token punctuation">.</span>mgt<span class="token punctuation">.</span></span><span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>web<span class="token punctuation">.</span>session<span class="token punctuation">.</span>mgt<span class="token punctuation">.</span></span><span class="token class-name">DefaultWebSessionManager</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>autoproxy<span class="token punctuation">.</span></span><span class="token class-name">DefaultAdvisorAutoProxyCreator</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">Filter</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">LinkedHashMap</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="20"></td><td><pre> * Shiro 配置</pre></td></tr><tr><td data-num="21"></td><td><pre> *</pre></td></tr><tr><td data-num="22"></td><td><pre> * @author 孙志强</pre></td></tr><tr><td data-num="23"></td><td><pre> * @date 2017-04-20 18:33</pre></td></tr><tr><td data-num="24"></td><td><pre> */</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"sessionManager"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">SessionManager</span> <span class="token function">sessionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token class-name">DefaultWebSessionManager</span> sessionManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSessionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        sessionManager<span class="token punctuation">.</span><span class="token function">setSessionValidationSchedulerEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        sessionManager<span class="token punctuation">.</span><span class="token function">setSessionIdCookieEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">return</span> sessionManager<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"securityManager"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">SecurityManager</span> <span class="token function">securityManager</span><span class="token punctuation">(</span><span class="token class-name">OAuth2Realm</span> oAuth2Realm<span class="token punctuation">,</span> <span class="token class-name">SessionManager</span> sessionManager<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token class-name">DefaultWebSecurityManager</span> securityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        securityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>oAuth2Realm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自己扩展 realm</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        securityManager<span class="token punctuation">.</span><span class="token function">setSessionManager</span><span class="token punctuation">(</span>sessionManager<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">return</span> securityManager<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"shiroFilter"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">ShiroFilterFactoryBean</span> <span class="token function">shirFilter</span><span class="token punctuation">(</span><span class="token class-name">SecurityManager</span> securityManager<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token class-name">ShiroFilterFactoryBean</span> shiroFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        shiroFilter<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>securityManager<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token comment">//oauth 过滤</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Filter</span><span class="token punctuation">></span></span> filters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        filters<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"oauth2"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2Filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自己扩展 filter</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        shiroFilter<span class="token punctuation">.</span><span class="token function">setFilters</span><span class="token punctuation">(</span>filters<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> filterMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/webjars/**"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/druid/**"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/app/**"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/sys/login"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/swagger/**"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/v2/api-docs"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/swagger-ui.html"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/swagger-resources/**"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/captcha.jpg"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/ueditor/**"</span><span class="token punctuation">,</span> <span class="token string">"anon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        filterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">,</span> <span class="token string">"oauth2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        shiroFilter<span class="token punctuation">.</span><span class="token function">setFilterChainDefinitionMap</span><span class="token punctuation">(</span>filterMap<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token keyword">return</span> shiroFilter<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"lifecycleBeanPostProcessor"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">LifecycleBeanPostProcessor</span> <span class="token function">lifecycleBeanPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LifecycleBeanPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">DefaultAdvisorAutoProxyCreator</span> <span class="token function">defaultAdvisorAutoProxyCreator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>        <span class="token class-name">DefaultAdvisorAutoProxyCreator</span> proxyCreator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAdvisorAutoProxyCreator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        proxyCreator<span class="token punctuation">.</span><span class="token function">setProxyTargetClass</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>        <span class="token keyword">return</span> proxyCreator<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="83"></td><td><pre></pre></td></tr><tr><td data-num="84"></td><td><pre>    <span class="token comment">// 解析 shiro 权限注解</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">AuthorizationAttributeSourceAdvisor</span> <span class="token function">authorizationAttributeSourceAdvisor</span><span class="token punctuation">(</span><span class="token class-name">SecurityManager</span> securityManager<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>        <span class="token class-name">AuthorizationAttributeSourceAdvisor</span> advisor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthorizationAttributeSourceAdvisor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>        advisor<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>securityManager<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token keyword">return</span> advisor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>权限码的缓存（使用 redis）</p></li><li><p>session 的分布式管理（使用 redis）</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"sessionDAO"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">SessionDAO</span> <span class="token function">sessionDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">RedisSessionDAO</span> redisSessionDAO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisSessionDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        redisSessionDAO<span class="token punctuation">.</span><span class="token function">setRedisManager</span><span class="token punctuation">(</span><span class="token function">redisManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">//session 在 redis 中的保存时间，最好大于 session 会话超时时间</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        redisSessionDAO<span class="token punctuation">.</span><span class="token function">setExpire</span><span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> redisSessionDAO<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ol><h2 id="gwt"><a class="anchor" href="#gwt">#</a> GWT</h2><h3 id="传统的session认证过程"><a class="anchor" href="#传统的session认证过程">#</a> 传统的 session 认证过程</h3><p><span class="exturl" data-url="aHR0cHM6Ly9hdXRoMC5jb20vYmxvZy9jcml0aWNhbC12dWxuZXJhYmlsaXRpZXMtaW4tanNvbi13ZWItdG9rZW4tbGlicmFyaWVzLyNNZWV0LXRoZS0tTm9uZS0tQWxnb3JpdGht">参考</span></p><ol><li>浏览器第一次访问，服务器返回 sessionId</li><li>浏览器存储 sessionId 为 cookie</li><li>用户没发起一次请求就携带 cookie 去服务器（tomcat 内存）查找 session，服务器有状态</li></ol><p>问题：session 占用内存且不好扩展，每次对服务器请求，服务器压力较大</p><h3 id="jwt"><a class="anchor" href="#jwt">#</a> JWT</h3><ol><li>能承载信息，如 session、用户信息等，并且信息被加密，无法篡改</li><li>服务器无状态，开发人员无需对 session 进行管理</li></ol><h3 id="jwt组成"><a class="anchor" href="#jwt组成">#</a> JWT 组成</h3><ol><li><p>标头（header）：用于生成签名的算法</p><pre><code>header = '&#123;&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;&#125;'
</code></pre></li><li><p>有效负载（payload）: 包含我们提出的声明</p><pre><code>payload = '&#123;&quot;loggedInAs&quot;:&quot;admin&quot;,&quot;iat&quot;:1422779638&#125;'
</code></pre><p>iat：过期时间</p></li><li><p>签名（signature）: 签名的计算方式是标头和有效负载的 base64，并将它们与句点作为分隔符串联</p><pre><code>key = 'secretkey'
unsignedToken = encodeBase64(header) + '.' + encodeBase64(payload)
signature = HMAC-SHA256(key, unsignedToken)
</code></pre><p>整个 JWT 就是以上三者的组成</p><pre><code>token = encodeBase64(header) + '.' + encodeBase64(payload) + '.' + encodeBase64(signature)
</code></pre></li></ol><h2 id="oauth"><a class="anchor" href="#oauth">#</a> OAuth</h2><p>OAuth 是访问委派的开放网络标准，通常用于互联网用户授予网站或应用程序访问其信息在其他网站上，但不给他们密码的一种方式。如使用第三方登录（微信、qq、微博）。</p><p>参考：</p><p>RFC7379：<span class="exturl" data-url="aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzY3NDk=">https://tools.ietf.org/html/rfc6749</span></p><p>微信公众平台：<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vZG9jL29wbGF0Zm9ybS9XZWJzaXRlX0FwcC9XZUNoYXRfTG9naW4vV2VjaGF0X0xvZ2luLmh0bWw=">https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html</span></p><p>阮一峰：<span class="exturl" data-url="aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTkvMDQvb2F1dGhfZGVzaWduLmh0bWw=">http://www.ruanyifeng.com/blog/2019/04/oauth_design.html</span></p><h3 id="名词解释"><a class="anchor" href="#名词解释">#</a> 名词解释</h3><p>clientId：应用的编号</p><p>code：第三方返回给应用的临时票据</p><p>scope：允许第三方登录后访问的数据范围</p><p>state：防止 CSRF 攻击</p><h3 id="登录过程"><a class="anchor" href="#登录过程">#</a> 登录过程</h3><p>如使用微博登录 gitee</p><ol><li>请求使用第三方（微博）登录，gitee 返回微博链接、clientId 等信息</li><li>输入微博账号密码，需要传参 clientId、callback、code</li><li>点击登录后，gitee 返回授权码 code，code 有效期十分钟且只能使用一次</li><li>gitee 使用授权码去微博换取 token 得到微博用户信息</li></ol><div class="tags"><a href="/tags/Java/" rel="tag"><i class="ic i-tag"></i> Java</a> <a href="/tags/Shiro/" rel="tag"><i class="ic i-tag"></i> Shiro</a> <a href="/tags/%E6%9D%83%E9%99%90/" rel="tag"><i class="ic i-tag"></i> 权限</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-12-24 11:31:36" itemprop="dateModified" datetime="2021-12-24T11:31:36+08:00">2021-12-24</time> </span><span id="/单点登录" class="item leancloud_visitors" data-flag-title="单点登录" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="fanfanfan 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="fanfanfan 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="fanfanfan PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>fanfanfan <i class="ic i-at"><em>@</em></i>书院十四先生</li><li class="link"><strong>本文链接：</strong> <a href="https://baiyezi.vip/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95" title="单点登录">https://baiyezi.vip/单点登录</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/shiro%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E7%99%BB%E5%BD%95" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;bfanfanfan&#x2F;img&#x2F;raw&#x2F;master&#x2F;guzhuang&#x2F;20211225105419.jpg" title="shiro的缓存机制与分布式登录"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Java</span><h3>shiro的缓存机制与分布式登录</h3></a></div><div class="item right"><a href="/%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;bfanfanfan&#x2F;img&#x2F;raw&#x2F;master&#x2F;guzhuang&#x2F;20211225104957.png" title="线程基础知识"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Java</span><h3>线程基础知识</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">单点登录原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">单点登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%87%BA"><span class="toc-number">1.2.</span> <span class="toc-text">单点登出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cas"><span class="toc-number">2.</span> <span class="toc-text">CAS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.1.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vuespringboot%E5%88%86%E5%B1%82%E5%BC%80%E5%8F%91"><span class="toc-number">3.</span> <span class="toc-text">vue+springboot 分层开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot"><span class="toc-number">3.1.</span> <span class="toc-text">SpringBoot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vue"><span class="toc-number">3.2.</span> <span class="toc-text">Vue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shiro"><span class="toc-number">3.3.</span> <span class="toc-text">shiro</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gwt"><span class="toc-number">4.</span> <span class="toc-text">GWT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E7%9A%84session%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">传统的 session 认证过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jwt"><span class="toc-number">4.2.</span> <span class="toc-text">JWT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jwt%E7%BB%84%E6%88%90"><span class="toc-number">4.3.</span> <span class="toc-text">JWT 组成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#oauth"><span class="toc-number">5.</span> <span class="toc-text">OAuth</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">5.1.</span> <span class="toc-text">名词解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%BF%87%E7%A8%8B"><span class="toc-number">5.2.</span> <span class="toc-text">登录过程</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/Linux%E4%B8%8B%E5%AE%89%E8%A3%85MySQL" rel="bookmark" title="Linux下安装MySQL">Linux下安装MySQL</a></li><li><a href="/MySQL%E5%9F%BA%E7%A1%80" rel="bookmark" title="MySQL基础">MySQL基础</a></li><li><a href="/IOC%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F%EF%BC%88%E4%B8%80%EF%BC%89" rel="bookmark" title="IOC配置方式（一）">IOC配置方式（一）</a></li><li><a href="/IOC%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F%EF%BC%88%E4%BA%8C%EF%BC%89" rel="bookmark" title="IOC配置方式（二）">IOC配置方式（二）</a></li><li><a href="/IOC%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F" rel="bookmark" title="IOC注解方式">IOC注解方式</a></li><li><a href="/AOP" rel="bookmark" title="AOP">AOP</a></li><li><a href="/SpringBoot%E5%85%A5%E9%97%A8" rel="bookmark" title="SpringBoot入门">SpringBoot入门</a></li><li><a href="/SpringBoot-Web%E5%BC%80%E5%8F%91" rel="bookmark" title="SpringBoot-Web开发">SpringBoot-Web开发</a></li><li><a href="/SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86" rel="bookmark" title="SpringBoot自动装配原理">SpringBoot自动装配原理</a></li><li><a href="/zookeeper%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" rel="bookmark" title="zookeeper搭建及基本概念">zookeeper搭建及基本概念</a></li><li><a href="/zookeeper%E5%8E%9F%E7%90%86" rel="bookmark" title="zookeeper原理">zookeeper原理</a></li><li><a href="/zookeeper%E6%A1%88%E4%BE%8B" rel="bookmark" title="zookeeper案例">zookeeper案例</a></li><li><a href="/MySQL%E8%B0%83%E4%BC%98%EF%BC%88%E4%B8%80%EF%BC%89" rel="bookmark" title="MySQL调优（一）">MySQL调优（一）</a></li><li><a href="/redis%E5%AE%89%E8%A3%85%E5%8F%8ANIO%E5%8E%9F%E7%90%86" rel="bookmark" title="redis安装及NIO原理">redis安装及NIO原理</a></li><li><a href="/SpringMVC%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89" rel="bookmark" title="SpringMVC入门（一）">SpringMVC入门（一）</a></li><li><a href="/SpringMVC%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89" rel="bookmark" title="SpringMVC入门（二）">SpringMVC入门（二）</a></li><li><a href="/SpringMVC-REST%E9%A3%8E%E6%A0%BC" rel="bookmark" title="SpringMVC-REST风格">SpringMVC-REST风格</a></li><li><a href="/SpringMVC%E8%BF%9B%E9%98%B6" rel="bookmark" title="SpringMVC进阶">SpringMVC进阶</a></li><li><a href="/SpringMVC%E6%BA%90%E7%A0%81%E6%80%BB%E7%BB%93" rel="bookmark" title="SpringMVC源码总结">SpringMVC源码总结</a></li><li><a href="/shiro%E5%85%A5%E9%97%A8" rel="bookmark" title="shiro入门">shiro入门</a></li><li><a href="/shiro%E6%95%B4%E5%90%88SpringBoot" rel="bookmark" title="shiro整合SpringBoot">shiro整合SpringBoot</a></li><li><a href="/shiro%E7%9A%84session%E7%AE%A1%E7%90%86" rel="bookmark" title="shiro的session管理">shiro的session管理</a></li><li><a href="/shiro%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E7%99%BB%E5%BD%95" rel="bookmark" title="shiro的缓存机制与分布式登录">shiro的缓存机制与分布式登录</a></li><li class="active"><a href="/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95" rel="bookmark" title="单点登录">单点登录</a></li><li><a href="/%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86" rel="bookmark" title="线程基础知识">线程基础知识</a></li><li><a href="/%E5%AE%B9%E5%99%A8%E4%B8%8E%E7%BA%BF%E7%A8%8B%E6%B1%A0" rel="bookmark" title="容器与线程池">容器与线程池</a></li><li><a href="/Win10%E5%AE%89%E8%A3%85docker" rel="bookmark" title="Win10安装docker">Win10安装docker</a></li><li><a href="/Win10%E5%AE%89%E8%A3%85docker" rel="bookmark" title="Win10安装docker">Win10安装docker</a></li><li><a href="/JMH" rel="bookmark" title="JMH">JMH</a></li><li><a href="/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B" rel="bookmark" title="并发编程">并发编程</a></li><li><a href="/java-%E6%97%A5%E5%BF%97%E4%BD%93%E7%B3%BB" rel="bookmark" title="java-日志体系">java-日志体系</a></li><li><a href="/redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" rel="bookmark" title="redis的数据类型">redis的数据类型</a></li><li><a href="/redis%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8" rel="bookmark" title="redis进阶使用">redis进阶使用</a></li><li><a href="/redis%E7%9A%84%E9%9B%86%E7%BE%A4" rel="bookmark" title="redis的集群">redis的集群</a></li><li><a href="/redis%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8" rel="bookmark" title="redis在开发中的简单使用">redis在开发中的简单使用</a></li><li><a href="/ChainOfResponsibility%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F" rel="bookmark" title="ChainOfResponsibility责任链模式">ChainOfResponsibility责任链模式</a></li><li><a href="/Composite%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Composite组合模式">Composite组合模式</a></li><li><a href="/Decorator%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Decorator装饰器模式">Decorator装饰器模式</a></li><li><a href="/Facade%E9%97%A8%E9%9D%A2%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Facade门面模式">Facade门面模式</a></li><li><a href="/Factory%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Factory工厂模式">Factory工厂模式</a></li><li><a href="/Flyweight%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Flyweight享元模式">Flyweight享元模式</a></li><li><a href="/Iterator%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Iterator迭代器模式">Iterator迭代器模式</a></li><li><a href="/Mediator%E8%B0%83%E5%81%9C%E8%80%85%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Mediator调停者模式">Mediator调停者模式</a></li><li><a href="/Observer%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Observer观察者模式">Observer观察者模式</a></li><li><a href="/Proxy%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Proxy代理模式">Proxy代理模式</a></li><li><a href="/Singleton%E5%8D%95%E4%BE%8B" rel="bookmark" title="Singleton单例">Singleton单例</a></li><li><a href="/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BB%A5%E5%8F%8A%E6%9E%B6%E6%9E%84%E5%8F%91%E5%B1%95" rel="bookmark" title="微服务以及架构发展">微服务以及架构发展</a></li><li><a href="/JVM-%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD" rel="bookmark" title="JVM-类的加载">JVM-类的加载</a></li><li><a href="/SpringCloud-Netflix%E4%BD%93%E7%B3%BB" rel="bookmark" title="SpringCloud-Netflix体系">SpringCloud-Netflix体系</a></li><li><a href="/%E5%BA%8F%E5%88%97%E5%8C%96" rel="bookmark" title="序列化">序列化</a></li><li><a href="/JVM-JMM" rel="bookmark" title="JVM-JMM">JVM-JMM</a></li><li><a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84" rel="bookmark" title="分布式系统与高并发系统架构">分布式系统与高并发系统架构</a></li><li><a href="/JVM-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA" rel="bookmark" title="JVM-对象的创建">JVM-对象的创建</a></li><li><a href="/JVM-JVM%E8%B0%83%E4%BC%98" rel="bookmark" title="JVM-JVM调优">JVM-JVM调优</a></li><li><a href="/JVM-GC" rel="bookmark" title="JVM-GC">JVM-GC</a></li><li><a href="/SpringCloud-Alibaba%E4%BD%93%E7%B3%BB" rel="bookmark" title="SpringCloud-Alibaba体系">SpringCloud-Alibaba体系</a></li><li><a href="/SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB" rel="bookmark" title="SpringCloud-SpringCloud体系">SpringCloud-SpringCloud体系</a></li><li><a href="/Apollo" rel="bookmark" title="Apollo">Apollo</a></li><li><a href="/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89" rel="bookmark" title="微服务中的会话管理（一）">微服务中的会话管理（一）</a></li><li><a href="/%E7%A3%81%E7%9B%98IO%E4%B8%8E%E7%BD%91%E7%BB%9CIO" rel="bookmark" title="磁盘IO与网络IO">磁盘IO与网络IO</a></li><li><a href="/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89" rel="bookmark" title="微服务中的会话管理（二）">微服务中的会话管理（二）</a></li><li><a href="/HTTPS" rel="bookmark" title="HTTPS">HTTPS</a></li><li><a href="/RocketMQ-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5" rel="bookmark" title="RocketMQ-基础概念">RocketMQ-基础概念</a></li><li><a href="/RocketMQ-%E6%B6%88%E6%81%AF%E3%80%81%E4%BA%8B%E5%8A%A1" rel="bookmark" title="RocketMQ-消息、事务">RocketMQ-消息、事务</a></li><li><a href="/Kafka-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84" rel="bookmark" title="Kafka-整体架构">Kafka-整体架构</a></li><li><a href="/%E7%BD%91%E7%BB%9CIO%E6%A8%A1%E5%9E%8B" rel="bookmark" title="网络IO模型">网络IO模型</a></li><li><a href="/Kafka-%E6%90%AD%E5%BB%BA" rel="bookmark" title="Kafka-搭建">Kafka-搭建</a></li><li><a href="/Netty" rel="bookmark" title="Netty">Netty</a></li><li><a href="/nginx%E5%AE%9E%E6%88%98" rel="bookmark" title="nginx实战">nginx实战</a></li><li><a href="/Java%E5%92%8C%E4%B8%B2%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1" rel="bookmark" title="Java和串口进行通信">Java和串口进行通信</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="fanfanfan" data-src="/images/avatar.png"><p class="name" itemprop="name">fanfanfan</p><div class="description" itemprop="description">花有重开日，人无再少年</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">76</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">4</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">78</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item CSDN" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDY2MDQwOA==" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_40660408"><i class="ic i-csdn"></i></span> <span class="exturl item Gitee" data-url="aHR0cHM6Ly9naXRlZS5jb20vYmZhbmZhbmZhbg==" title="https:&#x2F;&#x2F;gitee.com&#x2F;bfanfanfan"><i class="ic i-gitee"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-magic"></i>友链</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/shiro%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E7%99%BB%E5%BD%95" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/big-data/" title="分类于 大数据">大数据</a></div><span><a href="/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%B5%8B%E8%AF%95" title="大数据测试">大数据测试</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/Factory%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F" title="Factory工厂模式">Factory工厂模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/SpringMVC%E6%BA%90%E7%A0%81%E6%80%BB%E7%BB%93" title="SpringMVC源码总结">SpringMVC源码总结</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/Mediator%E8%B0%83%E5%81%9C%E8%80%85%E6%A8%A1%E5%BC%8F" title="Mediator调停者模式">Mediator调停者模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a> <i class="ic i-angle-right"></i> <a href="/categories/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" title="分类于 微服务">微服务</a></div><span><a href="/SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB" title="SpringCloud-SpringCloud体系">SpringCloud-SpringCloud体系</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/JVM-JMM" title="JVM-JMM">JVM-JMM</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/Win10%E5%AE%89%E8%A3%85docker" title="Win10安装docker">Win10安装docker</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/shiro%E6%95%B4%E5%90%88SpringBoot" title="shiro整合SpringBoot">shiro整合SpringBoot</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/Singleton%E5%8D%95%E4%BE%8B" title="Singleton单例">Singleton单例</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/Observer%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F" title="Observer观察者模式">Observer观察者模式</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">fanfanfan @ 书院十四先生</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.3m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">20:23</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"/单点登录",favicon:{show:"书院十四先生",hide:"书院十四先生"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->