<!-- build time:Tue Dec 28 2021 00:00:46 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN,en,default"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://baiyezi.vip/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://baiyezi.vip/atom.xml"><link rel="alternate" type="application/json" href="https://baiyezi.vip/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Java,数据库,MySQL"><link rel="canonical" href="https://baiyezi.vip/java/MySQL/MySQL%E8%B0%83%E4%BC%98%EF%BC%88%E4%B8%80%EF%BC%89/"><title>MySQL调优（一） - Java |</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">MySQL调优（一）</h1><div class="meta"><span class="item" title="创建时间：2021-01-25 21:15:12"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-01-25T21:15:12+08:00">2021-01-25</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>65k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>59 分钟</span> </span><span id="java/MySQL/MySQL调优（一）/" class="item leancloud_visitors" data-flag-title="" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start"></a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105420.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105422.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225104957.png"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105418.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105419.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105421.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/java/" itemprop="item" rel="index" title="分类于 Java"><span itemprop="name">Java</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://baiyezi.vip/java/MySQL/MySQL%E8%B0%83%E4%BC%98%EF%BC%88%E4%B8%80%EF%BC%89/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="fanfanfan"><meta itemprop="description" content=", 花有重开日，人无再少年"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><h2 id="mysql构成"><a class="anchor" href="#mysql构成">#</a> MySQL 构成</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cucHJvY2Vzc29uLmNvbS92aWV3L2xpbmsvNWZjNTBhNmNlNDAxZmQwZWI5OGEzMzcz">在线查看</span></p><blockquote><p>[!tip]</p><p>操作系统：CentOS8</p><p>MySQL 版本：MySQL5.7</p></blockquote><h2 id="profiling"><a class="anchor" href="#profiling">#</a> profiling</h2><p>创建数据库、表并插入数据</p><pre><code class="language-mysql">mysql&gt; create database locktest;
Query OK, 1 row affected (0.00 sec)

mysql&gt; use locktest;
Database changed
mysql&gt; create table `mylock`(`id` int(10) not null  auto_increment,`name` varchar(10) default null, primary key(`id`))engine=InnoDB auto_increment=1 default charset=utf8;
Query OK, 0 rows affected (0.15 sec)
</code></pre><p><span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vOC4wL2VuL3Nob3ctcHJvZmlsZS5odG1s">profiling</span> 是 MySQL 自带的 sql 性能分析工具。从官网来看，该工具将逐渐被替代。</p><blockquote><p>[!note]</p><p>The <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/show-profile.html"><code>SHOW PROFILE</code> </a>and <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/show-profiles.html"><code>SHOW PROFILES</code> </a>statements are deprecated; expect them to be removed in a future MySQL release. Use the <span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vOC4wL2VuL3BlcmZvcm1hbmNlLXNjaGVtYS5odG1s">Performance Schema</span> instead; see <span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vOC4wL2VuL3BlcmZvcm1hbmNlLXNjaGVtYS1xdWVyeS1wcm9maWxpbmcuaHRtbA==">Section 27.19.1, “Query Profiling Using Performance Schema”</span>.</p></blockquote><p>语法组成：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SHOW</span> PROFILE <span class="token punctuation">[</span><span class="token keyword">type</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">[</span><span class="token keyword">FOR</span> QUERY n<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">[</span><span class="token keyword">LIMIT</span> row_count <span class="token punctuation">[</span><span class="token keyword">OFFSET</span> <span class="token keyword">offset</span><span class="token punctuation">]</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 其中 type 包括以下项</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">type</span>: &#123;</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">ALL</span>  <span class="token comment"># 显示所有性能信息</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token operator">|</span> BLOCK IO  <span class="token comment"># 显示块 io 操作的次数</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token operator">|</span> CONTEXT SWITCHES  <span class="token comment"># 显示上下文切换次数，被动和主动</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token operator">|</span> CPU  <span class="token comment">#  显示用户 cpu 时间、系统 cpu 时间</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token operator">|</span> IPC  <span class="token comment"># 显示发送和接受的消息数量</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token operator">|</span> MEMORY  <span class="token comment"># 暂未实现</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token operator">|</span> PAGE FAULTS  <span class="token comment"># 显示页错误数量</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token operator">|</span> SOURCE  <span class="token comment"># 显示源码中的函数名称与位置</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token operator">|</span> SWAPS  <span class="token comment"># 显示 swap 的次数</span></pre></td></tr><tr><td data-num="16"></td><td><pre>&#125;</pre></td></tr></table></figure><p>开启方式：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">set</span> profiling<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><p>执行一条查询 sql 后查看执行性能：</p><p>show profiles 查询最近执行的一条 sql 的执行总耗时，即 type 为 Duration 项的耗时</p><p>show profile 打印最近一条（最后一条）执行的 sql 的执行过程中各个状态的执行具体耗时</p><p>show profile for query 2 查询第二条 sql 执行的各项具体耗时</p><p>show profile all 查询最近一条执行的 sql 的所有 type 项</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> mylock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">+</span><span class="token comment">----+------+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> name <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">+</span><span class="token comment">----+------+</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> a    <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> bb   <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> c    <span class="token operator">|</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> d    <span class="token operator">|</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> e    <span class="token operator">|</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> f    <span class="token operator">|</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">+</span><span class="token comment">----+------+</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">show</span> profiles<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">+</span><span class="token comment">----------+------------+----------------------+</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">|</span> Query_ID <span class="token operator">|</span> Duration   <span class="token operator">|</span> Query                <span class="token operator">|</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">+</span><span class="token comment">----------+------------+----------------------+</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">0.00067250</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> mylock <span class="token operator">|</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token operator">+</span><span class="token comment">----------+------------+----------------------+</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">show</span> profile<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------+----------+</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">|</span> <span class="token keyword">Status</span>               <span class="token operator">|</span> Duration <span class="token operator">|</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------+----------+</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token operator">|</span> <span class="token keyword">starting</span>             <span class="token operator">|</span> <span class="token number">0.000167</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token operator">|</span> checking permissions <span class="token operator">|</span> <span class="token number">0.000026</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token operator">|</span> Opening <span class="token keyword">tables</span>       <span class="token operator">|</span> <span class="token number">0.000050</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token operator">|</span> init                 <span class="token operator">|</span> <span class="token number">0.000033</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token operator">|</span> System <span class="token keyword">lock</span>          <span class="token operator">|</span> <span class="token number">0.000075</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token operator">|</span> optimizing           <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token operator">|</span> <span class="token keyword">statistics</span>           <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token operator">|</span> preparing            <span class="token operator">|</span> <span class="token number">0.000041</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token operator">|</span> executing            <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token operator">|</span> Sending <span class="token keyword">data</span>         <span class="token operator">|</span> <span class="token number">0.000155</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token operator">|</span> <span class="token keyword">end</span>                  <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token operator">|</span> query <span class="token keyword">end</span>            <span class="token operator">|</span> <span class="token number">0.000025</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token operator">|</span> closing <span class="token keyword">tables</span>       <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token operator">|</span> freeing items        <span class="token operator">|</span> <span class="token number">0.000031</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token operator">|</span> cleaning up          <span class="token operator">|</span> <span class="token number">0.000042</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------+----------+</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token number">15</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">show</span> profile <span class="token keyword">all</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+----------------------+-------------+</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token operator">|</span> <span class="token keyword">Status</span>               <span class="token operator">|</span> Duration <span class="token operator">|</span> CPU_user <span class="token operator">|</span> CPU_system <span class="token operator">|</span> Context_voluntary <span class="token operator">|</span> Context_involuntary <span class="token operator">|</span> Block_ops_in <span class="token operator">|</span> Block_ops_out <span class="token operator">|</span> Messages_sent <span class="token operator">|</span> Messages_received <span class="token operator">|</span> Page_faults_major <span class="token operator">|</span> Page_faults_minor <span class="token operator">|</span> Swaps <span class="token operator">|</span> Source_function       <span class="token operator">|</span> Source_file          <span class="token operator">|</span> Source_line <span class="token operator">|</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+----------------------+-------------+</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token operator">|</span> <span class="token keyword">starting</span>             <span class="token operator">|</span> <span class="token number">0.000167</span> <span class="token operator">|</span> <span class="token number">0.000017</span> <span class="token operator">|</span>   <span class="token number">0.000149</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>                  <span class="token operator">|</span> <span class="token boolean">NULL</span>                 <span class="token operator">|</span>        <span class="token boolean">NULL</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token operator">|</span> checking permissions <span class="token operator">|</span> <span class="token number">0.000026</span> <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>   <span class="token number">0.000023</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> check_access          <span class="token operator">|</span> sql_authorization<span class="token punctuation">.</span>cc <span class="token operator">|</span>         <span class="token number">809</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token operator">|</span> Opening <span class="token keyword">tables</span>       <span class="token operator">|</span> <span class="token number">0.000050</span> <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>   <span class="token number">0.000044</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> open_tables           <span class="token operator">|</span> sql_base<span class="token punctuation">.</span>cc          <span class="token operator">|</span>        <span class="token number">5753</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token operator">|</span> init                 <span class="token operator">|</span> <span class="token number">0.000033</span> <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>   <span class="token number">0.000030</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> handle_query          <span class="token operator">|</span> sql_select<span class="token punctuation">.</span>cc        <span class="token operator">|</span>         <span class="token number">128</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token operator">|</span> System <span class="token keyword">lock</span>          <span class="token operator">|</span> <span class="token number">0.000075</span> <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span>   <span class="token number">0.000067</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> mysql_lock_tables     <span class="token operator">|</span> <span class="token keyword">lock</span><span class="token punctuation">.</span>cc              <span class="token operator">|</span>         <span class="token number">330</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token operator">|</span> optimizing           <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span> <span class="token number">0.000000</span> <span class="token operator">|</span>   <span class="token number">0.000004</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">optimize</span>              <span class="token operator">|</span> sql_optimizer<span class="token punctuation">.</span>cc     <span class="token operator">|</span>         <span class="token number">158</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token operator">|</span> <span class="token keyword">statistics</span>           <span class="token operator">|</span> <span class="token number">0.000008</span> <span class="token operator">|</span> <span class="token number">0.000001</span> <span class="token operator">|</span>   <span class="token number">0.000007</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">optimize</span>              <span class="token operator">|</span> sql_optimizer<span class="token punctuation">.</span>cc     <span class="token operator">|</span>         <span class="token number">374</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token operator">|</span> preparing            <span class="token operator">|</span> <span class="token number">0.000041</span> <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span>   <span class="token number">0.000037</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">optimize</span>              <span class="token operator">|</span> sql_optimizer<span class="token punctuation">.</span>cc     <span class="token operator">|</span>         <span class="token number">482</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token operator">|</span> executing            <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span> <span class="token number">0.000000</span> <span class="token operator">|</span>   <span class="token number">0.000003</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">exec</span>                  <span class="token operator">|</span> sql_executor<span class="token punctuation">.</span>cc      <span class="token operator">|</span>         <span class="token number">126</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token operator">|</span> Sending <span class="token keyword">data</span>         <span class="token operator">|</span> <span class="token number">0.000155</span> <span class="token operator">|</span> <span class="token number">0.000016</span> <span class="token operator">|</span>   <span class="token number">0.000140</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">exec</span>                  <span class="token operator">|</span> sql_executor<span class="token punctuation">.</span>cc      <span class="token operator">|</span>         <span class="token number">202</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token operator">|</span> <span class="token keyword">end</span>                  <span class="token operator">|</span> <span class="token number">0.000005</span> <span class="token operator">|</span> <span class="token number">0.000000</span> <span class="token operator">|</span>   <span class="token number">0.000004</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> handle_query          <span class="token operator">|</span> sql_select<span class="token punctuation">.</span>cc        <span class="token operator">|</span>         <span class="token number">206</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token operator">|</span> query <span class="token keyword">end</span>            <span class="token operator">|</span> <span class="token number">0.000025</span> <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>   <span class="token number">0.000022</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> mysql_execute_command <span class="token operator">|</span> sql_parse<span class="token punctuation">.</span>cc         <span class="token operator">|</span>        <span class="token number">4956</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token operator">|</span> closing <span class="token keyword">tables</span>       <span class="token operator">|</span> <span class="token number">0.000007</span> <span class="token operator">|</span> <span class="token number">0.000001</span> <span class="token operator">|</span>   <span class="token number">0.000006</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> mysql_execute_command <span class="token operator">|</span> sql_parse<span class="token punctuation">.</span>cc         <span class="token operator">|</span>        <span class="token number">5009</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token operator">|</span> freeing items        <span class="token operator">|</span> <span class="token number">0.000031</span> <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>   <span class="token number">0.000028</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> mysql_parse           <span class="token operator">|</span> sql_parse<span class="token punctuation">.</span>cc         <span class="token operator">|</span>        <span class="token number">5622</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token operator">|</span> cleaning up          <span class="token operator">|</span> <span class="token number">0.000042</span> <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span>   <span class="token number">0.000038</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                   <span class="token number">0</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>             <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>                 <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span> dispatch_command      <span class="token operator">|</span> sql_parse<span class="token punctuation">.</span>cc         <span class="token operator">|</span>        <span class="token number">1931</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+----------------------+-------------+</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token number">15</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="performance-schema性能模式"><a class="anchor" href="#performance-schema性能模式">#</a> Performance Schema (性能模式)</h2><p>MySQL 官网表示<span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vOC4wL2VuL3BlcmZvcm1hbmNlLXNjaGVtYS5odG1s"> Performance Schema</span> 在之后的 MySQL 版本中将替代 profiling。Performance Schema 提供了一种在运行时检查 MySQL 服务器内部执行的方法，如监控资源消耗、资源等待等情况。</p><p>特点如下：</p><ol><li>提供了一种在数据库运行时实时检查 server 的内部执行情况的方法。performance_schema 数据库中的表使用 performance_schema 存储引擎。该数据库主要关注数据库运行过程中的性能相关的数据，与 information_schema 不同，information_schema 主要关注 server 运行过程中的元数据信息</li><li>performance_schema 通过监视 server 的事件来实现监视 server 内部运行情况， “事件” 就是 server 内部活动中所做的任何事情以及对应的时间消耗，利用这些信息来判断 server 中的相关资源消耗在了哪里？一般来说，事件可以是函数调用、操作系统的等待、SQL 语句执行的阶段（如 sql 语句执行过程中的 parsing 或 sorting 阶段）或者整个 SQL 语句与 SQL 语句集合。事件的采集可以方便的提供 server 中的相关存储引擎对磁盘文件、表 I/O、表锁等资源的同步调用信息。</li><li>performance_schema 中的事件与写入二进制日志中的事件（描述数据修改的 events）、事件计划调度程序（这是一种存储程序）的事件不同。performance_schema 中的事件记录的是 server 执行某些活动对某些资源的消耗、耗时、这些活动执行的次数等情况。</li><li>performance_schema 中的事件只记录在本地 server 的 performance_schema 中，其下的这些表中数据发生变化时不会被写入 binlog 中，也不会通过复制机制被复制到其他 server 中。</li><li>当前活跃事件、历史事件和事件摘要相关的表中记录的信息。能提供某个事件的执行次数、使用时长。进而可用于分析某个特定线程、特定对象（如 mutex 或 file）相关联的活动。</li><li>PERFORMANCE_SCHEMA 存储引擎使用 server 源代码中的 “检测点” 来实现事件数据的收集。对于 performance_schema 实现机制本身的代码没有相关的单独线程来检测，这与其他功能（如复制或事件计划程序）不同</li><li>收集的事件数据存储在 performance_schema 数据库的表中。这些表可以使用 SELECT 语句查询，也可以使用 SQL 语句更新 performance_schema 数据库中的表记录（如动态修改 performance_schema 的 setup_* 开头的几个配置表，但要注意：配置表的更改会立即生效，这会影响数据收集）</li><li>performance_schema 的表中的数据不会持久化存储在磁盘中，而是保存在内存中，一旦服务器重启，这些数据会丢失（包括配置表在内的整个 performance_schema 下的所有数据）</li><li>MySQL 支持的所有平台中事件监控功能都可用，但不同平台中用于统计事件时间开销的计时器类型可能会有所差异。</li></ol><h3 id="performance-schema设置"><a class="anchor" href="#performance-schema设置">#</a> Performance Schema 设置</h3><p>Performance Schema 默认是开启的，可以在 my.cnf 中设置开关</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>performance_schema<span class="token operator">=</span><span class="token keyword">ON</span></pre></td></tr></table></figure><p>在 mysql 服务启动时将初始化 Performance Schema，可以查看初始化是否成功</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'performance_schema'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+-------+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span> Variable_name      <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+-------+</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span> performance_schema <span class="token operator">|</span> <span class="token keyword">ON</span>    <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+-------+</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.46</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><p>Performance Schema 是作为一个存储引擎 PERFORMANCE_SCHEMA 实现的</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>engines <span class="token keyword">where</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token string">'performance_schema'</span>\g</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+---------+--------------------+--------------+------+------------+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span> <span class="token keyword">ENGINE</span>             <span class="token operator">|</span> SUPPORT <span class="token operator">|</span> <span class="token keyword">COMMENT</span>            <span class="token operator">|</span> <span class="token keyword">TRANSACTIONS</span> <span class="token operator">|</span> XA   <span class="token operator">|</span> SAVEPOINTS <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+---------+--------------------+--------------+------+------------+</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span> PERFORMANCE_SCHEMA <span class="token operator">|</span> YES     <span class="token operator">|</span> Performance <span class="token keyword">Schema</span> <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+---------+--------------------+--------------+------+------------+</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.14</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><p>或者使用</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">show</span> engines\g</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span> <span class="token keyword">Engine</span>             <span class="token operator">|</span> Support <span class="token operator">|</span> <span class="token keyword">Comment</span>                                                        <span class="token operator">|</span> <span class="token keyword">Transactions</span> <span class="token operator">|</span> XA   <span class="token operator">|</span> Savepoints <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span> MRG_MYISAM         <span class="token operator">|</span> YES     <span class="token operator">|</span> Collection <span class="token keyword">of</span> identical MyISAM <span class="token keyword">tables</span>                          <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span> CSV                <span class="token operator">|</span> YES     <span class="token operator">|</span> CSV storage <span class="token keyword">engine</span>                                             <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">|</span> MyISAM             <span class="token operator">|</span> YES     <span class="token operator">|</span> MyISAM storage <span class="token keyword">engine</span>                                          <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">|</span> BLACKHOLE          <span class="token operator">|</span> YES     <span class="token operator">|</span> <span class="token operator">/</span>dev<span class="token operator">/</span><span class="token boolean">null</span> storage <span class="token keyword">engine</span> <span class="token punctuation">(</span>anything you <span class="token keyword">write</span> <span class="token keyword">to</span> it disappears<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">|</span> PERFORMANCE_SCHEMA <span class="token operator">|</span> YES     <span class="token operator">|</span> Performance <span class="token keyword">Schema</span>                                             <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">|</span> <span class="token keyword">InnoDB</span>             <span class="token operator">|</span> <span class="token keyword">DEFAULT</span> <span class="token operator">|</span> Supports <span class="token keyword">transactions</span><span class="token punctuation">,</span> <span class="token keyword">row</span><span class="token operator">-</span><span class="token keyword">level</span> locking<span class="token punctuation">,</span> <span class="token operator">and</span> <span class="token keyword">foreign</span> <span class="token keyword">keys</span>     <span class="token operator">|</span> YES          <span class="token operator">|</span> YES  <span class="token operator">|</span> YES        <span class="token operator">|</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">|</span> ARCHIVE            <span class="token operator">|</span> YES     <span class="token operator">|</span> Archive storage <span class="token keyword">engine</span>                                         <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">|</span> MEMORY             <span class="token operator">|</span> YES     <span class="token operator">|</span> <span class="token keyword">Hash</span> based<span class="token punctuation">,</span> stored <span class="token operator">in</span> memory<span class="token punctuation">,</span> useful <span class="token keyword">for</span> <span class="token keyword">temporary</span> <span class="token keyword">tables</span>      <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span> FEDERATED          <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span> Federated MySQL storage <span class="token keyword">engine</span>                                 <span class="token operator">|</span> <span class="token boolean">NULL</span>         <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">9</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="performance-schema中的表"><a class="anchor" href="#performance-schema中的表">#</a> Performance Schema 中的表</h3><p>performance_schema 中包含了 87 张表（这些表使用了 PERFORMANCE_SCHEMA 存储引擎），这些表记录了 MySQL 在执行过程中的资源消耗、资源等待等性能情况的数据，所有表中的所有数据保存在内存中，所以并不会持久化，随着 MySQL 服务的关闭而释放。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span> <span class="token keyword">Database</span>           <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span> information_schema <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span> locktest           <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">|</span> mysql              <span class="token operator">|</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">|</span> performance_schema <span class="token operator">|</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">|</span> sys                <span class="token operator">|</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------+</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.12</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">use</span> performance_schema <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>Reading <span class="token keyword">table</span> information <span class="token keyword">for</span> completion <span class="token keyword">of</span> <span class="token keyword">table</span> <span class="token operator">and</span> <span class="token keyword">column</span> names</pre></td></tr><tr><td data-num="15"></td><td><pre>You can turn <span class="token keyword">off</span> this feature <span class="token keyword">to</span> get a quicker startup <span class="token keyword">with</span> <span class="token operator">-</span>A</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">Database</span> changed</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token operator">+</span><span class="token comment">------------------------------------------------------+</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">|</span> Tables_in_performance_schema                         <span class="token operator">|</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">+</span><span class="token comment">------------------------------------------------------+</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">|</span> accounts                                             <span class="token operator">|</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token operator">|</span> cond_instances                                       <span class="token operator">|</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token operator">|</span> events_stages_current                                <span class="token operator">|</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token operator">|</span> events_stages_history                                <span class="token operator">|</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token operator">|</span> events_stages_history_long                           <span class="token operator">|</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token operator">|</span> events_stages_summary_by_account_by_event_name       <span class="token operator">|</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token operator">|</span> events_stages_summary_by_host_by_event_name          <span class="token operator">|</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token operator">|</span> events_stages_summary_by_thread_by_event_name        <span class="token operator">|</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token operator">|</span> events_stages_summary_by_user_by_event_name          <span class="token operator">|</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token operator">|</span> events_stages_summary_global_by_event_name           <span class="token operator">|</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token operator">|</span> events_statements_current                            <span class="token operator">|</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token operator">|</span> events_statements_history                            <span class="token operator">|</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token operator">|</span> events_statements_history_long                       <span class="token operator">|</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token operator">|</span> events_statements_summary_by_account_by_event_name   <span class="token operator">|</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token operator">|</span> events_statements_summary_by_digest                  <span class="token operator">|</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token operator">|</span> events_statements_summary_by_host_by_event_name      <span class="token operator">|</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token operator">|</span> events_statements_summary_by_program                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token operator">|</span> events_statements_summary_by_thread_by_event_name    <span class="token operator">|</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token operator">|</span> events_statements_summary_by_user_by_event_name      <span class="token operator">|</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token operator">|</span> events_statements_summary_global_by_event_name       <span class="token operator">|</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token operator">|</span> events_transactions_current                          <span class="token operator">|</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token operator">|</span> events_transactions_history                          <span class="token operator">|</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token operator">|</span> events_transactions_history_long                     <span class="token operator">|</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token operator">|</span> events_transactions_summary_by_account_by_event_name <span class="token operator">|</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token operator">|</span> events_transactions_summary_by_host_by_event_name    <span class="token operator">|</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token operator">|</span> events_transactions_summary_by_thread_by_event_name  <span class="token operator">|</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token operator">|</span> events_transactions_summary_by_user_by_event_name    <span class="token operator">|</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token operator">|</span> events_transactions_summary_global_by_event_name     <span class="token operator">|</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token operator">|</span> events_waits_current                                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token operator">|</span> events_waits_history                                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token operator">|</span> events_waits_history_long                            <span class="token operator">|</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token operator">|</span> events_waits_summary_by_account_by_event_name        <span class="token operator">|</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token operator">|</span> events_waits_summary_by_host_by_event_name           <span class="token operator">|</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token operator">|</span> events_waits_summary_by_instance                     <span class="token operator">|</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token operator">|</span> events_waits_summary_by_thread_by_event_name         <span class="token operator">|</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token operator">|</span> events_waits_summary_by_user_by_event_name           <span class="token operator">|</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token operator">|</span> events_waits_summary_global_by_event_name            <span class="token operator">|</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token operator">|</span> file_instances                                       <span class="token operator">|</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token operator">|</span> file_summary_by_event_name                           <span class="token operator">|</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token operator">|</span> file_summary_by_instance                             <span class="token operator">|</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token operator">|</span> global_status                                        <span class="token operator">|</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token operator">|</span> global_variables                                     <span class="token operator">|</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token operator">|</span> host_cache                                           <span class="token operator">|</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token operator">|</span> hosts                                                <span class="token operator">|</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token operator">|</span> memory_summary_by_account_by_event_name              <span class="token operator">|</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token operator">|</span> memory_summary_by_host_by_event_name                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token operator">|</span> memory_summary_by_thread_by_event_name               <span class="token operator">|</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token operator">|</span> memory_summary_by_user_by_event_name                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token operator">|</span> memory_summary_global_by_event_name                  <span class="token operator">|</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token operator">|</span> metadata_locks                                       <span class="token operator">|</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token operator">|</span> mutex_instances                                      <span class="token operator">|</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token operator">|</span> objects_summary_global_by_type                       <span class="token operator">|</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token operator">|</span> performance_timers                                   <span class="token operator">|</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token operator">|</span> prepared_statements_instances                        <span class="token operator">|</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token operator">|</span> replication_applier_configuration                    <span class="token operator">|</span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token operator">|</span> replication_applier_status                           <span class="token operator">|</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token operator">|</span> replication_applier_status_by_coordinator            <span class="token operator">|</span></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token operator">|</span> replication_applier_status_by_worker                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token operator">|</span> replication_connection_configuration                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token operator">|</span> replication_connection_status                        <span class="token operator">|</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token operator">|</span> replication_group_member_stats                       <span class="token operator">|</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token operator">|</span> replication_group_members                            <span class="token operator">|</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token operator">|</span> rwlock_instances                                     <span class="token operator">|</span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token operator">|</span> session_account_connect_attrs                        <span class="token operator">|</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token operator">|</span> session_connect_attrs                                <span class="token operator">|</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token operator">|</span> session_status                                       <span class="token operator">|</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token operator">|</span> session_variables                                    <span class="token operator">|</span></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token operator">|</span> setup_actors                                         <span class="token operator">|</span></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token operator">|</span> setup_consumers                                      <span class="token operator">|</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token operator">|</span> setup_instruments                                    <span class="token operator">|</span></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token operator">|</span> setup_objects                                        <span class="token operator">|</span></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token operator">|</span> setup_timers                                         <span class="token operator">|</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token operator">|</span> socket_instances                                     <span class="token operator">|</span></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token operator">|</span> socket_summary_by_event_name                         <span class="token operator">|</span></pre></td></tr><tr><td data-num="98"></td><td><pre><span class="token operator">|</span> socket_summary_by_instance                           <span class="token operator">|</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token operator">|</span> status_by_account                                    <span class="token operator">|</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token operator">|</span> status_by_host                                       <span class="token operator">|</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token operator">|</span> status_by_thread                                     <span class="token operator">|</span></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token operator">|</span> status_by_user                                       <span class="token operator">|</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token operator">|</span> table_handles                                        <span class="token operator">|</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token operator">|</span> table_io_waits_summary_by_index_usage                <span class="token operator">|</span></pre></td></tr><tr><td data-num="105"></td><td><pre><span class="token operator">|</span> table_io_waits_summary_by_table                      <span class="token operator">|</span></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token operator">|</span> table_lock_waits_summary_by_table                    <span class="token operator">|</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token operator">|</span> threads                                              <span class="token operator">|</span></pre></td></tr><tr><td data-num="108"></td><td><pre><span class="token operator">|</span> user_variables_by_thread                             <span class="token operator">|</span></pre></td></tr><tr><td data-num="109"></td><td><pre><span class="token operator">|</span> users                                                <span class="token operator">|</span></pre></td></tr><tr><td data-num="110"></td><td><pre><span class="token operator">|</span> variables_by_thread                                  <span class="token operator">|</span></pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token operator">+</span><span class="token comment">------------------------------------------------------+</span></pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token number">87</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="113"></td><td><pre></pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token comment"># 或者使用 INFORMATION_SCHEMA.TABLES 查看指定数据库下的表（不需要进入具体的数据库）</span></pre></td></tr><tr><td data-num="115"></td><td><pre><span class="token comment"># INFORMATION_SCHEMA.TABLES 代表 NFORMATION_SCHEMA 数据库（schema）下的所有表，该数据库存储了包括其他数据库在内的所有表</span></pre></td></tr><tr><td data-num="116"></td><td><pre><span class="token comment"># TABLE_SCHEMA 代表数据库名</span></pre></td></tr><tr><td data-num="117"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> TABLE_NAME <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">TABLES</span> <span class="token keyword">WHERE</span> TABLE_SCHEMA <span class="token operator">=</span> <span class="token string">'performance_schema'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="performance-schema的表分类"><a class="anchor" href="#performance-schema的表分类">#</a> Performance Schema 的表分类</h3><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 语句事件记录表，这些表记录了语句事件信息，当前语句事件表 events_statements_current、历史语句事件表 events_statements_history 和长语句历史事件表 events_statements_history_long、以及聚合后的摘要表 summary，其中，summary 表还可以根据帐号 (account)，主机 (host)，程序 (program)，线程 (thread)，用户 (user) 和全局 (global) 再进行细分)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token operator">like</span> <span class="token string">'%statement%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 等待事件记录表，与语句事件类型的相关记录表类似：</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token operator">like</span> <span class="token string">'%wait%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">-- 阶段事件记录表，记录语句执行的阶段事件的表</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token operator">like</span> <span class="token string">'%stage%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">-- 事务事件记录表，记录事务相关的事件的表</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token operator">like</span> <span class="token string">'%transaction%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">-- 监控文件系统层调用的表</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token operator">like</span> <span class="token string">'%file%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">-- 监视内存使用的表</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token operator">like</span> <span class="token string">'%memory%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">-- 动态对 performance_schema 进行配置的配置表</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token operator">like</span> <span class="token string">'%setup%'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="performance-schema的配置"><a class="anchor" href="#performance-schema的配置">#</a> Performance Schema 的配置</h3><p>Performance Schema 数据库中有两张重要的配置表：setup_consumers 和 setup_instruments</p><p>instruments：生产者，用于采集 mysql 中各种各样的操作产生的事件信息，对应配置表中的配置项我们可以称为监控采集配置项。setup_instruments 表中记录了所有事件名，有些需要手动来开启。</p><p>consumers：消费者，对应的消费者表用于存储来自 instruments 采集的数据，对应配置表中的配置项我们可以称为消费存储配置项。表 setup_instruments 中的事件名隶属于表 setup_consumers 中的某张表。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 例如：以 wait 开头的部分事件名称，每个 NAME 代表一个事件名称</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> setup_instruments <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'wait%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------------------------------------------------------+---------+-------+</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">|</span> NAME                                                               <span class="token operator">|</span> ENABLED <span class="token operator">|</span> TIMED <span class="token operator">|</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">+</span><span class="token comment">--------------------------------------------------------------------+---------+-------+</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>TC_LOG_MMAP::LOCK_tc                          <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>LOCK_des_key_file                             <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>MYSQL_BIN_LOG::LOCK_commit                    <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>MYSQL_BIN_LOG::LOCK_commit_queue              <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>MYSQL_BIN_LOG::LOCK_done                      <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>MYSQL_BIN_LOG::LOCK_flush_queue               <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>MYSQL_BIN_LOG::LOCK_index                     <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>MYSQL_BIN_LOG::LOCK_log                       <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>MYSQL_BIN_LOG::LOCK_binlog_end_pos            <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>MYSQL_BIN_LOG::LOCK_sync                      <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">|</span> wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>MYSQL_BIN_LOG::LOCK_sync_queue                <span class="token operator">|</span> YES     <span class="token operator">|</span> YES   <span class="token operator">|</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">-- setup_consumers 表是总的事件表，每个 NAME 表示一张表，每张表又存储了当前 sql 服务发生的若干个具体的事件</span></pre></td></tr><tr><td data-num="20"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> setup_consumers<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------------------+---------+</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">|</span> NAME                             <span class="token operator">|</span> ENABLED <span class="token operator">|</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------------------+---------+</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">|</span> events_stages_current            <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token operator">|</span> events_stages_history            <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token operator">|</span> events_stages_history_long       <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token operator">|</span> events_statements_current        <span class="token operator">|</span> YES     <span class="token operator">|</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token operator">|</span> events_statements_history        <span class="token operator">|</span> YES     <span class="token operator">|</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token operator">|</span> events_statements_history_long   <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token operator">|</span> events_transactions_current      <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token operator">|</span> events_transactions_history      <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token operator">|</span> events_transactions_history_long <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token operator">|</span> events_waits_current             <span class="token operator">|</span> YES     <span class="token operator">|</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token operator">|</span> events_waits_history             <span class="token operator">|</span> YES     <span class="token operator">|</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token operator">|</span> events_waits_history_long        <span class="token operator">|</span> YES     <span class="token operator">|</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token operator">|</span> global_instrumentation           <span class="token operator">|</span> YES     <span class="token operator">|</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token operator">|</span> thread_instrumentation           <span class="token operator">|</span> YES     <span class="token operator">|</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token operator">|</span> statements_digest                <span class="token operator">|</span> YES     <span class="token operator">|</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------------------+---------+</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token number">15</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment">-- 查看 setup_consumers 表中 events_waits_current 事件表中的具体事件。可以看到， EVENT_NAME 字段就是具体的事件名称，即包含在 setup_instruments 表中的事件名称。</span></pre></td></tr><tr><td data-num="43"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> events_waits_current \G</pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            THREAD_ID: <span class="token number">11</span></pre></td></tr><tr><td data-num="46"></td><td><pre>             EVENT_ID: <span class="token number">57695</span></pre></td></tr><tr><td data-num="47"></td><td><pre>         END_EVENT_ID: <span class="token number">57695</span></pre></td></tr><tr><td data-num="48"></td><td><pre>           EVENT_NAME: wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">innodb</span><span class="token operator">/</span>buf_dblwr_mutex</pre></td></tr><tr><td data-num="49"></td><td><pre>               SOURCE: </pre></td></tr><tr><td data-num="50"></td><td><pre>          TIMER_START: <span class="token number">17048839129984024</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            TIMER_END: <span class="token number">17048839130085156</span></pre></td></tr><tr><td data-num="52"></td><td><pre>           TIMER_WAIT: <span class="token number">101132</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                SPINS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="54"></td><td><pre>        OBJECT_SCHEMA: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="55"></td><td><pre>          OBJECT_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="56"></td><td><pre>           INDEX_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="57"></td><td><pre>          OBJECT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="58"></td><td><pre>OBJECT_INSTANCE_BEGIN: <span class="token number">48018264</span></pre></td></tr><tr><td data-num="59"></td><td><pre>     NESTING_EVENT_ID: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="60"></td><td><pre>   NESTING_EVENT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            OPERATION: <span class="token keyword">lock</span></pre></td></tr><tr><td data-num="62"></td><td><pre>      NUMBER_OF_BYTES: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                FLAGS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">2.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="65"></td><td><pre>            THREAD_ID: <span class="token number">18</span></pre></td></tr><tr><td data-num="66"></td><td><pre>             EVENT_ID: <span class="token number">34807</span></pre></td></tr><tr><td data-num="67"></td><td><pre>         END_EVENT_ID: <span class="token number">34807</span></pre></td></tr><tr><td data-num="68"></td><td><pre>           EVENT_NAME: wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">innodb</span><span class="token operator">/</span>sync_array_mutex</pre></td></tr><tr><td data-num="69"></td><td><pre>               SOURCE: </pre></td></tr><tr><td data-num="70"></td><td><pre>          TIMER_START: <span class="token number">17048839187757416</span></pre></td></tr><tr><td data-num="71"></td><td><pre>            TIMER_END: <span class="token number">17048839187796016</span></pre></td></tr><tr><td data-num="72"></td><td><pre>           TIMER_WAIT: <span class="token number">38600</span></pre></td></tr><tr><td data-num="73"></td><td><pre>                SPINS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        OBJECT_SCHEMA: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="75"></td><td><pre>          OBJECT_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="76"></td><td><pre>           INDEX_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="77"></td><td><pre>          OBJECT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="78"></td><td><pre>OBJECT_INSTANCE_BEGIN: <span class="token number">40501824</span></pre></td></tr><tr><td data-num="79"></td><td><pre>     NESTING_EVENT_ID: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="80"></td><td><pre>   NESTING_EVENT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="81"></td><td><pre>            OPERATION: <span class="token keyword">lock</span></pre></td></tr><tr><td data-num="82"></td><td><pre>      NUMBER_OF_BYTES: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="83"></td><td><pre>                FLAGS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">3.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="85"></td><td><pre>            THREAD_ID: <span class="token number">20</span></pre></td></tr><tr><td data-num="86"></td><td><pre>             EVENT_ID: <span class="token number">103851</span></pre></td></tr><tr><td data-num="87"></td><td><pre>         END_EVENT_ID: <span class="token number">103851</span></pre></td></tr><tr><td data-num="88"></td><td><pre>           EVENT_NAME: wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">innodb</span><span class="token operator">/</span>flush_list_mutex</pre></td></tr><tr><td data-num="89"></td><td><pre>               SOURCE: </pre></td></tr><tr><td data-num="90"></td><td><pre>          TIMER_START: <span class="token number">17048839179937056</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            TIMER_END: <span class="token number">17048839180016572</span></pre></td></tr><tr><td data-num="92"></td><td><pre>           TIMER_WAIT: <span class="token number">79516</span></pre></td></tr><tr><td data-num="93"></td><td><pre>                SPINS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        OBJECT_SCHEMA: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="95"></td><td><pre>          OBJECT_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="96"></td><td><pre>           INDEX_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="97"></td><td><pre>          OBJECT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="98"></td><td><pre>OBJECT_INSTANCE_BEGIN: <span class="token number">44199200</span></pre></td></tr><tr><td data-num="99"></td><td><pre>     NESTING_EVENT_ID: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="100"></td><td><pre>   NESTING_EVENT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            OPERATION: <span class="token keyword">lock</span></pre></td></tr><tr><td data-num="102"></td><td><pre>      NUMBER_OF_BYTES: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="103"></td><td><pre>                FLAGS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">4.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="105"></td><td><pre>            THREAD_ID: <span class="token number">23</span></pre></td></tr><tr><td data-num="106"></td><td><pre>             EVENT_ID: <span class="token number">11539</span></pre></td></tr><tr><td data-num="107"></td><td><pre>         END_EVENT_ID: <span class="token number">11539</span></pre></td></tr><tr><td data-num="108"></td><td><pre>           EVENT_NAME: wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">innodb</span><span class="token operator">/</span>lock_wait_mutex</pre></td></tr><tr><td data-num="109"></td><td><pre>               SOURCE: </pre></td></tr><tr><td data-num="110"></td><td><pre>          TIMER_START: <span class="token number">17048839097306036</span></pre></td></tr><tr><td data-num="111"></td><td><pre>            TIMER_END: <span class="token number">17048839097793940</span></pre></td></tr><tr><td data-num="112"></td><td><pre>           TIMER_WAIT: <span class="token number">487904</span></pre></td></tr><tr><td data-num="113"></td><td><pre>                SPINS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="114"></td><td><pre>        OBJECT_SCHEMA: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="115"></td><td><pre>          OBJECT_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="116"></td><td><pre>           INDEX_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="117"></td><td><pre>          OBJECT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="118"></td><td><pre>OBJECT_INSTANCE_BEGIN: <span class="token number">47860280</span></pre></td></tr><tr><td data-num="119"></td><td><pre>     NESTING_EVENT_ID: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="120"></td><td><pre>   NESTING_EVENT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="121"></td><td><pre>            OPERATION: <span class="token keyword">lock</span></pre></td></tr><tr><td data-num="122"></td><td><pre>      NUMBER_OF_BYTES: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="123"></td><td><pre>                FLAGS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="124"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">5.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="125"></td><td><pre>            THREAD_ID: <span class="token number">24</span></pre></td></tr><tr><td data-num="126"></td><td><pre>             EVENT_ID: <span class="token number">1155</span></pre></td></tr><tr><td data-num="127"></td><td><pre>         END_EVENT_ID: <span class="token number">1155</span></pre></td></tr><tr><td data-num="128"></td><td><pre>           EVENT_NAME: wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">innodb</span><span class="token operator">/</span>recalc_pool_mutex</pre></td></tr><tr><td data-num="129"></td><td><pre>               SOURCE: </pre></td></tr><tr><td data-num="130"></td><td><pre>          TIMER_START: <span class="token number">17046907509257646</span></pre></td></tr><tr><td data-num="131"></td><td><pre>            TIMER_END: <span class="token number">17046907509811942</span></pre></td></tr><tr><td data-num="132"></td><td><pre>           TIMER_WAIT: <span class="token number">554296</span></pre></td></tr><tr><td data-num="133"></td><td><pre>                SPINS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="134"></td><td><pre>        OBJECT_SCHEMA: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="135"></td><td><pre>          OBJECT_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="136"></td><td><pre>           INDEX_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="137"></td><td><pre>          OBJECT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="138"></td><td><pre>OBJECT_INSTANCE_BEGIN: <span class="token number">34618368</span></pre></td></tr><tr><td data-num="139"></td><td><pre>     NESTING_EVENT_ID: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="140"></td><td><pre>   NESTING_EVENT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="141"></td><td><pre>            OPERATION: <span class="token keyword">lock</span></pre></td></tr><tr><td data-num="142"></td><td><pre>      NUMBER_OF_BYTES: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="143"></td><td><pre>                FLAGS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="144"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">6.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="145"></td><td><pre>            THREAD_ID: <span class="token number">29</span></pre></td></tr><tr><td data-num="146"></td><td><pre>             EVENT_ID: <span class="token number">854</span></pre></td></tr><tr><td data-num="147"></td><td><pre>         END_EVENT_ID: <span class="token number">854</span></pre></td></tr><tr><td data-num="148"></td><td><pre>           EVENT_NAME: wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">sql</span><span class="token operator">/</span>THD::LOCK_query_plan</pre></td></tr><tr><td data-num="149"></td><td><pre>               SOURCE: </pre></td></tr><tr><td data-num="150"></td><td><pre>          TIMER_START: <span class="token number">17049303381467710</span></pre></td></tr><tr><td data-num="151"></td><td><pre>            TIMER_END: <span class="token number">17049303381527926</span></pre></td></tr><tr><td data-num="152"></td><td><pre>           TIMER_WAIT: <span class="token number">60216</span></pre></td></tr><tr><td data-num="153"></td><td><pre>                SPINS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="154"></td><td><pre>        OBJECT_SCHEMA: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="155"></td><td><pre>          OBJECT_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="156"></td><td><pre>           INDEX_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="157"></td><td><pre>          OBJECT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="158"></td><td><pre>OBJECT_INSTANCE_BEGIN: <span class="token number">140436169654944</span></pre></td></tr><tr><td data-num="159"></td><td><pre>     NESTING_EVENT_ID: <span class="token number">844</span></pre></td></tr><tr><td data-num="160"></td><td><pre>   NESTING_EVENT_TYPE: STATEMENT</pre></td></tr><tr><td data-num="161"></td><td><pre>            OPERATION: <span class="token keyword">lock</span></pre></td></tr><tr><td data-num="162"></td><td><pre>      NUMBER_OF_BYTES: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="163"></td><td><pre>                FLAGS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="164"></td><td><pre><span class="token number">6</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><p>数据库刚刚初始化并启动时，并非所有 instruments (事件采集项，在采集项的配置表中每一项都有一个开关字段，或为 YES，或为 NO) 和 consumers (与采集项类似，也有一个对应的事件类型保存表配置项，为 YES 就表示对应的表保存性能数据，为 NO 就表示对应的表不保存性能数据) 都启用了，所以默认不会收集所有的事件，可能你需要检测的事件并没有打开，需要进行设置，可以使用如下两个语句打开对应的 instruments 和 consumers（行计数可能会因 MySQL 版本而异)。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 打开等待事件的采集器配置项开关，需要修改 setup_instruments 配置表中对应的采集器配置项</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">UPDATE</span> setup_instruments <span class="token keyword">SET</span> ENABLED <span class="token operator">=</span> <span class="token string">'YES'</span><span class="token punctuation">,</span> TIMED <span class="token operator">=</span> <span class="token string">'YES'</span><span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'wait%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 打开等待事件的保存表配置开关，修改 setup_consumers 配置表中对应的配置项</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">UPDATE</span> setup_consumers <span class="token keyword">SET</span> ENABLED <span class="token operator">=</span> <span class="token string">'YES'</span><span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'%wait%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">-- 当配置完成之后可以查看当前 server 正在做什么，可以通过查询 events_waits_current 表来得知，该表中每个线程只包含一行数据，用于显示每个线程的最新监视事件</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> events_waits_current\G</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            THREAD_ID: <span class="token number">11</span></pre></td></tr><tr><td data-num="11"></td><td><pre>             EVENT_ID: <span class="token number">570</span></pre></td></tr><tr><td data-num="12"></td><td><pre>         END_EVENT_ID: <span class="token number">570</span></pre></td></tr><tr><td data-num="13"></td><td><pre>           EVENT_NAME: wait<span class="token operator">/</span>synch<span class="token operator">/</span>mutex<span class="token operator">/</span><span class="token keyword">innodb</span><span class="token operator">/</span>buf_dblwr_mutex</pre></td></tr><tr><td data-num="14"></td><td><pre>               SOURCE: </pre></td></tr><tr><td data-num="15"></td><td><pre>          TIMER_START: <span class="token number">4508505105239280</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            TIMER_END: <span class="token number">4508505105270160</span></pre></td></tr><tr><td data-num="17"></td><td><pre>           TIMER_WAIT: <span class="token number">30880</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                SPINS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        OBJECT_SCHEMA: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="20"></td><td><pre>          OBJECT_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="21"></td><td><pre>           INDEX_NAME: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="22"></td><td><pre>          OBJECT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="23"></td><td><pre>OBJECT_INSTANCE_BEGIN: <span class="token number">67918392</span></pre></td></tr><tr><td data-num="24"></td><td><pre>     NESTING_EVENT_ID: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="25"></td><td><pre>   NESTING_EVENT_TYPE: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            OPERATION: <span class="token keyword">lock</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      NUMBER_OF_BYTES: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                FLAGS: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment">/* 该信息表示线程 id 为 11 的线程正在等待 buf_dblwr_mutex 锁，等待事件为 30880</span></pre></td></tr><tr><td data-num="30"></td><td><pre>属性说明：</pre></td></tr><tr><td data-num="31"></td><td><pre>	id: 事件来自哪个线程，事件编号是多少</pre></td></tr><tr><td data-num="32"></td><td><pre>	event_name: 表示检测到的具体的内容</pre></td></tr><tr><td data-num="33"></td><td><pre>	source: 表示这个检测代码在哪个源文件中以及行号</pre></td></tr><tr><td data-num="34"></td><td><pre>	timer_start: 表示该事件的开始时间</pre></td></tr><tr><td data-num="35"></td><td><pre>	timer_end: 表示该事件的结束时间</pre></td></tr><tr><td data-num="36"></td><td><pre>	timer_wait: 表示该事件总的花费时间</pre></td></tr><tr><td data-num="37"></td><td><pre>注意：_current 表中每个线程只保留一条记录，一旦线程完成工作，该表中不会再记录该线程的事件信息</pre></td></tr><tr><td data-num="38"></td><td><pre>*/</pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="41"></td><td><pre>_history 表中记录每个线程应该执行完成的事件信息，但每个线程的事件信息只会记录 10 条，再多就会被覆盖，*_history_long 表中记录所有线程的事件信息，但总记录数量是 10000，超过就会被覆盖掉</pre></td></tr><tr><td data-num="42"></td><td><pre>*/</pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token keyword">select</span> thread_id<span class="token punctuation">,</span>event_id<span class="token punctuation">,</span>event_name<span class="token punctuation">,</span>timer_wait <span class="token keyword">from</span> events_waits_history <span class="token keyword">order</span> <span class="token keyword">by</span> thread_id <span class="token keyword">limit</span> <span class="token number">21</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="46"></td><td><pre>summary 表提供所有事件的汇总信息，该组中的表以不同的方式汇总事件数据（如：按用户，按主机，按线程等等）。例如：要查看哪些 instruments 占用最多的时间，可以通过对 events_waits_summary_global_by_event_name 表的 COUNT_STAR 或 SUM_TIMER_WAIT 列进行查询（这两列是对事件的记录数执行 COUNT（*）、事件记录的 TIMER_WAIT 列执行 SUM（TIMER_WAIT）统计而来）</pre></td></tr><tr><td data-num="47"></td><td><pre>*/</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token keyword">SELECT</span> EVENT_NAME<span class="token punctuation">,</span>COUNT_STAR <span class="token keyword">FROM</span> events_waits_summary_global_by_event_name  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> COUNT_STAR <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="51"></td><td><pre>instance 表记录了哪些类型的对象会被检测。这些对象在被 server 使用时，在该表中将会产生一条事件记录，例如，file_instances 表列出了文件 I/O 操作及其关联文件名</pre></td></tr><tr><td data-num="52"></td><td><pre>*/</pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> file_instances <span class="token keyword">limit</span> <span class="token number">20</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="启动选项"><a class="anchor" href="#启动选项">#</a> 启动选项</h4><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>performance_schema_consumer_events_statements_current<span class="token operator">=</span><span class="token boolean">TRUE</span></pre></td></tr><tr><td data-num="2"></td><td><pre>是否在mysql server启动时就开启events_statements_current表的记录功能<span class="token punctuation">(</span>该表记录当前的语句事件信息<span class="token punctuation">)</span>，启动之后也可以在setup_consumers表中使用<span class="token keyword">UPDATE</span>语句进行动态更新setup_consumers配置表中的events_statements_current配置项，默认值为<span class="token boolean">TRUE</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>performance_schema_consumer_events_statements_history<span class="token operator">=</span><span class="token boolean">TRUE</span></pre></td></tr><tr><td data-num="5"></td><td><pre>与performance_schema_consumer_events_statements_current选项类似，但该选项是用于配置是否记录语句事件短历史信息，默认为<span class="token boolean">TRUE</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>performance_schema_consumer_events_stages_history_long<span class="token operator">=</span><span class="token boolean">FALSE</span></pre></td></tr><tr><td data-num="8"></td><td><pre>与performance_schema_consumer_events_statements_current选项类似，但该选项是用于配置是否记录语句事件长历史信息，默认为<span class="token boolean">FALSE</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>除了statement<span class="token punctuation">(</span>语句<span class="token punctuation">)</span>事件之外，还支持：wait<span class="token punctuation">(</span>等待<span class="token punctuation">)</span>事件、state<span class="token punctuation">(</span>阶段<span class="token punctuation">)</span>事件、<span class="token keyword">transaction</span><span class="token punctuation">(</span>事务<span class="token punctuation">)</span>事件，他们与statement事件一样都有三个启动项分别进行配置，但这些等待事件默认未启用，如果需要在MySQL Server启动时一同启动，则通常需要写进my<span class="token punctuation">.</span>cnf配置文件中</pre></td></tr><tr><td data-num="11"></td><td><pre>performance_schema_consumer_global_instrumentation<span class="token operator">=</span><span class="token boolean">TRUE</span></pre></td></tr><tr><td data-num="12"></td><td><pre>是否在MySQL Server启动时就开启全局表（如：mutex_instances、rwlock_instances、cond_instances、file_instances、users、hostsaccounts、socket_summary_by_event_name、file_summary_by_instance等大部分的全局对象计数统计和事件汇总统计信息表 ）的记录功能，启动之后也可以在setup_consumers表中使用<span class="token keyword">UPDATE</span>语句进行动态更新全局配置项</pre></td></tr><tr><td data-num="13"></td><td><pre>默认值为<span class="token boolean">TRUE</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>performance_schema_consumer_statements_digest<span class="token operator">=</span><span class="token boolean">TRUE</span></pre></td></tr><tr><td data-num="16"></td><td><pre>是否在MySQL Server启动时就开启events_statements_summary_by_digest 表的记录功能，启动之后也可以在setup_consumers表中使用<span class="token keyword">UPDATE</span>语句进行动态更新digest配置项</pre></td></tr><tr><td data-num="17"></td><td><pre>默认值为<span class="token boolean">TRUE</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>performance_schema_consumer_thread_instrumentation<span class="token operator">=</span><span class="token boolean">TRUE</span></pre></td></tr><tr><td data-num="20"></td><td><pre>是否在MySQL Server启动时就开启</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>events_xxx_summary_by_yyy_by_event_name表的记录功能，启动之后也可以在setup_consumers表中使用<span class="token keyword">UPDATE</span>语句进行动态更新线程配置项</pre></td></tr><tr><td data-num="23"></td><td><pre>默认值为<span class="token boolean">TRUE</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>performance_schema_instrument<span class="token punctuation">[</span><span class="token operator">=</span>name<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="26"></td><td><pre>是否在MySQL Server启动时就启用某些采集器，由于instruments配置项多达数千个，所以该配置项支持<span class="token keyword">key</span><span class="token operator">-</span><span class="token keyword">value</span>模式，还支持<span class="token operator">%</span>号进行通配等，如下:</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment"># [=name] 可以指定为具体的 Instruments 名称（但是这样如果有多个需要指定的时候，就需要使用该选项多次），也可以使用通配符，可以指定 instruments 相同的前缀 + 通配符，也可以使用 % 代表所有的 instruments</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">## 指定开启单个 instruments</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">--performance-schema-instrument= 'instrument_name=value'</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">## 使用通配符指定开启多个 instruments</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">--performance-schema-instrument= 'wait/synch/cond/%=COUNTED'</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment">## 开关所有的 instruments</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment">--performance-schema-instrument= '%=ON'</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment">--performance-schema-instrument= '%=OFF'</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>注意，这些启动选项要生效的前提是，需要设置performance_schema<span class="token operator">=</span><span class="token keyword">ON</span>。另外，这些启动选项虽然无法使用<span class="token keyword">show</span> variables语句查看，但我们可以通过setup_instruments和setup_consumers表查询这些选项指定的值。</pre></td></tr></table></figure><h4 id="系统变量"><a class="anchor" href="#系统变量">#</a> 系统变量</h4><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%performance_schema%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- 重要的属性解释</span></pre></td></tr><tr><td data-num="3"></td><td><pre>performance_schema<span class="token operator">=</span><span class="token keyword">ON</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="5"></td><td><pre>控制 performance_schema 功能的开关，要使用 MySQL 的 performance_schema，需要在 mysqld 启动时启用，以启用事件收集功能</pre></td></tr><tr><td data-num="6"></td><td><pre>该参数在 5.7.x 之前支持 performance_schema 的版本中默认关闭，5.7.x 版本开始默认开启</pre></td></tr><tr><td data-num="7"></td><td><pre>注意：如果 mysqld 在初始化 performance_schema 时发现无法分配任何相关的内部缓冲区，则 performance_schema 将自动禁用，并将 performance_schema 设置为 OFF</pre></td></tr><tr><td data-num="8"></td><td><pre>*/</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>performance_schema_digests_size<span class="token operator">=</span><span class="token number">10000</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="12"></td><td><pre>控制 events_statements_summary_by_digest 表中的最大行数。如果产生的语句摘要信息超过此最大值，便无法继续存入该表，此时 performance_schema 会增加状态变量</pre></td></tr><tr><td data-num="13"></td><td><pre>*/</pre></td></tr><tr><td data-num="14"></td><td><pre>performance_schema_events_statements_history_long_size<span class="token operator">=</span><span class="token number">10000</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="16"></td><td><pre>控制 events_statements_history_long 表中的最大行数，该参数控制所有会话在 events_statements_history_long 表中能够存放的总事件记录数，超过这个限制之后，最早的记录将被覆盖</pre></td></tr><tr><td data-num="17"></td><td><pre>全局变量，只读变量，整型值，5.6.3 版本引入 * 5.6.x 版本中，5.6.5 及其之前的版本默认为 10000，5.6.6 及其之后的版本默认值为 - 1，通常情况下，自动计算的值都是 10000 * 5.7.x 版本中，默认值为 - 1，通常情况下，自动计算的值都是 10000</pre></td></tr><tr><td data-num="18"></td><td><pre>*/</pre></td></tr><tr><td data-num="19"></td><td><pre>performance_schema_events_statements_history_size<span class="token operator">=</span><span class="token number">10</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="21"></td><td><pre>控制 events_statements_history 表中单个线程（会话）的最大行数，该参数控制单个会话在 events_statements_history 表中能够存放的事件记录数，超过这个限制之后，单个会话最早的记录将被覆盖</pre></td></tr><tr><td data-num="22"></td><td><pre>全局变量，只读变量，整型值，5.6.3 版本引入 * 5.6.x 版本中，5.6.5 及其之前的版本默认为 10，5.6.6 及其之后的版本默认值为 - 1，通常情况下，自动计算的值都是 10 * 5.7.x 版本中，默认值为 - 1，通常情况下，自动计算的值都是 10</pre></td></tr><tr><td data-num="23"></td><td><pre>除了 statement (语句) 事件之外，wait (等待) 事件、state (阶段) 事件、transaction (事务) 事件，他们与 statement 事件一样都有三个参数分别进行存储限制配置，有兴趣的同学自行研究，这里不再赘述</pre></td></tr><tr><td data-num="24"></td><td><pre>*/</pre></td></tr><tr><td data-num="25"></td><td><pre>performance_schema_max_digest_length<span class="token operator">=</span><span class="token number">1024</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="27"></td><td><pre>用于控制标准化形式的 SQL 语句文本在存入 performance_schema 时的限制长度，该变量与 max_digest_length 变量相关 (max_digest_length 变量含义请自行查阅相关资料)</pre></td></tr><tr><td data-num="28"></td><td><pre>全局变量，只读变量，默认值 1024 字节，整型值，取值范围 0~1048576</pre></td></tr><tr><td data-num="29"></td><td><pre>*/</pre></td></tr><tr><td data-num="30"></td><td><pre>performance_schema_max_sql_text_length<span class="token operator">=</span><span class="token number">1024</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="32"></td><td><pre>控制存入 events_statements_current，events_statements_history 和 events_statements_history_long 语句事件表中的 SQL_TEXT 列的最大 SQL 长度字节数。 超出系统变量 performance_schema_max_sql_text_length 的部分将被丢弃，不会记录，一般情况下不需要调整该参数，除非被截断的部分与其他 SQL 比起来有很大差异</pre></td></tr><tr><td data-num="33"></td><td><pre>全局变量，只读变量，整型值，默认值为 1024 字节，取值范围为 0~1048576，5.7.6 版本引入</pre></td></tr><tr><td data-num="34"></td><td><pre>降低系统变量 performance_schema_max_sql_text_length 值可以减少内存使用，但如果汇总的 SQL 中，被截断部分有较大差异，会导致没有办法再对这些有较大差异的 SQL 进行区分。 增加该系统变量值会增加内存使用，但对于汇总 SQL 来讲可以更精准地区分不同的部分。</pre></td></tr><tr><td data-num="35"></td><td><pre>*/</pre></td></tr></table></figure><h4 id="部分配置表"><a class="anchor" href="#部分配置表">#</a> 部分配置表</h4><p>配置表之间存在<span class="exturl" data-url="aHR0cHM6Ly93d3cucHJvY2Vzc29uLmNvbS92aWV3L2xpbmsvNWZjNzI4OWJlMGIzNGQxODU2ZDkxNmY4">相互关联关系</span>，按照配置影响的先后顺序可表示为：</p><p>![Performance Schema](<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vYmZhbmZhbmZhbi9pbWcvcmF3L21hc3Rlci9kb2NzaWZ5L1BlcmZvcm1hbmNl">https://gitee.com/bfanfanfan/img/raw/master/docsify/Performance</span> Schema.png)</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>performance_timers 表中记录了 server 中有哪些可用的事件计时器</pre></td></tr><tr><td data-num="3"></td><td><pre>字段解释：</pre></td></tr><tr><td data-num="4"></td><td><pre>	timer_name: 表示可用计时器名称，CYCLE 是基于 CPU 周期计数器的定时器</pre></td></tr><tr><td data-num="5"></td><td><pre>	timer_frequency: 表示每秒钟对应的计时器单位的数量，CYCLE 计时器的换算值与 CPU 的频率相关、</pre></td></tr><tr><td data-num="6"></td><td><pre>	timer_resolution: 计时器精度值，表示在每个计时器被调用时额外增加的值</pre></td></tr><tr><td data-num="7"></td><td><pre>	timer_overhead: 表示在使用定时器获取事件时开销的最小周期值</pre></td></tr><tr><td data-num="8"></td><td><pre>*/</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> performance_timers<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="12"></td><td><pre>setup_timers 表中记录当前使用的事件计时器信息</pre></td></tr><tr><td data-num="13"></td><td><pre>字段解释：</pre></td></tr><tr><td data-num="14"></td><td><pre>	name: 计时器类型，对应某个事件类别</pre></td></tr><tr><td data-num="15"></td><td><pre>	timer_name: 计时器类型名称</pre></td></tr><tr><td data-num="16"></td><td><pre>*/</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> setup_timers<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="20"></td><td><pre>setup_consumers 表中列出了 consumers 可配置列表项</pre></td></tr><tr><td data-num="21"></td><td><pre>字段解释：</pre></td></tr><tr><td data-num="22"></td><td><pre>	NAME：consumers 配置名称</pre></td></tr><tr><td data-num="23"></td><td><pre>	ENABLED：consumers 是否启用，有效值为 YES 或 NO，此列可以使用 UPDATE 语句修改。</pre></td></tr><tr><td data-num="24"></td><td><pre>*/</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> setup_consumers<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="28"></td><td><pre>setup_instruments 表列出了 instruments 列表配置项，即代表了哪些事件支持被收集：</pre></td></tr><tr><td data-num="29"></td><td><pre>字段解释：</pre></td></tr><tr><td data-num="30"></td><td><pre>	NAME：instruments 名称，instruments 名称可能具有多个部分并形成层次结构</pre></td></tr><tr><td data-num="31"></td><td><pre>	ENABLED：instrumetns 是否启用，有效值为 YES 或 NO，此列可以使用 UPDATE 语句修改。如果设置为 NO，则这个 instruments 不会被执行，不会产生任何的事件信息</pre></td></tr><tr><td data-num="32"></td><td><pre>	TIMED：instruments 是否收集时间信息，有效值为 YES 或 NO，此列可以使用 UPDATE 语句修改，如果设置为 NO，则这个 instruments 不会收集时间信息</pre></td></tr><tr><td data-num="33"></td><td><pre>*/</pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> setup_instruments<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="37"></td><td><pre>setup_actors 表的初始内容是匹配任何用户和主机，因此对于所有前台线程，默认情况下启用监视和历史事件收集功能</pre></td></tr><tr><td data-num="38"></td><td><pre>字段解释：</pre></td></tr><tr><td data-num="39"></td><td><pre>	HOST：与 grant 语句类似的主机名，一个具体的字符串名字，或使用 “％” 表示 “任何主机”</pre></td></tr><tr><td data-num="40"></td><td><pre>	USER：一个具体的字符串名称，或使用 “％” 表示 “任何用户”</pre></td></tr><tr><td data-num="41"></td><td><pre>	ROLE：当前未使用，MySQL 8.0 中才启用角色功能</pre></td></tr><tr><td data-num="42"></td><td><pre>	ENABLED：是否启用与 HOST，USER，ROLE 匹配的前台线程的监控功能，有效值为：YES 或 NO</pre></td></tr><tr><td data-num="43"></td><td><pre>	HISTORY：是否启用与 HOST， USER，ROLE 匹配的前台线程的历史事件记录功能，有效值为：YES 或 NO</pre></td></tr><tr><td data-num="44"></td><td><pre>*/</pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> setup_actors<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="48"></td><td><pre>setup_objects 表控制 performance_schema 是否监视特定对象。默认情况下，此表的最大行数为 100 行。</pre></td></tr><tr><td data-num="49"></td><td><pre>字段解释：</pre></td></tr><tr><td data-num="50"></td><td><pre>	OBJECT_TYPE：instruments 类型，有效值为：“EVENT”（事件调度器事件）、“FUNCTION”（存储函数）、“PROCEDURE”（存储过程）、“TABLE”（基表）、“TRIGGER”（触发器），TABLE 对象类型的配置会影响表 I/O 事件（wait/io/table/sql/handler instrument）和表锁事件（wait/lock/table/sql/handler instrument）的收集</pre></td></tr><tr><td data-num="51"></td><td><pre>	OBJECT_SCHEMA：某个监视类型对象涵盖的数据库名称，一个字符串名称，或 “％”(表示 “任何数据库”)</pre></td></tr><tr><td data-num="52"></td><td><pre>	OBJECT_NAME：某个监视类型对象涵盖的表名，一个字符串名称，或 “％”(表示 “任何数据库内的对象”)</pre></td></tr><tr><td data-num="53"></td><td><pre>	ENABLED：是否开启对某个类型对象的监视功能，有效值为：YES 或 NO。此列可以修改</pre></td></tr><tr><td data-num="54"></td><td><pre>	TIMED：是否开启对某个类型对象的时间收集功能，有效值为：YES 或 NO，此列可以修改</pre></td></tr><tr><td data-num="55"></td><td><pre>*/</pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> setup_objects<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="59"></td><td><pre>threads 表对于每个 server 线程生成一行包含线程相关的信息，</pre></td></tr><tr><td data-num="60"></td><td><pre>字段解释：</pre></td></tr><tr><td data-num="61"></td><td><pre>	THREAD_ID：线程的唯一标识符（ID）</pre></td></tr><tr><td data-num="62"></td><td><pre>	NAME：与 server 中的线程检测代码相关联的名称 (注意，这里不是 instruments 名称)</pre></td></tr><tr><td data-num="63"></td><td><pre>	TYPE：线程类型，有效值为：FOREGROUND、BACKGROUND。分别表示前台线程和后台线程</pre></td></tr><tr><td data-num="64"></td><td><pre>	PROCESSLIST_ID：对应 INFORMATION_SCHEMA.PROCESSLIST 表中的 ID 列。</pre></td></tr><tr><td data-num="65"></td><td><pre>	PROCESSLIST_USER：与前台线程相关联的用户名，对于后台线程为 NULL。</pre></td></tr><tr><td data-num="66"></td><td><pre>	PROCESSLIST_HOST：与前台线程关联的客户端的主机名，对于后台线程为 NULL。</pre></td></tr><tr><td data-num="67"></td><td><pre>	PROCESSLIST_DB：线程的默认数据库，如果没有，则为 NULL。</pre></td></tr><tr><td data-num="68"></td><td><pre>	PROCESSLIST_COMMAND：对于前台线程，该值代表着当前客户端正在执行的 command 类型，如果是 sleep 则表示当前会话处于空闲状态</pre></td></tr><tr><td data-num="69"></td><td><pre>	PROCESSLIST_TIME：当前线程已处于当前线程状态的持续时间（秒）</pre></td></tr><tr><td data-num="70"></td><td><pre>	PROCESSLIST_STATE：表示线程正在做什么事情。</pre></td></tr><tr><td data-num="71"></td><td><pre>	PROCESSLIST_INFO：线程正在执行的语句，如果没有执行任何语句，则为 NULL。</pre></td></tr><tr><td data-num="72"></td><td><pre>	PARENT_THREAD_ID：如果这个线程是一个子线程（由另一个线程生成），那么该字段显示其父线程 ID</pre></td></tr><tr><td data-num="73"></td><td><pre>	ROLE：暂未使用</pre></td></tr><tr><td data-num="74"></td><td><pre>	INSTRUMENTED：线程执行的事件是否被检测。有效值：YES、NO </pre></td></tr><tr><td data-num="75"></td><td><pre>	HISTORY：是否记录线程的历史事件。有效值：YES、NO * </pre></td></tr><tr><td data-num="76"></td><td><pre>	THREAD_OS_ID：由操作系统层定义的线程或任务标识符（ID）：</pre></td></tr><tr><td data-num="77"></td><td><pre>*/</pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> threads</pre></td></tr></table></figure><h3 id="performance-schema实践"><a class="anchor" href="#performance-schema实践">#</a> Performance Schema 实践</h3><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">--1、哪类的 SQL 执行最多？</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">SELECT</span> DIGEST_TEXT<span class="token punctuation">,</span>COUNT_STAR<span class="token punctuation">,</span>FIRST_SEEN<span class="token punctuation">,</span>LAST_SEEN <span class="token keyword">FROM</span> events_statements_summary_by_digest <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> COUNT_STAR <span class="token keyword">DESC</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">--2、哪类 SQL 的平均响应时间最多？</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">SELECT</span> DIGEST_TEXT<span class="token punctuation">,</span>AVG_TIMER_WAIT <span class="token keyword">FROM</span> events_statements_summary_by_digest <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> COUNT_STAR <span class="token keyword">DESC</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">--3、哪类 SQL 排序记录数最多？</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">SELECT</span> DIGEST_TEXT<span class="token punctuation">,</span>SUM_SORT_ROWS <span class="token keyword">FROM</span> events_statements_summary_by_digest <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> COUNT_STAR <span class="token keyword">DESC</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">--4、哪类 SQL 扫描记录数最多？</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">SELECT</span> DIGEST_TEXT<span class="token punctuation">,</span>SUM_ROWS_EXAMINED <span class="token keyword">FROM</span> events_statements_summary_by_digest <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> COUNT_STAR <span class="token keyword">DESC</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">--5、哪类 SQL 使用临时表最多？</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">SELECT</span> DIGEST_TEXT<span class="token punctuation">,</span>SUM_CREATED_TMP_TABLES<span class="token punctuation">,</span>SUM_CREATED_TMP_DISK_TABLES <span class="token keyword">FROM</span> events_statements_summary_by_digest <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> COUNT_STAR <span class="token keyword">DESC</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">--6、哪类 SQL 返回结果集最多？</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">SELECT</span> DIGEST_TEXT<span class="token punctuation">,</span>SUM_ROWS_SENT <span class="token keyword">FROM</span> events_statements_summary_by_digest <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> COUNT_STAR <span class="token keyword">DESC</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">--7、哪个表物理 IO 最多？</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">SELECT</span> file_name<span class="token punctuation">,</span>event_name<span class="token punctuation">,</span>SUM_NUMBER_OF_BYTES_READ<span class="token punctuation">,</span>SUM_NUMBER_OF_BYTES_WRITE <span class="token keyword">FROM</span> file_summary_by_instance <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> SUM_NUMBER_OF_BYTES_READ <span class="token operator">+</span> SUM_NUMBER_OF_BYTES_WRITE <span class="token keyword">DESC</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">--8、哪个表逻辑 IO 最多？</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">SELECT</span> object_name<span class="token punctuation">,</span>COUNT_READ<span class="token punctuation">,</span>COUNT_WRITE<span class="token punctuation">,</span>COUNT_FETCH<span class="token punctuation">,</span>SUM_TIMER_WAIT <span class="token keyword">FROM</span> table_io_waits_summary_by_table <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sum_timer_wait <span class="token keyword">DESC</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">--9、哪个索引访问最多？</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">SELECT</span> OBJECT_NAME<span class="token punctuation">,</span>INDEX_NAME<span class="token punctuation">,</span>COUNT_FETCH<span class="token punctuation">,</span>COUNT_INSERT<span class="token punctuation">,</span>COUNT_UPDATE<span class="token punctuation">,</span>COUNT_DELETE <span class="token keyword">FROM</span> table_io_waits_summary_by_index_usage <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> SUM_TIMER_WAIT <span class="token keyword">DESC</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">--10、哪个索引从来没有用过？</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">SELECT</span> OBJECT_SCHEMA<span class="token punctuation">,</span>OBJECT_NAME<span class="token punctuation">,</span>INDEX_NAME <span class="token keyword">FROM</span> table_io_waits_summary_by_index_usage <span class="token keyword">WHERE</span> INDEX_NAME <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token operator">AND</span> COUNT_STAR <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">AND</span> OBJECT_SCHEMA <span class="token operator">&lt;></span> <span class="token string">'mysql'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> OBJECT_SCHEMA<span class="token punctuation">,</span>OBJECT_NAME<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">--11、哪个等待事件消耗时间最多？</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">SELECT</span> EVENT_NAME<span class="token punctuation">,</span>COUNT_STAR<span class="token punctuation">,</span>SUM_TIMER_WAIT<span class="token punctuation">,</span>AVG_TIMER_WAIT <span class="token keyword">FROM</span> events_waits_summary_global_by_event_name <span class="token keyword">WHERE</span> event_name <span class="token operator">!=</span> <span class="token string">'idle'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> SUM_TIMER_WAIT <span class="token keyword">DESC</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">--12-1、剖析某条 SQL 的执行情况，包括 statement 信息，stege 信息，wait 信息</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">SELECT</span> EVENT_ID<span class="token punctuation">,</span>sql_text <span class="token keyword">FROM</span> events_statements_history <span class="token keyword">WHERE</span> sql_text <span class="token operator">LIKE</span> <span class="token string">'%count(*)%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">--12-2、查看每个阶段的时间消耗</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">SELECT</span> event_id<span class="token punctuation">,</span>EVENT_NAME<span class="token punctuation">,</span>SOURCE<span class="token punctuation">,</span>TIMER_END <span class="token operator">-</span> TIMER_START <span class="token keyword">FROM</span> events_stages_history_long <span class="token keyword">WHERE</span> NESTING_EVENT_ID <span class="token operator">=</span> <span class="token number">1553</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">--12-3、查看每个阶段的锁等待情况</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">SELECT</span> event_id<span class="token punctuation">,</span>event_name<span class="token punctuation">,</span>source<span class="token punctuation">,</span>timer_wait<span class="token punctuation">,</span>object_name<span class="token punctuation">,</span>index_name<span class="token punctuation">,</span>operation<span class="token punctuation">,</span>nesting_event_id <span class="token keyword">FROM</span> events_waits_history_longWHERE nesting_event_id <span class="token operator">=</span> <span class="token number">1553</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="show-processlist"><a class="anchor" href="#show-processlist">#</a> show processlist</h2><p><span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vOC4wL2VuL3Nob3ctcHJvY2Vzc2xpc3QuaHRtbA==">show processlist</span> 命令用于查看当前 MySQL 服务的连接数</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">show</span> processlist<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">+</span><span class="token comment">----+------+-----------+--------------------+---------+------+----------+------------------+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span> Id <span class="token operator">|</span> <span class="token keyword">User</span> <span class="token operator">|</span> Host      <span class="token operator">|</span> db                 <span class="token operator">|</span> Command <span class="token operator">|</span> <span class="token keyword">Time</span> <span class="token operator">|</span> State    <span class="token operator">|</span> Info             <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">+</span><span class="token comment">----+------+-----------+--------------------+---------+------+----------+------------------+</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> root <span class="token operator">|</span> localhost <span class="token operator">|</span> performance_schema <span class="token operator">|</span> Query   <span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">starting</span> <span class="token operator">|</span> <span class="token keyword">show</span> processlist <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">+</span><span class="token comment">----+------+-----------+--------------------+---------+------+----------+------------------+</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.12</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><p>![](<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vYmZhbmZhbmZhbi9pbWcvcmF3L21hc3Rlci9kb2NzaWZ5L3Nob3c=">https://gitee.com/bfanfanfan/img/raw/master/docsify/show</span> processlist.png)</p><h2 id="schema与数据类型优化"><a class="anchor" href="#schema与数据类型优化">#</a> schema 与数据类型优化</h2><h3 id="数据类型的优化"><a class="anchor" href="#数据类型的优化">#</a> 数据类型的优化</h3><ol><li>更小的通常更好</li></ol><p>应该尽量使用可以正确存储数据的最小数据类型，更小的数据类型通常更快，因为它们占用更少的磁盘、内存和 CPU 缓存，并且处理时需要的 CPU 周期更少，但是要确保没有低估需要存储的值的范围，如果无法确认哪个数据类型，就选择你认为不会超过范围的最小类型<br>案例：<br>设计两张表，设计不同的数据类型，查看表的容量</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> 	<span class="token punctuation">`</span>tbl<span class="token punctuation">`</span><span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> 	<span class="token punctuation">`</span>tbl1<span class="token punctuation">`</span><span class="token punctuation">(</span>id <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>执行后去 MySQL 的 data 目录下查看两张表的 ibd 文件大小</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * @Description</pre></td></tr><tr><td data-num="3"></td><td><pre> * @Author yuan199696@qq.com</pre></td></tr><tr><td data-num="4"></td><td><pre> * @Date 2020-12-02 17:25</pre></td></tr><tr><td data-num="5"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num="6"></td><td><pre> * @Project mysql_test</pre></td></tr><tr><td data-num="7"></td><td><pre> **/</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DriverManager</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">PreparedStatement</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/test?serverTimezone=UTC"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token class-name">PreparedStatement</span> pstmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"insert into tbl values(?,?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">//        PreparedStatement pstmt = conn.prepareStatement("insert into tbl1 values(?,?)");</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            pstmt<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            pstmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            pstmt<span class="token punctuation">.</span><span class="token function">addBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        pstmt<span class="token punctuation">.</span><span class="token function">executeBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="2"><li><p>简单就好</p><p>简单数据类型的操作通常需要更少的 CPU 周期，例如：</p><ul><li>整型比字符操作代价更低，因为字符集和校对规则是字符比较比整型比较更复杂</li><li>使用 mysql 自建类型而不是字符串来存储日期和时间</li><li>用整型存储 IP 地址</li></ul><p>案例：创建两张相同的表，改变日期的数据类型（分别将日期类型设置为 date 和 varchar），查看 SQL 语句执行的速度</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>emp<span class="token punctuation">`</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token punctuation">`</span>empno<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token punctuation">`</span>ename<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">`</span>job<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">`</span>mgr<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">`</span>hiredate<span class="token punctuation">`</span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">`</span>sal<span class="token punctuation">`</span> <span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">`</span>comm<span class="token punctuation">`</span> <span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">`</span>deptno<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">`</span>version<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>empno<span class="token punctuation">`</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>latin1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>emp1<span class="token punctuation">`</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">`</span>empno<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">`</span>ename<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">`</span>job<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">`</span>mgr<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">`</span>hiredate<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token punctuation">`</span>sal<span class="token punctuation">`</span> <span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">`</span>comm<span class="token punctuation">`</span> <span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">`</span>deptno<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">`</span>version<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>empno<span class="token punctuation">`</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>latin1<span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">use</span> test<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">Database</span> changed</pre></td></tr><tr><td data-num="3"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">set</span> profiling<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> hiredate<span class="token operator">=</span><span class="token string">'2020-12-02'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">+</span><span class="token comment">-------+----------+------+------+----------------------------+----------+------+--------+---------+</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">|</span> empno <span class="token operator">|</span> ename    <span class="token operator">|</span> job  <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate                   <span class="token operator">|</span> sal      <span class="token operator">|</span> comm <span class="token operator">|</span> deptno <span class="token operator">|</span> version <span class="token operator">|</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">+</span><span class="token comment">-------+----------+------+------+----------------------------+----------+------+--------+---------+</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">|</span>  <span class="token number">1111</span> <span class="token operator">|</span> zhangsan <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00.000000</span> <span class="token operator">|</span> <span class="token number">15111.50</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>       <span class="token number">2</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">+</span><span class="token comment">-------+----------+------+------+----------------------------+----------+------+--------+---------+</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1 <span class="token keyword">where</span> hiredate<span class="token operator">=</span><span class="token string">'2020-12-02'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">+</span><span class="token comment">-------+----------+------+------+------------+------+------+--------+---------+</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">|</span> empno <span class="token operator">|</span> ename    <span class="token operator">|</span> job  <span class="token operator">|</span> mgr  <span class="token operator">|</span> hiredate   <span class="token operator">|</span> sal  <span class="token operator">|</span> comm <span class="token operator">|</span> deptno <span class="token operator">|</span> version <span class="token operator">|</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">+</span><span class="token comment">-------+----------+------+------+------------+------+------+--------+---------+</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">|</span>  <span class="token number">1111</span> <span class="token operator">|</span> zhangsan <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>   <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token boolean">NULL</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token operator">+</span><span class="token comment">-------+----------+------+------+------------+------+------+--------+---------+</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">show</span> profiles<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">+</span><span class="token comment">----------+------------+----------------------------------------------------------------+</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">|</span> Query_ID <span class="token operator">|</span> Duration   <span class="token operator">|</span> Query                                                          <span class="token operator">|</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token operator">+</span><span class="token comment">----------+------------+----------------------------------------------------------------+</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">0.00024875</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> hiredate<span class="token operator">=</span><span class="token string">'2020-12-02'</span>                  <span class="token operator">|</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">0.00021775</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp1 <span class="token keyword">where</span> hiredate<span class="token operator">=</span><span class="token string">'2020-12-02'</span>                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token operator">+</span><span class="token comment">----------+------------+----------------------------------------------------------------+</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><p>整型类型的 ip 地址与字符串类型的 ip 地址互相转换</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">select</span> INET_ATON<span class="token punctuation">(</span><span class="token string">'192.168.20.10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------------+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span> INET_ATON<span class="token punctuation">(</span><span class="token string">'192.168.20.10'</span><span class="token punctuation">)</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------------+</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span>                 <span class="token number">3232240650</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">+</span><span class="token comment">----------------------------+</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.11</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">select</span> INET_NTOA<span class="token punctuation">(</span><span class="token string">'3232240650'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">+</span><span class="token comment">-------------------------+</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">|</span> INET_NTOA<span class="token punctuation">(</span><span class="token string">'3232240650'</span><span class="token punctuation">)</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">+</span><span class="token comment">-------------------------+</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span> <span class="token number">192.168</span><span class="token number">.20</span><span class="token number">.10</span>           <span class="token operator">|</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">+</span><span class="token comment">-------------------------+</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.07</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure></li><li><p>尽量避免 null</p><p>如果查询中包含可为 NULL 的列，对 mysql 来说很难优化，因为可为 null 的列使得索引、索引统计和值比较都更加复杂，坦白来说，通常情况下 null 的列改为 not null 带来的性能提升比较小，所有没有必要将所有的表的 schema 进行修改，但是应该尽量避免设计成可为 null 的列。</p></li><li><p>实际细则</p><ul><li><p>整数类型</p><p>可以使用的几种整数类型：TINYINT，SMALLINT，MEDIUMINT，INT，BIGINT 分别使用 8，16，24，32，64 位存储空间。尽量使用满足需求的最小数据类型。</p></li><li><p>字符串和字符类型</p><ul><li><p>char 长度固定，即每条数据占用等长字节空间；最大长度是 255 个字符，适合用在身份证号、手机号等定长字符串</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203132352459.png" alt="image-20201203132352459"></p></li><li><p>varchar 可变程度，可以设置最大长度；最大空间是 65535 个字节，适合用在长度可变的属性</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203133227617.png" alt="image-20201203133227617"></p></li><li><p>text 不设置长度，当不知道属性的最大长度时，适合用 text<br>按照查询速度：char&gt;varchar&gt;text</p></li></ul></li><li><p>BLOB 和 TEXT 类型</p><p>MySQL 把每个 BLOB 和 TEXT 值当作一个独立的对象处理。两者都是为了存储很大数据而设计的字符串类型，分别采用二进制和字符方式存储。</p></li><li><p>datetime 和 timestamp</p><ul><li>不要使用字符串类型来存储日期时间数据</li><li>日期时间类型通常比字符串占用的存储空间小</li><li>日期时间类型在进行查找过滤时可以利用日期来进行比对</li><li>日期时间类型还有着丰富的处理函数，可以方便的对时间类型进行日期计算</li><li>使用 int 存储日期时间不如使用 timestamp（存储的是整数型的秒值）类型</li></ul><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203133308533.png" alt="image-20201203133308533"></p></li><li><p>使用枚举替代字符串类型</p><p>有时可以使用枚举类代替常用的字符串类型，mysql 存储枚举类型会非常紧凑，会根据列表值的数据压缩到一个或两个字节中，mysql 在内部会将每个值在列表中的位置保存为整数，并且在表的.frm 文件中保存 “数字 - 字符串” 映射关系的查找表。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> enum_test<span class="token punctuation">(</span>e <span class="token keyword">enum</span><span class="token punctuation">(</span><span class="token string">'fish'</span><span class="token punctuation">,</span><span class="token string">'apple'</span><span class="token punctuation">,</span><span class="token string">'dog'</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">insert</span> <span class="token keyword">into</span> enum_test<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'fish'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">select</span> e<span class="token operator">+</span><span class="token number">0</span> <span class="token keyword">from</span> enum_test<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> enum_test <span class="token keyword">where</span> e<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>elect <span class="token operator">*</span> <span class="token keyword">from</span> enum_test <span class="token keyword">where</span> e<span class="token operator">=</span><span class="token string">'fish'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>特殊类型数据</p><p>人们经常使用 varchar (15) 来存储 ip 地址，然而，它的本质是 32 位无符号整数不是字符串，可以使用 INET_ATON () 和 INET_NTOA 函数在这两种表示方法之间转换。<br>案例：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span> inet_aton<span class="token punctuation">(</span><span class="token string">'1.1.1.1'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">select</span> inet_ntoa<span class="token punctuation">(</span><span class="token number">16843009</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li></ul></li></ol><h3 id="范式与反范式"><a class="anchor" href="#范式与反范式">#</a> 范式与反范式</h3><p>三范式：列不可分、不能存在传递依赖、其他列的值必须依赖主键</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203133751577.png" alt="image-20201203133751577"></p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203141546203.png" alt="image-20201203141546203"></p><p>案例：</p><p>范式设计</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203141632645.png" alt="image-20201203141632645"></p><p>反范式设计</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203141658716.png" alt="image-20201203141658716"></p><h3 id="主键的选择"><a class="anchor" href="#主键的选择">#</a> 主键的选择</h3><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203141150639.png" alt="image-20201203141150639"></p><h3 id="字符集的选择"><a class="anchor" href="#字符集的选择">#</a> 字符集的选择</h3><p>MySQL 中 utf8 编码只允许存储两个字节的字符，当有的中文超过两个字节时就会报错，推荐使用 utf8mb4 编码。</p><p>没有中文时可以使用 latin1 编码。</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203141220228.png" alt="image-20201203141220228"></p><h3 id="存储引擎的选择"><a class="anchor" href="#存储引擎的选择">#</a> 存储引擎的选择</h3><p>存储引擎代表数据文件的组织形式</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203141408743.png" alt="image-20201203141408743"></p><h3 id="适当的数据冗余"><a class="anchor" href="#适当的数据冗余">#</a> 适当的数据冗余</h3><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201203141439587.png" alt="image-20201203141439587"></p><h3 id="适当拆分"><a class="anchor" href="#适当拆分">#</a> 适当拆分</h3><p>垂直切分：按照业务来切分。将不同业务的表放在不同的服务器中来减少一台服务器的压力。</p><p>水平切分：切分表字段。</p><p>当我们的表中存在类似于 TEXT 或者是很大的 VARCHAR 类型的大字段的时候，如果我们大部分访问这张表的时候都不需要这个字段，我们就该义无反顾的将其拆分到另外的独立表中，以减少常用数据所占用的存储空间。这样做的一个明显好处就是每个数据块中可以存储的数据条数可以大大增加，既减少物理 IO 次数，也能大大提高内存中的缓存命中率。</p><h2 id="执行计划"><a class="anchor" href="#执行计划">#</a> 执行计划</h2><p>在企业的应用场景中，为了知道优化 SQL 语句的执行，需要查看 SQL 语句的具体执行过程，以加快 SQL 语句的执行效率。</p><p>可以使用 explain+SQL 语句来模拟优化器执行 SQL 查询语句，从而知道 mysql 是如何处理 sql 语句的。</p><p><span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vNS43L2VuL2V4cGxhaW4uaHRtbA==">explain 使用</span></p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>&#123;<span class="token keyword">EXPLAIN</span> <span class="token operator">|</span> <span class="token keyword">DESCRIBE</span> <span class="token operator">|</span> <span class="token keyword">DESC</span>&#125;</pre></td></tr><tr><td data-num="2"></td><td><pre>    tbl_name <span class="token punctuation">[</span>col_name <span class="token operator">|</span> wild<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>&#123;<span class="token keyword">EXPLAIN</span> <span class="token operator">|</span> <span class="token keyword">DESCRIBE</span> <span class="token operator">|</span> <span class="token keyword">DESC</span>&#125;</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">[</span>explain_type<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    &#123;explainable_stmt <span class="token operator">|</span> <span class="token keyword">FOR</span> CONNECTION connection_id&#125;</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>explain_type: &#123;</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">EXTENDED</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token operator">|</span> PARTITIONS</pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token operator">|</span> FORMAT <span class="token operator">=</span> format_name</pre></td></tr><tr><td data-num="12"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>format_name: &#123;</pre></td></tr><tr><td data-num="15"></td><td><pre>    TRADITIONAL</pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token operator">|</span> JSON</pre></td></tr><tr><td data-num="17"></td><td><pre>&#125;</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>explainable_stmt: &#123;</pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">SELECT</span> statement</pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token operator">|</span> <span class="token keyword">DELETE</span> statement</pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token operator">|</span> <span class="token keyword">INSERT</span> statement</pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token operator">|</span> <span class="token keyword">REPLACE</span> statement</pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token operator">|</span> <span class="token keyword">UPDATE</span> statement</pre></td></tr><tr><td data-num="25"></td><td><pre>&#125;</pre></td></tr></table></figure><h3 id="执行计划中包含的信息"><a class="anchor" href="#执行计划中包含的信息">#</a> 执行计划中包含的信息</h3><p><span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vNS41L2VuL2V4cGxhaW4tb3V0cHV0Lmh0bWw=">各字段含义</span></p><table><thead><tr><th style="text-align:center">Column</th><th style="text-align:center">Meaning</th></tr></thead><tbody><tr><td style="text-align:center">id</td><td style="text-align:center">The <code>SELECT</code> identifier</td></tr><tr><td style="text-align:center">select_type</td><td style="text-align:center">The <code>SELECT</code> type</td></tr><tr><td style="text-align:center">table</td><td style="text-align:center">The table for the output row</td></tr><tr><td style="text-align:center">partitions</td><td style="text-align:center">The matching partitions</td></tr><tr><td style="text-align:center">type</td><td style="text-align:center">The join type</td></tr><tr><td style="text-align:center">possible_keys</td><td style="text-align:center">The possible indexes to choose</td></tr><tr><td style="text-align:center">key</td><td style="text-align:center">The index actually chosen</td></tr><tr><td style="text-align:center">key_len</td><td style="text-align:center">The length of the chosen key</td></tr><tr><td style="text-align:center">ref</td><td style="text-align:center">The columns compared to the index</td></tr><tr><td style="text-align:center">rows</td><td style="text-align:center">Estimate of rows to be examined</td></tr><tr><td style="text-align:center">filtered</td><td style="text-align:center">Percentage of rows filtered by table condition</td></tr><tr><td style="text-align:center">extra</td><td style="text-align:center">Additional information</td></tr></tbody></table><p><strong>id</strong></p><p>select 查询的序列号，包含一组数字，表示查询中执行 select 子句或者操作表的顺序</p><p>id 号分为三种情况：</p><p>​ 1、如果 id 相同，那么执行顺序从上到下</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">join</span> dept d <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno <span class="token operator">and</span> e<span class="token punctuation">.</span>deptno<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+----------------------------------------------------+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                                              <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+----------------------------------------------------+</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> d     <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span>                                        <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> e     <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">join</span> buffer <span class="token punctuation">(</span>Block Nested <span class="token keyword">Loop</span><span class="token punctuation">)</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+----------------------------------------------------+</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><p>​ 2、如果 id 不同，如果是子查询，id 的序号会递增，id 值越大优先级越高，越先被执行</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> deptno <span class="token keyword">from</span> dept d <span class="token keyword">where</span> d<span class="token punctuation">.</span>dname<span class="token operator">=</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">+</span><span class="token comment">----+--------------+-------------+------+---------------+------+---------+------+------+----------------------------------------------------+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type  <span class="token operator">|</span> <span class="token keyword">table</span>       <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                                              <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">+</span><span class="token comment">----+--------------+-------------+------+---------------+------+---------+------+------+----------------------------------------------------+</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>       <span class="token operator">|</span> <span class="token operator">&lt;</span>subquery2<span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>       <span class="token operator">|</span> e           <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">join</span> buffer <span class="token punctuation">(</span>Block Nested <span class="token keyword">Loop</span><span class="token punctuation">)</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> MATERIALIZED <span class="token operator">|</span> d           <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span>                                        <span class="token operator">|</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">+</span><span class="token comment">----+--------------+-------------+------+---------------+------+---------+------+------+----------------------------------------------------+</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>xxxxxxxxxx mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> deptno <span class="token keyword">from</span> dept d <span class="token keyword">where</span> d<span class="token punctuation">.</span>dname<span class="token operator">=</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+--------------+-------------+------+---------------+------+---------+------+------+----------------------------------------------------+| id | select_type  | table       | type | possible_keys | key  | key_len | ref  | rows | Extra                                              |+----+--------------+-------------+------+---------------+------+---------+------+------+----------------------------------------------------+|  1 | SIMPLE       | &lt;subquery2> | ALL  | NULL          | NULL | NULL    | NULL | NULL | NULL                                               ||  1 | SIMPLE       | e           | ALL  | NULL          | NULL | NULL    | NULL |    5 | Using where; Using join buffer (Block Nested Loop) ||  2 | MATERIALIZED | d           | ALL  | NULL          | NULL | NULL    | NULL |    2 | Using where                                        |+----+--------------+-------------+------+---------------+------+---------+------+------+----------------------------------------------------+3 rows in set (0.00 sec)explain select * from emp e where e.deptno in (select d.deptno from dept d where d.dname = 'SALES');sql</span></pre></td></tr></table></figure><p>​ 3、id 相同和不同的，同时存在：相同的可以认为是一组，从上往下顺序执行，在所有组中，id 值越大，优先级越高，越先执行</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">join</span> dept d <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> d<span class="token punctuation">.</span>deptno <span class="token keyword">from</span> dept d <span class="token keyword">where</span> d<span class="token punctuation">.</span>dname<span class="token operator">=</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">+</span><span class="token comment">----+--------------+-------------+------+---------------+------+---------+------+------+----------------------------------------------------+</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type  <span class="token operator">|</span> <span class="token keyword">table</span>       <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                                              <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">+</span><span class="token comment">----+--------------+-------------+------+---------------+------+---------+------+------+----------------------------------------------------+</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>       <span class="token operator">|</span> d           <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>                                               <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>       <span class="token operator">|</span> <span class="token operator">&lt;</span>subquery2<span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">join</span> buffer <span class="token punctuation">(</span>Block Nested <span class="token keyword">Loop</span><span class="token punctuation">)</span>              <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>       <span class="token operator">|</span> e           <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">join</span> buffer <span class="token punctuation">(</span>Block Nested <span class="token keyword">Loop</span><span class="token punctuation">)</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> MATERIALIZED <span class="token operator">|</span> d           <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span>                                        <span class="token operator">|</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">+</span><span class="token comment">----+--------------+-------------+------+---------------+------+---------+------+------+----------------------------------------------------+</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.10</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>select_type</strong></p><p>主要用来分辨查询的类型，是普通查询还是联合查询还是子查询</p><table><thead><tr><th style="text-align:center"><code>select_type</code> Value</th><th style="text-align:center">Meaning</th></tr></thead><tbody><tr><td style="text-align:center">SIMPLE</td><td style="text-align:center">Simple SELECT (not using UNION or subqueries)</td></tr><tr><td style="text-align:center">PRIMARY</td><td style="text-align:center">Outermost SELECT</td></tr><tr><td style="text-align:center">UNION</td><td style="text-align:center">Second or later SELECT statement in a UNION</td></tr><tr><td style="text-align:center">DEPENDENT UNION</td><td style="text-align:center">Second or later SELECT statement in a UNION, dependent on outer query</td></tr><tr><td style="text-align:center">UNION RESULT</td><td style="text-align:center">Result of a UNION.</td></tr><tr><td style="text-align:center">SUBQUERY</td><td style="text-align:center">First SELECT in subquery</td></tr><tr><td style="text-align:center">DEPENDENT SUBQUERY</td><td style="text-align:center">First SELECT in subquery, dependent on outer query</td></tr><tr><td style="text-align:center">DERIVED</td><td style="text-align:center">Derived table</td></tr><tr><td style="text-align:center">UNCACHEABLE SUBQUERY</td><td style="text-align:center">A subquery for which the result cannot be cached and must be re-evaluated for each row of the outer query</td></tr><tr><td style="text-align:center">UNCACHEABLE UNION</td><td style="text-align:center">The second or later select in a UNION that belongs to an uncacheable subquery (see UNCACHEABLE SUBQUERY)</td></tr></tbody></table><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">--sample: 简单的查询，不包含子查询和 union</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">--primary: 查询中若包含任何复杂的子查询，最外层查询则被标记为 Primary</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> staname<span class="token punctuation">,</span>ename supname <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> ename staname<span class="token punctuation">,</span>mgr <span class="token keyword">from</span> emp<span class="token punctuation">)</span> t <span class="token keyword">join</span> emp <span class="token keyword">on</span> t<span class="token punctuation">.</span>mgr<span class="token operator">=</span>emp<span class="token punctuation">.</span>empno <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">--union: 若第二个 select 出现在 union 之后，则被标记为 union</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">></span><span class="token number">2000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">--dependent union: 跟 union 类似，此处的 depentent 表示 union 或 union all 联合而成的结果会受外部表影响</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> e<span class="token punctuation">.</span>empno  <span class="token operator">in</span> <span class="token punctuation">(</span> <span class="token keyword">select</span> empno <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">union</span> <span class="token keyword">select</span> empno <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">></span><span class="token number">2000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">--union result: 从 union 表获取结果的 select</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">></span><span class="token number">2000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">--subquery: 在 select 或者 where 列表中包含子查询</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">></span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">)</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">--dependent subquery:subquery 的子查询要受到外部表查询的影响</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> deptno <span class="token keyword">from</span> dept<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">--DERIVED: from 子句中出现的子查询，也叫做派生类，</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> staname<span class="token punctuation">,</span>ename supname <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> ename staname<span class="token punctuation">,</span>mgr <span class="token keyword">from</span> emp<span class="token punctuation">)</span> t <span class="token keyword">join</span> emp <span class="token keyword">on</span> t<span class="token punctuation">.</span>mgr<span class="token operator">=</span>emp<span class="token punctuation">.</span>empno <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">--UNCACHEABLE SUBQUERY：表示使用子查询的结果不能被缓存</span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> empno <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno<span class="token operator">=</span>@<span class="token variable">@sort_buffer_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre> </pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">--uncacheable union: 表示 union 的查询结果不能被缓存：sql 语句未验证</span></pre></td></tr></table></figure><p><strong>table</strong></p><p>对应行正在访问哪一个表，表名或者别名，可能是临时表或者 union 合并结果集<br>1、如果是具体的表名，则表明从实际的物理表中获取数据，当然也可以是表的别名</p><p>​ 2、表名是 derivedN 的形式，表示使用了 id 为 N 的查询产生的衍生表</p><p>​ 3、当有 union result 的时候，表名是 union n1,n2 等的形式，n1,n2 表示参与 union 的 id</p><p><strong>type</strong></p><p>type 显示的是访问类型，访问类型表示我是以何种方式去访问我们的数据，最容易想的是全表扫描，直接暴力的遍历一张表去寻找需要的数据，效率非常低下，访问的类型有很多，效率从最好到最坏依次是：</p><p>system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</p><p>一般情况下，得保证查询至少达到 range 级别，最好能达到 ref</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">--all: 全表扫描，一般情况下出现这样的 sql 语句而且数据量比较大的话那么就需要进行优化。</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+-------+</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra <span class="token operator">|</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+-------+</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> emp   <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+-------+</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">--index：全索引扫描这个比 all 的效率要好，主要有两种情况，一种是当前的查询时覆盖索引，即我们需要的数据在索引中就可以索取，或者是使用了索引进行排序，这样就避免数据的重排序</span></pre></td></tr><tr><td data-num="11"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> empno <span class="token keyword">from</span> emp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> emp   <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">--range：表示利用索引查询的时候限制了范围，在指定范围内进行查询，这样避免了 index 的全索引扫描，适用的操作符： =, &lt;>, >, >=, &lt;, &lt;=, IS NULL, BETWEEN, LIKE, or IN () </span></pre></td></tr><tr><td data-num="20"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">between</span> <span class="token number">1111</span> <span class="token operator">and</span> <span class="token number">4444</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> emp   <span class="token operator">|</span> range <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">--index_subquery：利用索引来关联子查询，不再扫描全表</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> emp<span class="token punctuation">.</span>job <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> job <span class="token keyword">from</span> t_job<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">--unique_subquery: 该连接类型类似与 index_subquery, 使用的是唯一索引</span></pre></td></tr><tr><td data-num="32"></td><td><pre> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> deptno <span class="token keyword">from</span> dept<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre> </pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">--index_merge：在查询过程中需要多个索引组合使用，没有模拟出来</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">--ref_or_null：对于某个字段即需要关联条件，也需要 null 值的情况下，查询优化器会选择这种访问方式</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span>  e<span class="token punctuation">.</span>mgr <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">or</span> e<span class="token punctuation">.</span>mgr<span class="token operator">=</span><span class="token number">7369</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment">--ref：使用了非唯一性索引进行数据的查找</span></pre></td></tr><tr><td data-num="40"></td><td><pre> <span class="token keyword">create</span> <span class="token keyword">index</span> idx_3 <span class="token keyword">on</span> emp<span class="token punctuation">(</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e<span class="token punctuation">,</span>dept d <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span>d<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token comment">--eq_ref ：使用唯一性索引进行数据查找</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>emp2 <span class="token keyword">where</span> emp<span class="token punctuation">.</span>empno <span class="token operator">=</span> emp2<span class="token punctuation">.</span>empno<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token comment">--const：这个表至多有一个匹配行，</span></pre></td></tr><tr><td data-num="47"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno<span class="token operator">=</span><span class="token string">'1111'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra <span class="token operator">|</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> emp   <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.11</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre> </pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token comment">--system：表只有一行记录（等于系统表），这是 const 类型的特例，平时不会出现</span></pre></td></tr></table></figure><p><strong>possible_keys</strong></p><p>​ 显示可能应用在这张表中的索引，一个或多个，查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询实际使用</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">and</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>key</strong></p><p>​ 实际使用的索引，如果为 null，则没有使用索引，查询中若使用了覆盖索引，则该索引和查询的 select 字段重叠。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">and</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>key_len</strong></p><p>表示索引中使用的字节数，可以通过 key_len 计算查询中使用的索引长度，在不损失精度的情况下长度越短越好。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">and</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>ref</strong></p><p>显示哪一列的索引被使用了，如果可能的话，是一个常数</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">and</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>rows</strong></p><p>根据表的统计信息及索引使用情况，大致估算出找出所需记录需要读取的行数，此参数很重要，直接反应的 sql 找了多少数据，在完成目的的情况下越少越好</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>extra</strong></p><p>包含额外的信息。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">--using filesort: 说明 mysql 无法利用索引进行排序，只能利用排序算法进行排序，会消耗额外的位置</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> sal<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+----------------+</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra          <span class="token operator">|</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+----------------+</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> emp   <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span> <span class="token keyword">Using</span> filesort <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+----------------+</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">--using temporary: 建立临时表来保存中间结果，查询完成之后把临时表删除</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">group</span> <span class="token keyword">by</span> ename<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">--using index: 这个表示当前的查询是覆盖索引的，直接从索引中读取数据，而不用访问数据表。如果同时出现 using where 表示索引被用来执行索引键值的查找，如果没有，表示索引被用来读取数据，而不是真的查找</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">--using where: 使用 where 进行条件过滤</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_user <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">--using join buffer: 使用连接缓存，情况没有模拟出来</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">--impossible where：没有匹配的结果，where 语句的结果总是 false</span></pre></td></tr><tr><td data-num="22"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno<span class="token operator">=</span><span class="token string">'6666'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+-----------------------------------------------------+</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra</pre></td></tr><tr><td data-num="25"></td><td><pre>               <span class="token operator">|</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+-----------------------------------------------------+</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> Impossible <span class="token keyword">WHERE</span> noticed <span class="token keyword">after</span> reading const <span class="token keyword">tables</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+-------+------+---------------+------+---------+------+------+-----------------------------------------------------+</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="索引优化"><a class="anchor" href="#索引优化">#</a> 索引优化</h2><p><span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vNS43L2VuL29wdGltaXphdGlvbi1pbmRleGVzLmh0bWw=">索引使用</span></p><h3 id="树的发展"><a class="anchor" href="#树的发展">#</a> 树的发展</h3><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY3MudXNmY2EuZWR1L35nYWxsZXMvdmlzdWFsaXphdGlvbi9BbGdvcml0aG1zLmh0bWw=">树的在线模拟</span></p><ul><li><p>二叉树：每个分支节点过多，导致 IO 次数过多，影响数据读取效率。</p></li><li><p>二叉搜索树（BST）</p></li><li><p>二叉平衡树（AVL）：最短子树和最长子树长度差不能超过 1。查找效率高，插入和删除效率低，因为每当节点改变后需要进行左旋或右旋来保证平衡。且任何旋转都比较浪费时间。</p></li><li><p>红黑树（RBT）：旋转加变色；最长子树长度不超过最短子树的两倍；任何一条分支不能有两个连续的红色节点；各条分支的黑色节点个数相同。是 AVL 树的一个变种，变色的目的是减少旋转次数，损失了 AVL 树部分的查找性能，在查找和插入之间做了平衡。</p></li></ul><p><span class="exturl" data-url="aHR0cHM6Ly93d3cucHJvY2Vzc29uLmNvbS92aWV3L2xpbmsvNWZjOWRlNDVlNDAxZmQxZTE1YzcyNjhi">红黑树节点插入过程</span></p><p>无论是二叉平衡树还是红黑树，每个节点均只有两个总的分支，最终都会因为节点的过多而导致树的深度过深，进一步导致 IO 次数过多影响数据读取效率。</p><p>MySQL 读取数据先进行预读，InnoDB 存储引擎下，每次读取 16KB 数据，即 4 页，每页大小为 4KB。</p><h3 id="b树"><a class="anchor" href="#b树">#</a> B + 树</h3><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204172424814.png" alt="image-20201204172424814"></p><h3 id="myisam"><a class="anchor" href="#myisam">#</a> MyISAM</h3><p>文件格式：数据和索引分开存放</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204171801304.png" alt="image-20201204171801304"></p><p>最后的叶子节点中放的是主键的值以及其他列数据的地址</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204172054556.png" alt="image-20201204172054556"></p><h3 id="innodb"><a class="anchor" href="#innodb">#</a> InnoDB</h3><p>文件格式：数据和索引存放在一起</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204172127470.png" alt="image-20201204172127470"></p><p>叶子节点存放的是主键的值以及其他列的数据</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204172246167.png" alt="image-20201204172246167"></p><h3 id="索引分类"><a class="anchor" href="#索引分类">#</a> 索引分类</h3><p>MySQL 默认会为唯一键建立索引，主键属于唯一键。</p><p>主键索引：为主键列所创建的索引。</p><p>唯一索引：为唯一非空列创建的索引。</p><p>普通索引：除了主键外其他列的索引。</p><p>全文索引（fulltext）：适合类型为 varchar、char、text 类型的字段列。</p><p>组合索引：几个列组合起来创建的索引。</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204173636705.png" alt="image-20201204173636705"></p><h3 id="索引采用的数据结构"><a class="anchor" href="#索引采用的数据结构">#</a> 索引采用的数据结构</h3><p>memory 存储引擎的索引实现：哈希表</p><p>InnoDB 和 MyISAM 存储引擎的实现：B + 树</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204173711572.png" alt="image-20201204173711572"></p><h3 id="索引优点"><a class="anchor" href="#索引优点">#</a> 索引优点</h3><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204173501587.png" alt="image-20201204173501587"></p><h3 id="索引的用处"><a class="anchor" href="#索引的用处">#</a> 索引的用处</h3><p>建议将具有索引的列作为 where 查询的条件，但是如果有回表的话，效率并不是很高。</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204173557678.png" alt="image-20201204173557678"></p><h3 id="索引匹配方式"><a class="anchor" href="#索引匹配方式">#</a> 索引匹配方式</h3><p>创建表</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t_hero<span class="token punctuation">`</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token punctuation">`</span>hero_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token punctuation">`</span>hero_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">`</span>hero_job<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">`</span>hero_cp<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">`</span>hero_skill<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>hero_id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_hero_name<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>hero_name<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_hero_job<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>hero_job<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_hero_name_job<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>hero_name<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>hero_job<span class="token punctuation">`</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span></pre></td></tr></table></figure><p>以上表中，hero_name、hero_job 各自有各自索引，以及这两个字段共同有一个组合索引。</p><p>索引匹配原则：根据 where 的条件来决定使用（匹配）哪个字段（列）的索引，如果没有 where 条件，那么优先使用组合索引；只查询具有索引的字段（列）时将使用覆盖索引；组合索引中，与 where 后面的字段顺序无关（但需要包含一个条件字段是构成组合索引的第一个字段，这样组合索引才会起作用），会自动优化。</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 当没有 where 条件时，将使用组合索引</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> hero_name<span class="token punctuation">,</span> hero_job <span class="token keyword">from</span> t_hero<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+-------------------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>               <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+-------------------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t_hero <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> idx_hero_name_job <span class="token operator">|</span> <span class="token number">456</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+-------------------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">-- 当查询的字段有多个且均有索引，但 where 后面的条件只有其中一个字段时，此时只使用 where 条件字段的索引，根据以下 Extra 字段的值可以看出，此时并没有使用覆盖索引（Extra 的值为 Using index 时，表明使用了覆盖索引）</span></pre></td></tr><tr><td data-num="11"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> hero_name<span class="token punctuation">,</span> hero_job <span class="token keyword">from</span> t_hero <span class="token keyword">where</span> hero_name<span class="token operator">=</span><span class="token string">'西门吹雪'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------------------------+---------------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys                   <span class="token operator">|</span> <span class="token keyword">key</span>           <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------------------------+---------------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t_hero <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_hero_name<span class="token punctuation">,</span>idx_hero_name_job <span class="token operator">|</span> idx_hero_name <span class="token operator">|</span> <span class="token number">153</span>     <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------------------------+---------------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> hero_name<span class="token punctuation">,</span> hero_job <span class="token keyword">from</span> t_hero <span class="token keyword">where</span> hero_job<span class="token operator">=</span><span class="token string">'流浪者'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+--------------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>          <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+--------------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t_hero <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_hero_job  <span class="token operator">|</span> idx_hero_job <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+--------------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">-- 当查询的字段有多个，且字段均包括在 where 中时，此时会使用哪个索引呢？？？</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">-- 1、可能跟数据量有关，当表结构比较简单并且数据量较少时，那么此时单独索引和组合索引的优化成本差不多，那么可能将优先选择单独的索引</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">-- 2、可能跟索引建立的顺序有关，如果先建立的是单独索引，那么将使用单独索引，如果先建立的是组合索引，那么将使用组合索引</span></pre></td></tr><tr><td data-num="34"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> hero_name<span class="token punctuation">,</span> hero_job <span class="token keyword">from</span> t_hero <span class="token keyword">where</span> hero_name<span class="token operator">=</span><span class="token string">'西门吹雪'</span> <span class="token operator">and</span> hero_job<span class="token operator">=</span><span class="token string">'流浪者'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+----------------------------------------------+---------------+---------+-------+------+------------------------------------+</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys                                <span class="token operator">|</span> <span class="token keyword">key</span>           <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra</pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token operator">|</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+----------------------------------------------+---------------+---------+-------+------+------------------------------------+</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t_hero <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_hero_name<span class="token punctuation">,</span>idx_hero_job<span class="token punctuation">,</span>idx_hero_name_job <span class="token operator">|</span> idx_hero_name <span class="token operator">|</span> <span class="token number">153</span>     <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition<span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+----------------------------------------------+---------------+---------+-------+------+------------------------------------+</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment">-- 这里先把以上两个单独索引删除，之后再重新建立，此时可以看到使用了组合索引</span></pre></td></tr><tr><td data-num="43"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>t_hero<span class="token punctuation">`</span> <span class="token keyword">drop</span> <span class="token keyword">index</span> <span class="token punctuation">`</span>idx_hero_name<span class="token punctuation">`</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.33</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>t_hero<span class="token punctuation">`</span> <span class="token keyword">drop</span> <span class="token keyword">index</span> <span class="token punctuation">`</span>idx_hero_job<span class="token punctuation">`</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token comment">-- 只剩组合索引后，当然是使用组合索引，并且是索引覆盖</span></pre></td></tr><tr><td data-num="51"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> hero_name<span class="token punctuation">,</span> hero_job <span class="token keyword">from</span> t_hero <span class="token keyword">where</span> hero_job<span class="token operator">=</span><span class="token string">'流浪者'</span> <span class="token operator">and</span> hero_name<span class="token operator">=</span><span class="token string">'西门吹雪'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+-------------------+-------------------+---------+-------------+------+--------------------------+</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys     <span class="token operator">|</span> <span class="token keyword">key</span>               <span class="token operator">|</span> key_len <span class="token operator">|</span> ref         <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                    <span class="token operator">|</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+-------------------+-------------------+---------+-------------+------+--------------------------+</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t_hero <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_hero_name_job <span class="token operator">|</span> idx_hero_name_job <span class="token operator">|</span> <span class="token number">456</span>     <span class="token operator">|</span> const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+-------------------+-------------------+---------+-------------+------+--------------------------+</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>t_hero<span class="token punctuation">`</span> <span class="token keyword">add</span> <span class="token keyword">index</span> <span class="token punctuation">`</span>idx_hero_name<span class="token punctuation">`</span><span class="token punctuation">(</span>hero_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>t_hero<span class="token punctuation">`</span> <span class="token keyword">add</span> <span class="token keyword">index</span> <span class="token punctuation">`</span>idx_hero_job<span class="token punctuation">`</span><span class="token punctuation">(</span>hero_job<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.10</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token comment">-- 此时可以发现，单独索引删除后再重新建立，将使用组合索引并且是覆盖索引</span></pre></td></tr><tr><td data-num="67"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> hero_name<span class="token punctuation">,</span> hero_job <span class="token keyword">from</span> t_hero <span class="token keyword">where</span> hero_job<span class="token operator">=</span><span class="token string">'流浪者'</span> <span class="token operator">and</span> hero_name<span class="token operator">=</span><span class="token string">'西门吹雪'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+----------------------------------------------+-------------------+---------+-------------+------+--------------------------+</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys                                <span class="token operator">|</span> <span class="token keyword">key</span>               <span class="token operator">|</span> key_len <span class="token operator">|</span> ref         <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                    <span class="token operator">|</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+----------------------------------------------+-------------------+---------+-------------+------+--------------------------+</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t_hero <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_hero_name_job<span class="token punctuation">,</span>idx_hero_name<span class="token punctuation">,</span>idx_hero_job <span class="token operator">|</span> idx_hero_name_job <span class="token operator">|</span> <span class="token number">456</span>     <span class="token operator">|</span> const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+----------------------------------------------+-------------------+---------+-------------+------+--------------------------+</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre></pre></td></tr><tr><td data-num="75"></td><td><pre></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre></pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token comment">-- 如果只查询单独一个具有索引的字段时，此时可以看到使用了索引覆盖</span></pre></td></tr><tr><td data-num="81"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> hero_job <span class="token keyword">from</span> t_hero <span class="token keyword">where</span> hero_job<span class="token operator">=</span><span class="token string">'流浪者'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+--------------+---------+-------+------+--------------------------+</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>          <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                    <span class="token operator">|</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+--------------+---------+-------+------+--------------------------+</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t_hero <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_hero_job  <span class="token operator">|</span> idx_hero_job <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+--------------+---------+-------+------+--------------------------+</span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="88"></td><td><pre></pre></td></tr><tr><td data-num="89"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> hero_job <span class="token keyword">from</span> t_hero<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+--------------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>          <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+--------------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t_hero <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> idx_hero_job <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+--------------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="96"></td><td><pre></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token comment">-- 如果只查询单独一个具有索引字段，但是 where 条件并不是查询的字段时，此时可以看到将不会使用覆盖索引，而是根据 where 后字段的索引进行匹配</span></pre></td></tr><tr><td data-num="98"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> hero_job <span class="token keyword">from</span> t_hero <span class="token keyword">where</span> hero_name<span class="token operator">=</span><span class="token string">'西门吹雪'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------------------------+---------------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys                   <span class="token operator">|</span> <span class="token keyword">key</span>           <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------------------------+---------------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t_hero <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_hero_name<span class="token punctuation">,</span>idx_hero_name_job <span class="token operator">|</span> idx_hero_name <span class="token operator">|</span> <span class="token number">153</span>     <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------------------------+---------------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><p>再看另外一个例子：</p><p>创建表</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>staffs<span class="token punctuation">`</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">''</span> <span class="token keyword">comment</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">`</span>age<span class="token punctuation">`</span> <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">0</span> <span class="token keyword">comment</span> <span class="token string">'职位'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">`</span>pos<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token string">''</span> <span class="token keyword">comment</span> <span class="token string">'职位'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">`</span>add_time<span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">comment</span> <span class="token string">'入职时间'</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">default</span> <span class="token keyword">charset</span><span class="token operator">=</span>utf8 <span class="token keyword">comment</span> <span class="token string">'员工记录表'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>staffs<span class="token punctuation">`</span> <span class="token keyword">add</span> <span class="token keyword">index</span> <span class="token punctuation">`</span>idx_nap<span class="token punctuation">`</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token punctuation">`</span>staffs<span class="token punctuation">`</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'July'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">'前端'</span><span class="token punctuation">,</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Marry'</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token string">'java'</span><span class="token punctuation">,</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207113245420.png" alt="image-20201207113245420"></p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 全值匹配</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> staffs <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'July'</span> <span class="token operator">and</span> age<span class="token operator">=</span><span class="token string">'25'</span> <span class="token operator">and</span> pos<span class="token operator">=</span><span class="token string">'前端'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------------------+------+-----------------------+</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------------------+------+-----------------------+</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> staffs <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_nap       <span class="token operator">|</span> idx_nap <span class="token operator">|</span> <span class="token number">140</span>     <span class="token operator">|</span> const<span class="token punctuation">,</span>const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------------------+------+-----------------------+</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">`</span><span class="token comment">-- 匹配最左前缀</span></pre></td></tr><tr><td data-num="11"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> staffs <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'July'</span> <span class="token operator">and</span> age<span class="token operator">=</span><span class="token string">'25'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------------+------+-----------------------+</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref         <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------------+------+-----------------------+</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> staffs <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_nap       <span class="token operator">|</span> idx_nap <span class="token operator">|</span> <span class="token number">78</span>      <span class="token operator">|</span> const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------------+------+-----------------------+</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> staffs <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'July'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> staffs <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_nap       <span class="token operator">|</span> idx_nap <span class="token operator">|</span> <span class="token number">74</span>      <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">-- 匹配列前缀</span></pre></td></tr><tr><td data-num="28"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> staffs <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'J%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> staffs <span class="token operator">|</span> range <span class="token operator">|</span> idx_nap       <span class="token operator">|</span> idx_nap <span class="token operator">|</span> <span class="token number">74</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> staffs <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'%J%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> staffs <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+------+---------+------+------+-------------+</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment">-- 匹配范围值</span></pre></td></tr><tr><td data-num="45"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> staffs <span class="token keyword">where</span> name <span class="token operator">></span> <span class="token string">'July'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> staffs <span class="token operator">|</span> range <span class="token operator">|</span> idx_nap       <span class="token operator">|</span> idx_nap <span class="token operator">|</span> <span class="token number">74</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token comment">-- 精确匹配某一列，同时范围匹配另一列</span></pre></td></tr><tr><td data-num="54"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> staffs <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'July'</span> <span class="token operator">and</span> age<span class="token operator">></span><span class="token number">23</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> staffs <span class="token operator">|</span> range <span class="token operator">|</span> idx_nap       <span class="token operator">|</span> idx_nap <span class="token operator">|</span> <span class="token number">78</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> staffs <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'July'</span> <span class="token operator">and</span> pos<span class="token operator">></span><span class="token number">23</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> staffs <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_nap       <span class="token operator">|</span> idx_nap <span class="token operator">|</span> <span class="token number">74</span>      <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------+------+-----------------------+</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token comment">-- 注意使用了范围查找的字段之后的其他字段的索引不再起作用，如以下不会使用 pos 字段的索引</span></pre></td></tr><tr><td data-num="69"></td><td><pre>mysql<span class="token operator">></span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> staffs <span class="token operator">|</span> range <span class="token operator">|</span> idx_nap       <span class="token operator">|</span> idx_nap <span class="token operator">|</span> <span class="token number">78</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+-------+---------------+---------+---------+------+------+-----------------------+</span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token comment">-- 只访问索引的查询，注意 Extra 的值包含一个 Using index，代表只查询索引所在列，本质上是索引覆盖。如果</span></pre></td></tr><tr><td data-num="78"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> pos <span class="token keyword">from</span> staffs <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'July'</span> <span class="token operator">and</span> age<span class="token operator">=</span><span class="token number">25</span> <span class="token operator">and</span> pos<span class="token operator">=</span><span class="token string">'前端'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------------------+------+--------------------------+</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>  <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra</pre></td></tr><tr><td data-num="81"></td><td><pre>     <span class="token operator">|</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------------------+------+--------------------------+</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> staffs <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_nap       <span class="token operator">|</span> idx_nap <span class="token operator">|</span> <span class="token number">140</span>     <span class="token operator">|</span> const<span class="token punctuation">,</span>const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token operator">+</span><span class="token comment">----+-------------+--------+------+---------------+---------+---------+-------------------+------+--------------------------+</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="哈希索引"><a class="anchor" href="#哈希索引">#</a> 哈希索引</h3><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204174109136.png" alt="image-20201204174109136"></p><p>案例：</p><p>当需要存储大量的 URL，并且根据 URL 进行搜索查找，如果使用 B + 树，存储的内容就会很大。<br>select id from url where url=&quot;&quot;<br>也可以利用将 url 使用 CRC32 做哈希，可以使用以下查询方式：<br>select id fom url where url=&quot;&quot; and url_crc=CRC32(&quot;&quot;)<br>此查询性能较高原因是使用体积很小的索引来完成查找。</p><h3 id="组合索引"><a class="anchor" href="#组合索引">#</a> 组合索引</h3><p>当包含多个列作为索引，需要注意的是正确的顺序依赖于该索引的查询，同时需要考虑如何更好的满足排序和分组的需要。如建立组合索引 a，b，c：</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204174349299.png" alt="image-20201204174349299"></p><h3 id="聚簇索引"><a class="anchor" href="#聚簇索引">#</a> 聚簇索引</h3><p>不是单独的索引类型，而是一种数据存储方式，指的是数据行跟相邻的键值紧凑的存储在一起，如 InnoDB。</p><p>当在插入数据时，如果某列的一个索引块已经满了，这时该索引块就会进行页分裂，分成两个索引块，每个索引块存储分裂之前的索引块的一部分数据，然后将新的数据存入分裂后的索引块。当进行删除数据时，如果删除的是页分裂的索引块中的数据，那么数据删除之后，页分裂的索引块由于剩余有过多的空间，所以又会进行页合并，合并成一个索引块。</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204174514134.png" alt="image-20201204174514134"></p><h3 id="非聚簇索引"><a class="anchor" href="#非聚簇索引">#</a> 非聚簇索引</h3><p>数据文件跟索引文件分开存放，如 MyISAM</p><h3 id="覆盖索引"><a class="anchor" href="#覆盖索引">#</a> 覆盖索引</h3><p>只查询索引所在的列时将使用覆盖索引，<strong>此时索引中存放的是该列的键值以及该列的数据</strong>，通过键值查找得到数据。</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201204174702584.png" alt="image-20201204174702584"></p><p>案例：</p><p>1、当发起一个被索引覆盖的查询时，在 explain 的 extra 列可以看到 using index 的信息，此时就使用了覆盖索引</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> store_id<span class="token punctuation">,</span>film_id <span class="token keyword">from</span> inventory\G</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>           id: <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  select_type: <span class="token keyword">SIMPLE</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">table</span>: inventory</pre></td></tr><tr><td data-num="6"></td><td><pre>   partitions: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="7"></td><td><pre>         <span class="token keyword">type</span>: <span class="token keyword">index</span></pre></td></tr><tr><td data-num="8"></td><td><pre>possible_keys: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="9"></td><td><pre>          <span class="token keyword">key</span>: idx_store_id_film_id</pre></td></tr><tr><td data-num="10"></td><td><pre>      key_len: <span class="token number">3</span></pre></td></tr><tr><td data-num="11"></td><td><pre>          ref: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="12"></td><td><pre>         <span class="token keyword">rows</span>: <span class="token number">4581</span></pre></td></tr><tr><td data-num="13"></td><td><pre>     filtered: <span class="token number">100.00</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        Extra: <span class="token keyword">Using</span> <span class="token keyword">index</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><p>2、在大多数存储引擎中，覆盖索引只能覆盖那些只访问索引中部分列的查询。不过，可以进一步的进行优化，可以使用 innodb 的二级索引来覆盖查询。</p><p>例如：actor 使用 innodb 存储引擎，并在 last_name 字段又二级索引，虽然该索引的列不包括主键 actor_id，但也能够用于对 actor_id 做覆盖查询</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">explain</span> <span class="token keyword">select</span> actor_id<span class="token punctuation">,</span>last_name <span class="token keyword">from</span> actor <span class="token keyword">where</span> last_name<span class="token operator">=</span><span class="token string">'HOPPER'</span>\G</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>           id: <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  select_type: <span class="token keyword">SIMPLE</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">table</span>: actor</pre></td></tr><tr><td data-num="6"></td><td><pre>   partitions: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="7"></td><td><pre>         <span class="token keyword">type</span>: ref</pre></td></tr><tr><td data-num="8"></td><td><pre>possible_keys: idx_actor_last_name</pre></td></tr><tr><td data-num="9"></td><td><pre>          <span class="token keyword">key</span>: idx_actor_last_name</pre></td></tr><tr><td data-num="10"></td><td><pre>      key_len: <span class="token number">137</span></pre></td></tr><tr><td data-num="11"></td><td><pre>          ref: const</pre></td></tr><tr><td data-num="12"></td><td><pre>         <span class="token keyword">rows</span>: <span class="token number">2</span></pre></td></tr><tr><td data-num="13"></td><td><pre>     filtered: <span class="token number">100.00</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        Extra: <span class="token keyword">Using</span> <span class="token keyword">index</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="常用名词"><a class="anchor" href="#常用名词">#</a> 常用名词</h3><ul><li><p><strong>回表</strong>：当为普通列创建索引（即只有普通索引才有回表）时，该普通列索引的 B + 树的最后一层节点存放的不是整行数据记录，而是主键，所以当<strong>根据普通列查询整条记录</strong>时会根据该普通列的索引的 B + 树中存放的主键去查找主键索引对应的 B + 树，再根据该主键的 B + 树去查找整条的记录，两次的 B + 树的查找使得 IO 次数会增多。</p><p>例如：为 name 列创建索引，然后根据 name 列去查找整行记录</p><p>select * from emp where name='zhangsan';</p></li><li><p><strong>覆盖索引</strong>：直接查询索引所在的列（如查询主键，因为主键默认有索引；查询构成组合索引的列等）而不是使用 select * 或 select 其他字段时，此时只是查询索引所在列的值而不需要访问整条数据记录，且不需要回表进行两次索引的 B + 树去通过主键索引查找整条记录。</p></li><li><p><strong>最左匹配</strong>：当为某几个列共同建立一个索引（组合索引）后，查询的时候需要共同满足这几个列的值，索引才会起作用，否则就使用最左匹配原则。</p><p>例如：</p><p>为 name-age 共同建立一个索引，再为 age 单独建立一个索引；</p><p>为 age-name 建立一个共同所索引，再为 name 单独建立一个索引；</p><p>如果单独为 age 和 name 两个字段建立索引，将涉及到索引合并，效率未必会高；</p><p>以上两种方案中，使用第一种较好，因为索引也会持久化到磁盘中，而单独为 age 建立索引需要的磁盘空间更小，响应的 IO 次数也会少一些（int 比 varchar 占用空间小）</p><p>select * from emp where name = &quot;zhangsan&quot; and age=25; -- 将使用索引</p><p>select * from emp where age=25; -- 如果没有 age 单独索引，将使用最左匹配</p><p>select * from emp where name=&quot;zhangsan&quot;; -- 如果没有 name 单独索引，将使用最左匹配</p></li><li><p><strong>索引下推</strong>：即谓词下推，（需要是组合索引）在存储引擎中直接将需要的字段同时匹配取出来后返回给 server 层。</p><p>例如：</p><p>select * from emp where name = &quot;zhangsan&quot; and age=25;</p><p>以上语句在 MySQL 老版本（5.7 以下）时，会先将 name 在存储引擎中取到，之后在 server 中再将 age 取到，然后共同返回，现在版本的 MySQL 将 age 字段下推到存储引擎，直接在存储引擎中将两个字段都取到后返回给 server 层。</p></li></ul><h3 id="优化细节"><a class="anchor" href="#优化细节">#</a> 优化细节</h3><ul><li><p>当使用索引列进行查询的时候尽量不要使用表达式，把计算放到业务层而不是数据库层</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207111335981.png" alt="image-20201207111335981"></p></li><li><p>尽量使用主键查询，而不是其他索引，因为主键查询不会触发回表查询</p></li><li><p>使用前缀索引</p><p>实例：</p><p>​ 有时候需要索引很长的字符串，这会让索引变的大且慢，通常情况下可以使用某个列开始的部分字符串，这样大大的节约索引空间，从而提高索引效率，但这会降低索引的选择性，索引的选择性是指不重复的索引值和数据表记录总数的比值，范围从 1/#T 到 1 之间。索引的选择性越高则查询效率越高，因为选择性更高的索引可以让 mysql 在查找的时候过滤掉更多的行。</p><p>​ 一般情况下某个列前缀的选择性也是足够高的，足以满足查询的性能，但是对应 BLOB,TEXT,VARCHAR 类型的列，必须要使用前缀索引，因为 mysql 不允许索引这些列的完整长度，使用该方法的诀窍在于要选择足够长的前缀以保证较高的选择性，同时又不能太长。</p><p>案例演示：</p><p>下载 MySQL 官网提供的 sakila 数据库 <span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9pbmRleC1vdGhlci5odG1s">下载地址</span>，解压后先执行 sakila-schema.sql，再执行 sakila-data.sql 即可。这里需要借助 sakila 数据库的 city 表的数据。</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207153449944.png" alt="image-20201207153449944"></p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 创建数据表</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> citydemo<span class="token punctuation">(</span>city <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">insert</span> <span class="token keyword">into</span> citydemo<span class="token punctuation">(</span>city<span class="token punctuation">)</span> <span class="token keyword">select</span> city <span class="token keyword">from</span> city<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">-- 重复执行 5 次下面的 sql 语句</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">insert</span> <span class="token keyword">into</span> citydemo<span class="token punctuation">(</span>city<span class="token punctuation">)</span> <span class="token keyword">select</span> city <span class="token keyword">from</span> citydemo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">-- 更新城市表的名称</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">update</span> citydemo <span class="token keyword">set</span> city<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> city <span class="token keyword">from</span> city <span class="token keyword">order</span> <span class="token keyword">by</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">-- 查找最常见的城市列表，发现每个值都出现 45-65 次，</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cnt<span class="token punctuation">,</span>city <span class="token keyword">from</span> citydemo <span class="token keyword">group</span> <span class="token keyword">by</span> city <span class="token keyword">order</span> <span class="token keyword">by</span> cnt <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">-- 查找最频繁出现的城市前缀，先从 3 个前缀字母开始，发现比原来出现的次数更多，可以分别截取多个字符查看城市出现的次数</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cnt<span class="token punctuation">,</span><span class="token keyword">left</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pref <span class="token keyword">from</span> citydemo <span class="token keyword">group</span> <span class="token keyword">by</span> pref <span class="token keyword">order</span> <span class="token keyword">by</span> cnt <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cnt<span class="token punctuation">,</span><span class="token keyword">left</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pref <span class="token keyword">from</span> citydemo <span class="token keyword">group</span> <span class="token keyword">by</span> pref <span class="token keyword">order</span> <span class="token keyword">by</span> cnt <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">-- 此时前缀的选择性接近于完整列的选择性</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">-- 还可以通过另外一种方式来计算完整列的选择性，可以看到当前缀长度到达 7 之后，再增加前缀长度，选择性提升的幅度已经很小了</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sel3<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sel4<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sel5<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sel6<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sel7<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sel8 </pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">from</span> citydemo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">-- 计算完成之后可以创建前缀索引，使用 city 值的前 7 个字符创建索引</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">alter</span> <span class="token keyword">table</span> citydemo <span class="token keyword">add</span> <span class="token keyword">key</span><span class="token punctuation">(</span>city<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">-- 以下查询结果中，Cardinality 的为基数，代表某一列不重复的值的近似个数，基数值越小代表不重复的值越少，那么重复的值就越多，当其他列关联该列时查询的效率就越高。</span></pre></td></tr><tr><td data-num="32"></td><td><pre>mysql<span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> citydemo<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token operator">+</span><span class="token comment">----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token operator">|</span> <span class="token keyword">Table</span>    <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> Sub_part <span class="token operator">|</span> Packed <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span> <span class="token keyword">Comment</span> <span class="token operator">|</span> Index_comment <span class="token operator">|</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token operator">+</span><span class="token comment">----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token operator">|</span> citydemo <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> city     <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> city        <span class="token operator">|</span> A         <span class="token operator">|</span>        <span class="token number">1202</span> <span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token operator">+</span><span class="token comment">----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment">-- 注意：前缀索引是一种能使索引更小更快的有效方法，但是也包含缺点：mysql 无法使用前缀索引做 order by 和 group by。</span></pre></td></tr></table></figure></li><li><p>使用扫描索引来排序</p><p>order by 排序时需要浪费额外的空间，效率较低，而索引本身是有序的，所以可以利用索引进行排序。</p><p>实例：</p><p>mysql 有两种方式可以生成有序的结果：通过排序操作或者按索引顺序扫描，如果 explain 出来的 type 列的值为 index, 则说明 mysql 使用了索引扫描来做排序</p><p>​ 扫描索引本身是很快的，因为只需要从一条索引记录移动到紧接着的下一条记录。但如果索引不能覆盖查询所需的全部列，那么就不得不每扫描一条索引记录就得回表查询一次对应的行，这基本都是随机 IO，因此按索引顺序读取数据的速度通常要比顺序地全表扫描慢</p><p>​ mysql 可以使用同一个索引即满足排序，又用于查找行，如果可能的话，设计索引时应该尽可能地同时满足这两种任务。</p><p>​ 只有当索引的列顺序和 order by 子句的顺序完全一致，并且所有列的排序方式都一样时，mysql 才能够使用索引来对结果进行排序，如果查询需要关联多张表，则只有当 orderby 子句引用的字段全部为第一张表时，才能使用索引做排序。order by 子句和查找型查询的限制是一样的，需要满足索引的最左前缀的要求，否则，mysql 都需要执行顺序操作，而无法利用索引排序</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">--sakila 数据库中 rental 表在 rental_date,inventory_id,customer_id 上有 rental_date 的索引</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- 使用 rental_date 索引为下面的查询做排序</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> rental_id<span class="token punctuation">,</span>staff_id <span class="token keyword">from</span> rental <span class="token keyword">where</span> rental_date<span class="token operator">=</span><span class="token string">'2005-05-25'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> inventory_id<span class="token punctuation">,</span>customer_id\G</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="5"></td><td><pre>           id: <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  select_type: <span class="token keyword">SIMPLE</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">table</span>: rental</pre></td></tr><tr><td data-num="8"></td><td><pre>   partitions: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="9"></td><td><pre>         <span class="token keyword">type</span>: ref</pre></td></tr><tr><td data-num="10"></td><td><pre>possible_keys: rental_date</pre></td></tr><tr><td data-num="11"></td><td><pre>          <span class="token keyword">key</span>: rental_date</pre></td></tr><tr><td data-num="12"></td><td><pre>      key_len: <span class="token number">5</span></pre></td></tr><tr><td data-num="13"></td><td><pre>          ref: const</pre></td></tr><tr><td data-num="14"></td><td><pre>         <span class="token keyword">rows</span>: <span class="token number">1</span></pre></td></tr><tr><td data-num="15"></td><td><pre>     filtered: <span class="token number">100.00</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        Extra: <span class="token keyword">Using</span> <span class="token keyword">index</span> condition</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">--order by 子句不满足索引的最左前缀的要求，也可以用于查询排序，这是因为你的第一列被指定为一个常数</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">-- 该查询为索引的第一列提供了常量条件，而使用第二列进行排序，将两个列组合在一起，就形成了索引的最左前缀</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> rental_id<span class="token punctuation">,</span>staff_id <span class="token keyword">from</span> rental <span class="token keyword">where</span> rental_date<span class="token operator">=</span><span class="token string">'2005-05-25'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> inventory_id <span class="token keyword">desc</span>\G</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="23"></td><td><pre>           id: <span class="token number">1</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  select_type: <span class="token keyword">SIMPLE</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">table</span>: rental</pre></td></tr><tr><td data-num="26"></td><td><pre>   partitions: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="27"></td><td><pre>         <span class="token keyword">type</span>: ref</pre></td></tr><tr><td data-num="28"></td><td><pre>possible_keys: rental_date</pre></td></tr><tr><td data-num="29"></td><td><pre>          <span class="token keyword">key</span>: rental_date</pre></td></tr><tr><td data-num="30"></td><td><pre>      key_len: <span class="token number">5</span></pre></td></tr><tr><td data-num="31"></td><td><pre>          ref: const</pre></td></tr><tr><td data-num="32"></td><td><pre>         <span class="token keyword">rows</span>: <span class="token number">1</span></pre></td></tr><tr><td data-num="33"></td><td><pre>     filtered: <span class="token number">100.00</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        Extra: <span class="token keyword">Using</span> <span class="token keyword">where</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">-- 下面的查询不会利用索引</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> rental_id<span class="token punctuation">,</span>staff_id <span class="token keyword">from</span> rental <span class="token keyword">where</span> rental_date<span class="token operator">></span><span class="token string">'2005-05-25'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> rental_date<span class="token punctuation">,</span>inventory_id\G</pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="40"></td><td><pre>           id: <span class="token number">1</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  select_type: <span class="token keyword">SIMPLE</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token keyword">table</span>: rental</pre></td></tr><tr><td data-num="43"></td><td><pre>   partitions: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="44"></td><td><pre>         <span class="token keyword">type</span>: <span class="token keyword">ALL</span></pre></td></tr><tr><td data-num="45"></td><td><pre>possible_keys: rental_date</pre></td></tr><tr><td data-num="46"></td><td><pre>          <span class="token keyword">key</span>: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="47"></td><td><pre>      key_len: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="48"></td><td><pre>          ref: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="49"></td><td><pre>         <span class="token keyword">rows</span>: <span class="token number">16005</span></pre></td></tr><tr><td data-num="50"></td><td><pre>     filtered: <span class="token number">50.00</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        Extra: <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> filesort</pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token comment">-- 该查询使用了两中不同的排序方向，但是索引列默认都是正序排序的</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> rental_id<span class="token punctuation">,</span>staff_id <span class="token keyword">from</span> rental <span class="token keyword">where</span> rental_date<span class="token operator">></span><span class="token string">'2005-05-25'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> inventory_id <span class="token keyword">desc</span><span class="token punctuation">,</span>customer_id <span class="token keyword">asc</span>\G</pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="56"></td><td><pre>           id: <span class="token number">1</span></pre></td></tr><tr><td data-num="57"></td><td><pre>  select_type: <span class="token keyword">SIMPLE</span></pre></td></tr><tr><td data-num="58"></td><td><pre>        <span class="token keyword">table</span>: rental</pre></td></tr><tr><td data-num="59"></td><td><pre>   partitions: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="60"></td><td><pre>         <span class="token keyword">type</span>: <span class="token keyword">ALL</span></pre></td></tr><tr><td data-num="61"></td><td><pre>possible_keys: rental_date</pre></td></tr><tr><td data-num="62"></td><td><pre>          <span class="token keyword">key</span>: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="63"></td><td><pre>      key_len: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="64"></td><td><pre>          ref: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="65"></td><td><pre>         <span class="token keyword">rows</span>: <span class="token number">16005</span></pre></td></tr><tr><td data-num="66"></td><td><pre>     filtered: <span class="token number">50.00</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        Extra: <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> filesort</pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token comment">-- 该查询中引用了一个不再索引中的列</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token keyword">explain</span> <span class="token keyword">select</span> rental_id<span class="token punctuation">,</span>staff_id <span class="token keyword">from</span> rental <span class="token keyword">where</span> rental_date<span class="token operator">></span><span class="token string">'2005-05-25'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> inventory_id<span class="token punctuation">,</span>staff_id\G</pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="73"></td><td><pre>           id: <span class="token number">1</span></pre></td></tr><tr><td data-num="74"></td><td><pre>  select_type: <span class="token keyword">SIMPLE</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token keyword">table</span>: rental</pre></td></tr><tr><td data-num="76"></td><td><pre>   partitions: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="77"></td><td><pre>         <span class="token keyword">type</span>: <span class="token keyword">ALL</span></pre></td></tr><tr><td data-num="78"></td><td><pre>possible_keys: rental_date</pre></td></tr><tr><td data-num="79"></td><td><pre>          <span class="token keyword">key</span>: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="80"></td><td><pre>      key_len: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="81"></td><td><pre>          ref: <span class="token boolean">NULL</span></pre></td></tr><tr><td data-num="82"></td><td><pre>         <span class="token keyword">rows</span>: <span class="token number">16005</span></pre></td></tr><tr><td data-num="83"></td><td><pre>     filtered: <span class="token number">50.00</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        Extra: <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> filesort</pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure></li><li><p>union all,in,or 都能够使用索引，但是推荐使用 in</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207112349868.png" alt="image-20201207112349868"></p></li><li><p>范围列可以用到索引</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207112431664.png" alt="image-20201207112431664"></p></li><li><p>强制类型转换会全表扫描</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">user</span><span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>phone <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token keyword">user</span> <span class="token keyword">add</span> <span class="token keyword">index</span> idx_1<span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207112532174.png" alt="image-20201207112532174"></p></li><li><p>更新十分频繁，数据区分度不高的字段上不宜建立索引</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207112649867.png" alt="image-20201207112649867"></p></li><li><p>当需要进行表连接的时候，最好不要超过三张表，因为需要 join 的字段，数据类型必须一致</p></li><li><p>能使用 limit 的时候尽量使用 limit</p></li><li><p>单表索引建议控制在 5 个以内</p></li><li><p>单索引字段数不允许超过 5 个（组合索引）</p></li><li><p>创建索引的时候应该避免以下错误概念</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207112800543.png" alt="image-20201207112800543"></p></li></ul><h3 id="索引监控"><a class="anchor" href="#索引监控">#</a> 索引监控</h3><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207113416391.png" alt="image-20201207113416391"></p><h2 id="查询优化"><a class="anchor" href="#查询优化">#</a> 查询优化</h2><h3 id="查询慢的原因"><a class="anchor" href="#查询慢的原因">#</a> 查询慢的原因</h3><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207132540911.png" alt="image-20201207132540911"></p><h3 id="优化数据访问"><a class="anchor" href="#优化数据访问">#</a> 优化数据访问</h3><ul><li><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20201207135259549.png" alt="image-20201207135259549"></p></li><li><p>是否向数据库请求了不需要的数据</p><ul><li><p>查询不需要的记录</p><p>我们常常会误以为 mysql 会只返回需要的数据，实际上 mysql 却是先返回全部结果再进行计算，在日常的开发习惯中，经常是先用 select 语句查询大量的结果，然后获取前面的 N 行后关闭结果集。优化方式是在查询后面添加 limit。</p></li><li><p>多表关联时返回全部列</p><p>select * from actor inner join film_actor using(actor_id) inner join film using(film_id) where film.title='Academy Dinosaur';</p><p>select actor.* from actor...;</p></li><li><p>总是取出全部列</p><p>在公司的企业需求中，禁止使用 select *, 虽然这种方式能够简化开发，但是会影响查询的性能，所以尽量不要使用。</p></li><li><p>重复查询相同的数据</p><p>如果需要不断的重复执行相同的查询，且每次返回完全相同的数据，因此，基于这样的应用场景，我们可以将这部分数据缓存起来，这样的话能够提高查询效率。</p></li></ul></li></ul><h3 id="执行过程的优化"><a class="anchor" href="#执行过程的优化">#</a> 执行过程的优化</h3><div class="tags"><a href="/tags/Java/" rel="tag"><i class="ic i-tag"></i> Java</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="ic i-tag"></i> 数据库</a> <a href="/tags/MySQL/" rel="tag"><i class="ic i-tag"></i> MySQL</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-12-27 23:23:29" itemprop="dateModified" datetime="2021-12-27T23:23:29+08:00">2021-12-27</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="fanfanfan 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="fanfanfan 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="fanfanfan paypal"><p>paypal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>fanfanfan <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://baiyezi.vip/java/MySQL/MySQL%E8%B0%83%E4%BC%98%EF%BC%88%E4%B8%80%EF%BC%89/" title="MySQL调优（一）">https://baiyezi.vip/java/MySQL/MySQL调优（一）/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/java/zookeeper/zookeeper%E6%A1%88%E4%BE%8B/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;bfanfanfan&#x2F;img&#x2F;raw&#x2F;master&#x2F;guzhuang&#x2F;20211225105420.jpg" title="zookeeper案例"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Java</span><h3>zookeeper案例</h3></a></div><div class="item right"><a href="/java/redis/redis%E5%AE%89%E8%A3%85%E5%8F%8ANIO%E5%8E%9F%E7%90%86/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;bfanfanfan&#x2F;img&#x2F;raw&#x2F;master&#x2F;guzhuang&#x2F;20211225105423.jpg" title="redis安装及NIO原理"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Java</span><h3>redis安装及NIO原理</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E6%9E%84%E6%88%90"><span class="toc-number">1.</span> <span class="toc-text">MySQL 构成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#profiling"><span class="toc-number">2.</span> <span class="toc-text">profiling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#performance-schema%E6%80%A7%E8%83%BD%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">Performance Schema (性能模式)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#performance-schema%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.1.</span> <span class="toc-text">Performance Schema 设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#performance-schema%E4%B8%AD%E7%9A%84%E8%A1%A8"><span class="toc-number">3.2.</span> <span class="toc-text">Performance Schema 中的表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#performance-schema%E7%9A%84%E8%A1%A8%E5%88%86%E7%B1%BB"><span class="toc-number">3.3.</span> <span class="toc-text">Performance Schema 的表分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#performance-schema%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.</span> <span class="toc-text">Performance Schema 的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.1.</span> <span class="toc-text">启动选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">3.4.2.</span> <span class="toc-text">系统变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E5%88%86%E9%85%8D%E7%BD%AE%E8%A1%A8"><span class="toc-number">3.4.3.</span> <span class="toc-text">部分配置表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#performance-schema%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.5.</span> <span class="toc-text">Performance Schema 实践</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#show-processlist"><span class="toc-number">4.</span> <span class="toc-text">show processlist</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#schema%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%BC%98%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">schema 与数据类型优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">5.1.</span> <span class="toc-text">数据类型的优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8C%83%E5%BC%8F%E4%B8%8E%E5%8F%8D%E8%8C%83%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">范式与反范式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">5.3.</span> <span class="toc-text">主键的选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">5.4.</span> <span class="toc-text">字符集的选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">5.5.</span> <span class="toc-text">存储引擎的选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E5%BD%93%E7%9A%84%E6%95%B0%E6%8D%AE%E5%86%97%E4%BD%99"><span class="toc-number">5.6.</span> <span class="toc-text">适当的数据冗余</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E5%BD%93%E6%8B%86%E5%88%86"><span class="toc-number">5.7.</span> <span class="toc-text">适当拆分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">6.</span> <span class="toc-text">执行计划</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E4%B8%AD%E5%8C%85%E5%90%AB%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">6.1.</span> <span class="toc-text">执行计划中包含的信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96"><span class="toc-number">7.</span> <span class="toc-text">索引优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E7%9A%84%E5%8F%91%E5%B1%95"><span class="toc-number">7.1.</span> <span class="toc-text">树的发展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b%E6%A0%91"><span class="toc-number">7.2.</span> <span class="toc-text">B + 树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#myisam"><span class="toc-number">7.3.</span> <span class="toc-text">MyISAM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#innodb"><span class="toc-number">7.4.</span> <span class="toc-text">InnoDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB"><span class="toc-number">7.5.</span> <span class="toc-text">索引分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E9%87%87%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">7.6.</span> <span class="toc-text">索引采用的数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BC%98%E7%82%B9"><span class="toc-number">7.7.</span> <span class="toc-text">索引优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%94%A8%E5%A4%84"><span class="toc-number">7.8.</span> <span class="toc-text">索引的用处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%8C%B9%E9%85%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">7.9.</span> <span class="toc-text">索引匹配方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E7%B4%A2%E5%BC%95"><span class="toc-number">7.10.</span> <span class="toc-text">哈希索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-number">7.11.</span> <span class="toc-text">组合索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95"><span class="toc-number">7.12.</span> <span class="toc-text">聚簇索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95"><span class="toc-number">7.13.</span> <span class="toc-text">非聚簇索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-number">7.14.</span> <span class="toc-text">覆盖索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%90%8D%E8%AF%8D"><span class="toc-number">7.15.</span> <span class="toc-text">常用名词</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%BB%86%E8%8A%82"><span class="toc-number">7.16.</span> <span class="toc-text">优化细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9B%91%E6%8E%A7"><span class="toc-number">7.17.</span> <span class="toc-text">索引监控</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">8.</span> <span class="toc-text">查询优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%85%A2%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">8.1.</span> <span class="toc-text">查询慢的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="toc-number">8.2.</span> <span class="toc-text">优化数据访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">8.3.</span> <span class="toc-text">执行过程的优化</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/java/MySQL/Linux%E4%B8%8B%E5%AE%89%E8%A3%85MySQL/" rel="bookmark" title="Linux下安装MySQL">Linux下安装MySQL</a></li><li><a href="/java/MySQL/MySQL%E5%9F%BA%E7%A1%80/" rel="bookmark" title="MySQL基础">MySQL基础</a></li><li><a href="/java/Spring/IOC%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F%EF%BC%88%E4%B8%80%EF%BC%89/" rel="bookmark" title="IOC配置方式（一）">IOC配置方式（一）</a></li><li><a href="/java/Spring/IOC%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F%EF%BC%88%E4%BA%8C%EF%BC%89/" rel="bookmark" title="IOC配置方式（二）">IOC配置方式（二）</a></li><li><a href="/java/Spring/IOC%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F/" rel="bookmark" title="IOC注解方式">IOC注解方式</a></li><li><a href="/java/Spring/AOP/" rel="bookmark" title="AOP">AOP</a></li><li><a href="/java/SpringBoot/SpringBoot%E5%85%A5%E9%97%A8/" rel="bookmark" title="SpringBoot入门">SpringBoot入门</a></li><li><a href="/java/SpringBoot/SpringBoot-Web%E5%BC%80%E5%8F%91/" rel="bookmark" title="SpringBoot-Web开发">SpringBoot-Web开发</a></li><li><a href="/java/SpringBoot/SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86/" rel="bookmark" title="SpringBoot自动装配原理">SpringBoot自动装配原理</a></li><li><a href="/java/zookeeper/zookeeper%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" rel="bookmark" title="zookeeper搭建及基本概念">zookeeper搭建及基本概念</a></li><li><a href="/java/zookeeper/zookeeper%E5%8E%9F%E7%90%86/" rel="bookmark" title="zookeeper原理">zookeeper原理</a></li><li><a href="/java/zookeeper/zookeeper%E6%A1%88%E4%BE%8B/" rel="bookmark" title="zookeeper案例">zookeeper案例</a></li><li class="active"><a href="/java/MySQL/MySQL%E8%B0%83%E4%BC%98%EF%BC%88%E4%B8%80%EF%BC%89/" rel="bookmark" title="MySQL调优（一）">MySQL调优（一）</a></li><li><a href="/java/redis/redis%E5%AE%89%E8%A3%85%E5%8F%8ANIO%E5%8E%9F%E7%90%86/" rel="bookmark" title="redis安装及NIO原理">redis安装及NIO原理</a></li><li><a href="/java/SpringMVC/SpringMVC%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89/" rel="bookmark" title="SpringMVC入门（一）">SpringMVC入门（一）</a></li><li><a href="/java/SpringMVC/SpringMVC%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89/" rel="bookmark" title="SpringMVC入门（二）">SpringMVC入门（二）</a></li><li><a href="/java/SpringMVC/SpringMVC-REST%E9%A3%8E%E6%A0%BC/" rel="bookmark" title="SpringMVC-REST风格">SpringMVC-REST风格</a></li><li><a href="/java/SpringMVC/SpringMVC%E8%BF%9B%E9%98%B6/" rel="bookmark" title="SpringMVC进阶">SpringMVC进阶</a></li><li><a href="/java/SpringMVC/SpringMVC%E6%BA%90%E7%A0%81%E6%80%BB%E7%BB%93/" rel="bookmark" title="SpringMVC源码总结">SpringMVC源码总结</a></li><li><a href="/java/shiro/shiro%E5%85%A5%E9%97%A8/" rel="bookmark" title="shiro入门">shiro入门</a></li><li><a href="/java/shiro/shiro%E6%95%B4%E5%90%88SpringBoot/" rel="bookmark" title="shiro整合SpringBoot">shiro整合SpringBoot</a></li><li><a href="/java/shiro/shiro%E7%9A%84session%E7%AE%A1%E7%90%86/" rel="bookmark" title="shiro的session管理">shiro的session管理</a></li><li><a href="/java/shiro/shiro%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E7%99%BB%E5%BD%95/" rel="bookmark" title="shiro的缓存机制与分布式登录">shiro的缓存机制与分布式登录</a></li><li><a href="/java/shiro/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/" rel="bookmark" title="单点登录">单点登录</a></li><li><a href="/java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="bookmark" title="线程基础知识">线程基础知识</a></li><li><a href="/java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/%E5%AE%B9%E5%99%A8%E4%B8%8E%E7%BA%BF%E7%A8%8B%E6%B1%A0/" rel="bookmark" title="容器与线程池">容器与线程池</a></li><li><a href="/java/docker/Win10%E5%AE%89%E8%A3%85docker/" rel="bookmark" title="Win10安装docker">Win10安装docker</a></li><li><a href="/java/docker/Win10%E4%B8%ADdocker%E9%83%A8%E7%BD%B2springboot%E9%A1%B9%E7%9B%AE/" rel="bookmark" title="Win10安装docker">Win10安装docker</a></li><li><a href="/java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/JMH/" rel="bookmark" title="JMH">JMH</a></li><li><a href="/java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" rel="bookmark" title="并发编程">并发编程</a></li><li><a href="/java/%E6%97%A5%E5%BF%97/java-%E6%97%A5%E5%BF%97%E4%BD%93%E7%B3%BB/" rel="bookmark" title="java-日志体系">java-日志体系</a></li><li><a href="/java/redis/redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" rel="bookmark" title="redis的数据类型">redis的数据类型</a></li><li><a href="/java/redis/redis%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8/" rel="bookmark" title="redis进阶使用">redis进阶使用</a></li><li><a href="/java/redis/redis%E7%9A%84%E9%9B%86%E7%BE%A4/" rel="bookmark" title="redis的集群">redis的集群</a></li><li><a href="/java/redis/redis%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" rel="bookmark" title="redis在开发中的简单使用">redis在开发中的简单使用</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ChainOfResponsibility%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="ChainOfResponsibility责任链模式">ChainOfResponsibility责任链模式</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Composite%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="Composite组合模式">Composite组合模式</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Decorator%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="Decorator装饰器模式">Decorator装饰器模式</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Facade%E9%97%A8%E9%9D%A2%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="Facade门面模式">Facade门面模式</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Factory%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="Factory工厂模式">Factory工厂模式</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Iterator%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="Iterator迭代器模式">Iterator迭代器模式</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Flyweight%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="Flyweight享元模式">Flyweight享元模式</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Mediator%E8%B0%83%E5%81%9C%E8%80%85%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="Mediator调停者模式">Mediator调停者模式</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Observer%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="Observer观察者模式">Observer观察者模式</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Singleton%E5%8D%95%E4%BE%8B/" rel="bookmark" title="Singleton单例">Singleton单例</a></li><li><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Proxy%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" rel="bookmark" title="Proxy代理模式">Proxy代理模式</a></li><li><a href="/java/SpringCloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BB%A5%E5%8F%8A%E6%9E%B6%E6%9E%84%E5%8F%91%E5%B1%95/" rel="bookmark" title="微服务以及架构发展">微服务以及架构发展</a></li><li><a href="/java/JVM/JVM-%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD/" rel="bookmark" title="JVM-类的加载">JVM-类的加载</a></li><li><a href="/java/SpringCloud/SpringCloud-Netflix%E4%BD%93%E7%B3%BB/" rel="bookmark" title="SpringCloud-Netflix体系">SpringCloud-Netflix体系</a></li><li><a href="/java/%E5%BA%8F%E5%88%97%E5%8C%96/" rel="bookmark" title="序列化">序列化</a></li><li><a href="/java/JVM/JVM-JMM/" rel="bookmark" title="JVM-JMM">JVM-JMM</a></li><li><a href="/java/%E4%BA%BF%E7%BA%A7%E6%B5%81%E9%87%8F%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/" rel="bookmark" title="分布式系统与高并发系统架构">分布式系统与高并发系统架构</a></li><li><a href="/java/JVM/JVM-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA/" rel="bookmark" title="JVM-对象的创建">JVM-对象的创建</a></li><li><a href="/java/JVM/JVM-JVM%E8%B0%83%E4%BC%98/" rel="bookmark" title="JVM-JVM调优">JVM-JVM调优</a></li><li><a href="/java/JVM/JVM-GC/" rel="bookmark" title="JVM-GC">JVM-GC</a></li><li><a href="/java/SpringCloud/SpringCloud-Alibaba%E4%BD%93%E7%B3%BB/" rel="bookmark" title="SpringCloud-Alibaba体系">SpringCloud-Alibaba体系</a></li><li><a href="/java/SpringCloud/SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB/" rel="bookmark" title="SpringCloud-SpringCloud体系">SpringCloud-SpringCloud体系</a></li><li><a href="/java/SpringCloud/Apollo/" rel="bookmark" title="Apollo">Apollo</a></li><li><a href="/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89/" rel="bookmark" title="微服务中的会话管理（一）">微服务中的会话管理（一）</a></li><li><a href="/java/io/%E7%A3%81%E7%9B%98IO%E4%B8%8E%E7%BD%91%E7%BB%9CIO/" rel="bookmark" title="磁盘IO与网络IO">磁盘IO与网络IO</a></li><li><a href="/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89/" rel="bookmark" title="微服务中的会话管理（二）">微服务中的会话管理（二）</a></li><li><a href="/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/HTTPS/" rel="bookmark" title="HTTPS">HTTPS</a></li><li><a href="/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/RocketMQ/RocketMQ-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" rel="bookmark" title="RocketMQ-基础概念">RocketMQ-基础概念</a></li><li><a href="/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/RocketMQ/RocketMQ-%E6%B6%88%E6%81%AF%E3%80%81%E4%BA%8B%E5%8A%A1/" rel="bookmark" title="RocketMQ-消息、事务">RocketMQ-消息、事务</a></li><li><a href="/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/" rel="bookmark" title="Kafka-整体架构">Kafka-整体架构</a></li><li><a href="/java/io/%E7%BD%91%E7%BB%9CIO%E6%A8%A1%E5%9E%8B/" rel="bookmark" title="网络IO模型">网络IO模型</a></li><li><a href="/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka-%E6%90%AD%E5%BB%BA/" rel="bookmark" title="Kafka-搭建">Kafka-搭建</a></li><li><a href="/java/io/Netty/" rel="bookmark" title="Netty">Netty</a></li><li><a href="/java/Nginx/nginx%E5%AE%9E%E6%88%98/" rel="bookmark" title="nginx实战">nginx实战</a></li><li><a href="/Java%E5%92%8C%E4%B8%B2%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1" rel="bookmark" title="Java和串口进行通信">Java和串口进行通信</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="fanfanfan" data-src="/images/avatar.png"><p class="name" itemprop="name">fanfanfan</p><div class="description" itemprop="description">花有重开日，人无再少年</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">73</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">3</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">77</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-magic"></i>友链</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/java/zookeeper/zookeeper%E6%A1%88%E4%BE%8B/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/java/redis/redis%E5%AE%89%E8%A3%85%E5%8F%8ANIO%E5%8E%9F%E7%90%86/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89/" title="微服务中的会话管理（二）">微服务中的会话管理（二）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Factory%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" title="Factory工厂模式">Factory工厂模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/instruments/" title="分类于 工具">工具</a> <i class="ic i-angle-right"></i> <a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/Java%E5%92%8C%E4%B8%B2%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1" title="Java和串口进行通信">Java和串口进行通信</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Observer%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" title="Observer观察者模式">Observer观察者模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/HTTPS/" title="HTTPS">HTTPS</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/java/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Iterator%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/" title="Iterator迭代器模式">Iterator迭代器模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/java/MySQL/Linux%E4%B8%8B%E5%AE%89%E8%A3%85MySQL/" title="Linux下安装MySQL">Linux下安装MySQL</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/java/shiro/shiro%E6%95%B4%E5%90%88SpringBoot/" title="shiro整合SpringBoot">shiro整合SpringBoot</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/java/JVM/JVM-JMM/" title="JVM-JMM">JVM-JMM</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/java/SpringMVC/SpringMVC%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89/" title="SpringMVC入门（二）">SpringMVC入门（二）</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">fanfanfan</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">1.3m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">20:22</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"java/MySQL/MySQL调优（一）/",favicon:{show:"书院十四先生",hide:"书院十四先生"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->