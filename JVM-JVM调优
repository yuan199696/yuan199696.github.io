<!-- build time:Sat Dec 25 2021 13:16:37 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN,en,default"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="书院十四先生" href="https://baiyezi.vip/rss.xml"><link rel="alternate" type="application/atom+xml" title="书院十四先生" href="https://baiyezi.vip/atom.xml"><link rel="alternate" type="application/json" title="书院十四先生" href="https://baiyezi.vip/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Java,JVM"><link rel="canonical" href="https://baiyezi.vip/JVM-JVM%E8%B0%83%E4%BC%98"><title>JVM-JVM调优 - Java | 书院十四先生</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">JVM-JVM调优</h1><div class="meta"><span class="item" title="创建时间：2021-06-11 20:10:15"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-06-11T20:10:15+08:00">2021-06-11</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">书院十四先生</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225104957.png"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105419.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105421.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105418.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105420.jpg"></li><li class="item" data-background-image="https://gitee.com/bfanfanfan/img/raw/master/guzhuang/20211225105008.png"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/java/" itemprop="item" rel="index" title="分类于 Java"><span itemprop="name">Java</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://baiyezi.vip/JVM-JVM%E8%B0%83%E4%BC%98"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="fanfanfan"><meta itemprop="description" content=", 花有重开日，人无再少年"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="书院十四先生"></span><div class="body md" itemprop="articleBody"><p>JVM 参数查看</p><p>java -：标准参数，每个版本一样的参数</p><p>java -X：非标准参数</p><p>java -XX：不稳定参数，每个版本可能不同</p><p>java -XX:+PrintFlagsFinal -version：打印所有参数</p><p>java -XX:+PrintFlagsFinal -version | grep Tenure：打印与 Tenure 参数（某一个参数）相关的参数</p><p>不同的 JVM 的参数个数不同，如 G1 的参数不到一百个，CMS 参数有二三百个，Zing 据说只有一个参数</p><h2 id="参考资料"><a class="anchor" href="#参考资料">#</a> 参考资料</h2><ol><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9ncy5vcmFjbGUuY29tL2pvbnRoZWNvbGxlY3Rvci9vdXItY29sbGVjdG9ycw==">https://blogs.oracle.com/</span><span class="exturl" data-url="aHR0cHM6Ly9ibG9ncy5vcmFjbGUuY29tL2pvbnRoZWNvbGxlY3Rvci9vdXItY29sbGVjdG9ycw==">jonthecollector</span><span class="exturl" data-url="aHR0cHM6Ly9ibG9ncy5vcmFjbGUuY29tL2pvbnRoZWNvbGxlY3Rvci9vdXItY29sbGVjdG9ycw==">/our-collectors</span></li><li>JVM 的命令行参数 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vamF2YXNlLzgvZG9jcy90ZWNobm90ZXMvdG9vbHMvdW5peC9qYXZhLmh0bWw=">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</span></li><li><span class="exturl" data-url="aHR0cDovL2phdmEuc3VuLmNvbS9qYXZhc2UvdGVjaG5vbG9naWVzL2hvdHNwb3Qvdm1vcHRpb25zLmpzcA==">http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp</span></li><li>JVM 调优参考文档：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vZW4vamF2YS9qYXZhc2UvMTMvZ2N0dW5pbmcvaW50cm9kdWN0aW9uLWdhcmJhZ2UtY29sbGVjdGlvbi10dW5pbmcuaHRtbCNHVUlELThBNDQzMTg0LTdFMDctNEI3MS05Nzc3LTRGMTI5NDdDODE4NA==">https://docs.oracle.com/en/java/javase/13/gctuning/introduction-garbage-collection-tuning.html#GUID-8A443184-7E07-4B71-9777-4F12947C8184</span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbnhsaGVyby9wLzExNjYwODU0Lmh0bWw=">https://www.cnblogs.com/nxlhero/p/11660854.html</span> 在线排查工具</li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC81MDdmN2UwY2MzYTM=">https://www.jianshu.com/p/507f7e0cc3a3</span> arthas 常用命令</li><li>Arthas 手册：<ol><li>启动 arthas java -jar arthas-boot.jar</li><li>绑定 java 进程</li><li>dashboard 命令观察系统整体情况</li><li>help 查看帮助</li><li>help xx 查看具体命令帮助</li></ol></li><li>jmap 命令参考： <span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC81MDdmN2UwY2MzYTM=">https://www.jianshu.com/p/507f7e0cc3a3</span><ol><li>jmap -heap pid</li><li>jmap -histo pid</li><li>jmap -clstats pid</li></ol></li></ol><h2 id="一个例子"><a class="anchor" href="#一个例子">#</a> 一个例子</h2><h3 id="jvm常用参数"><a class="anchor" href="#jvm常用参数">#</a> JVM 常用参数</h3><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuaWJtLmNvbS9zdXBwb3J0L2tub3dsZWRnZWNlbnRlci96aC9TUzNKUk5fNy4yLjEvY29tLmlibS5pdG0uZG9jXzYuMy9pbnN0YWxsL3NhbmRwdHVuaW5nX3R3by5odG0=">默认堆大小</span></p><ol><li>区分概念：内存泄漏 memory leak（内存被垃圾对象占用，且无法回收），内存溢出 out of memory（不断产生对象，导致内存不够使用）</li><li>java -XX:+PrintCommandLineFlags HelloGC</li><li>java -Xmn10M（新生代大小） -Xms40M（最小堆大小） -Xmx60M（最大堆大小） -XX:+PrintCommandLineFlags -XX:+PrintGC（打印 GC 信息） HelloGC<br>此外，PrintGC 还有其他参数：PrintGCDetails PrintGCTimeStamps PrintGCCauses</li><li>java -XX:+UseConcMarkSweepGC（使用 CMS 垃圾回收器） -XX:+PrintCommandLineFlags HelloGC</li><li>java -XX:+PrintFlagsInitial 默认参数值</li><li>java -XX:+PrintFlagsFinal 最终参数值</li><li>java -XX:+PrintFlagsFinal | grep xxx 找到对应的参数</li><li>java -XX:+PrintFlagsFinal -version |grep GC</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">LinkedList</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloGC</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HelloGC!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code class="language-cmd">D:\Do\spring\jvm\jvm01\out\production\jvm01&gt;java -XX:+PrintCommandLineFlags com.fan.gc.HelloGC

-XX:InitialHeapSize=130856640（最小堆大小） -XX:MaxHeapSize=2093706240（最大堆大小） -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers（开启类指针压缩） -XX:+UseCompressedOops（开启普通对象指针压缩） -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC（垃圾回收器为Parallel）
</code></pre><pre><code class="language-cmd">D:\Do\spring\jvm\jvm01\out\production\jvm01&gt;java -Xmn10M -Xms40M -Xmn1024M -XX:+PrintCommandLineFlags -XX:+PrintGC com.fan.gc.HelloGC

-XX:InitialHeapSize=41943040 -XX:MaxHeapSize=2093706240 -XX:MaxNewSize=1073741824 -XX:NewSize=1073741824（新生代大小） -XX:+PrintCommandLineFlags -XX:+PrintGC -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC
HelloGC!
[GC (Allocation Failure)  30546K-&gt;29536K(62464K), 0.0896619 secs]
[Full GC (Ergonomics)  29536K-&gt;29304K(88576K), 0.0287968 secs]
[GC (Allocation Failure)  59612K-&gt;59114K(118272K), 0.0208280 secs]
[Full GC (Ergonomics)  59114K-&gt;59000K(150016K), 0.0262090 secs]
[GC (Allocation Failure)  116441K-&gt;116527K(180736K), 0.0322102 secs]
[Full GC (Ergonomics)  116527K-&gt;116346K(241152K), 0.0349488 secs]
[GC (Allocation Failure)  177970K-&gt;177970K(263168K), 0.0365349 secs]
[Full GC (Ergonomics)  177970K-&gt;177788K(338944K), 0.0130424 secs]
[GC (Allocation Failure)  261341K-&gt;260915K(346624K), 0.0521528 secs]
[Full GC (Ergonomics)  260915K-&gt;260736K(444928K), 0.0084799 secs]
[GC (Allocation Failure)  344289K-&gt;343892K(538624K), 0.0492779 secs]
[Full GC (Ergonomics)  343892K-&gt;343683K(627712K), 0.0486633 secs]
[GC (Allocation Failure)  455431K-&gt;455556K(647168K), 0.0579904 secs]
[Full GC (Ergonomics)  455556K-&gt;455303K(747008K), 0.0507343 secs]
[GC (Allocation Failure)  567062K-&gt;567177K(814080K), 0.0651118 secs]
[Full GC (Ergonomics)  567177K-&gt;566923K(915968K), 0.0595970 secs]
[GC (Allocation Failure)  724619K-&gt;723854K(939008K), 0.0737379 secs]
[Full GC (Ergonomics)  723854K-&gt;723601K(1038336K), 0.3017586 secs]
[GC (Allocation Failure)  881297K-&gt;880531K(1092096K), 0.3059804 secs]
[Full GC (Ergonomics)  880531K-&gt;880279K(1201152K), 0.1095388 secs]
[GC (Allocation Failure)  1065170K-&gt;1064913K(1251840K), 0.1283588 secs]
[Full GC (Ergonomics)  1064913K-&gt;1064606K(1371136K), 0.2394774 secs]
[Full GC (Ergonomics)  1249495K-&gt;1248933K(1371136K), 0.9279972 secs]
[Full GC (Allocation Failure)  1248933K-&gt;1248921K(1371136K), 1.7605059 secs]
Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space
        at com.fan.gc.HelloGC.main(HelloGC.java:15)
</code></pre><pre><code class="language-cmd">D:\Do\spring\jvm\jvm01\out\production\jvm01&gt;java -XX:+UseConcMarkSweepGC -XX:+PrintCommandLineFlags -XX:+PrintGCDetails com.fan.gc.HelloGC


-XX:InitialHeapSize=130856640 -XX:MaxHeapSize=2093706240 -XX:MaxNewSize=697655296 -XX:MaxTenuringThreshold=6 -XX:OldPLABSize=16 -XX:+PrintCommandLineFlags -XX:+PrintGCDetails -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseConcMarkSweepGC -XX:-UseLargePagesIndividualAllocation -XX:+UseParNewGC
HelloGC!
[GC (Allocation Failure) [ParNew: 33810K-&gt;3736K(38720K), 0.0822155 secs] 33810K-&gt;32415K(124736K), 0.1173799 secs] [Times: user=0.11 sys=0.00, real=0.12 secs]
[GC (Allocation Failure) [ParNew: 37180K-&gt;4270K(38720K), 0.0260453 secs] 65858K-&gt;65339K(124736K), 0.0263542 secs] [Times: user=0.08 sys=0.02, real=0.03 secs]
[GC (CMS Initial Mark) [1 CMS-initial-mark: 61069K(86016K)] 66363K(124736K), 0.0007145 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-mark-start]
[CMS-concurrent-mark: 0.003/0.003 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-preclean-start]
[GC (Allocation Failure) [ParNew: 37707K-&gt;4183K(38720K), 0.0230081 secs] 98776K-&gt;98021K(133988K), 0.0232160 secs] [Times: user=0.08 sys=0.06, real=0.02 secs]
[CMS-concurrent-preclean: 0.025/0.025 secs] [Times: user=0.08 sys=0.06, real=0.03 secs]
[CMS-concurrent-abortable-preclean-start]
[GC (Allocation Failure) [ParNew: 37622K-&gt;4114K(38720K), 0.0237163 secs] 131461K-&gt;130722K(165856K), 0.0242994 secs] [Times: user=0.11 sys=0.05, real=0.03 secs]
[CMS-concurrent-abortable-preclean: 0.002/0.031 secs] [Times: user=0.11 sys=0.05, real=0.03 secs]
[GC (CMS Final Remark) [YG occupancy: 8882 K (38720 K)][Rescan (parallel) , 0.0005308 secs][weak refs processing, 0.0000917 secs][class unloading, 0.0014198 secs][scrub symbol table, 0.0005496 secs][scrub string table, 0.0001908 secs][1 CMS-remark: 126607K(127136K)] 135490K(165856K), 0.0038196 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-sweep-start]
[CMS-concurrent-sweep: 0.002/0.002 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-reset-start]
[GC (Allocation Failure) [ParNew: 37555K-&gt;4108K(38720K), 0.0250266 secs] 164161K-&gt;163484K(249732K), 0.0252999 secs] [Times: user=0.09 sys=0.02, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37549K-&gt;4104K(38720K), 0.0260556 secs] 196925K-&gt;196249K(249732K), 0.0264418 secs] [Times: user=0.11 sys=0.00, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37546K-&gt;4104K(38720K), 0.0252457 secs] 229691K-&gt;229018K(265152K), 0.0255272 secs] [Times: user=0.11 sys=0.00, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37546K-&gt;4102K(38720K), 0.0251384 secs] 262461K-&gt;261786K(297020K), 0.0253610 secs] [Times: user=0.06 sys=0.03, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37544K-&gt;4102K(38720K), 0.0274734 secs] 295228K-&gt;294555K(329916K), 0.0277400 secs] [Times: user=0.11 sys=0.06, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37545K-&gt;4102K(38720K), 0.0285399 secs] 327998K-&gt;327324K(362812K), 0.0287534 secs] [Times: user=0.13 sys=0.05, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37550K-&gt;4102K(38720K), 0.0262213 secs] 360772K-&gt;360093K(395708K), 0.0271539 secs] [Times: user=0.09 sys=0.00, real=0.03 secs]
[CMS-concurrent-reset: 0.042/0.233 secs] [Times: user=0.80 sys=0.16, real=0.23 secs]
[GC (Allocation Failure) [ParNew: 37548K-&gt;4106K(38720K), 0.0271220 secs] 393540K-&gt;392867K(428604K), 0.0283210 secs] [Times: user=0.06 sys=0.03, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37551K-&gt;4102K(38720K), 0.0328048 secs] 426312K-&gt;425632K(461500K), 0.0333511 secs] [Times: user=0.14 sys=0.03, real=0.03 secs]
[GC (CMS Initial Mark) [1 CMS-initial-mark: 421530K(422780K)] 426656K(461500K), 0.0011249 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-mark-start]
[GC (Allocation Failure) [ParNew: 37546K-&gt;4104K(38720K), 0.0255051 secs] 459076K-&gt;458403K(494396K), 0.0258942 secs] [Times: user=0.08 sys=0.01, real=0.03 secs]
[CMS-concurrent-mark: 0.009/0.035 secs] [Times: user=0.16 sys=0.01, real=0.04 secs]
[GC (Allocation Failure) [ParNew: 37548K-&gt;4104K(38720K), 0.0270089 secs] 491847K-&gt;491172K(527292K), 0.0276231 secs] [Times: user=0.06 sys=0.02, real=0.03 secs]
[CMS-concurrent-preclean-start]
[CMS-concurrent-preclean: 0.005/0.005 secs] [Times: user=0.00 sys=0.00, real=0.01 secs]
[CMS-concurrent-abortable-preclean-start]
[GC (Allocation Failure) [ParNew: 37547K-&gt;4100K(38720K), 0.0286575 secs] 524616K-&gt;523937K(560188K), 0.0292869 secs] [Times: user=0.13 sys=0.03, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37543K-&gt;4102K(38720K), 0.0288577 secs] 557381K-&gt;556709K(593084K), 0.0299351 secs] [Times: user=0.17 sys=0.02, real=0.03 secs]
[CMS-concurrent-abortable-preclean: 0.033/0.066 secs] [Times: user=0.30 sys=0.05, real=0.07 secs]
[GC (CMS Final Remark) [YG occupancy: 9897 K (38720 K)][Rescan (parallel) , 0.0006325 secs][weak refs processing, 0.0000372 secs][class unloading, 0.0006484 secs][scrub symbol table, 0.0009103 secs][scrub string table, 0.0009322 secs][1 CMS-remark: 552607K(554364K)] 562504K(593084K), 0.0043822 secs] [Times: user=0.02 sys=0.00, real=0.01 secs]
[CMS-concurrent-sweep-start]
[CMS-concurrent-sweep: 0.003/0.003 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-reset-start]
[GC (Allocation Failure) [ParNew: 37545K-&gt;4106K(38720K), 0.0277160 secs] 590152K-&gt;589482K(959732K), 0.0280511 secs] [Times: user=0.14 sys=0.02, real=0.03 secs]
[CMS-concurrent-reset: 0.005/0.033 secs] [Times: user=0.14 sys=0.02, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37549K-&gt;4102K(38720K), 0.0275422 secs] 622925K-&gt;622247K(959732K), 0.0277071 secs] [Times: user=0.08 sys=0.03, real=0.03 secs]
[GC (CMS Initial Mark) [1 CMS-initial-mark: 618145K(921012K)] 623271K(959732K), 0.0003133 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-mark-start]
[GC (Allocation Failure) [ParNew: 37545K-&gt;4104K(38720K), 0.0279225 secs] 655691K-&gt;655019K(959732K), 0.0291747 secs] [Times: user=0.16 sys=0.03, real=0.03 secs]
[CMS-concurrent-mark: 0.009/0.039 secs] [Times: user=0.20 sys=0.03, real=0.04 secs]
[GC (Allocation Failure) [ParNew: 37547K-&gt;4106K(38720K), 0.0267354 secs] 688462K-&gt;687790K(959732K), 0.0270388 secs] [Times: user=0.09 sys=0.06, real=0.03 secs]
[CMS-concurrent-preclean-start]
[CMS-concurrent-preclean: 0.005/0.005 secs][GC (Allocation Failure)  [Times: user=0.00 sys=0.00, real=0.01 secs]
[ParNew: 37549K-&gt;4104K(38720K), 0.0270707 secs] 721233K-&gt;720557K(959732K), 0.0280226 secs] [Times: user=0.13 sys=0.06, real=0.03 secs]
[GC (CMS Final Remark) [YG occupancy: 5128 K (38720 K)][Rescan (parallel) , 0.0008040 secs][weak refs processing, 0.0000480 secs][class unloading, 0.0003649 secs][scrub symbol table, 0.0014814 secs][scrub string table, 0.0007356 secs][1 CMS-remark: 716453K(921012K)] 721581K(959732K), 0.0045419 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-sweep-start]
[CMS-concurrent-sweep: 0.004/0.004 secs] [Times: user=0.03 sys=0.00, real=0.00 secs]
[CMS-concurrent-reset-start]
[GC (Allocation Failure) [ParNew: 37547K-&gt;4106K(38720K), 0.0279713 secs] 754000K-&gt;753328K(1232812K), 0.0281267 secs] [Times: user=0.14 sys=0.05, real=0.03 secs]
[CMS-concurrent-reset: 0.004/0.032 secs] [Times: user=0.14 sys=0.05, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37549K-&gt;4104K(38720K), 0.0274639 secs] 786772K-&gt;786096K(1232812K), 0.0276339 secs] [Times: user=0.14 sys=0.02, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37547K-&gt;4102K(38720K), 0.0250852 secs] 819539K-&gt;818863K(1232812K), 0.0254033 secs] [Times: user=0.11 sys=0.05, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37545K-&gt;4104K(38720K), 0.0258201 secs] 852306K-&gt;851634K(1232812K), 0.0261560 secs] [Times: user=0.20 sys=0.02, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37547K-&gt;4108K(38720K), 0.0228793 secs] 885077K-&gt;884407K(1232812K), 0.0230739 secs] [Times: user=0.25 sys=0.00, real=0.02 secs]
[GC (Allocation Failure) [ParNew: 37551K-&gt;4100K(38720K), 0.0247890 secs] 917851K-&gt;917168K(1232812K), 0.0252483 secs] [Times: user=0.08 sys=0.03, real=0.03 secs]
[GC (CMS Initial Mark) [1 CMS-initial-mark: 913068K(1194092K)] 918193K(1232812K), 0.0009598 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-mark-start]
[GC (Allocation Failure) [ParNew: 37543K-&gt;4104K(38720K), 0.0216953 secs] 950612K-&gt;949942K(1232812K), 0.0218936 secs] [Times: user=0.11 sys=0.00, real=0.02 secs]
[GC (Allocation Failure) [ParNew: 37547K-&gt;4102K(38720K), 0.0296214 secs] 983385K-&gt;982709K(1232812K), 0.0298997 secs] [Times: user=0.19 sys=0.02, real=0.03 secs]
[CMS-concurrent-mark: 0.015/0.070 secs] [Times: user=0.34 sys=0.03, real=0.07 secs]
[GC (Allocation Failure) [ParNew: 37545K-&gt;4102K(38720K), 0.0301351 secs] 1016152K-&gt;1015478K(1232812K), 0.0303364 secs] [Times: user=0.16 sys=0.01, real=0.03 secs]
[CMS-concurrent-preclean-start]
[CMS-concurrent-preclean: 0.006/0.006 secs][GC (Allocation Failure)  [Times: user=0.03 sys=0.00, real=0.01 secs]
[ParNew: 37545K-&gt;4102K(38720K), 0.0261597 secs] 1048922K-&gt;1048248K(1232812K), 0.0269864 secs] [Times: user=0.09 sys=0.00, real=0.03 secs]
[GC (CMS Final Remark) [YG occupancy: 5800 K (38720 K)][Rescan (parallel) , 0.0006522 secs][weak refs processing, 0.0000420 secs][class unloading, 0.0003094 secs][scrub symbol table, 0.0005387 secs][scrub string table, 0.0004087 secs][1 CMS-remark: 1044145K(1194092K)] 1049946K(1232812K), 0.0027323 secs] [Times: user=0.02 sys=0.00, real=0.00 secs]
[CMS-concurrent-sweep-start]
[GC (Allocation Failure) [ParNew: 37545K-&gt;4108K(38720K), 0.0251137 secs] 1081691K-&gt;1081023K(1232812K), 0.0254681 secs] [Times: user=0.16 sys=0.03, real=0.02 secs]
[CMS-concurrent-sweep: 0.004/0.031 secs] [Times: user=0.16 sys=0.03, real=0.04 secs]
[CMS-concurrent-reset-start]
[GC (Allocation Failure) [ParNew: 37551K-&gt;4104K(38720K), 0.0295451 secs] 1114466K-&gt;1113788K(1403392K), 0.0297117 secs] [Times: user=0.09 sys=0.02, real=0.03 secs]
[CMS-concurrent-reset: 0.005/0.035 secs] [Times: user=0.09 sys=0.02, real=0.04 secs]
[GC (Allocation Failure) [ParNew: 37547K-&gt;4102K(38720K), 0.0288549 secs] 1147231K-&gt;1146555K(1403392K), 0.0290894 secs] [Times: user=0.11 sys=0.03, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37545K-&gt;4106K(38720K), 0.0302115 secs] 1179999K-&gt;1179329K(1403392K), 0.0307714 secs] [Times: user=0.06 sys=0.03, real=0.03 secs]
[GC (CMS Initial Mark) [1 CMS-initial-mark: 1175222K(1364672K)] 1180353K(1403392K), 0.0004696 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-mark-start]
[GC (Allocation Failure) [ParNew: 37549K-&gt;4102K(38720K), 0.0283055 secs] 1212772K-&gt;1212094K(1403392K), 0.0287325 secs] [Times: user=0.17 sys=0.03, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37545K-&gt;4104K(38720K), 0.0296743 secs] 1245537K-&gt;1244865K(1403392K), 0.0305795 secs] [Times: user=0.17 sys=0.03, real=0.03 secs]
[GC (Allocation Failure) [ParNew: 37547K-&gt;4102K(38720K), 0.0265442 secs] 1278308K-&gt;1277632K(1403392K), 0.0289526 secs] [Times: user=0.16 sys=0.03, real=0.03 secs]
[CMS-concurrent-mark: 0.018/0.109 secs] [Times: user=0.55 sys=0.09, real=0.11 secs]
[CMS-concurrent-preclean-start]
[GC (Allocation Failure) [ParNew: 37545K-&gt;4106K(38720K), 0.0243971 secs] 1311076K-&gt;1310406K(1403392K), 0.0250380 secs] [Times: user=0.19 sys=0.02, real=0.03 secs]
[CMS-concurrent-preclean: 0.009/0.038 secs] [Times: user=0.20 sys=0.02, real=0.04 secs]
[GC (Allocation Failure) [ParNew: 37549K-&gt;4102K(38720K), 0.0262650 secs] 1343849K-&gt;1343171K(1403392K), 0.0267596 secs] [Times: user=0.09 sys=0.00, real=0.03 secs]
[GC (CMS Final Remark) [YG occupancy: 6824 K (38720 K)][Rescan (parallel) , 0.0012639 secs][weak refs processing, 0.0002055 secs][class unloading, 0.0023680 secs][scrub symbol table, 0.0012191 secs][scrub string table, 0.0002618 secs][1 CMS-remark: 1339069K(1364672K)] 1345894K(1403392K), 0.0064672 secs] [Times: user=0.00 sys=0.00, real=0.01 secs]
[CMS-concurrent-sweep-start]
[GC (Allocation Failure) [ParNew: 37545K-&gt;37545K(38720K), 0.0001400 secs][CMS[CMS-concurrent-sweep: 0.003/0.003 secs] [Times: user=0.02 sys=0.00, real=0.01 secs]
 (concurrent mode failure): 1339069K-&gt;1364653K(1364672K), 0.4676363 secs] 1376614K-&gt;1375918K(1403392K), [Metaspace: 2594K-&gt;2594K(1056768K)], 0.4728215 secs] [Times: user=0.47 sys=0.00, real=0.47 secs]
[Full GC (Allocation Failure) [CMS: 1364653K-&gt;1364653K(1364672K), 0.1735066 secs] 1976433K-&gt;1976005K(1977856K), [Metaspace: 2594K-&gt;2594K(1056768K)], 0.1743198 secs] [Times: user=0.17 sys=0.00, real=0.17 secs]
[GC (CMS Initial Mark) [1 CMS-initial-mark: 1364653K(1364672K)] 1977029K(1977856K), 0.0014778 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[CMS-concurrent-mark-start]
[Full GC (Allocation Failure) [CMS[CMS-concurrent-mark: 0.007/0.008 secs] [Times: user=0.03 sys=0.00, real=0.01 secs]
 (concurrent mode failure): 1364653K-&gt;1364653K(1364672K), 0.0181630 secs] 1977326K-&gt;1977029K(1977856K), [Metaspace: 2594K-&gt;2594K(1056768K)], 0.0186337 secs] [Times: user=0.03 sys=0.00, real=0.02 secs]
[Full GC (Allocation Failure) [CMS: 1364653K-&gt;1364641K(1364672K), 0.3564214 secs] 1977029K-&gt;1977017K(1977856K), [Metaspace: 2594K-&gt;2594K(1056768K)], 0.3570369 secs] [Times: user=0.36 sys=0.00, real=0.36 secs]
Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space
        at com.fan.gc.HelloGC.main(HelloGC.java:15)
Heap
 par new generation   total 613184K, used 612673K [0x0000000083200000, 0x00000000acb50000, 0x00000000acb50000)
  eden space 545088K, 100% used [0x0000000083200000, 0x00000000a4650000, 0x00000000a4650000)
  from space 68096K,  99% used [0x00000000a4650000, 0x00000000a88507a8, 0x00000000a88d0000)
  to   space 68096K,   0% used [0x00000000a88d0000, 0x00000000a88d0000, 0x00000000acb50000)
 concurrent mark-sweep generation total 1364672K, used 1364641K [0x00000000acb50000, 0x0000000100000000, 0x0000000100000000)
 Metaspace       used 2624K, capacity 4486K, committed 4864K, reserved 1056768K
  class space    used 288K, capacity 386K, committed 512K, reserved 1048576K
</code></pre><h2 id="gc日志"><a class="anchor" href="#gc日志">#</a> GC 日志</h2><pre><code class="language-cmd">D:\Do\spring\jvm\jvm01\out\production\jvm01&gt;java -Xmn10M -Xms40M -Xmx60M -XX:+PrintCommandLineFlags -XX:+PrintGCDetails com.fan.gc.HelloGC
-XX:InitialHeapSize=41943040 -XX:MaxHeapSize=62914560 -XX:MaxNewSize=10485760 -XX:NewSize=10485760 -XX:+PrintCommandLineFlags -XX:+PrintGCDetails -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC
HelloGC!
#YGC   回收原因              垃圾回收器      回收前年轻代对象所占大小-&gt;回收后年轻代对象所占大小(年轻代总大小)   回收前堆大小-&gt;回收后堆大小(堆总大小)
[GC (Allocation Failure) [PSYoungGen: 7292K-&gt;720K(9216K)] 7292K-&gt;6872K(39936K), 0.0297667 secs] [Times: user=0.00 sys=0.00, real=0.03 secs]
[GC (Allocation Failure) [PSYoungGen: 8048K-&gt;720K(9216K)] 14200K-&gt;14048K(39936K), 0.0021418 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[GC (Allocation Failure) [PSYoungGen: 8040K-&gt;720K(9216K)] 21369K-&gt;21216K(39936K), 0.0026219 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[GC (Allocation Failure) [PSYoungGen: 8043K-&gt;688K(9216K)] 28539K-&gt;28352K(39936K), 0.0020034 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[Full GC (Ergonomics) [PSYoungGen: 688K-&gt;0K(9216K)] [ParOldGen: 27664K-&gt;28291K(46080K)] 28352K-&gt;28291K(55296K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0109781 secs] [Times: user=0.02 sys=0.00, real=0.01 secs]
[GC (Allocation Failure) [PSYoungGen: 7325K-&gt;128K(9216K)] 35616K-&gt;35587K(55296K), 0.0023654 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[GC (Allocation Failure) [PSYoungGen: 7446K-&gt;128K(9216K)] 42905K-&gt;42755K(55296K), 0.0021450 secs] [Times: user=0.05 sys=0.02, real=0.00 secs]
[Full GC (Ergonomics) [PSYoungGen: 128K-&gt;0K(9216K)] [ParOldGen: 42627K-&gt;42627K(51200K)] 42755K-&gt;42627K(60416K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0030819 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[GC (Allocation Failure) [PSYoungGen: 7321K-&gt;128K(9216K)] 49949K-&gt;49923K(60416K), 0.0026320 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[Full GC (Ergonomics) [PSYoungGen: 128K-&gt;0K(9216K)] [ParOldGen: 49795K-&gt;49796K(51200K)] 49923K-&gt;49796K(60416K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0032270 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[Full GC (Ergonomics) [PSYoungGen: 7316K-&gt;6144K(9216K)] [ParOldGen: 49796K-&gt;50820K(51200K)] 57112K-&gt;56964K(60416K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0043314 secs] [Times: user=0.06 sys=0.00, real=0.00 secs]
[Full GC (Ergonomics) [PSYoungGen: 7168K-&gt;7168K(9216K)] [ParOldGen: 50820K-&gt;50820K(51200K)] 57988K-&gt;57988K(60416K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0047029 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]
[Full GC (Allocation Failure) [PSYoungGen: 7168K-&gt;7168K(9216K)] [ParOldGen: 50820K-&gt;50808K(51200K)] 57988K-&gt;57976K(60416K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0086502 secs] [Times: user=0.00 sys=0.00, real=0.01 secs]
Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space
        at com.fan.gc.HelloGC.main(HelloGC.java:15)
Heap
 PSYoungGen      total 9216K, used 7476K [0x00000000ff600000, 0x0000000100000000, 0x0000000100000000)
  eden space 8192K, 91% used [0x00000000ff600000,0x00000000ffd4d3c0,0x00000000ffe00000)
  from space 1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)
  to   space 1024K, 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)
 ParOldGen       total 51200K, used 50808K [0x00000000fc400000, 0x00000000ff600000, 0x00000000ff600000)
  object space 51200K, 99% used [0x00000000fc400000,0x00000000ff59e070,0x00000000ff600000)
 Metaspace       used 2709K, capacity 4486K, committed 4864K, reserved 1056768K
  class space    used 293K, capacity 386K, committed 512K, reserved 1048576K
</code></pre><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/20210316213356.png" alt="GC日志详解"></p><p>heap dump 部分：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>eden space <span class="token number">5632</span>K<span class="token punctuation">,</span> <span class="token number">94</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000000ff980000</span><span class="token punctuation">,</span><span class="token number">0x00000000ffeb3e28</span><span class="token punctuation">,</span><span class="token number">0x00000000fff00000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>                            后面的内存地址指的是，起始地址，使用空间结束地址，整体空间结束地址</pre></td></tr></table></figure><p><img data-src="D:%5Cfan%5Cblog%5Csource_posts%5Cjava%5CJVM%5CJVM-JVM%E8%B0%83%E4%BC%98.assets%5CGCHeapDump.png" alt="GCHeapDump"></p><p>total = eden + 1 个 survivor</p><h2 id="jvm调优"><a class="anchor" href="#jvm调优">#</a> JVM 调优</h2><h3 id="前置知识"><a class="anchor" href="#前置知识">#</a> 前置知识</h3><ol><li>吞吐量：用户代码时间 /（用户代码执行时间 + 垃圾回收时间）</li><li>响应时间：STW 越短，响应时间越好</li></ol><p>G1 的响应时间优于 CMS，但其吞吐量比 G1 小 15% 左右</p><p>所谓调优，首先确定，追求啥？吞吐量优先，还是响应时间优先？还是在满足一定的响应时间的情况下，要求达到多大的吞吐量...</p><p>问题：</p><p>吞吐量：科学计算、数据挖掘。吞吐量优先的一般：（PS + PO）</p><p>响应时间：网站 GUI API 。响应时间优先的一般：G1</p><h3 id="调优的概念"><a class="anchor" href="#调优的概念">#</a> 调优的概念</h3><ol><li>根据需求进行 JVM 规划和预调优</li><li>优化运行 JVM 运行环境（慢，卡顿）</li><li>解决 JVM 运行过程中出现的各种问题 (OOM)</li></ol><h3 id="调优规划"><a class="anchor" href="#调优规划">#</a> 调优规划</h3><ul><li><p>调优，从业务场景开始，没有业务场景的调优都是耍流氓</p></li><li><p>无监控（压力测试，能看到结果），不调优</p></li><li><p>步骤：</p><ol><li><p>熟悉业务场景（没有最好的垃圾回收器，只有最合适的垃圾回收器）</p><ol><li>响应时间、停顿时间 [CMS G1 ZGC] （需要给用户作响应）</li><li>吞吐量 = 用户时间 /(用户时间 + GC 时间) [PS]</li></ol></li><li><p>选择回收器组合</p></li><li><p>计算内存需求（经验值 1.5G 16G）</p></li><li><p>选定 CPU（越高越好）</p></li><li><p>设定年代大小、升级年龄</p></li><li><p>设定日志参数</p><ol><li><p>-Xloggc:/opt/xxx/logs/xxx-xxx-gc-%t.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=20M -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCCause</p><p>参数解释：以系统时间为后缀命名日志 循环产生 五个日志文件（当五个日志都满了后就删除最开始的那个日志文件，重新开启一个日志文件） 每个日志文件最大为 20M 打印一些 GC 参数</p></li><li><p>或者每天产生一个日志文件</p></li></ol></li><li><p>观察日志情况</p></li></ol></li><li><p>案例 1：垂直电商，最高每日百万订单，处理订单系统需要什么样的服务器配置？</p><blockquote><p>这个问题比较业余，因为很多不同的服务器配置都能支撑 (1.5G 16G)</p><p>1 小时 360000 集中时间段， 100 个订单 / 秒，（找一小时内的高峰期，1000 订单 / 秒）</p><p>经验值，</p><p>非要计算：一个订单产生需要多少内存？512K * 1000 500M 内存</p><p>专业一点儿问法：要求响应时间 100ms</p><p>压测！</p></blockquote></li><li><p>案例 2：12306 遭遇春节大规模抢票应该如何支撑？</p><blockquote><p>12306 应该是中国并发量最大的秒杀网站：</p><p>号称并发量 100W 最高</p><p>CDN -&gt; LVS -&gt; NGINX -&gt; 业务系统 -&gt; 每台机器 1W 并发（10K 问题） 100 台机器</p><p>普通电商订单 -&gt; 下单 -&gt; 订单系统（IO）减库存 -&gt; 等待用户付款</p><p>12306 的一种可能的模型： 下单 -&gt; 减库存 和 订单 (redis kafka) 同时异步进行 -&gt; 等付款</p><p>减库存最后还会把压力压到一台服务器</p><p>可以做分布式本地库存 + 单独服务器做库存均衡</p><p>大流量的处理方法：分而治之</p></blockquote></li><li><p>怎么得到一个事务会消耗多少内存？</p><blockquote><ol><li><p>弄台机器，看能承受多少 TPS？是不是达到目标？扩容或调优，让它达到</p></li><li><p>用压测来确定</p></li></ol></blockquote></li></ul><h3 id="优化环境"><a class="anchor" href="#优化环境">#</a> 优化环境</h3><ol><li>有一个 50 万 PV 的资料类网站（从磁盘提取文档到内存）原服务器 32 位，1.5G<br>的堆，用户反馈网站比较缓慢，因此公司决定升级，新的服务器为 64 位，16G<br>的堆内存，结果用户反馈卡顿十分严重，反而比以前效率更低了<ol><li>为什么原网站慢？<br>很多用户浏览数据，很多数据 load 到内存，内存不足，频繁 GC，STW 长，响应时间变慢</li><li>为什么会更卡顿？<br>内存越大，FGC 时间越长</li><li>咋办？<br>PS -&gt; PN + CMS 或者 G1</li></ol></li><li>系统 CPU 经常 100%，如何调优？(面试高频)<br>CPU100% 那么一定有线程在占用系统资源，<ol><li>找出哪个进程 cpu 高（top）</li><li>该进程中的哪个线程 cpu 高（top -Hp）</li><li>导出该线程的堆栈 (jstack)</li><li>查找哪个方法（栈帧）消耗时间 (jstack)</li><li>工作线程占比高 | 垃圾回收线程占比高</li></ol></li><li>系统内存飙高，如何查找问题？（面试高频）<ol><li>导出堆内存 (jmap)</li><li>分析 (jhat jvisualvm mat jprofiler ...)</li></ol></li><li>如何监控 JVM<ol><li>jstat jvisualvm jprofiler arthas top...</li></ol></li></ol><h3 id="监控jjvm运行中的问题"><a class="anchor" href="#监控jjvm运行中的问题">#</a> 监控 jJVM 运行中的问题</h3><p>接下来通过一个案例解析常用工具</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>fan<span class="token punctuation">.</span>gc</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ScheduledThreadPoolExecutor</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="12"></td><td><pre> * 使用 top 命令查看 gc 情况</pre></td></tr><tr><td data-num="13"></td><td><pre> * @Description:</pre></td></tr><tr><td data-num="14"></td><td><pre> * @Author: Fan</pre></td></tr><tr><td data-num="15"></td><td><pre> * @Date: 2021/3/20 18:41</pre></td></tr><tr><td data-num="16"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num="17"></td><td><pre> **/</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FullGC_Problem01</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CardInfo</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token class-name">BigDecimal</span> price <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token class-name">Date</span> birthdate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ScheduledThreadPoolExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScheduledThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>DiscardOldestPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        executor<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token function">modelFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">modelFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CardInfo</span><span class="token punctuation">></span></span> taskList <span class="token operator">=</span> <span class="token function">getAllCardInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        taskList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>info <span class="token operator">-></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token comment">// do something</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            executor<span class="token punctuation">.</span><span class="token function">scheduleWithFixedDelay</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                <span class="token comment">//do sth with info</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                info<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CardInfo</span><span class="token punctuation">></span></span> <span class="token function">getAllCardInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CardInfo</span><span class="token punctuation">></span></span> taskList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token class-name">CardInfo</span> ci <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CardInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            taskList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ci<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token keyword">return</span> taskList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>执行以上代码</p><p>可以看到，程序在执行的过程中，产生的对象越来越多，不断触法 YGC，且 YGC 来不及回收垃圾对象，导致对象所占堆内存越来越多，当设置的堆内存 200M 使用完后出发了 FGC</p><p>同时，使用 top 命令（或者使用 jps 只查看 java 相关的进程）查看进程 cpu、内存使用情况，可以看到 java 进程所占用的 CPU 资源最多</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># top</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">top</span> - <span class="token number">11</span>:49:19 up  <span class="token number">4</span>:50,  <span class="token number">7</span> users,  load average: <span class="token number">0.17</span>, <span class="token number">0.22</span>, <span class="token number">0.12</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Tasks: <span class="token number">277</span> total,   <span class="token number">2</span> running, <span class="token number">275</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">0</span> zombie</pre></td></tr><tr><td data-num="4"></td><td><pre>%Cpu<span class="token punctuation">(</span>s<span class="token punctuation">)</span>: <span class="token number">14.6</span> us,  <span class="token number">1.7</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">82.9</span> id,  <span class="token number">0.0</span> wa,  <span class="token number">0.7</span> hi,  <span class="token number">0.0</span> si,  <span class="token number">0.0</span> st</pre></td></tr><tr><td data-num="5"></td><td><pre>MiB Mem <span class="token builtin class-name">:</span>   <span class="token number">3758.6</span> total,   <span class="token number">1360.8</span> free,   <span class="token number">1380.9</span> used,   <span class="token number">1016.9</span> buff/cache</pre></td></tr><tr><td data-num="6"></td><td><pre>MiB Swap:   <span class="token number">2560.0</span> total,   <span class="token number">2560.0</span> free,      <span class="token number">0.0</span> used.   <span class="token number">2114.2</span> avail Mem </pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>   PID <span class="token environment constant">USER</span>      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                                                               </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token number">42061</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">2168892</span> <span class="token number">222980</span>  <span class="token number">17084</span> S  <span class="token number">19.3</span>   <span class="token number">5.8</span>   <span class="token number">1</span>:12.45 java                                                                                  </pre></td></tr><tr><td data-num="10"></td><td><pre>   <span class="token number">910</span> root      <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">402088</span>  <span class="token number">30528</span>  <span class="token number">14192</span> S   <span class="token number">0.3</span>   <span class="token number">0.8</span>   <span class="token number">0</span>:02.34 tuned                                                                                 </pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token number">7480</span> root      <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">177920</span>  <span class="token number">29640</span>   <span class="token number">8092</span> S   <span class="token number">0.3</span>   <span class="token number">0.8</span>   <span class="token number">0</span>:20.88 sssd_kcm                                                                              </pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token number">7605</span> fan       <span class="token number">20</span>   <span class="token number">0</span>  <span class="token number">549012</span>  <span class="token number">39596</span>  <span class="token number">32464</span> S   <span class="token number">0.3</span>   <span class="token number">1.0</span>   <span class="token number">0</span>:16.84 vmtoolsd                                                                              </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token number">42134</span> root      <span class="token number">20</span>   <span class="token number">0</span>   <span class="token number">64220</span>   <span class="token number">4908</span>   <span class="token number">4032</span> R   <span class="token number">0.3</span>   <span class="token number">0.1</span>   <span class="token number">0</span>:01.63 <span class="token function">top</span>    </pre></td></tr><tr><td data-num="14"></td><td><pre> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># jps</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">42281</span> Jps</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">42061</span> FullGC_Problem01</pre></td></tr></table></figure><p>使用 jstack 命令查看该 java 进程下所有线程的执行情况</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># jstack 42061</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2021</span>-03-21 <span class="token number">11</span>:40:54</pre></td></tr><tr><td data-num="3"></td><td><pre>Full thread dump OpenJDK <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span><span class="token number">25.275</span>-b01 mixed mode<span class="token punctuation">)</span>:</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token string">"Attach Listener"</span> <span class="token comment">#58 daemon prio=9 os_prio=0 tid=0x00007f8f1c005800 nid=0xa4b2 waiting on condition [0x0000000000000000]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   java.lang.Thread.State: RUNNABLE</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token string">"pool-1-thread-50"</span> <span class="token comment">#57 prio=5 os_prio=0 tid=0x00007f8f401e0800 nid=0xa488 waiting on condition [0x00007f8f10cb3000]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   java.lang.Thread.State: WAITING <span class="token punctuation">(</span>parking<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	at sun.misc.Unsafe.park<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	- parking to <span class="token function">wait</span> <span class="token keyword">for</span>  <span class="token operator">&lt;</span>0x00000000f7419d5<span class="token operator"><span class="token file-descriptor important">8</span>></span> <span class="token punctuation">(</span>a java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	at java.util.concurrent.locks.LockSupport.park<span class="token punctuation">(</span>LockSupport.java:175<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	at java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span>.await<span class="token punctuation">(</span>AbstractQueuedSynchronizer.java:2039<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	at java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$DelayedWorkQueue</span>.take<span class="token punctuation">(</span>ScheduledThreadPoolExecutor.java:1088<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	at java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$DelayedWorkQueue</span>.take<span class="token punctuation">(</span>ScheduledThreadPoolExecutor.java:809<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor.getTask<span class="token punctuation">(</span>ThreadPoolExecutor.java:1074<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor.runWorker<span class="token punctuation">(</span>ThreadPoolExecutor.java:1134<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor<span class="token variable">$Worker</span>.run<span class="token punctuation">(</span>ThreadPoolExecutor.java:624<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	at java.lang.Thread.run<span class="token punctuation">(</span>Thread.java:748<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token string">"pool-1-thread-49"</span> <span class="token comment">#56 prio=5 os_prio=0 tid=0x00007f8f401de800 nid=0xa487 waiting on condition [0x00007f8f10db4000]</span></pre></td></tr><tr><td data-num="22"></td><td><pre>   java.lang.Thread.State: WAITING <span class="token punctuation">(</span>parking<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	at sun.misc.Unsafe.park<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	- parking to <span class="token function">wait</span> <span class="token keyword">for</span>  <span class="token operator">&lt;</span>0x00000000f7419d5<span class="token operator"><span class="token file-descriptor important">8</span>></span> <span class="token punctuation">(</span>a java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	at java.util.concurrent.locks.LockSupport.park<span class="token punctuation">(</span>LockSupport.java:175<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	at java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span>.await<span class="token punctuation">(</span>AbstractQueuedSynchronizer.java:2039<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	at java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$DelayedWorkQueue</span>.take<span class="token punctuation">(</span>ScheduledThreadPoolExecutor.java:1088<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	at java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$DelayedWorkQueue</span>.take<span class="token punctuation">(</span>ScheduledThreadPoolExecutor.java:809<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor.getTask<span class="token punctuation">(</span>ThreadPoolExecutor.java:1074<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor.runWorker<span class="token punctuation">(</span>ThreadPoolExecutor.java:1134<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor<span class="token variable">$Worker</span>.run<span class="token punctuation">(</span>ThreadPoolExecutor.java:624<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	at java.lang.Thread.run<span class="token punctuation">(</span>Thread.java:748<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token string">"pool-1-thread-48"</span> <span class="token comment">#55 prio=5 os_prio=0 tid=0x00007f8f401dc800 nid=0xa486 waiting on condition [0x00007f8f10eb5000]</span></pre></td></tr><tr><td data-num="35"></td><td><pre>   java.lang.Thread.State: WAITING <span class="token punctuation">(</span>parking<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>	at sun.misc.Unsafe.park<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	- parking to <span class="token function">wait</span> <span class="token keyword">for</span>  <span class="token operator">&lt;</span>0x00000000f7419d5<span class="token operator"><span class="token file-descriptor important">8</span>></span> <span class="token punctuation">(</span>a java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	at java.util.concurrent.locks.LockSupport.park<span class="token punctuation">(</span>LockSupport.java:175<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	at java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span>.await<span class="token punctuation">(</span>AbstractQueuedSynchronizer.java:2039<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>	at java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$DelayedWorkQueue</span>.take<span class="token punctuation">(</span>ScheduledThreadPoolExecutor.java:1088<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	at java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$DelayedWorkQueue</span>.take<span class="token punctuation">(</span>ScheduledThreadPoolExecutor.java:809<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor.getTask<span class="token punctuation">(</span>ThreadPoolExecutor.java:1074<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor.runWorker<span class="token punctuation">(</span>ThreadPoolExecutor.java:1134<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor<span class="token variable">$Worker</span>.run<span class="token punctuation">(</span>ThreadPoolExecutor.java:624<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>	at java.lang.Thread.run<span class="token punctuation">(</span>Thread.java:748<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token string">"pool-1-thread-47"</span> <span class="token comment">#54 prio=5 os_prio=0 tid=0x00007f8f401da800 nid=0xa485 waiting on condition [0x00007f8f10fb6000]</span></pre></td></tr><tr><td data-num="48"></td><td><pre>   java.lang.Thread.State: WAITING <span class="token punctuation">(</span>parking<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>	at sun.misc.Unsafe.park<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>	- parking to <span class="token function">wait</span> <span class="token keyword">for</span>  <span class="token operator">&lt;</span>0x00000000f7419d5<span class="token operator"><span class="token file-descriptor important">8</span>></span> <span class="token punctuation">(</span>a java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>	at java.util.concurrent.locks.LockSupport.park<span class="token punctuation">(</span>LockSupport.java:175<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>	at java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span>.await<span class="token punctuation">(</span>AbstractQueuedSynchronizer.java:2039<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>	at java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$DelayedWorkQueue</span>.take<span class="token punctuation">(</span>ScheduledThreadPoolExecutor.java:1088<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>	at java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$DelayedWorkQueue</span>.take<span class="token punctuation">(</span>ScheduledThreadPoolExecutor.java:809<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor.getTask<span class="token punctuation">(</span>ThreadPoolExecutor.java:1074<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor.runWorker<span class="token punctuation">(</span>ThreadPoolExecutor.java:1134<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre>	at java.util.concurrent.ThreadPoolExecutor<span class="token variable">$Worker</span>.run<span class="token punctuation">(</span>ThreadPoolExecutor.java:624<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>	at java.lang.Thread.run<span class="token punctuation">(</span>Thread.java:748<span class="token punctuation">)</span></pre></td></tr></table></figure><p>可以看到该 java 进程中很多线程处于 WAITING 状态，所以该 java 程序有问题。</p><p>接着继续使用 jmap 查看各个类创建的对像的情况</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost java<span class="token punctuation">]</span><span class="token comment"># jmap -histo 47568</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre> num     <span class="token comment">#instances         #bytes  class name</span></pre></td></tr><tr><td data-num="4"></td><td><pre>----------------------------------------------</pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token number">1</span>:           <span class="token number">370</span>       <span class="token number">21870976</span>  <span class="token punctuation">[</span>I</pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token number">2</span>:        <span class="token number">284882</span>        <span class="token number">9116224</span>  java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$Node</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token number">3</span>:         <span class="token number">86500</span>        <span class="token number">6228000</span>  java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$ScheduledFutureTask</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token number">4</span>:         <span class="token number">86526</span>        <span class="token number">3461040</span>  java.math.BigDecimal</pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token number">5</span>:         <span class="token number">86500</span>        <span class="token number">2768000</span>  FullGC_Problem01<span class="token variable">$CardInfo</span></pre></td></tr><tr><td data-num="10"></td><td><pre>   <span class="token number">6</span>:         <span class="token number">86500</span>        <span class="token number">2076000</span>  java.util.Date</pre></td></tr><tr><td data-num="11"></td><td><pre>   <span class="token number">7</span>:         <span class="token number">86500</span>        <span class="token number">2076000</span>  java.util.concurrent.Executors<span class="token variable">$RunnableAdapter</span></pre></td></tr><tr><td data-num="12"></td><td><pre>   <span class="token number">8</span>:            <span class="token number">10</span>        <span class="token number">1395688</span>  <span class="token punctuation">[</span>Ljava.util.concurrent.RunnableScheduledFuture<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>   <span class="token number">9</span>:         <span class="token number">86500</span>        <span class="token number">1384000</span>  FullGC_Problem01<span class="token variable">$$</span>Lambda<span class="token variable">$2</span>/1044036744</pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token number">10</span>:          <span class="token number">6734</span>        <span class="token number">1196120</span>  <span class="token punctuation">[</span>Ljava.lang.Object<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token number">11</span>:          <span class="token number">1865</span>         <span class="token number">147440</span>  <span class="token punctuation">[</span>C</pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token number">12</span>:           <span class="token number">738</span>          <span class="token number">84984</span>  java.lang.Class</pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token number">13</span>:          <span class="token number">1844</span>          <span class="token number">44256</span>  java.lang.String</pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token number">14</span>:            <span class="token number">50</span>          <span class="token number">26816</span>  <span class="token punctuation">[</span>B</pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token number">15</span>:            <span class="token number">56</span>          <span class="token number">21056</span>  java.lang.Thread</pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token number">16</span>:           <span class="token number">848</span>          <span class="token number">20352</span>  java.util.ArrayList</pre></td></tr></table></figure><p>综上所述，定位问题步骤：</p><ol><li><p>java -Xms200M -Xmx200M -XX:+PrintGC com.mashibing.jvm.gc.T15_FullGC_Problem01</p></li><li><p>一般是运维团队首先受到报警信息（CPU Memory）</p></li><li><p>top 命令观察到问题：内存不断增长 CPU 占用率居高不下</p></li><li><p>top -Hp 进程号，观察进程中的线程，哪个线程 CPU 和内存占比高</p></li><li><p>jps 定位具体 java 进程<br>jstack 定位线程状况，重点关注：WAITING 、BLOCKED<br>eg.<br>waiting on &lt;0x0000000088ca3310&gt; (a java.lang.Object)<br>假如有一个进程中 100 个线程，很多线程都在 waiting on &lt;xx&gt; ，一定要找到是哪个线程持有这把锁<br>怎么找？搜索 jstack dump 的信息，找 &lt;xx&gt; ，看哪个线程持有这把锁 RUNNABLE<br>作业：1：写一个死锁程序，用 jstack 观察 2 ：写一个程序，一个线程持有锁不释放，其他线程等待</p></li><li><p>为什么阿里规范里规定，线程的名称（尤其是线程池）都要写有意义的名称<br>怎么样自定义线程池里的线程名称？（自定义 ThreadFactory）</p></li><li><p>jinfo pid</p></li><li><p>jstat -gc 动态观察 gc 情况 / 阅读 GC 日志发现频繁 GC /arthas 观察 /jconsole/jvisualVM/ Jprofiler（最好用）<br>jstat -gc 4655 500 : 每个 500 个毫秒打印进程为 4655 的 GC 的情况<br>如果面试官问你是怎么定位 OOM 问题的？如果你回答用图形界面（错误），因为需要开启 jmx，而 jmx 会耗费 CPU 资源，影响原来应用程序的性能<br>1：已经上线的系统不用图形界面用什么？（使用命令行或在线定位 arthas 等）<br>2：图形界面到底用在什么地方？测试！测试的时候进行监控！（压测观察）</p></li><li><p>jmap - histo 4655 | head -20，查找有多少对象产生，可以定位 OOM 问题</p></li><li><p>jmap -dump:format=b,file=xxx pid</p><p>线上系统，内存特别大，该命令执行期间会对进程产生很大影响，甚至卡顿（电商不适合）<br>1：设定了参数 HeapDump，OOM 的时候会自动产生堆转储文件<br>2：&lt;font color='red'&gt; 很多服务器备份（高可用），停掉这台服务器对其他服务器不影响 &lt;/font&gt;<br>3：在线定位 (一般小点儿公司用不到)</p></li><li><p>java -Xms20M -Xmx20M -XX:+UseParallelGC -XX:+HeapDumpOnOutOfMemoryError com.fan.gc.FullGC_Problem01</p></li><li><p>使用 MAT /jhat/jvisualvm 进行 dump 文件分析<br><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYmFpaHVpdGVzdHNvZnR3YXJlL2FydGljbGVzLzY0MDYyNzEuaHRtbA==">https://www.cnblogs.com/baihuitestsoftware/articles/6406271.html</span><br>jhat -J-mx512M xxx.dump<br><span class="exturl" data-url="aHR0cDovLzE5Mi4xNjguMTcuMTE6NzAwMA==">http://192.168.17.11:7000</span><br>拉到最后：找到对应链接<br>可以使用 OQL 查找特定问题对象</p></li><li><p>找到代码的问题</p></li><li><p>程序启动加入参数：</p><blockquote><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>java -Djava.rmi.server.hostname<span class="token operator">=</span><span class="token number">192.168</span>.17.11 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port<span class="token operator">=</span><span class="token number">11111</span> -Dcom.sun.management.jmxremote.authenticate<span class="token operator">=</span>false -Dcom.sun.management.jmxremote.ssl<span class="token operator">=</span>false  -Xms20M -Xmx20M  -XX:+PrintGC  FullGC_Problem01</pre></td></tr></table></figure></blockquote></li><li><p>如果遭遇 Local host name unknown：XXX 的错误，修改 /etc/hosts 文件，把 XXX 加入进去</p><blockquote><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">192.168</span><span class="token number">.17</span><span class="token number">.11</span> basic localhost localhost<span class="token punctuation">.</span>localdomain localhost4 localhost4<span class="token punctuation">.</span>localdomain4</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">::</span><span class="token number">1</span>         localhost localhost<span class="token punctuation">.</span>localdomain localhost6 localhost6<span class="token punctuation">.</span>localdomain6</pre></td></tr></table></figure></blockquote></li><li><p>关闭 linux 防火墙（实战中应该打开对应端口）</p><blockquote><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">service</span> iptables stop</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">chkconfig</span> iptables off <span class="token comment">#永久关闭</span></pre></td></tr></table></figure></blockquote></li><li><p>windows 上打开 jconsole 远程连接 192.168.17.11:11111</p></li></ol><h4 id="jvisualvm远程连接"><a class="anchor" href="#jvisualvm远程连接">#</a> jvisualvm 远程连接</h4><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbGl1Z2gvcC83NjIwMzM2Lmh0bWw=">https://www.cnblogs.com/liugh/p/7620336.html</span> （简单做法）</p><h4 id="jprofiler-收费"><a class="anchor" href="#jprofiler-收费">#</a> jprofiler (收费)</h4><h4 id="arthas在线排查工具"><a class="anchor" href="#arthas在线排查工具">#</a> arthas 在线排查工具</h4><p><span class="exturl" data-url="aHR0cHM6Ly9hcnRoYXMuYWxpeXVuLmNvbS9kb2MvaW5zdGFsbC1kZXRhaWwuaHRtbA==">arthas 官方文档</span></p><ul><li>为什么需要在线排查？<br>在生产上我们经常会碰到一些不好排查的问题，例如线程安全问题，用最简单的 threaddump 或者 heapdump 不好查到问题原因。为了排查这些问题，有时我们会临时加一些日志，比如在一些关键的函数里打印出入参，然后重新打包发布，如果打了日志还是没找到问题，继续加日志，重新打包发布。对于上线流程复杂而且审核比较严的公司，从改代码到上线需要层层的流转，会大大影响问题排查的进度。</li><li>jvm 观察 jvm 信息</li><li>thread 定位线程问题</li><li>dashboard 观察系统情况</li><li>heapdump + jhat 分析</li><li>jad 反编译<br>动态代理生成类的问题定位<br>第三方的类（观察代码）<br>版本问题（确定自己最新提交的版本是不是被使用）</li><li>redefine 热替换<br>目前有些限制条件：只能改方法实现（方法已经运行完成），不能改方法名， 不能改属性<br>m () -&gt; mm ()</li><li>sc - search class</li><li>watch - watch method</li><li>没有包含的功能：jmap</li></ul><h4 id="arthas使用"><a class="anchor" href="#arthas使用">#</a> arthas 使用</h4><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 下载 arthas</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># curl -O https://arthas.aliyun.com/arthas-boot.jar</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</pre></td></tr><tr><td data-num="4"></td><td><pre>                                 Dload  Upload   Total   Spent    Left  Speed</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">100</span>  137k  <span class="token number">100</span>  137k    <span class="token number">0</span>     <span class="token number">0</span>  <span class="token number">78138</span>      <span class="token number">0</span>  <span class="token number">0</span>:00:01  <span class="token number">0</span>:00:01 --:--:-- <span class="token number">78138</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ls</span></pre></td></tr><tr><td data-num="7"></td><td><pre> anaconda-ks.cfg  <span class="token string">'index.html?id=498903'</span>   java                                         redis-6.0.9.tar.gz</pre></td></tr><tr><td data-num="8"></td><td><pre> arthas-boot.jar   initial-setup-ks.cfg    mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz   <span class="token builtin class-name">test</span></pre></td></tr></table></figure><p>在另一个窗口启动要执行的 java 程序</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cd /root/java</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@localhost java<span class="token punctuation">]</span><span class="token comment"># ls</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token string">'FullGC_Problem01$1.class'</span>  <span class="token string">'FullGC_Problem01$CardInfo.class'</span>   FullGC_Problem01.class   FullGC_Problem01.java</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@localhost java<span class="token punctuation">]</span><span class="token comment"># java -Xms200M -Xmx200M -XX:+PrintGC FullGC_Problem01 </span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>GC <span class="token punctuation">(</span>Allocation Failure<span class="token punctuation">)</span>  54656K-<span class="token operator">></span>1147K<span class="token punctuation">(</span>198016K<span class="token punctuation">)</span>, <span class="token number">0.0028642</span> secs<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>GC <span class="token punctuation">(</span>Allocation Failure<span class="token punctuation">)</span>  55795K-<span class="token operator">></span>13171K<span class="token punctuation">(</span>198016K<span class="token punctuation">)</span>, <span class="token number">0.0352064</span> secs<span class="token punctuation">]</span></pre></td></tr></table></figure><p>然后启动 arthas 的 jar 包</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># java -jar arthas-boot.jar </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> arthas-boot version: <span class="token number">3.5</span>.0</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Found existing java process, please choose one and input the serial number of the process, eg <span class="token builtin class-name">:</span> <span class="token number">1</span>. Then hit ENTER.</pre></td></tr><tr><td data-num="4"></td><td><pre>* <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: <span class="token number">46140</span> FullGC_Problem01</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">1</span>  <span class="token comment">#选择要监控的 java 进程后回车，写进程前面的序号即可</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#会自动下载 arthas 所需其他依赖</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Start download arthas from remote server: https://arthas.aliyun.com/download/3.5.0?mirror<span class="token operator">=</span>aliyun</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">484.89</span> KB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">1.60</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">3.14</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">3.47</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">3.74</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">4.06</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">4.48</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">4.58</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">4.84</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">5.27</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">7.10</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">9.68</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">9.99</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">10.27</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">10.47</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">10.81</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">11.08</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">11.51</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> File size: <span class="token number">12.22</span> MB, downloaded size: <span class="token number">11.84</span> MB, downloading <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Download arthas success.</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> arthas home: /root/.arthas/lib/3.5.0/arthas  <span class="token comment">#下载的 arthas 存放的目录</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Try to attach process <span class="token number">46140</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Attach process <span class="token number">46140</span> success.  <span class="token comment"># 成功挂载到之前的 java 进程</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> arthas-client connect <span class="token number">127.0</span>.0.1 <span class="token number">3658</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.                           </pre></td></tr><tr><td data-num="33"></td><td><pre> /  O  <span class="token punctuation">\</span> <span class="token operator">|</span>  .--. <span class="token string">''</span>--.  .--<span class="token string">'|  '</span>--<span class="token string">'  | /  O  \ '</span>   .-<span class="token string">'                          </span></pre></td></tr><tr><td data-num="34"></td><td><pre>|  .-.  ||  '--<span class="token string">'.'</span>   <span class="token operator">|</span>  <span class="token operator">|</span>   <span class="token operator">|</span>  .--.  <span class="token operator">||</span>  .-.  <span class="token operator">|</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">.</span>  <span class="token variable">`</span></span>-.                          </pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token operator">|</span>  <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">||</span>  <span class="token operator">|</span><span class="token punctuation">\</span>  <span class="token punctuation">\</span>    <span class="token operator">|</span>  <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">||</span>  <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">|</span>.-<span class="token string">'    |                         </span></pre></td></tr><tr><td data-num="36"></td><td><pre>`--' <span class="token variable"><span class="token variable">`</span>--'<span class="token variable">`</span></span>--<span class="token string">' '</span>--<span class="token string">'   `--'</span>   <span class="token variable"><span class="token variable">`</span>--'  <span class="token variable">`</span></span>--<span class="token string">'`--'</span> <span class="token variable"><span class="token variable">`</span>--'<span class="token variable">`</span></span>-----'                          </pre></td></tr><tr><td data-num="37"></td><td><pre>                                                                                </pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>wiki       https://arthas.aliyun.com/doc                                        </pre></td></tr><tr><td data-num="40"></td><td><pre>tutorials  https://arthas.aliyun.com/doc/arthas-tutorials.html                  </pre></td></tr><tr><td data-num="41"></td><td><pre>version    <span class="token number">3.5</span>.0                                                                </pre></td></tr><tr><td data-num="42"></td><td><pre>main_class                                                                      </pre></td></tr><tr><td data-num="43"></td><td><pre>pid        <span class="token number">46140</span>                                                                </pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token function">time</span>       <span class="token number">2021</span>-03-21 <span class="token number">20</span>:56:23</pre></td></tr></table></figure><p>接下来就可以使用 arthas 的一些命令来监控正在执行的 java 进程了</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#查看 arthas 的全部命令</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>arthas@46140<span class="token punctuation">]</span>$ <span class="token builtin class-name">help</span></pre></td></tr><tr><td data-num="3"></td><td><pre> NAME         DESCRIPTION                                                                                                                                    </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token builtin class-name">help</span>         Display Arthas Help                                                                                                                            </pre></td></tr><tr><td data-num="5"></td><td><pre> auth         Authenticates the current session                                                                                                              </pre></td></tr><tr><td data-num="6"></td><td><pre> keymap       Display all the available keymap <span class="token keyword">for</span> the specified connection.                                                                                 </pre></td></tr><tr><td data-num="7"></td><td><pre> sc           Search all the classes loaded by JVM                                                                                                           </pre></td></tr><tr><td data-num="8"></td><td><pre> sm           Search the method of classes loaded by JVM                                                                                                     </pre></td></tr><tr><td data-num="9"></td><td><pre> classloader  Show classloader info                                                                                                                          </pre></td></tr><tr><td data-num="10"></td><td><pre> jad          Decompile class                                                                                                                                </pre></td></tr><tr><td data-num="11"></td><td><pre> getstatic    Show the static field of a class                                                                                                               </pre></td></tr><tr><td data-num="12"></td><td><pre> monitor      Monitor method execution statistics, e.g. total/success/failure count, average rt, fail rate, etc.                                             </pre></td></tr><tr><td data-num="13"></td><td><pre> stack        Display the stack trace <span class="token keyword">for</span> the specified class and method                                                                                     </pre></td></tr><tr><td data-num="14"></td><td><pre> thread       Display thread info, thread stack                                                                                                              </pre></td></tr><tr><td data-num="15"></td><td><pre> trace        Trace the execution <span class="token function">time</span> of specified method invocation.                                                                                       </pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token function">watch</span>        Display the input/output parameter, <span class="token builtin class-name">return</span> object, and thrown exception of specified method invocation                                         </pre></td></tr><tr><td data-num="17"></td><td><pre> tt           Time Tunnel                                                                                                                                    </pre></td></tr><tr><td data-num="18"></td><td><pre> jvm          Display the target JVM information                                                                                                             </pre></td></tr><tr><td data-num="19"></td><td><pre> perfcounter  Display the perf counter information.                                                                                                          </pre></td></tr><tr><td data-num="20"></td><td><pre> ognl         Execute ognl expression.                                                                                                                       </pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token function">mc</span>           Memory compiler, compiles java files into bytecode and class files <span class="token keyword">in</span> memory.                                                                  </pre></td></tr><tr><td data-num="22"></td><td><pre> redefine     Redefine classes. @see Instrumentation<span class="token comment">#redefineClasses(ClassDefinition...)                                                                     </span></pre></td></tr><tr><td data-num="23"></td><td><pre> retransform  Retransform classes. @see Instrumentation<span class="token comment">#retransformClasses(Class...)                                                                         </span></pre></td></tr><tr><td data-num="24"></td><td><pre> dashboard    Overview of target jvm's thread, memory, gc, vm, tomcat info.                                                                                  </pre></td></tr><tr><td data-num="25"></td><td><pre> dump         Dump class byte array from JVM                                                                                                                 </pre></td></tr><tr><td data-num="26"></td><td><pre> heapdump     Heap dump                                                                                                                                      </pre></td></tr><tr><td data-num="27"></td><td><pre> options      View and change various Arthas options                                                                                                         </pre></td></tr><tr><td data-num="28"></td><td><pre> cls          Clear the <span class="token function">screen</span>                                                                                                                               </pre></td></tr><tr><td data-num="29"></td><td><pre> reset        Reset all the enhanced classes                                                                                                                 </pre></td></tr><tr><td data-num="30"></td><td><pre> version      Display Arthas version                                                                                                                         </pre></td></tr><tr><td data-num="31"></td><td><pre> session      Display current session information                                                                                                            </pre></td></tr><tr><td data-num="32"></td><td><pre> sysprop      Display, and change the system properties.                                                                                                     </pre></td></tr><tr><td data-num="33"></td><td><pre> sysenv       Display the system env.                                                                                                                        </pre></td></tr><tr><td data-num="34"></td><td><pre> vmoption     Display, and update the vm diagnostic options.                                                                                                 </pre></td></tr><tr><td data-num="35"></td><td><pre> logger       Print logger info, and update the logger level                                                                                                 </pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token function">history</span>      Display <span class="token builtin class-name">command</span> <span class="token function">history</span>                                                                                                                        </pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token function">cat</span>          Concatenate and print files                                                                                                                    </pre></td></tr><tr><td data-num="38"></td><td><pre> base64       Encode and decode using Base64 representation                                                                                                  </pre></td></tr><tr><td data-num="39"></td><td><pre> <span class="token builtin class-name">echo</span>         <span class="token function">write</span> arguments to the standard output                                                                                                         </pre></td></tr><tr><td data-num="40"></td><td><pre> <span class="token builtin class-name">pwd</span>          Return working directory name                                                                                                                  </pre></td></tr><tr><td data-num="41"></td><td><pre> mbean        Display the mbean information                                                                                                                  </pre></td></tr><tr><td data-num="42"></td><td><pre> <span class="token function">grep</span>         <span class="token function">grep</span> <span class="token builtin class-name">command</span> <span class="token keyword">for</span> pipes.                                                                                                                        </pre></td></tr><tr><td data-num="43"></td><td><pre> <span class="token function">tee</span>          <span class="token function">tee</span> <span class="token builtin class-name">command</span> <span class="token keyword">for</span> pipes.                                                                                                                         </pre></td></tr><tr><td data-num="44"></td><td><pre> profiler     Async Profiler. https://github.com/jvm-profiling-tools/async-profiler                                                                          </pre></td></tr><tr><td data-num="45"></td><td><pre> stop         Stop/Shutdown Arthas server and <span class="token builtin class-name">exit</span> the console.</pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#查看监控的 java 进程的所有线程</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>arthas@46906<span class="token punctuation">]</span>$ thread</pre></td></tr><tr><td data-num="3"></td><td><pre>Threads Total: <span class="token number">69</span>, NEW: <span class="token number">0</span>, RUNNABLE: <span class="token number">7</span>, BLOCKED: <span class="token number">0</span>, WAITING: <span class="token number">53</span>, TIMED_WAITING: <span class="token number">4</span>, TERMINATED: <span class="token number">0</span>, Internal threads: <span class="token number">5</span>                                        </pre></td></tr><tr><td data-num="4"></td><td><pre>ID     NAME                                   GROUP              PRIORITY      STATE        %CPU         DELTA_TIME   TIME         INTERRUPTED  DAEMON       </pre></td></tr><tr><td data-num="5"></td><td><pre>-1     C2 CompilerThread0                     -                  -1            -            <span class="token number">5.05</span>         <span class="token number">0.010</span>        <span class="token number">0</span>:1.063      <span class="token boolean">false</span>        <span class="token boolean">true</span>         </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">8</span>      pool-1-thread-1                        main               <span class="token number">5</span>             TIMED_WAITIN <span class="token number">2.37</span>         <span class="token number">0.004</span>        <span class="token number">0</span>:1.757      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">71</span>     arthas-command-execute                 system             <span class="token number">5</span>             RUNNABLE     <span class="token number">0.65</span>         <span class="token number">0.001</span>        <span class="token number">0</span>:0.056      <span class="token boolean">false</span>        <span class="token boolean">true</span>         </pre></td></tr><tr><td data-num="8"></td><td><pre>-1     C1 CompilerThread1                     -                  -1            -            <span class="token number">0.51</span>         <span class="token number">0.001</span>        <span class="token number">0</span>:0.631      <span class="token boolean">false</span>        <span class="token boolean">true</span>         </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">10</span>     pool-1-thread-3                        main               <span class="token number">5</span>             WAITING      <span class="token number">0.18</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.059      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="10"></td><td><pre>-1     VM Periodic Task Thread                -                  -1            -            <span class="token number">0.14</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.065      <span class="token boolean">false</span>        <span class="token boolean">true</span>         </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">12</span>     pool-1-thread-5                        main               <span class="token number">5</span>             WAITING      <span class="token number">0.09</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.066      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">14</span>     pool-1-thread-7                        main               <span class="token number">5</span>             WAITING      <span class="token number">0.07</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.062      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">19</span>     pool-1-thread-12                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.07</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.065      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">34</span>     pool-1-thread-27                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.07</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.060      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">55</span>     pool-1-thread-48                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.06</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.058      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">33</span>     pool-1-thread-26                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.05</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.062      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">26</span>     pool-1-thread-19                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.05</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.066      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">18</span>     pool-1-thread-11                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.05</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.062      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">32</span>     pool-1-thread-25                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.05</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.070      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">9</span>      pool-1-thread-2                        main               <span class="token number">5</span>             WAITING      <span class="token number">0.05</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.067      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">21</span>     pool-1-thread-14                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.05</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.070      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token number">23</span>     pool-1-thread-16                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.05</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.077      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token number">51</span>     pool-1-thread-44                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.061      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token number">15</span>     pool-1-thread-8                        main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.064      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token number">17</span>     pool-1-thread-10                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.064      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token number">35</span>     pool-1-thread-28                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.066      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token number">43</span>     pool-1-thread-36                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.067      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token number">41</span>     pool-1-thread-34                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.061      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">31</span>     pool-1-thread-24                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.064      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token number">16</span>     pool-1-thread-9                        main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.064      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token number">49</span>     pool-1-thread-42                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.067      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token number">44</span>     pool-1-thread-37                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.075      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token number">50</span>     pool-1-thread-43                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.04</span>         <span class="token number">0.000</span>        <span class="token number">0</span>:0.064      <span class="token boolean">false</span>        <span class="token boolean">false</span>    </pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment">#查看某个具体线程的堆栈调用情况</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">[</span>arthas@46906<span class="token punctuation">]</span>$ thread <span class="token number">43</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token string">"pool-1-thread-36"</span> <span class="token assign-left variable">Id</span><span class="token operator">=</span><span class="token number">43</span> WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span>@14f8bb89</pre></td></tr><tr><td data-num="38"></td><td><pre>    at sun.misc.Unsafe.park<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    -  waiting on java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span>@14f8bb89</pre></td></tr><tr><td data-num="40"></td><td><pre>    at java.util.concurrent.locks.LockSupport.park<span class="token punctuation">(</span>LockSupport.java:175<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    at java.util.concurrent.locks.AbstractQueuedSynchronizer<span class="token variable">$ConditionObject</span>.await<span class="token punctuation">(</span>AbstractQueuedSynchronizer.java:2039<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    at java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$DelayedWorkQueue</span>.take<span class="token punctuation">(</span>ScheduledThreadPoolExecutor.java:1088<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    at java.util.concurrent.ScheduledThreadPoolExecutor<span class="token variable">$DelayedWorkQueue</span>.take<span class="token punctuation">(</span>ScheduledThreadPoolExecutor.java:809<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    at java.util.concurrent.ThreadPoolExecutor.getTask<span class="token punctuation">(</span>ThreadPoolExecutor.java:1074<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    at java.util.concurrent.ThreadPoolExecutor.runWorker<span class="token punctuation">(</span>ThreadPoolExecutor.java:1134<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    at java.util.concurrent.ThreadPoolExecutor<span class="token variable">$Worker</span>.run<span class="token punctuation">(</span>ThreadPoolExecutor.java:624<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    at java.lang.Thread.run<span class="token punctuation">(</span>Thread.java:748<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    </pre></td></tr><tr><td data-num="49"></td><td><pre>    </pre></td></tr><tr><td data-num="50"></td><td><pre>  <span class="token comment">#查看堆内存以及 CPU 使用情况，会及时刷新</span></pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token punctuation">[</span>arthas@46906<span class="token punctuation">]</span>$ dashboard </pre></td></tr><tr><td data-num="52"></td><td><pre>ID     NAME                                   GROUP              PRIORITY      STATE        %CPU         DELTA_TIME   TIME         INTERRUPTED  DAEMON       </pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token number">43</span>     pool-1-thread-36                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:9.489      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token number">8</span>      pool-1-thread-1                        main               <span class="token number">5</span>             WAITING      <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:7.428      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token number">41</span>     pool-1-thread-34                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:2.155      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token number">27</span>     pool-1-thread-20                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:1.559      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token number">51</span>     pool-1-thread-44                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:1.196      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="58"></td><td><pre>-1     C2 CompilerThread0                     -                  -1            -            <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:1.128      <span class="token boolean">false</span>        <span class="token boolean">true</span>         </pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token number">32</span>     pool-1-thread-25                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:0.733      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token number">38</span>     pool-1-thread-31                       main               <span class="token number">5</span>             TIMED_WAITIN <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:0.672      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="61"></td><td><pre>-1     C1 CompilerThread1                     -                  -1            -            <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:0.669      <span class="token boolean">false</span>        <span class="token boolean">true</span>         </pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token number">1</span>      main                                   main               <span class="token number">5</span>             TIMED_WAITIN <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:0.441      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token number">31</span>     pool-1-thread-24                       main               <span class="token number">5</span>             WAITING      <span class="token number">0.0</span>          <span class="token number">0.000</span>        <span class="token number">0</span>:0.439      <span class="token boolean">false</span>        <span class="token boolean">false</span>        </pre></td></tr><tr><td data-num="64"></td><td><pre>Memory                            used       total      max         usage      GC                                                                            </pre></td></tr><tr><td data-num="65"></td><td><pre>heap                              121M       193M       193M        <span class="token number">62.82</span>%     gc.copy.count                          <span class="token number">6</span>                                      </pre></td></tr><tr><td data-num="66"></td><td><pre>eden_space                        36M        53M        53M         <span class="token number">67.69</span>%     gc.copy.time<span class="token punctuation">(</span>ms<span class="token punctuation">)</span>                       <span class="token number">306</span>                                    </pre></td></tr><tr><td data-num="67"></td><td><pre>survivor_space                    6M         6M         6M          <span class="token number">100.00</span>%    gc.marksweepcompact.count              <span class="token number">1</span>                                      </pre></td></tr><tr><td data-num="68"></td><td><pre>tenured_gen                       78M        133M       133M        <span class="token number">59.04</span>%     gc.marksweepcompact.time<span class="token punctuation">(</span>ms<span class="token punctuation">)</span>           <span class="token number">37</span>                                     </pre></td></tr><tr><td data-num="69"></td><td><pre>nonheap                           29M        31M        -1          <span class="token number">95.83</span>%                                                                                   </pre></td></tr><tr><td data-num="70"></td><td><pre>code_cache                        4M         5M         240M        <span class="token number">2.01</span>%                                                                                    </pre></td></tr><tr><td data-num="71"></td><td><pre>metaspace                         22M        23M        -1          <span class="token number">97.57</span>%                                                                                   </pre></td></tr><tr><td data-num="72"></td><td><pre>compressed_class_space            2M         2M         1024M       <span class="token number">0.26</span>%                                                                                    </pre></td></tr><tr><td data-num="73"></td><td><pre>direct                            8K         8K         -           <span class="token number">100.01</span>%                                                                                  </pre></td></tr><tr><td data-num="74"></td><td><pre>mapped                            0K         0K         -           <span class="token number">0.00</span>%                                                                                    </pre></td></tr><tr><td data-num="75"></td><td><pre>Runtime                                                                                                                                                      </pre></td></tr><tr><td data-num="76"></td><td><pre>os.name                                                                        Linux                                                                         </pre></td></tr><tr><td data-num="77"></td><td><pre>os.version                                                                     <span class="token number">4.18</span>.0-80.el8.x86_64                                                          </pre></td></tr><tr><td data-num="78"></td><td><pre>java.version                                                                   <span class="token number">1.8</span>.0_275                                                                     </pre></td></tr><tr><td data-num="79"></td><td><pre>java.home                                                                      /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.275.b01-1.el8_3.x86_64/jre              </pre></td></tr><tr><td data-num="80"></td><td><pre>systemload.average                                                             <span class="token number">0.31</span>                                                                          </pre></td></tr><tr><td data-num="81"></td><td><pre>processors                                                                     <span class="token number">1</span>                                                                             </pre></td></tr><tr><td data-num="82"></td><td><pre>timestamp/uptime                                                               Sun Mar <span class="token number">21</span> <span class="token number">21</span>:26:44 CST <span class="token number">2021</span>/411s            </pre></td></tr><tr><td data-num="83"></td><td><pre></pre></td></tr><tr><td data-num="84"></td><td><pre></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token comment"># 导出堆的使用情况到指定目录</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token punctuation">[</span>arthas@46906<span class="token punctuation">]</span>$ heapdump /root/java/20210321.hprof</pre></td></tr><tr><td data-num="87"></td><td><pre>Dumping heap to /root/java/20210321.hprof <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="88"></td><td><pre>Heap dump <span class="token function">file</span> created</pre></td></tr><tr><td data-num="89"></td><td><pre></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token comment">#使用 jdk 自带的 jhat 命令分析以上导出的堆文件。 -J-mx1024M 指定 jhat 分析该文件时所占的堆大小，如果过小的话会报错 OOM</span></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token punctuation">[</span>root@localhost java<span class="token punctuation">]</span><span class="token comment"># jhat -J-mx1024M 20210321.hprof </span></pre></td></tr><tr><td data-num="92"></td><td><pre>Reading from <span class="token number">20210321</span>.hprof<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="93"></td><td><pre>Dump <span class="token function">file</span> created Sun Mar <span class="token number">21</span> <span class="token number">21</span>:32:05 CST <span class="token number">2021</span></pre></td></tr><tr><td data-num="94"></td><td><pre>Snapshot read, resolving<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="95"></td><td><pre>Resolving <span class="token number">4438864</span> objects<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="96"></td><td><pre>Chasing references, <span class="token function">expect</span> <span class="token number">887</span> dots<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="97"></td><td><pre>Eliminating duplicate references<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="98"></td><td><pre>Snapshot resolved.</pre></td></tr><tr><td data-num="99"></td><td><pre>Started HTTP server on port <span class="token number">7000</span></pre></td></tr><tr><td data-num="100"></td><td><pre>Server is ready.</pre></td></tr></table></figure><p>可以看到以上 jhat 执行完成后开了一个 http 服务，端口为 7000，我们可以通过浏览器来查看 jhat 分析的结果</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/20210321214908.png" alt="image-20210321214906322"></p><p>查看所分析的 java 进程产生的所有对象</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/20210321220126.png" alt="image-20210321220125381"></p><p>可以通过查询所分析的 java 进程中相关类创建的所有对象，可以清晰的看到某个对象大小</p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/20210321220158.png" alt="image-20210321220154829"></p><p><img data-src="https://gitee.com/bfanfanfan/img/raw/master/docsify/20210321220231.png" alt="image-20210321220229221"></p><h5 id="反编译"><a class="anchor" href="#反编译">#</a> 反编译</h5><p>arthas 还有两个强大的功能就是反编译和热替换，先看反编译</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>arthas@50291<span class="token punctuation">]</span>$ jad FullGC_Problem01</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>ClassLoader:                                                                                                                                                 </pre></td></tr><tr><td data-num="4"></td><td><pre>+-sun.misc.Launcher<span class="token variable">$AppClassLoader</span>@4e0e2f2a                                                                                                                  </pre></td></tr><tr><td data-num="5"></td><td><pre>  +-sun.misc.Launcher<span class="token variable">$ExtClassLoader</span>@75668b9d                                                                                                                </pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>Location:                                                                                                                                                    </pre></td></tr><tr><td data-num="8"></td><td><pre>/root/java/                                                                                                                                                  </pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>       /*</pre></td></tr><tr><td data-num="11"></td><td><pre>        * Decompiled with CFR.</pre></td></tr><tr><td data-num="12"></td><td><pre>        */</pre></td></tr><tr><td data-num="13"></td><td><pre>       <span class="token function">import</span> java.math.BigDecimal<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>       <span class="token function">import</span> java.util.ArrayList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>       <span class="token function">import</span> java.util.Date<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>       <span class="token function">import</span> java.util.List<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>       <span class="token function">import</span> java.util.concurrent.ScheduledThreadPoolExecutor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>       <span class="token function">import</span> java.util.concurrent.ThreadPoolExecutor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>       <span class="token function">import</span> java.util.concurrent.TimeUnit<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>       </pre></td></tr><tr><td data-num="21"></td><td><pre>       public class FullGC_Problem01 <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>           private static ScheduledThreadPoolExecutor executor <span class="token operator">=</span> new ScheduledThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">50</span>, new ThreadPoolExecutor.DiscardOldestPolicy<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>       </pre></td></tr><tr><td data-num="24"></td><td><pre>           private static List<span class="token operator">&lt;</span>CardInfo<span class="token operator">></span> <span class="token function-name function">getAllCardInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>               ArrayList<span class="token operator">&lt;</span>CardInfo<span class="token operator">></span> arrayList <span class="token operator">=</span> new ArrayList<span class="token operator">&lt;</span>CardInfo<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>/*55*/         <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> ++i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                   CardInfo cardInfo <span class="token operator">=</span> new CardInfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>/*57*/             arrayList.add<span class="token punctuation">(</span>cardInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>               <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>/*60*/         <span class="token builtin class-name">return</span> arrayList<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>           <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>       </pre></td></tr><tr><td data-num="33"></td><td><pre>           private static void <span class="token function-name function">modelFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>/*41*/         List<span class="token operator">&lt;</span>CardInfo<span class="token operator">></span> list <span class="token operator">=</span> FullGC_Problem01.getAllCardInfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>               list.forEach<span class="token punctuation">(</span>cardInfo -<span class="token operator">></span> executor.scheduleWithFixedDelay<span class="token variable"><span class="token punctuation">((</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> cardInfo.m<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span>L<span class="token punctuation">,</span> <span class="token number">3</span>L<span class="token punctuation">,</span> TimeUnit.SECONDS<span class="token punctuation">))</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>           <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>       </pre></td></tr><tr><td data-num="38"></td><td><pre>           public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> stringArray<span class="token punctuation">)</span> throws Exception <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>/*32*/         executor.setMaximumPoolSize<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>               <span class="token keyword">while</span> <span class="token punctuation">(</span>true<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>/*35*/             FullGC_Problem01.modelFit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>/*36*/             Thread.sleep<span class="token punctuation">(</span>100L<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>               <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>           <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>       </pre></td></tr><tr><td data-num="46"></td><td><pre>           private static class CardInfo <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>               BigDecimal price <span class="token operator">=</span> new BigDecimal<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>               String name <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>               int age <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>               Date birthdate <span class="token operator">=</span> new Date<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>       </pre></td></tr><tr><td data-num="52"></td><td><pre>               private <span class="token function-name function">CardInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>               <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>       </pre></td></tr><tr><td data-num="55"></td><td><pre>               public void <span class="token function-name function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>               <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>           <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>       <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>Affect<span class="token punctuation">(</span>row-cnt:3<span class="token punctuation">)</span> cost <span class="token keyword">in</span> <span class="token number">5494</span> ms.</pre></td></tr></table></figure><h5 id="热替换"><a class="anchor" href="#热替换">#</a> 热替换</h5><p>接下来看 arthas 的热替换功能</p><p>新建 T.java，功能是通过键盘输入任何值就会调用 TT 对象的 m 方法输出 1，现在要实现在不停止该 java 进程的情况下替换 TT 对象的 m 方法的输出 2</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost java<span class="token punctuation">]</span><span class="token comment"># vim T.java</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>public class T <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> throws Exception<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>                for<span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                 System.in.read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                 new TT<span class="token punctuation">(</span><span class="token punctuation">)</span>.m<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>新建 TT.java</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost java<span class="token punctuation">]</span><span class="token comment"># vim TT.java</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>public class TT<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        public void <span class="token function-name function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>         System.out.println<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>启动 T.java</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost java<span class="token punctuation">]</span><span class="token comment"># java T</span></pre></td></tr><tr><td data-num="2"></td><td><pre>a</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">1</span></pre></td></tr></table></figure><p>开启 arthas</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># java -jar arthas-boot.jar </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> arthas-boot version: <span class="token number">3.5</span>.0</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Found existing java process, please choose one and input the serial number of the process, eg <span class="token builtin class-name">:</span> <span class="token number">1</span>. Then hit ENTER.</pre></td></tr><tr><td data-num="4"></td><td><pre>* <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: <span class="token number">50966</span> T</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> arthas home: /root/.arthas/lib/3.5.0/arthas</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Try to attach process <span class="token number">50966</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Attach process <span class="token number">50966</span> success.</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> arthas-client connect <span class="token number">127.0</span>.0.1 <span class="token number">3658</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.                           </pre></td></tr><tr><td data-num="11"></td><td><pre> /  O  <span class="token punctuation">\</span> <span class="token operator">|</span>  .--. <span class="token string">''</span>--.  .--<span class="token string">'|  '</span>--<span class="token string">'  | /  O  \ '</span>   .-<span class="token string">'                          </span></pre></td></tr><tr><td data-num="12"></td><td><pre>|  .-.  ||  '--<span class="token string">'.'</span>   <span class="token operator">|</span>  <span class="token operator">|</span>   <span class="token operator">|</span>  .--.  <span class="token operator">||</span>  .-.  <span class="token operator">|</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">.</span>  <span class="token variable">`</span></span>-.                          </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">|</span>  <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">||</span>  <span class="token operator">|</span><span class="token punctuation">\</span>  <span class="token punctuation">\</span>    <span class="token operator">|</span>  <span class="token operator">|</span>   <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">||</span>  <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token operator">|</span>.-<span class="token string">'    |                         </span></pre></td></tr><tr><td data-num="14"></td><td><pre>`--' <span class="token variable"><span class="token variable">`</span>--'<span class="token variable">`</span></span>--<span class="token string">' '</span>--<span class="token string">'   `--'</span>   <span class="token variable"><span class="token variable">`</span>--'  <span class="token variable">`</span></span>--<span class="token string">'`--'</span> <span class="token variable"><span class="token variable">`</span>--'<span class="token variable">`</span></span>-----'                          </pre></td></tr><tr><td data-num="15"></td><td><pre>                                                                                </pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>wiki       https://arthas.aliyun.com/doc                                        </pre></td></tr><tr><td data-num="18"></td><td><pre>tutorials  https://arthas.aliyun.com/doc/arthas-tutorials.html                  </pre></td></tr><tr><td data-num="19"></td><td><pre>version    <span class="token number">3.5</span>.0                                                                </pre></td></tr><tr><td data-num="20"></td><td><pre>main_class                                                                      </pre></td></tr><tr><td data-num="21"></td><td><pre>pid        <span class="token number">50966</span>                                                                </pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token function">time</span>       <span class="token number">2021</span>-03-22 <span class="token number">23</span>:30:11                                                  </pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span>arthas@50966<span class="token punctuation">]</span>$</pre></td></tr></table></figure><p>修改 TT.java 并编译</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost java<span class="token punctuation">]</span><span class="token comment"># vim TT.java</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>public class TT<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        public void <span class="token function-name function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>         System.out.println<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>root@localhost java<span class="token punctuation">]</span><span class="token comment"># javac TT.java</span></pre></td></tr></table></figure><p>使用 arthas 的热替换命令使得刚才修改的 TT.java 生效</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>arthas@50966<span class="token punctuation">]</span>$ redefine /root/java/TT.class</pre></td></tr><tr><td data-num="2"></td><td><pre>redefine success, size: <span class="token number">1</span>, classes:</pre></td></tr><tr><td data-num="3"></td><td><pre>TT</pre></td></tr></table></figure><p>再次测试 T.java 输出</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@localhost java<span class="token punctuation">]</span><span class="token comment"># java T</span></pre></td></tr><tr><td data-num="2"></td><td><pre>a</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>a</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">2</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">2</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/Java/" rel="tag"><i class="ic i-tag"></i> Java</a> <a href="/tags/JVM/" rel="tag"><i class="ic i-tag"></i> JVM</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-12-24 10:49:58" itemprop="dateModified" datetime="2021-12-24T10:49:58+08:00">2021-12-24</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="fanfanfan 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="fanfanfan 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="fanfanfan PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>fanfanfan <i class="ic i-at"><em>@</em></i>书院十四先生</li><li class="link"><strong>本文链接：</strong> <a href="https://baiyezi.vip/JVM-JVM%E8%B0%83%E4%BC%98" title="JVM-JVM调优">https://baiyezi.vip/JVM-JVM调优</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/JVM-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;bfanfanfan&#x2F;img&#x2F;raw&#x2F;master&#x2F;guzhuang&#x2F;20211225104957.png" title="JVM-对象的创建"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Java</span><h3>JVM-对象的创建</h3></a></div><div class="item right"><a href="/JVM-GC" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;bfanfanfan&#x2F;img&#x2F;raw&#x2F;master&#x2F;guzhuang&#x2F;20211225105419.jpg" title="JVM-GC"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Java</span><h3>JVM-GC</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.</span> <span class="toc-text">参考资料</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90"><span class="toc-number">2.</span> <span class="toc-text">一个例子</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jvm%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-number">2.1.</span> <span class="toc-text">JVM 常用参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gc%E6%97%A5%E5%BF%97"><span class="toc-number">3.</span> <span class="toc-text">GC 日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jvm%E8%B0%83%E4%BC%98"><span class="toc-number">4.</span> <span class="toc-text">JVM 调优</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">4.1.</span> <span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E4%BC%98%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">4.2.</span> <span class="toc-text">调优的概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E4%BC%98%E8%A7%84%E5%88%92"><span class="toc-number">4.3.</span> <span class="toc-text">调优规划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%8E%AF%E5%A2%83"><span class="toc-number">4.4.</span> <span class="toc-text">优化环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7jjvm%E8%BF%90%E8%A1%8C%E4%B8%AD%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.5.</span> <span class="toc-text">监控 jJVM 运行中的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#jvisualvm%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.5.1.</span> <span class="toc-text">jvisualvm 远程连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jprofiler-%E6%94%B6%E8%B4%B9"><span class="toc-number">4.5.2.</span> <span class="toc-text">jprofiler (收费)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arthas%E5%9C%A8%E7%BA%BF%E6%8E%92%E6%9F%A5%E5%B7%A5%E5%85%B7"><span class="toc-number">4.5.3.</span> <span class="toc-text">arthas 在线排查工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arthas%E4%BD%BF%E7%94%A8"><span class="toc-number">4.5.4.</span> <span class="toc-text">arthas 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91"><span class="toc-number">4.5.4.1.</span> <span class="toc-text">反编译</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%83%AD%E6%9B%BF%E6%8D%A2"><span class="toc-number">4.5.4.2.</span> <span class="toc-text">热替换</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/Linux%E4%B8%8B%E5%AE%89%E8%A3%85MySQL" rel="bookmark" title="Linux下安装MySQL">Linux下安装MySQL</a></li><li><a href="/MySQL%E5%9F%BA%E7%A1%80" rel="bookmark" title="MySQL基础">MySQL基础</a></li><li><a href="/IOC%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F%EF%BC%88%E4%B8%80%EF%BC%89" rel="bookmark" title="IOC配置方式（一）">IOC配置方式（一）</a></li><li><a href="/IOC%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F%EF%BC%88%E4%BA%8C%EF%BC%89" rel="bookmark" title="IOC配置方式（二）">IOC配置方式（二）</a></li><li><a href="/IOC%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F" rel="bookmark" title="IOC注解方式">IOC注解方式</a></li><li><a href="/AOP" rel="bookmark" title="AOP">AOP</a></li><li><a href="/SpringBoot%E5%85%A5%E9%97%A8" rel="bookmark" title="SpringBoot入门">SpringBoot入门</a></li><li><a href="/SpringBoot-Web%E5%BC%80%E5%8F%91" rel="bookmark" title="SpringBoot-Web开发">SpringBoot-Web开发</a></li><li><a href="/SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86" rel="bookmark" title="SpringBoot自动装配原理">SpringBoot自动装配原理</a></li><li><a href="/zookeeper%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" rel="bookmark" title="zookeeper搭建及基本概念">zookeeper搭建及基本概念</a></li><li><a href="/zookeeper%E5%8E%9F%E7%90%86" rel="bookmark" title="zookeeper原理">zookeeper原理</a></li><li><a href="/zookeeper%E6%A1%88%E4%BE%8B" rel="bookmark" title="zookeeper案例">zookeeper案例</a></li><li><a href="/MySQL%E8%B0%83%E4%BC%98%EF%BC%88%E4%B8%80%EF%BC%89" rel="bookmark" title="MySQL调优（一）">MySQL调优（一）</a></li><li><a href="/redis%E5%AE%89%E8%A3%85%E5%8F%8ANIO%E5%8E%9F%E7%90%86" rel="bookmark" title="redis安装及NIO原理">redis安装及NIO原理</a></li><li><a href="/SpringMVC%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89" rel="bookmark" title="SpringMVC入门（一）">SpringMVC入门（一）</a></li><li><a href="/SpringMVC%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89" rel="bookmark" title="SpringMVC入门（二）">SpringMVC入门（二）</a></li><li><a href="/SpringMVC-REST%E9%A3%8E%E6%A0%BC" rel="bookmark" title="SpringMVC-REST风格">SpringMVC-REST风格</a></li><li><a href="/SpringMVC%E8%BF%9B%E9%98%B6" rel="bookmark" title="SpringMVC进阶">SpringMVC进阶</a></li><li><a href="/SpringMVC%E6%BA%90%E7%A0%81%E6%80%BB%E7%BB%93" rel="bookmark" title="SpringMVC源码总结">SpringMVC源码总结</a></li><li><a href="/shiro%E5%85%A5%E9%97%A8" rel="bookmark" title="shiro入门">shiro入门</a></li><li><a href="/shiro%E6%95%B4%E5%90%88SpringBoot" rel="bookmark" title="shiro整合SpringBoot">shiro整合SpringBoot</a></li><li><a href="/shiro%E7%9A%84session%E7%AE%A1%E7%90%86" rel="bookmark" title="shiro的session管理">shiro的session管理</a></li><li><a href="/shiro%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E7%99%BB%E5%BD%95" rel="bookmark" title="shiro的缓存机制与分布式登录">shiro的缓存机制与分布式登录</a></li><li><a href="/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95" rel="bookmark" title="单点登录">单点登录</a></li><li><a href="/%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86" rel="bookmark" title="线程基础知识">线程基础知识</a></li><li><a href="/%E5%AE%B9%E5%99%A8%E4%B8%8E%E7%BA%BF%E7%A8%8B%E6%B1%A0" rel="bookmark" title="容器与线程池">容器与线程池</a></li><li><a href="/Win10%E5%AE%89%E8%A3%85docker" rel="bookmark" title="Win10安装docker">Win10安装docker</a></li><li><a href="/Win10%E5%AE%89%E8%A3%85docker" rel="bookmark" title="Win10安装docker">Win10安装docker</a></li><li><a href="/JMH" rel="bookmark" title="JMH">JMH</a></li><li><a href="/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B" rel="bookmark" title="并发编程">并发编程</a></li><li><a href="/java-%E6%97%A5%E5%BF%97%E4%BD%93%E7%B3%BB" rel="bookmark" title="java-日志体系">java-日志体系</a></li><li><a href="/redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" rel="bookmark" title="redis的数据类型">redis的数据类型</a></li><li><a href="/redis%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8" rel="bookmark" title="redis进阶使用">redis进阶使用</a></li><li><a href="/redis%E7%9A%84%E9%9B%86%E7%BE%A4" rel="bookmark" title="redis的集群">redis的集群</a></li><li><a href="/redis%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8" rel="bookmark" title="redis在开发中的简单使用">redis在开发中的简单使用</a></li><li><a href="/ChainOfResponsibility%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F" rel="bookmark" title="ChainOfResponsibility责任链模式">ChainOfResponsibility责任链模式</a></li><li><a href="/Composite%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Composite组合模式">Composite组合模式</a></li><li><a href="/Decorator%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Decorator装饰器模式">Decorator装饰器模式</a></li><li><a href="/Facade%E9%97%A8%E9%9D%A2%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Facade门面模式">Facade门面模式</a></li><li><a href="/Factory%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Factory工厂模式">Factory工厂模式</a></li><li><a href="/Flyweight%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Flyweight享元模式">Flyweight享元模式</a></li><li><a href="/Iterator%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Iterator迭代器模式">Iterator迭代器模式</a></li><li><a href="/Mediator%E8%B0%83%E5%81%9C%E8%80%85%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Mediator调停者模式">Mediator调停者模式</a></li><li><a href="/Observer%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Observer观察者模式">Observer观察者模式</a></li><li><a href="/Proxy%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F" rel="bookmark" title="Proxy代理模式">Proxy代理模式</a></li><li><a href="/Singleton%E5%8D%95%E4%BE%8B" rel="bookmark" title="Singleton单例">Singleton单例</a></li><li><a href="/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BB%A5%E5%8F%8A%E6%9E%B6%E6%9E%84%E5%8F%91%E5%B1%95" rel="bookmark" title="微服务以及架构发展">微服务以及架构发展</a></li><li><a href="/JVM-%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD" rel="bookmark" title="JVM-类的加载">JVM-类的加载</a></li><li><a href="/SpringCloud-Netflix%E4%BD%93%E7%B3%BB" rel="bookmark" title="SpringCloud-Netflix体系">SpringCloud-Netflix体系</a></li><li><a href="/%E5%BA%8F%E5%88%97%E5%8C%96" rel="bookmark" title="序列化">序列化</a></li><li><a href="/JVM-JMM" rel="bookmark" title="JVM-JMM">JVM-JMM</a></li><li><a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%8E%E9%AB%98%E5%B9%B6%E5%8F%91%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84" rel="bookmark" title="分布式系统与高并发系统架构">分布式系统与高并发系统架构</a></li><li><a href="/JVM-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA" rel="bookmark" title="JVM-对象的创建">JVM-对象的创建</a></li><li class="active"><a href="/JVM-JVM%E8%B0%83%E4%BC%98" rel="bookmark" title="JVM-JVM调优">JVM-JVM调优</a></li><li><a href="/JVM-GC" rel="bookmark" title="JVM-GC">JVM-GC</a></li><li><a href="/SpringCloud-Alibaba%E4%BD%93%E7%B3%BB" rel="bookmark" title="SpringCloud-Alibaba体系">SpringCloud-Alibaba体系</a></li><li><a href="/SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB" rel="bookmark" title="SpringCloud-SpringCloud体系">SpringCloud-SpringCloud体系</a></li><li><a href="/Apollo" rel="bookmark" title="Apollo">Apollo</a></li><li><a href="/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89" rel="bookmark" title="微服务中的会话管理（一）">微服务中的会话管理（一）</a></li><li><a href="/%E7%A3%81%E7%9B%98IO%E4%B8%8E%E7%BD%91%E7%BB%9CIO" rel="bookmark" title="磁盘IO与网络IO">磁盘IO与网络IO</a></li><li><a href="/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89" rel="bookmark" title="微服务中的会话管理（二）">微服务中的会话管理（二）</a></li><li><a href="/HTTPS" rel="bookmark" title="HTTPS">HTTPS</a></li><li><a href="/RocketMQ-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5" rel="bookmark" title="RocketMQ-基础概念">RocketMQ-基础概念</a></li><li><a href="/RocketMQ-%E6%B6%88%E6%81%AF%E3%80%81%E4%BA%8B%E5%8A%A1" rel="bookmark" title="RocketMQ-消息、事务">RocketMQ-消息、事务</a></li><li><a href="/Kafka-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84" rel="bookmark" title="Kafka-整体架构">Kafka-整体架构</a></li><li><a href="/%E7%BD%91%E7%BB%9CIO%E6%A8%A1%E5%9E%8B" rel="bookmark" title="网络IO模型">网络IO模型</a></li><li><a href="/Kafka-%E6%90%AD%E5%BB%BA" rel="bookmark" title="Kafka-搭建">Kafka-搭建</a></li><li><a href="/Netty" rel="bookmark" title="Netty">Netty</a></li><li><a href="/nginx%E5%AE%9E%E6%88%98" rel="bookmark" title="nginx实战">nginx实战</a></li><li><a href="/Java%E5%92%8C%E4%B8%B2%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1" rel="bookmark" title="Java和串口进行通信">Java和串口进行通信</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="fanfanfan" data-src="/images/avatar.png"><p class="name" itemprop="name">fanfanfan</p><div class="description" itemprop="description">花有重开日，人无再少年</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">76</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">4</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">78</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-magic"></i>友链</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/JVM-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/JVM-GC" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/AOP" title="AOP">AOP</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/%E7%A3%81%E7%9B%98IO%E4%B8%8E%E7%BD%91%E7%BB%9CIO" title="磁盘IO与网络IO">磁盘IO与网络IO</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/shiro%E6%95%B4%E5%90%88SpringBoot" title="shiro整合SpringBoot">shiro整合SpringBoot</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/Proxy%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F" title="Proxy代理模式">Proxy代理模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86" title="线程基础知识">线程基础知识</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/java-%E6%97%A5%E5%BF%97%E4%BD%93%E7%B3%BB" title="java-日志体系">java-日志体系</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/redis%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8" title="redis在开发中的简单使用">redis在开发中的简单使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/java/" title="分类于 Java">Java</a></div><span><a href="/IOC%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F" title="IOC注解方式">IOC注解方式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/instruments/" title="分类于 工具">工具</a></div><span><a href="/%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E7%BF%BB%E8%AF%91%E5%B0%8F%E5%B7%A5%E5%85%B7%EF%BC%88%E4%BA%8C%EF%BC%89" title="手动实现翻译小工具（二）">手动实现翻译小工具（二）</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/title/" title="未命名">未命名</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">fanfanfan @ 书院十四先生</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"/JVM-JVM调优",favicon:{show:"书院十四先生",hide:"书院十四先生"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->