{
    "version": "https://jsonfeed.org/version/1",
    "title": null,
    "subtitle": null,
    "icon": "https://baiyezi.vip/images/favicon.ico",
    "description": "èŠ±æœ‰é‡å¼€æ—¥ï¼Œäººæ— å†å°‘å¹´",
    "home_page_url": "https://baiyezi.vip",
    "items": [
        {
            "id": "https://baiyezi.vip/instruments/%E7%BF%BB%E8%AF%91%E5%B0%8F%E5%B7%A5%E5%85%B7/%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E7%BF%BB%E8%AF%91%E5%B0%8F%E5%B7%A5%E5%85%B7%EF%BC%88%E4%BA%8C%EF%BC%89/",
            "url": "https://baiyezi.vip/instruments/%E7%BF%BB%E8%AF%91%E5%B0%8F%E5%B7%A5%E5%85%B7/%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E7%BF%BB%E8%AF%91%E5%B0%8F%E5%B7%A5%E5%85%B7%EF%BC%88%E4%BA%8C%EF%BC%89/",
            "title": "æ‰‹åŠ¨å®ç°ç¿»è¯‘å°å·¥å…·ï¼ˆäºŒï¼‰",
            "date_published": "2021-12-24T01:30:17.000Z",
            "content_html": "<p>æ¥ç€ä¸ŠæœŸçš„å†…å®¹æ¥æ”¹è¿›æˆ‘ä»¬çš„ç¿»è¯‘å°å·¥å…·ã€‚æ”¹è¿›åçš„ç¿»è¯‘å°å·¥å…·ç°åœ¨æ”¯æŒï¼š</p>\n<p>ğŸ‰‘ è‹±æ–‡éŸ³æ ‡çš„æ˜¾ç¤ºä¸æ’­æ”¾ï¼ˆä»…å½“æŸ¥è¯ä¸ºè‹±æ–‡æ—¶æ”¯æŒï¼Œè¿™æ˜¯æœ‰é“å®˜æ–¹ API çš„é™åˆ¶ï¼‰</p>\n<p>ğŸ’Œæ¥å…¥äº†ç™¾åº¦ç¿»è¯‘çš„ API</p>\n<p>å…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20211228211822.png\" alt=\"QQå›¾ç‰‡20200816181834-1597576605650\" /></p>\n<p>ğŸ“” è¯´æ˜ï¼š</p>\n<ul>\n<li>\n<p>ç™¾åº¦ç¿»è¯‘ API éœ€è¦å¼€é€šä¼ä¸šèµ„è´¨æ‰èƒ½è¿”å›éŸ³æ ‡ä»¥åŠéŸ³æ ‡çš„æ’­æ”¾é“¾æ¥ã€‚å¯¹äºä¸ªäººè€Œè¨€ï¼Œå…¶ API åªä¼šè¿”å›ä¸€é¡¹åŸºç¡€çš„æŸ¥è¯¢ç»“æœã€‚</p>\n</li>\n<li>\n<p>æœ‰é“äº‘ API è§„å®šï¼Œéœ€è¦å¼€é€š TTS è¯­éŸ³æœåŠ¡æ‰èƒ½è¿”å›è¯­éŸ³é“¾æ¥</p>\n</li>\n<li>\n<p>æºç å·²ä¸Šä¼  Github ä»¥åŠ Giteeï¼Œæ¬¢è¿å¤§å®¶ issue ä»¥åŠ forkï¼Œå…±åŒå‚ä¸æ”¹è¿›å°å·¥å…·ï¼</p>\n</li>\n<li>\n<p>Giteeï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vYmZhbmZhbmZhbi90cmFuc2xhdGlvbl90b29scy90cmVlL21hc3Rlcg==\">https://gitee.com/bfanfanfan/translation_tools/tree/master</span></p>\n</li>\n<li>\n<p>Githubï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3l1YW4xOTk2OTYvdHJhbnNsYXRpb25fdG9vbHM=\">https://github.com/yuan199696/translation_tools</span></p>\n</li>\n</ul>\n<p>ğŸ’Œ æˆ‘æ˜¯ä¸€åªå°ç™½çŒ¿ï¼Œä¸‹æœŸè§ï¼</p>\n",
            "tags": [
                "å·¥å…·",
                "å‰ç«¯",
                "å·¥å…·",
                "ç¿»è¯‘",
                "Vue"
            ]
        },
        {
            "id": "https://baiyezi.vip/instruments/%E6%B5%81%E7%A8%8B%E5%9B%BE/%E5%9F%BA%E4%BA%8ETypora%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E5%88%B6%E4%BD%9C/",
            "url": "https://baiyezi.vip/instruments/%E6%B5%81%E7%A8%8B%E5%9B%BE/%E5%9F%BA%E4%BA%8ETypora%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE%E5%88%B6%E4%BD%9C/",
            "title": "åŸºäºTyporaçš„æµç¨‹å›¾åˆ¶ä½œ",
            "date_published": "2021-12-24T01:30:17.000Z",
            "content_html": "<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0LnR5cG9yYS5pby9EcmF3LURpYWdyYW1zLVdpdGgtTWFya2Rvd24v\">å®˜ç½‘</span></p>\n<h2 id=\"sequence\"><a class=\"anchor\" href=\"#sequence\">#</a> Sequence</h2>\n<pre><code class=\"language-cmd\">Title:æ ‡é¢˜\nA-&gt;B:hello\nB--&gt;C:è™šçº¿\nNote right of B:æ³¨é‡Š\nB-&gt;A:hhhhh\nC-&gt;&gt;A:ç©ºå¿ƒç®­å¤´\nNote left of A:Aå·¦è¾¹çš„æ³¨é‡Š\\næ¢è¡Œ\nNote right of A:Aå³è¾¹çš„æ³¨é‡Š\nNote over B:Bä¸­é—´çš„æ³¨é‡Š\nNote over A,C:æ¨ªè·¨Aã€Cçš„æ³¨é‡Š\n</code></pre>\n<pre><code class=\"language-sequence\">Title:æ ‡é¢˜\nA-&gt;B:hello\nB--&gt;C:è™šçº¿\nNote right of B:æ³¨é‡Š\nB-&gt;A:hhhhh\nC-&gt;&gt;A:ç©ºå¿ƒç®­å¤´\nNote left of A:Aå·¦è¾¹çš„æ³¨é‡Š\\næ¢è¡Œ\nNote right of A:Aå³è¾¹çš„æ³¨é‡Š\nNote over B:Bä¸­é—´çš„æ³¨é‡Š\nNote over A,C:æ¨ªè·¨Aã€Cçš„æ³¨é‡Š\n\n</code></pre>\n<h2 id=\"flow\"><a class=\"anchor\" href=\"#flow\">#</a> Flow</h2>\n<pre><code class=\"language-cmd\">st=&gt;start: å¼€å§‹\nop=&gt;operation: ä½ å¥½å—\nsub=&gt;subroutine: çœŸçš„ä¸å¥½å—\ncond=&gt;condition: å¥½è¿˜æ˜¯ä¸å¥½\nio=&gt;inputoutput: é‚£å°±å¥½\npara=&gt;parallel: å†æ¬¡ç¡®å®š\ne=&gt;end\n# è§„å®šä»¥ä¸Šç»„ä»¶çš„æŒ‡å‘ä»¥åŠè¿æ¥çº¿æ–¹å‘\nst-&gt;op-&gt;cond\ncond(yes)-&gt;io-&gt;e\ncond(no)-&gt;sub(right)-&gt;para-&gt;op\npara(path1, right)-&gt;op\n</code></pre>\n<figure class=\"highlight flow\"><figcaption data-lang=\"flow\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>st<span class=\"token operator\">=></span>start<span class=\"token operator\">:</span> å¼€å§‹</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>op<span class=\"token operator\">=></span>operation<span class=\"token operator\">:</span> ä½ å¥½å—</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>sub<span class=\"token operator\">=></span>subroutine<span class=\"token operator\">:</span> çœŸçš„ä¸å¥½å—</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>cond<span class=\"token operator\">=></span>condition<span class=\"token operator\">:</span> å¥½è¿˜æ˜¯ä¸å¥½</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>io<span class=\"token operator\">=></span>inputoutput<span class=\"token operator\">:</span> é‚£å°±å¥½</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>para<span class=\"token operator\">=></span>parallel<span class=\"token operator\">:</span> å†æ¬¡ç¡®å®š</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>e<span class=\"token operator\">=></span>end</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>st<span class=\"token operator\">-</span><span class=\"token operator\">></span>op<span class=\"token operator\">-</span><span class=\"token operator\">></span>cond</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">cond</span><span class=\"token punctuation\">(</span>yes<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>io<span class=\"token operator\">-</span><span class=\"token operator\">></span>e</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function\">cond</span><span class=\"token punctuation\">(</span>no<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">sub</span><span class=\"token punctuation\">(</span>right<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>para<span class=\"token operator\">-</span><span class=\"token operator\">></span>op</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">para</span><span class=\"token punctuation\">(</span>path1<span class=\"token punctuation\">,</span> right<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>op</pre></td></tr></table></figure><h2 id=\"mermaid\"><a class=\"anchor\" href=\"#mermaid\">#</a> Mermaid</h2>\n<h3 id=\"sequence-diagrams\"><a class=\"anchor\" href=\"#sequence-diagrams\">#</a> Sequence Diagrams</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZXJtYWlkLWpzLmdpdGh1Yi5pby9tZXJtYWlkLyMvc2VxdWVuY2VEaWFncmFt\">åºåˆ—å›¾å®˜ç½‘</span></p>\n<p>è™šçº¿ã€å®çº¿ã€ç®­å¤´</p>\n<pre><code class=\"language-cmd\">sequenceDiagram #éœ€è¦ç”³æ˜å›¾è¡¨ç±»å‹\nparticipant A as Alice #å£°åAä»£è¡¨Alice\nparticipant  B as Bluence #å£°åBä»£è¡¨Bluence\nA-&gt;&gt;B: ä½ å¥½å— #å®çº¿æœ‰ç®­å¤´\nB--&gt;&gt;A: ä¸æ˜¯å¾ˆå¥½ #è™šçº¿æœ‰ç®­å¤´\nB-&gt; A: æ–­çº¿äº†... #å®çº¿æ— ç®­å¤´\nA--&gt;A: è¿çº¿ä¸­... #è™šçº¿æ— ç®­å¤´\nA--&gt;B: æ— æ³•è¿æ¥ #æŒ‡å‘è‡ªå·±\nB-&gt;&gt;A: ä½ çš„ç½‘ç»œä¸å¥½ï¼Œå…ˆä¸è¯´äº†ï¼\nA-xB: æˆ‘çš„ç½‘ç»œä¼¼ä¹æ–­äº†\nA--xB: ä½ è¿˜åœ¨å—ï¼Ÿ\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">sequenceDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">participant</span> A as Alice</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">participant</span>  B as Bluence</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>A<span class=\"token arrow operator\">->></span>B<span class=\"token operator\">:</span> ä½ å¥½å—</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>B<span class=\"token arrow operator\">-->></span>A<span class=\"token operator\">:</span> ä¸æ˜¯å¾ˆå¥½</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>B<span class=\"token arrow operator\">-></span> A<span class=\"token operator\">:</span> æ–­çº¿äº†...</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>A<span class=\"token arrow operator\">--></span>A<span class=\"token operator\">:</span> è¿çº¿ä¸­...</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>A<span class=\"token arrow operator\">--></span>B<span class=\"token operator\">:</span> æ— æ³•è¿æ¥</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>B<span class=\"token arrow operator\">->></span>A<span class=\"token operator\">:</span> ä½ çš„ç½‘ç»œä¸å¥½ï¼Œå…ˆä¸è¯´äº†ï¼</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>A<span class=\"token arrow operator\">-x</span>B<span class=\"token operator\">:</span> æˆ‘çš„ç½‘ç»œä¼¼ä¹æ–­äº†</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>A<span class=\"token arrow operator\">--x</span>B<span class=\"token operator\">:</span> ä½ è¿˜åœ¨å—ï¼Ÿ</pre></td></tr></table></figure><p>æ³¨é‡Š</p>\n<pre><code class=\"language-cmd\">sequenceDiagram\nNote left of A: æˆ‘æ˜¯Aå·¦è¾¹çš„æ³¨é‡Š\nNote over A: æˆ‘Aæ˜¯ä¸­é—´çš„æ³¨é‡Š\nNote right of A: æˆ‘æ˜¯å³Aè¾¹çš„æ³¨é‡Š\nNote over A,B: æˆ‘æ˜¯æ¨ªè·¨Aã€Bä¹‹é—´çš„æ³¨é‡Š\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">sequenceDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">Note left of</span> A<span class=\"token operator\">:</span> æˆ‘æ˜¯Aå·¦è¾¹çš„æ³¨é‡Š</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">Note over</span> A<span class=\"token operator\">:</span> æˆ‘Aæ˜¯ä¸­é—´çš„æ³¨é‡Š</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">Note right of</span> A<span class=\"token operator\">:</span> æˆ‘æ˜¯å³Aè¾¹çš„æ³¨é‡Š</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">Note over</span> A,B<span class=\"token operator\">:</span> æˆ‘æ˜¯æ¨ªè·¨Aã€Bä¹‹é—´çš„æ³¨é‡Š</pre></td></tr></table></figure><p>å¾ªç¯è¯­å¥</p>\n<pre><code class=\"language-cmd\">sequenceDiagram\nA--&gt;&gt;B: ä½ å¥½å—ï¼Ÿ\nloop æˆ‘ä»£è¡¨å¾ªç¯\n\tB--&gt;&gt;A: æˆ‘å¾ˆå¥½ï¼\nend\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">sequenceDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token arrow operator\">-->></span>B<span class=\"token operator\">:</span> ä½ å¥½å—ï¼Ÿ</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">loop</span> æˆ‘ä»£è¡¨å¾ªç¯</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tB<span class=\"token arrow operator\">-->></span>A<span class=\"token operator\">:</span> æˆ‘å¾ˆå¥½ï¼</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>åˆ¤æ–­è¯­å¥</p>\n<pre><code class=\"language-cmd\">sequenceDiagram\nA-&gt;&gt;B: ä½ å¥½å—ï¼Ÿ\nalt å¦‚æœBå¾ˆå¥½ï¼Œé‚£ä¹ˆBä¼šå¯¹Aè¯´ï¼š\n\tB-&gt;&gt;A: æˆ‘å¾ˆå¥½ï¼\nelse å¦åˆ™Bä¼šå¯¹Aè¯´ï¼š\n\tB-&gt;&gt;A: æˆ‘ä¸æ˜¯å¾ˆå¥½ï¼\nend\nopt ç®€å•çš„å›åº”  # å¦‚æœæ²¡æœ‰elseï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨optæ¥ä»£æ›¿if\n B-&gt;&gt;A: è°¢è°¢ä½ çš„å…³å¿ƒï¼\nend\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">sequenceDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token arrow operator\">-->></span>B<span class=\"token operator\">:</span> ä½ å¥½å—ï¼Ÿ</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">alt</span> å¦‚æœBå¾ˆå¥½ï¼Œé‚£ä¹ˆBä¼šå¯¹Aè¯´ï¼š</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tB<span class=\"token arrow operator\">->></span>A<span class=\"token operator\">:</span> æˆ‘å¾ˆå¥½ï¼</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">else</span> å¦åˆ™Bä¼šå¯¹Aè¯´ï¼š</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tB<span class=\"token arrow operator\">->></span>A<span class=\"token operator\">:</span> æˆ‘ä¸æ˜¯å¾ˆå¥½ï¼</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">opt</span> ç®€å•çš„å›åº”</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> B<span class=\"token arrow operator\">->></span>A<span class=\"token operator\">:</span> è°¢è°¢ä½ çš„å…³å¿ƒï¼</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>å¹³çº§è¡¨ç¤º</p>\n<pre><code class=\"language-cmd\">sequenceDiagram\npar Aå¯¹Bè¯´\nA-&gt;&gt;B: ä½ å¥½å—\nand Aå¯¹Cè¯´\nA-&gt;&gt;C: ä½ å¥½å—\nend\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">sequenceDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">par</span> Aå¯¹Bè¯´</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>A<span class=\"token arrow operator\">->></span>B<span class=\"token operator\">:</span> ä½ å¥½å—</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">and</span> Aå¯¹Cè¯´</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>A<span class=\"token arrow operator\">->></span>C<span class=\"token operator\">:</span> ä½ å¥½å—</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>èƒŒæ™¯é«˜äº®</p>\n<pre><code class=\"language-cmd\">sequenceDiagram\nrect rgb(0,245,255)\nA-&gt;&gt;B: ä½ å¥½å—\nend\nrect rgb(255,246,143)\nB-&gt;&gt;A: æˆ‘å¾ˆå¥½ï¼\nend\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">sequenceDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">rect</span> rgb<span class=\"token text string\">(0,245,255)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>A<span class=\"token arrow operator\">->></span>B<span class=\"token operator\">:</span> ä½ å¥½å—</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">rect</span> rgb<span class=\"token text string\">(255,246,143)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>B<span class=\"token arrow operator\">->></span>A<span class=\"token operator\">:</span> æˆ‘å¾ˆå¥½ï¼</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>ä»£ç æ³¨é‡Š</p>\n<pre><code class=\"language-cmd\">sequenceDiagram\n%% æˆ‘æ˜¯æ³¨é‡Šï¼Œä¸ä¼šè¢«æ˜¾ç¤º\nA-&gt;&gt;B: ä½ å¥½å—\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">sequenceDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">%% æˆ‘æ˜¯æ³¨é‡Š</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>A<span class=\"token arrow operator\">->></span>B<span class=\"token operator\">:</span> ä½ å¥½å—</pre></td></tr></table></figure><p>ç‰¹æ®Šç¬¦å·</p>\n<pre><code class=\"language-cmd\">sequenceDiagram\n    A-&gt;&gt;B: I #9829; you!\n    B-&gt;&gt;A: I #9829; you #infin; times more!\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">sequenceDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    A<span class=\"token arrow operator\">->></span>B<span class=\"token operator\">:</span> I <span class=\"token entity\" title=\"#9829;\">#9829;</span> you!</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    B<span class=\"token arrow operator\">->></span>A<span class=\"token operator\">:</span> I <span class=\"token entity\" title=\"#9829;\">#9829;</span> you <span class=\"token entity\" title=\"#infin;\">#infin;</span> times more!</pre></td></tr></table></figure><p>æœ‰åºåºå·</p>\n<pre><code class=\"language-cmd\">sequenceDiagram\n    autonumber\n    Alice-&gt;&gt;John: Hello John, how are you?\n    loop Healthcheck\n        John-&gt;&gt;John: Fight against hypochondria\n    end\n    Note right of John: Rational thoughts!\n    John--&gt;&gt;Alice: Great!\n    John-&gt;&gt;Bob: How about you?\n    Bob--&gt;&gt;John: Jolly good!\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">sequenceDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">autonumber</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    Alice<span class=\"token arrow operator\">->></span>John<span class=\"token operator\">:</span> Hello John, how are you?</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">loop</span> Healthcheck</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        John<span class=\"token arrow operator\">->></span>John<span class=\"token operator\">:</span> Fight against hypochondria</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">Note right of</span> John<span class=\"token operator\">:</span> Rational thoughts!</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    John<span class=\"token arrow operator\">-->></span>Alice<span class=\"token operator\">:</span> Great!</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    John<span class=\"token arrow operator\">->></span>Bob<span class=\"token operator\">:</span> How about you?</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    Bob<span class=\"token arrow operator\">-->></span>John<span class=\"token operator\">:</span> Jolly good!</pre></td></tr></table></figure><h3 id=\"flowcharts\"><a class=\"anchor\" href=\"#flowcharts\">#</a> Flowcharts</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZXJtYWlkLWpzLmdpdGh1Yi5pby9tZXJtYWlkLyMvZmxvd2NoYXJ0\">æµç¨‹å›¾å®˜ç½‘</span></p>\n<h4 id=\"æ–¹å‘\"><a class=\"anchor\" href=\"#æ–¹å‘\">#</a> æ–¹å‘</h4>\n<p>TDã€TBã€LRã€RLã€BT è¡¨ç¤ºæ–¹å‘</p>\n<pre><code class=\"language-cmd\">graph TD  #TDæˆ–TBè¡¨ç¤ºä»ä¸Šåˆ°ä¸‹\nå¼€å§‹--&gt;ç»“æŸ\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> TD</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>å¼€å§‹<span class=\"token arrow operator\">--></span>ç»“æŸ</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR #ä»å·¦åˆ°å³\nå¼€å§‹--&gt;ç»“æŸ\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>å¼€å§‹<span class=\"token arrow operator\">--></span>ç»“æŸ</pre></td></tr></table></figure><h4 id=\"èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#èŠ‚ç‚¹\">#</a> èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph LR\nå•ä¸ªèŠ‚ç‚¹\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>å•ä¸ªèŠ‚ç‚¹</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nid1[å•ä¸ªèŠ‚ç‚¹]\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1<span class=\"token text string\">[å•ä¸ªèŠ‚ç‚¹]</span></pre></td></tr></table></figure><h4 id=\"åœ†å½¢è¾¹ç¼˜èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#åœ†å½¢è¾¹ç¼˜èŠ‚ç‚¹\">#</a> åœ†å½¢è¾¹ç¼˜èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph LR\nid1(åœ†å½¢è¾¹ç¼˜èŠ‚ç‚¹)\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1<span class=\"token text string\">(åœ†å½¢è¾¹ç¼˜èŠ‚ç‚¹)</span></pre></td></tr></table></figure><h4 id=\"æ¤­åœ†å½¢èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#æ¤­åœ†å½¢èŠ‚ç‚¹\">#</a> æ¤­åœ†å½¢èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph LR\nid1([æ¤­åœ†å½¢èŠ‚ç‚¹])\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1<span class=\"token text string\">([æ¤­åœ†å½¢èŠ‚ç‚¹])</span></pre></td></tr></table></figure><h4 id=\"å­èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#å­èŠ‚ç‚¹\">#</a> å­èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph LR\nid1[[å­èŠ‚ç‚¹]]\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1<span class=\"token text string\">[[å­èŠ‚ç‚¹]]</span></pre></td></tr></table></figure><h4 id=\"åœ†æŸ±å½¢èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#åœ†æŸ±å½¢èŠ‚ç‚¹\">#</a> åœ†æŸ±å½¢èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph LR\nid1[(åœ†æŸ±å½¢èŠ‚ç‚¹)]\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1<span class=\"token text string\">[(åœ†æŸ±å½¢èŠ‚ç‚¹)]</span></pre></td></tr></table></figure><h4 id=\"åœ†å½¢èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#åœ†å½¢èŠ‚ç‚¹\">#</a> åœ†å½¢èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph LR\nid1((åœ†å½¢èŠ‚ç‚¹))\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1<span class=\"token text string\">((åœ†å½¢èŠ‚ç‚¹))</span></pre></td></tr></table></figure><h4 id=\"éå¯¹ç§°èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#éå¯¹ç§°èŠ‚ç‚¹\">#</a> éå¯¹ç§°èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph LR\nid1&gt;éå¯¹ç§°èŠ‚ç‚¹]\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1<span class=\"token text string\">>éå¯¹ç§°èŠ‚ç‚¹]</span></pre></td></tr></table></figure><h4 id=\"è±å½¢èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#è±å½¢èŠ‚ç‚¹\">#</a> è±å½¢èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph LR\nid1&#123;è±å½¢èŠ‚ç‚¹&#125;\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1<span class=\"token text string\">&#123;è±å½¢èŠ‚ç‚¹&#125;</span></pre></td></tr></table></figure><h4 id=\"å…­è§’èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#å…­è§’èŠ‚ç‚¹\">#</a> å…­è§’èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph LR\nid1&#123;&#123;å…­è§’èŠ‚ç‚¹&#125;&#125;\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1&lt;!<span class=\"token inter-arrow-label\"><span class=\"token arrow-head arrow operator\">--</span><span class=\"token label property\">swigï¿¼1</span><span class=\"token arrow operator\">--></span></span></pre></td></tr></table></figure><h4 id=\"å¹³è¡Œå››è¾¹å½¢èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#å¹³è¡Œå››è¾¹å½¢èŠ‚ç‚¹\">#</a> å¹³è¡Œå››è¾¹å½¢èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph TD\nid1[/å¹³è¡Œå››è¾¹å½¢èŠ‚ç‚¹/]\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> TD</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1<span class=\"token text string\">[/å¹³è¡Œå››è¾¹å½¢èŠ‚ç‚¹/]</span></pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph TD\nid1[\\å¹³è¡Œå››è¾¹å½¢èŠ‚ç‚¹\\]\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> TD</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>id1<span class=\"token text string\">[\\å¹³è¡Œå››è¾¹å½¢èŠ‚ç‚¹\\]</span></pre></td></tr></table></figure><h4 id=\"æ¢¯å½¢èŠ‚ç‚¹\"><a class=\"anchor\" href=\"#æ¢¯å½¢èŠ‚ç‚¹\">#</a> æ¢¯å½¢èŠ‚ç‚¹</h4>\n<pre><code class=\"language-cmd\">graph TD\nA[/æ¢¯å½¢èŠ‚ç‚¹\\]\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> TD</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token text string\">[/æ¢¯å½¢èŠ‚ç‚¹\\]</span></pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph TD\nB[\\æ¢¯å½¢èŠ‚ç‚¹/]\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> TD</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>B<span class=\"token text string\">[\\æ¢¯å½¢èŠ‚ç‚¹/]</span></pre></td></tr></table></figure><h4 id=\"èŠ‚ç‚¹è¿æ¥\"><a class=\"anchor\" href=\"#èŠ‚ç‚¹è¿æ¥\">#</a> èŠ‚ç‚¹è¿æ¥</h4>\n<pre><code class=\"language-cmd\">graph LR\nA--&gt;B\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token arrow operator\">--></span>B</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nA---B\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token arrow operator\">---</span>B</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nA--è¯´æ˜---B\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token inter-arrow-label\"><span class=\"token arrow-head arrow operator\">--</span><span class=\"token label property\">è¯´æ˜</span><span class=\"token arrow operator\">---</span></span>B</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nA---|è¯´æ˜|B\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token arrow operator\">---</span><span class=\"token label property\">|è¯´æ˜|</span>B</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nA--&gt;|è¯´æ˜|B\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token arrow operator\">--></span><span class=\"token label property\">|è¯´æ˜|</span>B</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nA--è¯´æ˜--&gt;B\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token inter-arrow-label\"><span class=\"token arrow-head arrow operator\">--</span><span class=\"token label property\">è¯´æ˜</span><span class=\"token arrow operator\">--></span></span>B</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR;\nA-.-&gt;B\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token arrow operator\">-.-></span>B</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nA-.è¯´æ˜.-&gt;B\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token inter-arrow-label\"><span class=\"token arrow-head arrow operator\">-.</span><span class=\"token label property\">è¯´æ˜</span><span class=\"token arrow operator\">.-></span></span>B</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nA==&gt;B\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token arrow operator\">==></span>B</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nA==è¯´æ˜==&gt;B\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token inter-arrow-label\"><span class=\"token arrow-head arrow operator\">==</span><span class=\"token label property\">è¯´æ˜</span><span class=\"token arrow operator\">==></span></span>B</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nA--è¯´æ˜--&gt;B--è¯´æ˜--&gt;C\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token inter-arrow-label\"><span class=\"token arrow-head arrow operator\">--</span><span class=\"token label property\">è¯´æ˜</span><span class=\"token arrow operator\">--></span></span>B<span class=\"token inter-arrow-label\"><span class=\"token arrow-head arrow operator\">--</span><span class=\"token label property\">è¯´æ˜</span><span class=\"token arrow operator\">--></span></span>C</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\nA--&gt;B &amp; C--&gt;D\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A<span class=\"token arrow operator\">--></span>B <span class=\"token operator\">&amp;</span> C<span class=\"token arrow operator\">--></span>D</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph TB\nA &amp; B--&gt;C &amp; D\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> TB</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>A <span class=\"token operator\">&amp;</span> B<span class=\"token arrow operator\">--></span>C <span class=\"token operator\">&amp;</span> D</pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph TB\n    A --&gt; C\n    A --&gt; D\n    B --&gt; C\n    B --&gt; D\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> TB</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    A <span class=\"token arrow operator\">--></span> C</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    A <span class=\"token arrow operator\">--></span> D</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    B <span class=\"token arrow operator\">--></span> C</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    B <span class=\"token arrow operator\">--></span> D</pre></td></tr></table></figure><pre><code class=\"language-cmd\">flowchart LR\n    A --o B\n    B --x C\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">flowchart</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    A <span class=\"token arrow operator\">--o</span> B</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    B <span class=\"token arrow operator\">--x</span> C</pre></td></tr></table></figure><pre><code class=\"language-cmd\">flowchart LR\n    A o--o B\n    B &lt;--&gt; C\n    C x--x D\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">flowchart</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    A <span class=\"token arrow operator\">o--o</span> B</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    B <span class=\"token arrow operator\">&lt;--></span> C</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    C <span class=\"token arrow operator\">x--x</span> D</pre></td></tr></table></figure><h4 id=\"ç®­å¤´æ€»ç»“\"><a class=\"anchor\" href=\"#ç®­å¤´æ€»ç»“\">#</a> ç®­å¤´æ€»ç»“</h4>\n<table>\n<thead>\n<tr>\n<th>Length</th>\n<th>1</th>\n<th>2</th>\n<th>3</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Normal</td>\n<td><code>---</code></td>\n<td><code>----</code></td>\n<td><code>-----</code></td>\n</tr>\n<tr>\n<td>Normal with arrow</td>\n<td><code>--&gt;</code></td>\n<td><code>---&gt;</code></td>\n<td><code>----&gt;</code></td>\n</tr>\n<tr>\n<td>Thick</td>\n<td><code>===</code></td>\n<td><code>====</code></td>\n<td><code>=====</code></td>\n</tr>\n<tr>\n<td>Thick with arrow</td>\n<td><code>==&gt;</code></td>\n<td><code>===&gt;</code></td>\n<td><code>====&gt;</code></td>\n</tr>\n<tr>\n<td>Dotted</td>\n<td><code>-.-</code></td>\n<td><code>-..-</code></td>\n<td><code>-...-</code></td>\n</tr>\n<tr>\n<td>Dotted with arrow</td>\n<td><code>-.-&gt;</code></td>\n<td><code>-..-&gt;</code></td>\n<td><code>-...-&gt;</code></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"ç‰¹æ®Šå­—ç¬¦\"><a class=\"anchor\" href=\"#ç‰¹æ®Šå­—ç¬¦\">#</a> ç‰¹æ®Šå­—ç¬¦</h4>\n<pre><code class=\"language-cmd\">graph LR\n        A[&quot;A double quote:#quot;&quot;] --&gt;B[&quot;A dec char:#9829;&quot;]\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        A<span class=\"token text string\">[\"A double quote:#quot;\"]</span> <span class=\"token arrow operator\">--></span>B<span class=\"token text string\">[\"A dec char:#9829;\"]</span></pre></td></tr></table></figure><h4 id=\"å­å›¾\"><a class=\"anchor\" href=\"#å­å›¾\">#</a> å­å›¾</h4>\n<pre><code class=\"language-cmd\">graph TB\n    c1--&gt;a2\n    subgraph one\n    a1--&gt;a2\n    end\n    subgraph two\n    b1--&gt;b2\n    end\n    subgraph three\n    c1--&gt;c2\n    end\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> TB</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    c1<span class=\"token arrow operator\">--></span>a2</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">subgraph</span> one</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    a1<span class=\"token arrow operator\">--></span>a2</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">subgraph</span> two</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    b1<span class=\"token arrow operator\">--></span>b2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">subgraph</span> three</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    c1<span class=\"token arrow operator\">--></span>c2</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph TB\n    c1--&gt;a2\n    subgraph ide1 [one]\n    a1--&gt;a2\n    end\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> TB</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    c1<span class=\"token arrow operator\">--></span>a2</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">subgraph</span> ide1 <span class=\"token text string\">[one]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    a1<span class=\"token arrow operator\">--></span>a2</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr></table></figure><pre><code class=\"language-cmd\">flowchart TB\n    c1--&gt;a2\n    subgraph one\n    a1--&gt;a2\n    end\n    subgraph two\n    b1--&gt;b2\n    end\n    subgraph three\n    c1--&gt;c2\n    end\n    one --&gt; two\n    three --&gt; two\n    two --&gt; c2\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">flowchart</span> TB</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    c1<span class=\"token arrow operator\">--></span>a2</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">subgraph</span> one</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    a1<span class=\"token arrow operator\">--></span>a2</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">subgraph</span> two</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    b1<span class=\"token arrow operator\">--></span>b2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">subgraph</span> three</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    c1<span class=\"token arrow operator\">--></span>c2</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">end</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    one <span class=\"token arrow operator\">--></span> two</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    three <span class=\"token arrow operator\">--></span> two</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    two <span class=\"token arrow operator\">--></span> c2</pre></td></tr></table></figure><h4 id=\"æ³¨é‡Š\"><a class=\"anchor\" href=\"#æ³¨é‡Š\">#</a> æ³¨é‡Š</h4>\n<pre><code class=\"language-cmd\">graph LR\n%% this is a comment A -- text --&gt; B&#123;node&#125;\n   A -- text --&gt; B -- text2 --&gt; C\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">%% this is a comment A -- text --> B&#123;node&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   A <span class=\"token inter-arrow-label\"><span class=\"token arrow-head arrow operator\">--</span> <span class=\"token label property\">text</span> <span class=\"token arrow operator\">--></span></span> B <span class=\"token inter-arrow-label\"><span class=\"token arrow-head arrow operator\">--</span> <span class=\"token label property\">text2</span> <span class=\"token arrow operator\">--></span></span> C</pre></td></tr></table></figure><h4 id=\"èŠ‚ç‚¹æ ·å¼\"><a class=\"anchor\" href=\"#èŠ‚ç‚¹æ ·å¼\">#</a> èŠ‚ç‚¹æ ·å¼</h4>\n<pre><code class=\"language-cmd\">graph LR\n    id1(Start)--&gt;id2(Stop)\n    style id1 fill:#f9f,stroke:#333,stroke-width:4px\n    style id2 fill:#bbf,stroke:#f66,stroke-width:2px,color:#fff,stroke-dasharray: 5 5\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    id1<span class=\"token text string\">(Start)</span><span class=\"token arrow operator\">--></span>id2<span class=\"token text string\">(Stop)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">style</span> id1 <span class=\"token style\"><span class=\"token property\">fill</span><span class=\"token operator\">:</span>#f9f<span class=\"token punctuation\">,</span><span class=\"token property\">stroke</span><span class=\"token operator\">:</span>#333<span class=\"token punctuation\">,</span><span class=\"token property\">stroke-width</span><span class=\"token operator\">:</span>4px</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">style</span> id2 <span class=\"token style\"><span class=\"token property\">fill</span><span class=\"token operator\">:</span>#bbf<span class=\"token punctuation\">,</span><span class=\"token property\">stroke</span><span class=\"token operator\">:</span>#f66<span class=\"token punctuation\">,</span><span class=\"token property\">stroke-width</span><span class=\"token operator\">:</span>2px<span class=\"token punctuation\">,</span><span class=\"token property\">color</span><span class=\"token operator\">:</span>#fff<span class=\"token punctuation\">,</span><span class=\"token property\">stroke-dasharray</span><span class=\"token operator\">:</span> 5 5</span></pre></td></tr></table></figure><pre><code class=\"language-cmd\">graph LR\n    A:::someclass --&gt; B\n    classDef someclass fill:#f96;\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">graph</span> LR</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    A<span class=\"token operator\">:::</span>someclass <span class=\"token arrow operator\">--></span> B</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">classDef</span> someclass <span class=\"token style\"><span class=\"token property\">fill</span><span class=\"token operator\">:</span>#f96</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"gantt-charts\"><a class=\"anchor\" href=\"#gantt-charts\">#</a> Gantt Charts</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZXJtYWlkLWpzLmdpdGh1Yi5pby9tZXJtYWlkLyMvZ2FudHQ=\">ç”˜ç‰¹å›¾å®˜ç½‘</span></p>\n<pre><code class=\"language-cmd\">gantt\n    title ç”˜ç‰¹å›¾\n    dateFormat  YYYY-MM-DD\n    section ç¬¬ä¸€èŠ‚\n    ç¬¬ä¸€èŠ‚ä»»åŠ¡1           :a1, 2021-04-03, 20d\n    ç¬¬ä¸€èŠ‚ä»»åŠ¡2    :after a1  , 5d\n    section ç¬¬äºŒèŠ‚\n    ç¬¬äºŒèŠ‚ä»»åŠ¡1    :2021-03-12  , 12d\n    ç¬¬äºŒèŠ‚ä»»åŠ¡2      : 24d\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">gantt</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    title ç”˜ç‰¹å›¾</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    dateFormat  YYYY-MM-DD</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    section ç¬¬ä¸€èŠ‚</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    ç¬¬ä¸€èŠ‚ä»»åŠ¡1           <span class=\"token operator\">:</span>a1, 2021-04-03, 20d</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    ç¬¬ä¸€èŠ‚ä»»åŠ¡2    <span class=\"token operator\">:</span>after a1  , 5d</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    section ç¬¬äºŒèŠ‚</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    ç¬¬äºŒèŠ‚ä»»åŠ¡1    <span class=\"token operator\">:</span>2021-03-12  , 12d</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    ç¬¬äºŒèŠ‚ä»»åŠ¡2      <span class=\"token operator\">:</span> 24d</pre></td></tr></table></figure><pre><code class=\"language-cmd\">gantt\n    dateFormat  YYYY-MM-DD\n    title       Adding GANTT diagram functionality to mermaid\n    excludes    weekends\n    %% (`excludes` accepts specific dates in YYYY-MM-DD format, days of the week (&quot;sunday&quot;) or &quot;weekends&quot;, but not the word &quot;weekdays&quot;.)\n\n    section A section\n    Completed task            :done,    des1, 2014-01-06,2014-01-08\n    Active task               :active,  des2, 2014-01-09, 3d\n    Future task               :         des3, after des2, 5d\n    Future task2              :         des4, after des3, 5d\n\n    section Critical tasks\n    Completed task in the critical line :crit, done, 2014-01-06,24h\n    Implement parser and jison          :crit, done, after des1, 2d\n    Create tests for parser             :crit, active, 3d\n    Future task in critical line        :crit, 5d\n    Create tests for renderer           :2d\n    Add to mermaid                      :1d\n\n    section Documentation\n    Describe gantt syntax               :active, a1, after des1, 3d\n    Add gantt diagram to demo page      :after a1  , 20h\n    Add another diagram to demo page    :doc1, after a1  , 48h\n\n    section Last section\n    Describe gantt syntax               :after doc1, 3d\n    Add gantt diagram to demo page      :20h\n    Add another diagram to demo page    :48h\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">gantt</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    dateFormat  YYYY-MM-DD</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    title       Adding GANTT diagram functionality to mermaid</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    excludes    weekends</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">%% (`excludes` accepts specific dates in YYYY-MM-DD format, days of the week (\"sunday\") or \"weekends\", but not the word \"weekdays\".)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    section A section</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    Completed task            <span class=\"token operator\">:</span>done,    des1, 2014-01-06,2014-01-08</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    Active task               <span class=\"token operator\">:</span>active,  des2, 2014-01-09, 3d</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    Future task               <span class=\"token operator\">:</span>         des3, after des2, 5d</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    Future task2              <span class=\"token operator\">:</span>         des4, after des3, 5d</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    section Critical tasks</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    Completed task in the critical line <span class=\"token operator\">:</span>crit, done, 2014-01-06,24h</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    Implement parser and jison          <span class=\"token operator\">:</span>crit, done, after des1, 2d</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    Create tests for parser             <span class=\"token operator\">:</span>crit, active, 3d</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    Future task in critical line        <span class=\"token operator\">:</span>crit, 5d</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    Create tests for renderer           <span class=\"token operator\">:</span>2d</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    Add to mermaid                      <span class=\"token operator\">:</span>1d</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    section Documentation</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    Describe gantt syntax               <span class=\"token operator\">:</span>active, a1, after des1, 3d</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    Add gantt diagram to demo page      <span class=\"token operator\">:</span>after a1  , 20h</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    Add another diagram to demo page    <span class=\"token operator\">:</span>doc1, after a1  , 48h</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    section Last section</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    Describe gantt syntax               <span class=\"token operator\">:</span>after doc1, 3d</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    Add gantt diagram to demo page      <span class=\"token operator\">:</span>20h</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    Add another diagram to demo page    <span class=\"token operator\">:</span>48h</pre></td></tr></table></figure><pre><code class=\"language-cmd\"> gantt\n        apple :a, 2017-07-20, 1w\n        banana :crit, b, 2017-07-23, 1d\n        cherry :active, c, after b a, 1d\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">gantt</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        apple <span class=\"token operator\">:</span>a, 2017-07-20, 1w</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        banana <span class=\"token operator\">:</span>crit, b, 2017-07-23, 1d</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        cherry <span class=\"token operator\">:</span>active, c, after b a, 1d</pre></td></tr></table></figure><h4 id=\"è¾“å…¥æ—¥æœŸ\"><a class=\"anchor\" href=\"#è¾“å…¥æ—¥æœŸ\">#</a> è¾“å…¥æ—¥æœŸ</h4>\n<pre><code class=\"language-cmd\">dateFormat YYYY-MM-DD\n</code></pre>\n<p>æ—¥æœŸæ ¼å¼</p>\n<pre><code class=\"language-cmd\">Input       Example             Description:\nYYYY        2014                4 digit year\nYY          14                  2 digit year\nQ           1..4                Quarter of year. Sets month to first month in quarter.\nM MM        1..12               Month number\nMMM MMMM    January..Dec        Month name in locale set by moment.locale()\nD DD        1..31               Day of month\nDo          1st..31st           Day of month with ordinal\nDDD DDDD    1..365              Day of year\nX           1410715640.579      Unix timestamp\nx           1410715640579       Unix ms timestamp\nH HH        0..23               24 hour time\nh hh        1..12               12 hour time used with a A.\na A         am pm               Post or ante meridiem\nm mm        0..59               Minutes\ns ss        0..59               Seconds\nS           0..9                Tenths of a second\nSS          0..99               Hundreds of a second\nSSS         0..999              Thousandths of a second\nZ ZZ        +12:00              Offset from UTC as +-HH:mm, +-HHmm, or Z\nMore info in: http://momentjs.com/docs/#/parsing/string-format/\n</code></pre>\n<h4 id=\"è¾“å‡ºæ—¥æœŸ\"><a class=\"anchor\" href=\"#è¾“å‡ºæ—¥æœŸ\">#</a> è¾“å‡ºæ—¥æœŸ</h4>\n<pre><code class=\"language-cmd\">axisFormat  %Y-%m-%d\n</code></pre>\n<p>æ—¥æœŸæ ¼å¼</p>\n<pre><code class=\"language-cmd\">%a - abbreviated weekday name.\n%A - full weekday name.\n%b - abbreviated month name.\n%B - full month name.\n%c - date and time, as &quot;%a %b %e %H:%M:%S %Y&quot;.\n%d - zero-padded day of the month as a decimal number [01,31].\n%e - space-padded day of the month as a decimal number [ 1,31]; equivalent to %_d.\n%H - hour (24-hour clock) as a decimal number [00,23].\n%I - hour (12-hour clock) as a decimal number [01,12].\n%j - day of the year as a decimal number [001,366].\n%m - month as a decimal number [01,12].\n%M - minute as a decimal number [00,59].\n%L - milliseconds as a decimal number [000, 999].\n%p - either AM or PM.\n%S - second as a decimal number [00,61].\n%U - week number of the year (Sunday as the first day of the week) as a decimal number [00,53].\n%w - weekday as a decimal number [0(Sunday),6].\n%W - week number of the year (Monday as the first day of the week) as a decimal number [00,53].\n%x - date, as &quot;%m/%d/%Y&quot;.\n%X - time, as &quot;%H:%M:%S&quot;.\n%y - year without century as a decimal number [00,99].\n%Y - year with century as a decimal number.\n%Z - time zone offset, such as &quot;-0700&quot;.\n%% - a literal &quot;%&quot; character.\nMore info in: https://github.com/mbostock/d3/wiki/Time-Formatting\n</code></pre>\n<h3 id=\"state-diagrams\"><a class=\"anchor\" href=\"#state-diagrams\">#</a> State Diagrams</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZXJtYWlkLWpzLmdpdGh1Yi5pby9tZXJtYWlkLyMvc3RhdGVEaWFncmFt\">çŠ¶æ€å›¾å®˜ç½‘</span></p>\n<pre><code class=\"language-cmd\">stateDiagram\n    [*] --&gt; Still\n    Still --&gt; [*]\n\n    Still --&gt; Moving\n    Moving --&gt; Still\n    Moving --&gt; Crash\n    Crash --&gt; [*]\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">stateDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token text string\">[*]</span> <span class=\"token arrow operator\">--></span> Still</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    Still <span class=\"token arrow operator\">--></span> <span class=\"token text string\">[*]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    Still <span class=\"token arrow operator\">--></span> Moving</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    Moving <span class=\"token arrow operator\">--></span> Still</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    Moving <span class=\"token arrow operator\">--></span> Crash</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    Crash <span class=\"token arrow operator\">--></span> <span class=\"token text string\">[*]</span></pre></td></tr></table></figure><h3 id=\"pie-chart-diagrams\"><a class=\"anchor\" href=\"#pie-chart-diagrams\">#</a> Pie chart diagrams</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZXJtYWlkLWpzLmdpdGh1Yi5pby9tZXJtYWlkLyMvcGll\">é¥¼å›¾å®˜ç½‘</span></p>\n<pre><code class=\"language-cmd\">pie title åŠ¨ç‰©ä¸–ç•Œ\n    &quot;Dogs&quot; : 386\n    &quot;Cats&quot; : 85\n    &quot;Rats&quot; : 15\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">pie</span> title åŠ¨ç‰©ä¸–ç•Œ</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">\"Dogs\"</span> <span class=\"token operator\">:</span> 386</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token string\">\"Cats\"</span> <span class=\"token operator\">:</span> 85</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token string\">\"Rats\"</span> <span class=\"token operator\">:</span> 15</pre></td></tr></table></figure><h3 id=\"user-journey-diagram\"><a class=\"anchor\" href=\"#user-journey-diagram\">#</a> User Journey Diagram</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZXJtYWlkLWpzLmdpdGh1Yi5pby9tZXJtYWlkLyMvdXNlci1qb3VybmV5\">ç”¨æˆ·ä¹‹æ—…å›¾å®˜ç½‘</span></p>\n<pre><code class=\"language-cmd\">journey\n    title æˆ‘çš„ä¸€å¤©\n    section Go to work\n      Make tea: 5: Me\n      Go upstairs: 3: Me\n      Do work: 1: Me, Cat\n    section Go home\n      Go downstairs: 5: Me\n      Sit down: 5: Me\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">journey</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    title æˆ‘çš„ä¸€å¤©</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    section Go to work</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      Make tea<span class=\"token operator\">:</span> 5<span class=\"token operator\">:</span> Me</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      Go upstairs<span class=\"token operator\">:</span> 3<span class=\"token operator\">:</span> Me</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      Do work<span class=\"token operator\">:</span> 1<span class=\"token operator\">:</span> Me, Cat</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    section Go home</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      Go downstairs<span class=\"token operator\">:</span> 5<span class=\"token operator\">:</span> Me</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      Sit down<span class=\"token operator\">:</span> 5<span class=\"token operator\">:</span> Me</pre></td></tr></table></figure><h3 id=\"entity-relationship-diagram\"><a class=\"anchor\" href=\"#entity-relationship-diagram\">#</a> Entity Relationship Diagram</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZXJtYWlkLWpzLmdpdGh1Yi5pby9tZXJtYWlkLyMvZW50aXR5UmVsYXRpb25zaGlwRGlhZ3JhbQ==\">å®ä½“å…³è”å›¾å®˜ç½‘</span></p>\n<pre><code class=\"language-cmd\">erDiagram\n    CUSTOMER ||--o&#123; ORDER : places\n    ORDER ||--|&#123; LINE-ITEM : contains\n    CUSTOMER &#125;|..|&#123; DELIVERY-ADDRESS : uses\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">erDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    CUSTOMER <span class=\"token arrow operator\">||--o&#123;</span> ORDER <span class=\"token operator\">:</span> places</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    ORDER <span class=\"token arrow operator\">||--|&#123;</span> LINE-ITEM <span class=\"token operator\">:</span> contains</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    CUSTOMER <span class=\"token arrow operator\">&#125;|..|&#123;</span> DELIVERY-ADDRESS <span class=\"token operator\">:</span> uses</pre></td></tr></table></figure><h3 id=\"class-diagram\"><a class=\"anchor\" href=\"#class-diagram\">#</a> Class Diagram</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZXJtYWlkLWpzLmdpdGh1Yi5pby9tZXJtYWlkLyMvY2xhc3NEaWFncmFt\">ç±»å›¾å®˜ç½‘</span></p>\n<pre><code class=\"language-cmd\">classDiagram\n      Animal &lt;|-- Duck\n      Animal &lt;|-- Fish\n      Animal &lt;|-- Zebra\n      Animal : +int age\n      Animal : +String gender\n      Animal: +isMammal()\n      Animal: +mate()\n      class Duck&#123;\n          +String beakColor\n          +swim()\n          +quack()\n      &#125;\n      class Fish&#123;\n          -int sizeInFeet\n          -canEat()\n      &#125;\n      class Zebra&#123;\n          +bool is_wild\n          +run()\n      &#125;\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">classDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      Animal <span class=\"token arrow operator\">&lt;|--</span> Duck</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      Animal <span class=\"token arrow operator\">&lt;|--</span> Fish</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      Animal <span class=\"token arrow operator\">&lt;|--</span> Zebra</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      Animal <span class=\"token operator\">:</span> +int age</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      Animal <span class=\"token operator\">:</span> +String gender</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      Animal<span class=\"token operator\">:</span> +isMammal<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      Animal<span class=\"token operator\">:</span> +mate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token keyword\">class</span> Duck<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>          +String beakColor</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>          +swim<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>          +quack<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token keyword\">class</span> Fish<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          -int sizeInFeet</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>          -canEat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token keyword\">class</span> Zebra<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>          +bool is_wild</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>          +run<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"æˆå‘˜å±æ€§ç±»å‹\"><a class=\"anchor\" href=\"#æˆå‘˜å±æ€§ç±»å‹\">#</a> æˆå‘˜å±æ€§ç±»å‹</h4>\n<pre><code class=\"language-cmd\">+ Public\n- Private\n# Protected\n~ Package/Internal\n* Abstract e.g.: someAbstractMethod()*\n$ Static e.g.: someStaticMethod()$\n</code></pre>\n<h4 id=\"å®šä¹‰ç±»çš„ä¸¤ç§æ–¹å¼\"><a class=\"anchor\" href=\"#å®šä¹‰ç±»çš„ä¸¤ç§æ–¹å¼\">#</a> å®šä¹‰ç±»çš„ä¸¤ç§æ–¹å¼</h4>\n<pre><code class=\"language-cmd\">classDiagram\n    class Animal\n    Vehicle &lt;|-- Car\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">classDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">class</span> Animal</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    Vehicle <span class=\"token arrow operator\">&lt;|--</span> Car</pre></td></tr></table></figure><h4 id=\"å®šä¹‰ç±»çš„æˆå‘˜\"><a class=\"anchor\" href=\"#å®šä¹‰ç±»çš„æˆå‘˜\">#</a> å®šä¹‰ç±»çš„æˆå‘˜</h4>\n<pre><code class=\"language-cmd\">classDiagram\nclass BankAccount\n BankAccount : +String owner\n BankAccount : +BigDecimal balance\n BankAccount : +deposit(amount)\n BankAccount : +withdrawal(amount)\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">classDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> BankAccount</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> BankAccount <span class=\"token operator\">:</span> +String owner</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> BankAccount <span class=\"token operator\">:</span> +BigDecimal balance</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> BankAccount <span class=\"token operator\">:</span> +deposit<span class=\"token text string\">(amount)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> BankAccount <span class=\"token operator\">:</span> +withdrawal<span class=\"token text string\">(amount)</span></pre></td></tr></table></figure><pre><code class=\"language-cmd\">classDiagram\nclass BankAccount&#123;\n    +String owner\n    +BigDecimal balance\n    +deposit(amount) bool\n    +withdrawl(amount) int\n&#125;\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">classDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> BankAccount<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    +String owner</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    +BigDecimal balance</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    +deposit<span class=\"token text string\">(amount)</span> bool</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    +withdrawl<span class=\"token text string\">(amount)</span> int</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"æ³›å‹ç±»å‹\"><a class=\"anchor\" href=\"#æ³›å‹ç±»å‹\">#</a> æ³›å‹ç±»å‹</h4>\n<pre><code class=\"language-cmd\">classDiagram\nclass Square~Shape~&#123;\n    int id\n    List~int~ position\n    setPoints(List~int~ points)\n    getPoints() List~int~\n&#125;\n\nSquare : -List~string~ messages\nSquare : +setMessages(List~string~ messages)\nSquare : +getMessages() List~string~\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">classDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> Square~Shape~<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    int id</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    List~int~ position</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    setPoints<span class=\"token text string\">(List~int~ points)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    getPoints<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> List~int~</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Square <span class=\"token operator\">:</span> -List~string~ messages</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Square <span class=\"token operator\">:</span> +setMessages<span class=\"token text string\">(List~string~ messages)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Square <span class=\"token operator\">:</span> +getMessages<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> List~string~</pre></td></tr></table></figure><h4 id=\"ç±»æˆ–æ¥å£ä¹‹é—´çš„å…³è”\"><a class=\"anchor\" href=\"#ç±»æˆ–æ¥å£ä¹‹é—´çš„å…³è”\">#</a> ç±»æˆ–æ¥å£ä¹‹é—´çš„å…³è”</h4>\n<table>\n<thead>\n<tr>\n<th>Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&lt;|--</td>\n<td>Inheritance</td>\n</tr>\n<tr>\n<td>*--</td>\n<td>Composition</td>\n</tr>\n<tr>\n<td>o--</td>\n<td>Aggregation</td>\n</tr>\n<tr>\n<td>--&gt;</td>\n<td>Association</td>\n</tr>\n<tr>\n<td>--</td>\n<td>Link (Solid)</td>\n</tr>\n<tr>\n<td>..&gt;</td>\n<td>Dependency</td>\n</tr>\n<tr>\n<td>..|&gt;</td>\n<td>Realization</td>\n</tr>\n<tr>\n<td>..</td>\n<td>Link (Dashed)</td>\n</tr>\n</tbody>\n</table>\n<pre><code class=\"language-cmd\">classDiagram\nclassA --|&gt; classB : Inheritance\nclassC --* classD : Composition\nclassE --o classF : Aggregation\nclassG --&gt; classH : Association\nclassI -- classJ : Link(Solid)\nclassK ..&gt; classL : Dependency\nclassM ..|&gt; classN : Realization\nclassO .. classP : Link(Dashed)\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">classDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>classA <span class=\"token arrow operator\">--|></span> classB <span class=\"token operator\">:</span> Inheritance</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>classC <span class=\"token arrow operator\">--*</span> classD <span class=\"token operator\">:</span> Composition</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>classE <span class=\"token arrow operator\">--o</span> classF <span class=\"token operator\">:</span> Aggregation</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>classG <span class=\"token arrow operator\">--></span> classH <span class=\"token operator\">:</span> Association</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>classI <span class=\"token arrow operator\">--</span> classJ <span class=\"token operator\">:</span> Link<span class=\"token text string\">(Solid)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>classK <span class=\"token arrow operator\">..></span> classL <span class=\"token operator\">:</span> Dependency</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>classM <span class=\"token arrow operator\">..|></span> classN <span class=\"token operator\">:</span> Realization</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>classO <span class=\"token arrow operator\">..</span> classP <span class=\"token operator\">:</span> Link<span class=\"token text string\">(Dashed)</span></pre></td></tr></table></figure><ul>\n<li><code>1</code>  Only 1</li>\n<li><code>0..1</code>  Zero or One</li>\n<li><code>1..*</code>  One or more</li>\n<li><code>*</code>  Many</li>\n<li where=\"\" n1=\"\"><code>n</code>  n</li>\n<li where=\"\" n1=\"\"><code>0..n</code>  zero to n</li>\n<li where=\"\" n1=\"\"><code>1..n</code>  one to n</li>\n</ul>\n<pre><code class=\"language-cmd\">classDiagram\n    Customer &quot;1&quot; --&gt; &quot;*&quot; Ticket\n    Student &quot;1&quot; --&gt; &quot;1..*&quot; Course\n    Galaxy --&gt; &quot;many&quot; Star : Contains\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">classDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    Customer <span class=\"token string\">\"1\"</span> <span class=\"token arrow operator\">--></span> <span class=\"token string\">\"*\"</span> Ticket</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    Student <span class=\"token string\">\"1\"</span> <span class=\"token arrow operator\">--></span> <span class=\"token string\">\"1..*\"</span> Course</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    Galaxy <span class=\"token arrow operator\">--></span> <span class=\"token string\">\"many\"</span> Star <span class=\"token operator\">:</span> Contains</pre></td></tr></table></figure><h4 id=\"æ ‡æ˜ç±»æˆ–æ¥å£\"><a class=\"anchor\" href=\"#æ ‡æ˜ç±»æˆ–æ¥å£\">#</a> æ ‡æ˜ç±»æˆ–æ¥å£</h4>\n<ul>\n<li><code>&lt;&lt;Interface&gt;&gt;</code>  To represent an Interface class</li>\n<li><code>&lt;&lt;abstract&gt;&gt;</code>  To represent an abstract class</li>\n<li><code>&lt;&lt;Service&gt;&gt;</code>  To represent a service class</li>\n<li><code>&lt;&lt;enumeration&gt;&gt;</code>  To represent an enum</li>\n</ul>\n<pre><code class=\"language-cmd\">classDiagram\nclass Shape&#123;\n    &lt;&lt;interface&gt;&gt;\n    noOfVertices\n    draw()\n&#125;\nclass Color&#123;\n    &lt;&lt;enumeration&gt;&gt;\n    RED\n    BLUE\n    GREEN\n    WHITE\n    BLACK\n&#125;\n</code></pre>\n<figure class=\"highlight mermaid\"><figcaption data-lang=\"mermaid\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">classDiagram</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> Shape<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation important\">&lt;&lt;interface>></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    noOfVertices</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    draw<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">class</span> Color<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation important\">&lt;&lt;enumeration>></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    RED</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    BLUE</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    GREEN</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    WHITE</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    BLACK</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "å·¥å…·",
                "å·¥å…·",
                "æµç¨‹å›¾"
            ]
        },
        {
            "id": "https://baiyezi.vip/instruments/%E7%BF%BB%E8%AF%91%E5%B0%8F%E5%B7%A5%E5%85%B7/%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E7%BF%BB%E8%AF%91%E5%B0%8F%E5%B7%A5%E5%85%B7%EF%BC%88%E4%B8%80%EF%BC%89/",
            "url": "https://baiyezi.vip/instruments/%E7%BF%BB%E8%AF%91%E5%B0%8F%E5%B7%A5%E5%85%B7/%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E7%BF%BB%E8%AF%91%E5%B0%8F%E5%B7%A5%E5%85%B7%EF%BC%88%E4%B8%80%EF%BC%89/",
            "title": "æ‰‹åŠ¨å®ç°ç¿»è¯‘å°å·¥å…·ï¼ˆä¸€ï¼‰",
            "date_published": "2021-12-24T01:30:17.000Z",
            "content_html": "<p>ç¬¬ä¸€æ¬¡æ¨æ–‡ï¼Œå°±å…ˆå†™å†™æœ€è¿‘åœ¨åšçš„ç¿»è¯‘å°å·¥å…·ã€‚é€šè¿‡è°ƒç”¨æœ‰é“äº‘ API æˆ–è€…ç™¾åº¦ç¿»è¯‘çš„ API æ¥è·å¾—ç¿»è¯‘èµ„æºã€‚</p>\n<h5 id=\"æ³¨å†Œæœ‰é“æ™ºäº‘æˆ–è€…ç™¾åº¦ç¿»è¯‘å¼€æ”¾å¹³å°\"><a class=\"anchor\" href=\"#æ³¨å†Œæœ‰é“æ™ºäº‘æˆ–è€…ç™¾åº¦ç¿»è¯‘å¼€æ”¾å¹³å°\">#</a> ğŸ¥— æ³¨å†Œæœ‰é“æ™ºäº‘æˆ–è€…ç™¾åº¦ç¿»è¯‘å¼€æ”¾å¹³å°ï¼š</h5>\n<p>æœ‰é“æ™ºäº‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9haS55b3VkYW8uY29tL3JlZ2lzdGVyLnM=\">https://ai.youdao.com/register.s</span></p>\n<p>ç™¾åº¦ç¿»è¯‘å¼€æ”¾å¹³å°ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYW55aS1hcGkuYmFpZHUuY29tLw==\">https://fanyi-api.baidu.com/</span></p>\n<p>ä»¥ä¸‹ä¾‹ç¨‹å°†ä»¥æœ‰é“æ™ºäº‘ä¸ºä¾‹å±•å¼€ã€‚</p>\n<h5 id=\"æ³¨å†ŒæˆåŠŸåé¦–å…ˆåˆ›å»ºä¸€ä¸ªå®ä¾‹\"><a class=\"anchor\" href=\"#æ³¨å†ŒæˆåŠŸåé¦–å…ˆåˆ›å»ºä¸€ä¸ªå®ä¾‹\">#</a> ğŸ¤ æ³¨å†ŒæˆåŠŸåé¦–å…ˆåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼š</h5>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20211228211726.png\" alt=\"image-20200815114216458\" /></p>\n<h5 id=\"ç´§æ¥ç€åˆ›å»ºä¸€ä¸ªåº”ç”¨æ³¨æ„æ¥å…¥æ–¹å¼é€‰æ‹©api\"><a class=\"anchor\" href=\"#ç´§æ¥ç€åˆ›å»ºä¸€ä¸ªåº”ç”¨æ³¨æ„æ¥å…¥æ–¹å¼é€‰æ‹©api\">#</a> ğŸŒ› ç´§æ¥ç€åˆ›å»ºä¸€ä¸ªåº”ç”¨ï¼Œæ³¨æ„æ¥å…¥æ–¹å¼é€‰æ‹© APIï¼š</h5>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20211228211739.png\" alt=\"image-20200815121700345\" /></p>\n<h5 id=\"åº”ç”¨åˆ›å»ºå¥½ä¹‹åéœ€è¦ç»‘å®šåˆšæ‰åˆ›å»ºçš„å®ä¾‹\"><a class=\"anchor\" href=\"#åº”ç”¨åˆ›å»ºå¥½ä¹‹åéœ€è¦ç»‘å®šåˆšæ‰åˆ›å»ºçš„å®ä¾‹\">#</a> ğŸ‘±â€â™€ åº”ç”¨åˆ›å»ºå¥½ä¹‹åéœ€è¦ç»‘å®šåˆšæ‰åˆ›å»ºçš„å®ä¾‹ï¼š</h5>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20211228211747.png\" alt=\"image-20200815122030635\" /></p>\n<p>ä¹‹åä¾¿å¯ä»¥é€šè¿‡ API æ¥è¿›è¡Œç¼–ç¨‹äº†ï¼Œæœ‰é“äº‘å®˜æ–¹æ–‡æ¡£æä¾›äº†å‡ ç§ç¼–ç¨‹è¯­è¨€çš„ demoï¼Œè¿™é‡Œå°†ä»¥å‰ç«¯è°ƒç”¨ API ä¸ºä¾‹å±•å¼€è®²è§£ã€‚</p>\n<p>å®˜æ–¹æ–‡æ¡£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9haS55b3VkYW8uY29tL0RPQ1NJUk1BL2h0bWwv\">https://ai.youdao.com/DOCSIRMA/html/</span></p>\n<h5 id=\"æ­¤æ¬¡åŠŸèƒ½ä»¥å‰ç«¯æ¡†æ¶vueä»¥åŠå‰ç«¯æ ·å¼ç»„ä»¶element-uiæ¥è¿›è¡Œå®ç°-æ•´ä½“æ•ˆæœå¦‚ä¸‹\"><a class=\"anchor\" href=\"#æ­¤æ¬¡åŠŸèƒ½ä»¥å‰ç«¯æ¡†æ¶vueä»¥åŠå‰ç«¯æ ·å¼ç»„ä»¶element-uiæ¥è¿›è¡Œå®ç°-æ•´ä½“æ•ˆæœå¦‚ä¸‹\">#</a> ğŸŒ¾ æ­¤æ¬¡åŠŸèƒ½ä»¥å‰ç«¯æ¡†æ¶ vue ä»¥åŠå‰ç«¯æ ·å¼ç»„ä»¶ element-ui æ¥è¿›è¡Œå®ç°ã€‚æ•´ä½“æ•ˆæœå¦‚ä¸‹ï¼š</h5>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20211228211754.png\" alt=\"image-20200815145557509\" /></p>\n<p>å…¶ä¸­åº”ç”¨ ID ä»¥åŠåº”ç”¨å¯†é’¥å¯ä»¥åœ¨åˆšæ‰åˆ›å»ºçš„åº”ç”¨ä¸­æ‰¾åˆ°ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20211228211800.png\" alt=\"image-20200815145900909\" /></p>\n<p>ç›®å‰æ•´ä½“åŠŸèƒ½è¿˜åœ¨è¿›ä¸€æ­¥å®Œå–„ï¼Œæœ‰æ—¶é—´å†å†™åç»­ï¼</p>\n<h6 id=\"æ•´ä½“ä»£ç å¦‚ä¸‹\"><a class=\"anchor\" href=\"#æ•´ä½“ä»£ç å¦‚ä¸‹\">#</a> ğŸ“‘ æ•´ä½“ä»£ç å¦‚ä¸‹ï¼š</h6>\n<pre><code class=\"language-vue\">&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;UTF-8&quot;&gt;\n    &lt;title&gt;Translate&lt;/title&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/element-ui@2.13.1/lib/theme-chalk/index.css&quot;&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;../resources/css/animate.css&quot;&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div id=&quot;app&quot;&gt;\n&lt;template&gt;\n    &lt;el-row style=&quot;margin-bottom: 10px&quot;&gt;\n        &lt;el-col :span=&quot;24&quot; :xs=&quot;4&quot; :sm=&quot;6&quot; :md=&quot;8&quot; :lg=&quot;9&quot; :xl=&quot;11&quot;&gt;\n            &lt;el-radio v-model=&quot;radio&quot; label=&quot;1&quot; @change=&quot;radioLabelValue&quot;&gt;æœ‰é“äº‘ç¿»è¯‘&lt;/el-radio&gt;\n            &lt;el-radio v-model=&quot;radio&quot; label=&quot;2&quot; @change=&quot;radioLabelValue&quot;&gt;ç™¾åº¦ç¿»è¯‘&lt;/el-radio&gt;\n        &lt;/el-col&gt;\n    &lt;/el-row&gt;\n    &lt;el-row :gutter=&quot;10&quot; style=&quot;margin: 15px 0&quot;&gt;\n        &lt;el-col :span=&quot;12&quot; :xs=&quot;4&quot; :sm=&quot;6&quot; :md=&quot;8&quot; :lg=&quot;9&quot; :xl=&quot;11&quot;&gt;\n            &lt;el-input\n                    placeholder=&quot;è¯·è¾“å…¥åº”ç”¨ID&quot;\n                    prefix-icon=&quot;el-icon-edit&quot;\n                    v-model=&quot;input_appKey&quot;\n                    clearable\n                    &gt;\n                &lt;template slot=&quot;prepend&quot;&gt;åº”ç”¨ID&lt;/template&gt;\n            &lt;/el-input&gt;\n        &lt;/el-col&gt;\n        &lt;el-col :span=&quot;12&quot; :xs=&quot;4&quot; :sm=&quot;6&quot; :md=&quot;8&quot; :lg=&quot;9&quot; :xl=&quot;11&quot;&gt;\n            &lt;el-input\n                    placeholder=&quot;è¯·è¾“å…¥åº”ç”¨å¯†é’¥&quot;\n                    prefix-icon=&quot;el-icon-edit&quot;\n                    v-model=&quot;input_key&quot;\n                    clearable\n                    &gt;\n                &lt;template slot=&quot;prepend&quot;&gt;åº”ç”¨å¯†é’¥&lt;/template&gt;\n            &lt;/el-input&gt;\n        &lt;/el-col&gt;\n    &lt;/el-row&gt;\n    &lt;el-row&gt;\n        &lt;el-col :span=&quot;12&quot; :xs=&quot;4&quot; :sm=&quot;6&quot; :md=&quot;8&quot; :lg=&quot;9&quot; :xl=&quot;11&quot;&gt;\n            &lt;el-tag type=&quot;success&quot; &gt;æºè¯­è¨€ï¼š&lt;/el-tag&gt;\n            &lt;el-select v-model=&quot;selectSrcValue==''?'auto':selectSrcValue&quot; clearable filterable placeholder=&quot;è¯·é€‰æ‹©&quot; @change=&quot;selectValue_src&quot;&gt;\n                &lt;el-option\n                        v-for=&quot;item in options&quot;\n                        :key=&quot;item.value&quot;\n                        :label=&quot;item.label&quot;\n                        :value=&quot;item.value&quot;&gt;\n                    &lt;span style=&quot;float: left&quot;&gt;&#123;&#123; item.label &#125;&#125;&lt;/span&gt;\n                    &lt;span style=&quot;float: right; color: #8492a6; font-size: 13px&quot;&gt;&#123;&#123; item.value &#125;&#125;&lt;/span&gt;\n                &lt;/el-option&gt;\n            &lt;/el-select&gt;\n        &lt;/el-col&gt;\n        &lt;el-col :span=&quot;12&quot; :offset=&quot;1&quot; :xs=&quot;4&quot; :sm=&quot;6&quot; :md=&quot;8&quot; :lg=&quot;9&quot; :xl=&quot;11&quot;&gt;\n            &lt;el-tag type=&quot;success&quot; &gt;ç›®æ ‡è¯­è¨€ï¼š&lt;/el-tag&gt;\n            &lt;el-select v-model=&quot;selectDistValue==''?'en':selectDistValue&quot; clearable filterable placeholder=&quot;è¯·é€‰æ‹©&quot; @change=&quot;selectValue_dist&quot;&gt;\n                &lt;el-option\n                        v-for=&quot;item in options&quot;\n                        :key=&quot;item.value&quot;\n                        :label=&quot;item.label&quot;\n                        :value=&quot;item.value&quot;&gt;\n                    &lt;span style=&quot;float: left&quot;&gt;&#123;&#123; item.label &#125;&#125;&lt;/span&gt;\n                    &lt;span style=&quot;float: right; color: #8492a6; font-size: 13px&quot;&gt;&#123;&#123; item.value &#125;&#125;&lt;/span&gt;\n                &lt;/el-option&gt;\n            &lt;/el-select&gt;\n        &lt;/el-col&gt;\n    &lt;/el-row&gt;\n    &lt;el-row &gt;\n        &lt;el-col :span=&quot;12&quot; :xs=&quot;4&quot; :sm=&quot;6&quot; :md=&quot;8&quot; :lg=&quot;9&quot; :xl=&quot;11&quot;&gt;\n            &lt;textarea class=&quot;grid-content bg-purple-light&quot; v-model=&quot;trans_source&quot; placeholder=&quot;è¯·è¾“å…¥è¦ç¿»è¯‘çš„è¯æˆ–è¯­å¥ï¼&quot;&gt;&lt;/textarea&gt;\n        &lt;/el-col&gt;\n        &lt;el-col :span=&quot;12&quot; :offset=&quot;1&quot; :xs=&quot;4&quot; :sm=&quot;6&quot; :md=&quot;8&quot; :lg=&quot;9&quot; :xl=&quot;11&quot;&gt;\n            &lt;el-row style=&quot;margin-top:50px; width: 80px&quot;&gt;\n\n                &lt;el-tooltip  v-model=&quot;translation_show&quot; manual class=&quot;item&quot; effect=&quot;dark&quot;  placement=&quot;right-end&quot;&gt;\n                    &lt;div&gt;\n                        &lt;el-tag type=&quot;info&quot; v-show=&quot;translation_show&quot; class=&quot;animated bounceInDown&quot;&gt;ç»“æœï¼š&lt;/el-tag&gt;\n                    &lt;/div&gt;\n                    &lt;div slot=&quot;content&quot; v-for=&quot;(item, index) in translation&quot; :key=&quot;index&quot;&gt;\n                        &#123;&#123;item&#125;&#125;&lt;/br&gt;\n                    &lt;/div&gt;\n                &lt;/el-tooltip&gt;\n\n            &lt;/el-row&gt;\n            &lt;el-row style=&quot;margin-top:50px; width: 80px&quot;&gt;\n                &lt;el-tooltip  v-model=&quot;basic_show&quot; manual class=&quot;item&quot; effect=&quot;dark&quot;  placement=&quot;right-end&quot;&gt;\n                    &lt;div&gt;\n                        &lt;el-tag type=&quot;warning&quot; v-show=&quot;basic_show&quot; class=&quot;animated bounceInDown&quot;&gt;åŸºç¡€è¯å…¸ï¼š&lt;/el-tag&gt;\n                    &lt;/div&gt;\n                    &lt;div slot=&quot;content&quot; v-for=&quot;(item, index) in basic&quot; :key=&quot;index&quot;&gt;\n                        &#123;&#123;item&#125;&#125;&lt;/br&gt;\n                    &lt;/div&gt;\n                &lt;/el-tooltip&gt;\n            &lt;/el-row&gt;\n            &lt;el-row style=&quot;margin-top:50px; width: 80px&quot;&gt;\n                &lt;el-tooltip v-model=&quot;web_show&quot; manual class=&quot;item&quot; effect=&quot;dark&quot;  placement=&quot;right-end&quot;&gt;\n                    &lt;div&gt;\n                        &lt;el-tag type=&quot;danger&quot; v-show=&quot;web_show&quot; class=&quot;animated bounceInDown&quot;&gt;ç½‘ç»œè§£é‡Šï¼š&lt;/el-tag&gt;\n                    &lt;/div&gt;\n                    &lt;div  slot=&quot;content&quot; v-for=&quot;(item, index) in web&quot; :key=&quot;index&quot;&gt;\n                        &#123;&#123;item.key&#125;&#125;ï¼š\n                        &lt;span v-for=&quot;(item1, index1) in item.value&quot; :key=&quot;index1&quot;&gt;\n                            &#123;&#123;item1&#125;&#125;ï¼›\n                        &lt;/span&gt;\n                        &lt;/br&gt;\n                    &lt;/div&gt;\n                &lt;/el-tooltip&gt;\n            &lt;/el-row&gt;\n            &lt;!--&lt;textarea disabled class=&quot;grid-content bg-purple-light&quot;&gt;\n                åŸºæœ¬è¯å…¸ï¼š&#123;&#123;trans_result&#125;&#125;ï¼Œ\n                ç½‘ç»œè§£é‡Šï¼šhello\n            &lt;/textarea&gt;--&gt;\n        &lt;/el-col&gt;\n    &lt;/el-row&gt;\n    &lt;el-button type=&quot;success&quot;  round v-on:click=&quot;doTranslate&quot;&gt;Go&lt;/el-button&gt;\n\n&lt;/template&gt;\n&lt;/div&gt;\n\n&lt;!--vue-resource.min.jséœ€åœ¨vueä¹‹åå¼•ç”¨--&gt;\n&lt;!--&lt;script src=&quot;../resources/js/vue.js&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;../resources/js/vue-resource.min.js&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;../resources/js/crypto-js4.0.js&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;../resources/js/element-ui@2.13.1_lib_index.js&quot;&gt;&lt;/script&gt;--&gt;\n&lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;../resources/js/vue-resource.min.js&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;https://cdn.bootcdn.net/ajax/libs/crypto-js/4.0.0/crypto-js.js&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;https://cdn.jsdelivr.net/npm/element-ui@2.13.1/lib/index.js&quot;&gt;&lt;/script&gt;\n&lt;!--\n&lt;script src=&quot;https://unpkg.com/axios/dist/axios.min.js&quot;&gt;&lt;/script&gt;\n--&gt;\n&lt;script&gt;\n    new Vue(&#123;\n        el: '#app',\n        data: function () &#123;\n            return &#123;\n                radio: '1',\n                options: [&#123;\n                    value: 'auto',\n                    label: 'è‡ªåŠ¨è¯†åˆ«'\n                &#125;, &#123;\n                    value: 'zh-CHS',\n                    label: 'ä¸­æ–‡'\n                &#125;, &#123;\n                    value: 'en',\n                    label: 'è‹±æ–‡'\n                &#125;, &#123;\n                    value: 'ja',\n                    label: 'æ—¥æ–‡'\n                &#125;, &#123;\n                    value: 'ko',\n                    label: 'éŸ©æ–‡'\n                &#125;, &#123;\n                    value: 'fr',\n                    label: 'æ³•æ–‡'\n                &#125;, &#123;\n                    value: 'es',\n                    label: 'è¥¿ç­ç‰™æ–‡'\n                &#125;, &#123;\n                    value: 'pt',\n                    label: 'è‘¡è„ç‰™æ–‡'\n                &#125;, &#123;\n                    value: 'it',\n                    label: 'æ„å¤§åˆ©æ–‡'\n                &#125;, &#123;\n                    value: 'ru',\n                    label: 'ä¿„æ–‡'\n                &#125;, &#123;\n                    value: 'vi',\n                    label: 'è¶Šå—æ–‡'\n                &#125;, &#123;\n                    value: 'de',\n                    label: 'å¾·æ–‡'\n                &#125;, &#123;\n                    value: 'ar',\n                    label: 'é˜¿æ‹‰ä¼¯æ–‡'\n                &#125;, &#123;\n                    value: 'id',\n                    label: 'å°å°¼æ–‡'\n                &#125;, &#123;\n                    value: 'af',\n                    label: 'å—éè·å…°è¯­'\n                &#125;, &#123;\n                    value: 'bs',\n                    label: 'æ³¢æ–¯å°¼äºšè¯­'\n                &#125;, &#123;\n                    value: 'bg',\n                    label: 'ä¿åŠ åˆ©äºšè¯­'\n                &#125;, &#123;\n                    value: 'yue',\n                    label: 'ç²¤è¯­'\n                &#125;, &#123;\n                    value: 'ca',\n                    label: 'åŠ æ³°éš†è¯­'\n                &#125;, &#123;\n                    value: 'hr',\n                    label: 'å…‹ç½—åœ°äºšè¯­'\n                &#125;, &#123;\n                    value: 'cs',\n                    label: 'æ·å…‹è¯­'\n                &#125;, &#123;\n                    value: 'da',\n                    label: 'ä¸¹éº¦è¯­'\n                &#125;, &#123;\n                    value: 'nl',\n                    label: 'è·å…°è¯­'\n                &#125;, &#123;\n                    value: 'et',\n                    label: 'çˆ±æ²™å°¼äºšè¯­'\n                &#125;, &#123;\n                    value: 'fj',\n                    label: 'æ–æµè¯­'\n                &#125;, &#123;\n                    value: 'fi',\n                    label: 'èŠ¬å…°è¯­'\n                &#125;, &#123;\n                    value: 'el',\n                    label: 'å¸Œè…Šè¯­'\n                &#125;, &#123;\n                    value: 'ht',\n                    label: 'æµ·åœ°å…‹é‡Œå¥¥å°”è¯­'\n                &#125;, &#123;\n                    value: 'he',\n                    label: 'å¸Œä¼¯æ¥è¯­'\n                &#125;, &#123;\n                    value: 'hi',\n                    label: 'å°åœ°è¯­'\n                &#125;, &#123;\n                    value: 'mww',\n                    label: 'ç™½è‹—è¯­'\n                &#125;, &#123;\n                    value: 'hu',\n                    label: 'åŒˆç‰™åˆ©è¯­'\n                &#125;, &#123;\n                    value: 'sw',\n                    label: 'æ–¯ç“¦å¸Œé‡Œè¯­'\n                &#125;, &#123;\n                    value: 'tlh',\n                    label: 'å…‹æ—è´¡è¯­'\n                &#125;, &#123;\n                    value: 'lv',\n                    label: 'æ‹‰è„±ç»´äºšè¯­'\n                &#125;, &#123;\n                    value: 'lt',\n                    label: 'ç«‹é™¶å®›è¯­'\n                &#125;, &#123;\n                    value: 'ms',\n                    label: 'é©¬æ¥è¯­'\n                &#125;, &#123;\n                    value: 'mt',\n                    label: 'é©¬è€³ä»–è¯­'\n                &#125;, &#123;\n                    value: 'no',\n                    label: 'æŒªå¨è¯­'\n                &#125;, &#123;\n                    value: 'fa',\n                    label: 'æ³¢æ–¯è¯­'\n                &#125;, &#123;\n                    value: 'pl',\n                    label: 'æ³¢å…°è¯­'\n                &#125;, &#123;\n                    value: 'otq',\n                    label: 'å…‹é›·å¡”ç½—å¥¥æ‰˜ç±³è¯­'\n                &#125;, &#123;\n                    value: 'ro',\n                    label: 'ç½—é©¬å°¼äºšè¯­'\n                &#125;, &#123;\n                    value: 'sr-Cyrl',\n                    label: 'å¡å°”ç»´äºšè¯­(è¥¿é‡Œå°”æ–‡)'\n                &#125;, &#123;\n                    value: 'sr-Latn',\n                    label: 'å¡å°”ç»´äºšè¯­(æ‹‰ä¸æ–‡)'\n                &#125;, &#123;\n                    value: 'sk',\n                    label: 'æ–¯æ´›ä¼å…‹è¯­'\n                &#125;, &#123;\n                    value: 'sl',\n                    label: 'æ–¯æ´›æ–‡å°¼äºšè¯­'\n                &#125;, &#123;\n                    value: 'sv',\n                    label: 'ç‘å…¸è¯­'\n                &#125;, &#123;\n                    value: 'ty',\n                    label: 'å¡”å¸Œæè¯­'\n                &#125;, &#123;\n                    value: 'th',\n                    label: 'æ³°è¯­'\n                &#125;, &#123;\n                    value: 'to',\n                    label: 'æ±¤åŠ è¯­'\n                &#125;, &#123;\n                    value: 'tr',\n                    label: 'åœŸè€³å…¶è¯­'\n                &#125;, &#123;\n                    value: 'uk',\n                    label: 'ä¹Œå…‹å…°è¯­'\n                &#125;, &#123;\n                    value: 'ur',\n                    label: 'ä¹Œå°”éƒ½è¯­'\n                &#125;, &#123;\n                    value: 'cy',\n                    label: 'å¨å°”å£«è¯­'\n                &#125;, &#123;\n                    value: 'yua',\n                    label: 'å°¤å¡å¦ç›é›…è¯­'\n                &#125;, &#123;\n                    value: 'sq',\n                    label: 'é˜¿å°”å·´å°¼äºšè¯­'\n                &#125;, &#123;\n                    value: 'am',\n                    label: 'é˜¿å§†å“ˆæ‹‰è¯­'\n                &#125;, &#123;\n                    value: 'hy',\n                    label: 'äºšç¾å°¼äºšè¯­'\n                &#125;, &#123;\n                    value: 'az',\n                    label: 'é˜¿å¡æ‹œç–†è¯­'\n                &#125;, &#123;\n                    value: 'bn',\n                    label: 'å­ŸåŠ æ‹‰è¯­'\n                &#125;, &#123;\n                    value: 'eu',\n                    label: 'å·´æ–¯å…‹è¯­'\n                &#125;, &#123;\n                    value: 'be',\n                    label: 'ç™½ä¿„ç½—æ–¯è¯­'\n                &#125;, &#123;\n                    value: 'ceb',\n                    label: 'å®¿åŠ¡è¯­'\n                &#125;, &#123;\n                    value: 'co',\n                    label: 'ç§‘è¥¿å˜‰è¯­'\n                &#125;, &#123;\n                    value: 'eo',\n                    label: 'ä¸–ç•Œè¯­'\n                &#125;, &#123;\n                    value: 'tl',\n                    label: 'è²å¾‹å®¾è¯­'\n                &#125;, &#123;\n                    value: 'fy',\n                    label: 'å¼—é‡Œè¥¿è¯­'\n                &#125;, &#123;\n                    value: 'gl',\n                    label: 'åŠ åˆ©è¥¿äºšè¯­'\n                &#125;, &#123;\n                    value: 'ka',\n                    label: 'æ ¼é²å‰äºšè¯­'\n                &#125;, &#123;\n                    value: 'gu',\n                    label: 'å¤å‰æ‹‰ç‰¹è¯­'\n                &#125;, &#123;\n                    value: 'ha',\n                    label: 'è±ªè¨è¯­'\n                &#125;, &#123;\n                    value: 'haw',\n                    label: 'å¤å¨å¤·è¯­'\n                &#125;, &#123;\n                    value: 'is',\n                    label: 'å†°å²›è¯­'\n                &#125;, &#123;\n                    value: 'ig',\n                    label: 'ä¼Šåšè¯­'\n                &#125;, &#123;\n                    value: 'ga',\n                    label: 'çˆ±å°”å…°è¯­'\n                &#125;, &#123;\n                    value: 'jw',\n                    label: 'çˆªå“‡è¯­'\n                &#125;, &#123;\n                    value: 'kn',\n                    label: 'å¡çº³è¾¾è¯­'\n                &#125;, &#123;\n                    value: 'kk',\n                    label: 'å“ˆè¨å…‹è¯­'\n                &#125;, &#123;\n                    value: 'km',\n                    label: 'é«˜æ£‰è¯­'\n                &#125;, &#123;\n                    value: 'ku',\n                    label: 'åº“å°”å¾·è¯­'\n                &#125;, &#123;\n                    value: 'ky',\n                    label: 'æŸ¯å°”å…‹å­œè¯­'\n                &#125;, &#123;\n                    value: 'lo',\n                    label: 'è€æŒè¯­'\n                &#125;, &#123;\n                    value: 'la',\n                    label: 'æ‹‰ä¸è¯­'\n                &#125;, &#123;\n                    value: 'lb',\n                    label: 'å¢æ£®å ¡è¯­'\n                &#125;, &#123;\n                    value: 'mk',\n                    label: 'é©¬å…¶é¡¿è¯­'\n                &#125;, &#123;\n                    value: 'mg',\n                    label: 'é©¬å°”åŠ ä»€è¯­'\n                &#125;, &#123;\n                    value: 'ml',\n                    label: 'é©¬æ‹‰é›…æ‹‰å§†è¯­'\n                &#125;, &#123;\n                    value: 'mi',\n                    label: 'æ¯›åˆ©è¯­'\n                &#125;, &#123;\n                    value: 'mr',\n                    label: 'é©¬æ‹‰åœ°è¯­'\n                &#125;, &#123;\n                    value: 'mn',\n                    label: 'è’™å¤è¯­'\n                &#125;, &#123;\n                    value: 'my',\n                    label: 'ç¼…ç”¸è¯­'\n                &#125;, &#123;\n                    value: 'ne',\n                    label: 'å°¼æ³Šå°”è¯­'\n                &#125;, &#123;\n                    value: 'ny',\n                    label: 'é½åˆ‡ç“¦è¯­'\n                &#125;, &#123;\n                    value: 'ps',\n                    label: 'æ™®ä»€å›¾è¯­'\n                &#125;, &#123;\n                    value: 'pa',\n                    label: 'æ—é®æ™®è¯­'\n                &#125;, &#123;\n                    value: 'sm',\n                    label: 'è¨æ‘©äºšè¯­'\n                &#125;, &#123;\n                    value: 'gd',\n                    label: 'è‹æ ¼å…°ç›–å°”è¯­'\n                &#125;, &#123;\n                    value: 'st',\n                    label: 'å¡ç´¢æ‰˜è¯­'\n                &#125;, &#123;\n                    value: 'sn',\n                    label: 'ä¿®çº³è¯­'\n                &#125;, &#123;\n                    value: 'sd',\n                    label: 'ä¿¡å¾·è¯­'\n                &#125;, &#123;\n                    value: 'si',\n                    label: 'åƒ§ä¼½ç½—è¯­'\n                &#125;, &#123;\n                    value: 'so',\n                    label: 'ç´¢é©¬é‡Œè¯­'\n                &#125;, &#123;\n                    value: 'su',\n                    label: 'å·½ä»–è¯­'\n                &#125;, &#123;\n                    value: 'tg',\n                    label: 'å¡”å‰å…‹è¯­'\n                &#125;, &#123;\n                    value: 'ta',\n                    label: 'æ³°ç±³å°”è¯­'\n                &#125;, &#123;\n                    value: 'te',\n                    label: 'æ³°å¢å›ºè¯­'\n                &#125;, &#123;\n                    value: 'uz',\n                    label: 'ä¹Œå…¹åˆ«å…‹è¯­'\n                &#125;, &#123;\n                    value: 'xh',\n                    label: 'å—éç§‘è¨è¯­'\n                &#125;, &#123;\n                    value: 'yi',\n                    label: 'æ„ç¬¬ç»ªè¯­'\n                &#125;, &#123;\n                    value: 'yo',\n                    label: 'çº¦é²å·´è¯­'\n                &#125;, &#123;\n                    value: 'zu',\n                    label: 'å—éç¥–é²è¯­'\n                &#125;],\n                selectSrcValue: '',\n                selectDistValue: '',\n                input_appKey: '23059209eaca30b4',\n                input_key: 'S3eW0xliXFpnviLkhhnBym9TFYVDNzVz',\n                trans_source: '',\n                translation: [],\n                translation_show: false,\n                basic: [],\n                basic_show: false,\n                web: [],\n                web_show: false\n            &#125;\n        &#125;,\n        methods: &#123;\n            //å•é€‰æŒ‰é’®äº‹ä»¶ï¼Œå¾—åˆ°ä¸‹æ ‡å€¼\n            radioLabelValue(value)&#123;\n            &#125;,\n            //ä¸‹æ‹‰æ¡†äº‹ä»¶ï¼Œå¾—åˆ°keyå€¼\n            selectValue_src(value)&#123;\n                this.selectSrcValue = value;\n                console.log(this.selectSrcValue);\n            &#125;,\n            selectValue_dist(value)&#123;\n                this.selectDistValue = value;\n                console.log(this.selectDistValue);\n            &#125;,\n            //è¾“å…¥æ¡†äº‹ä»¶\n            appKeyInputValue(value)&#123;\n                this.input_appKey = value;\n            &#125;,\n            keyInputValue(value)&#123;\n                this.input_key = value;\n            &#125;,\n            truncate(q)&#123;\n                let len = q.length;\n                if(len&lt;=20) return q;\n                return q.substring(0, 10) + len + q.substring(len-10, len);\n            &#125;,\n            doTranslate()&#123;\n                console.log(this.input_appKey);\n                let salt = (new Date).getTime();\n                let currtime = Math.round(new Date().getTime()/1000);\n                // å¤šä¸ªqueryå¯ä»¥ç”¨\\nè¿æ¥  å¦‚ query='apple\\norange\\nbanana\\npear'\n                let str1 = this.input_appKey + this.truncate(this.trans_source) + salt + currtime + this.input_key;\n                let sign = CryptoJS.SHA256(str1).toString(CryptoJS.enc.Hex);\n                this.$http.jsonp('http://openapi.youdao.com/api',&#123;\n                    params:&#123;\n                        q: this.trans_source,\n                        appKey: this.input_appKey,\n                        salt: salt,\n                        from: this.selectSrcValue,\n                        to: this.selectDistValue,\n                        sign: sign,\n                        signType: &quot;v3&quot;,\n                        curtime: currtime,\n                    &#125;\n                &#125;).then(function(res)&#123;\n                    console.log(res);\n                    console.log(res.body.translation);\n                    console.log(res.body.basic);\n                    if(res.body.translation != null &amp;&amp; res.body.translation.length &gt; 0)&#123;\n                        this.translation = res.body.translation;\n                        this.translation_show = true;\n                    &#125;else&#123;\n                        this.translation = [];\n                        this.translation_show = false;\n                    &#125;\n                    if(res.body.basic != null &amp;&amp; res.body.basic.explains.length &gt; 0)&#123;\n                        this.basic = res.body.basic.explains;\n                        this.basic_show = true;\n                    &#125;else&#123;\n                        this.basic = [];\n                        this.basic_show = false;\n                    &#125;\n                    if(res.body.web != null &amp;&amp; res.body.web.length &gt; 0)&#123;\n                        this.web = res.body.web;\n                        this.web_show = true;\n                    &#125;else&#123;\n                        this.web = [];\n                        this.web_show = false;\n                    &#125;\n                &#125;)\n                //axiosæœ¬èº«ä¸æ”¯æŒè·¨åŸŸè¯·æ±‚,éœ€è¦é…ç½®æ–‡ä»¶è¾…åŠ©\n                /*axios(&#123;\n                    url: 'http://openapi.youdao.com/api',\n                    method: 'post',\n                    data: &#123;\n                        q: this.trans_source,\n                        appKey: this.input_appKey,\n                        salt: salt,\n                        from: this.selectSrcValue,\n                        to: this.selectDistValue,\n                        sign: sign,\n                        signType: &quot;v3&quot;,\n                        curtime: currtime\n                    &#125;\n                &#125;).then(function(res)&#123;\n                    console.log(res);\n                &#125;)*/\n            &#125;\n        &#125;\n    &#125;);\n&lt;/script&gt;\n&lt;style&gt;\n\n    .bg-purple-light &#123;\n        background: #303133;\n    &#125;\n    .grid-content &#123;\n        color: white;\n        font-family: &quot;Arial Narrow&quot;;\n        margin-top: 5px;\n        border-radius: 10px;\n        min-height: 300px;\n        min-width: 478.13px;\n    &#125;\n&lt;/style&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>ğŸ‘Šæˆ‘æ˜¯ä¸€åªå°ç™½çŒ¿ï¼Œä¸‹æœŸè§ï¼</p>\n",
            "tags": [
                "å·¥å…·",
                "å‰ç«¯",
                "å·¥å…·",
                "ç¿»è¯‘",
                "Vue"
            ]
        },
        {
            "id": "https://baiyezi.vip/instruments/%E4%B8%B2%E5%8F%A3/Java%E5%92%8C%E4%B8%B2%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1/",
            "url": "https://baiyezi.vip/instruments/%E4%B8%B2%E5%8F%A3/Java%E5%92%8C%E4%B8%B2%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1/",
            "title": "Javaå’Œä¸²å£è¿›è¡Œé€šä¿¡",
            "date_published": "2021-12-24T01:30:17.000Z",
            "content_html": "<h2 id=\"èƒŒæ™¯\"><a class=\"anchor\" href=\"#èƒŒæ™¯\">#</a> èƒŒæ™¯</h2>\n<p>ä½¿ç”¨ Java è¿›è¡Œä¸²å£é€šä¿¡ï¼Œå‰ç½®çŸ¥è¯†ç‚¹ï¼šRXTX çš„ APIã€SpringBootã€Thymeleafã€ElementUIã€WebSocketã€‚</p>\n<p>å®ç°çš„åŠŸèƒ½ï¼šå¯ä»¥å¯¹æŒ‡å®šä¸²å£è¿›è¡Œæ•°æ®çš„æ”¶å‘</p>\n<p>RXTX å®˜ç½‘ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3J4dHgucWJhbmcub3JnL3dpa2kvaW5kZXgucGhwL01haW5fUGFnZQ==\">http://rxtx.qbang.org/wiki/index.php/Main_Page</span></p>\n<p>å¼€å‘ä¾èµ–å®˜ç½‘æä¾›çš„ dll åº“å»è·Ÿä¸²å£ äº¤äº’ï¼Œä½†æ˜¯ä»å®˜ç½‘ç›´æ¥ä¸‹è½½çš„ dll æ˜¯ 32 ä½çš„ï¼Œä»¥ä¸‹æä¾› 32 ä½å’Œ 64 ä½çš„ä¸‹è½½åœ°å€</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2ZpenplZC5jb20vb3NzL3J4dHgtZm9yLWphdmE=\">http://fizzed.com/oss/rxtx-for-java</span></p>\n<p>æˆ–è€…ç½‘ç›˜åœ°å€ï¼š</p>\n<p>é“¾æ¥ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMTlKUTRGdXBvTlEzYms2LWdicDIzLXc=\">https://pan.baidu.com/s/19JQ4FupoNQ3bk6-gbp23-w</span><br />\n æå–ç ï¼šbruc</p>\n<p>ä¸‹è½½å®Œæˆåå°†ä¸¤ä¸ª dll åº“æ”¾åœ¨ jdk/jre/bin ç›®å½•ä¸‹ï¼Œè‡³äº RXTXcomm.jar å¯ä»¥æ”¾åœ¨ jdk/jre/lib/ext ç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ maven å¼•å…¥</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.bidib.jbidib.org.qbang.rxtx<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>rxtxcomm<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210717153502.png\" alt=\"image-20210717153500559\" /></p>\n<h2 id=\"æ•´ä½“æ•ˆæœ\"><a class=\"anchor\" href=\"#æ•´ä½“æ•ˆæœ\">#</a> æ•´ä½“æ•ˆæœ</h2>\n<p>é¡¹ç›®è®¿é—®åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgwL3NlcmlhbC8=\">http://localhost:8080/serial/</span></p>\n<p>æ‰“å¼€ä¸²å£ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210717153900.png\" alt=\"image-20210717153858961\" /></p>\n<p>ç»™ä¸²å£å‘é€ä¿¡æ¯ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210717153947.png\" alt=\"image-20210717153945679\" /></p>\n<p>åå°æ—¥å¿—ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210717154016.png\" alt=\"image-20210717154015449\" /></p>\n<p>ä¸²å£å·¥å…·æ¥æ”¶åˆ°ä¸²å£æ•°æ®ï¼šï¼ˆå¯ä»¥äº‹å…ˆä½¿ç”¨è™šæ‹Ÿä¸²å£é©±åŠ¨å·¥å…·ç”Ÿæˆè™šæ‹Ÿä¸²å£æ¥æ¨¡æ‹Ÿã€‚å·²ç»ä¸Šä¼ åˆ°æ–‡ç« å¼€å¤´çš„ç½‘ç›˜ã€‚ï¼‰</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210717154512.png\" alt=\"image-20210717154510444\" /></p>\n<p>è™šæ‹Ÿä¸²å£ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210717154656.png\" alt=\"image-20210717154654667\" /></p>\n<p>å…³é—­ä¸²å£ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210717154922.png\" alt=\"image-20210717154921032\" /></p>\n<h2 id=\"å®ç°æ€è·¯\"><a class=\"anchor\" href=\"#å®ç°æ€è·¯\">#</a> å®ç°æ€è·¯</h2>\n<ol>\n<li>è·å–å¯ç”¨çš„ä¸²å£</li>\n<li>æ‰“å¼€ä¸²å£</li>\n<li>å¯¹ä¸²å£è¿›è¡Œè¯»å†™</li>\n<li>å°†ä¸²å£è¯»å–åˆ°çš„å†…å®¹ä½¿ç”¨ WebSocket å®æ–½æ¨é€ç»™å‰ç«¯</li>\n</ol>\n<p>RXTX å®˜ç½‘æä¾›äº†ä¸€ç³»åˆ—çš„ APIï¼Œä½¿ç”¨é¢‘ç‡è¾ƒé«˜çš„æœ‰ CommPortã€SerialPortã€SerialPortEvent</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210717152924.png\" alt=\"image-20210717152819650\" /></p>\n<h3 id=\"è·å–æ­£åœ¨ä½¿ç”¨çš„ä¸²å£\"><a class=\"anchor\" href=\"#è·å–æ­£åœ¨ä½¿ç”¨çš„ä¸²å£\">#</a> è·å–æ­£åœ¨ä½¿ç”¨çš„ä¸²å£</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * æŸ¥æ‰¾å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ‰€æœ‰ä¸²å£</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/listPorts\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">ModelMap</span> <span class=\"token function\">listPorts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">ModelMap</span> modelMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ModelMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">CommPortIdentifier</span> commPortIdentifier<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Enumeration</span> ports <span class=\"token operator\">=</span> <span class=\"token class-name\">CommPortIdentifier</span><span class=\"token punctuation\">.</span><span class=\"token function\">getPortIdentifiers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> portList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>ports<span class=\"token punctuation\">.</span><span class=\"token function\">hasMoreElements</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            commPortIdentifier <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CommPortIdentifier</span><span class=\"token punctuation\">)</span> ports<span class=\"token punctuation\">.</span><span class=\"token function\">nextElement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>commPortIdentifier<span class=\"token punctuation\">.</span><span class=\"token function\">getPortType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">CommPortIdentifier</span><span class=\"token punctuation\">.</span>PORT_SERIAL<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                portList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>commPortIdentifier<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å½“å‰æ­£åœ¨ä½¿ç”¨çš„ä¸²å£æœ‰ï¼š&#123;&#125;\"</span><span class=\"token punctuation\">,</span> commPortIdentifier<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        modelMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data\"</span><span class=\"token punctuation\">,</span> portList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">return</span> modelMap<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"æ‰“å¼€ä¸²å£\"><a class=\"anchor\" href=\"#æ‰“å¼€ä¸²å£\">#</a> æ‰“å¼€ä¸²å£</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * æ‰“å¼€æŒ‡å®šç«¯å£</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * @param serialDO ä¸²å£å‚æ•°å¯¹è±¡</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * @return ä¸²å£çš„å¯¹è±¡</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/openPort\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Result</span> <span class=\"token function\">openPort</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SerialDO</span> serialDO<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">Result</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸²å£å‚æ•°ï¼š&#123;&#125;\"</span><span class=\"token punctuation\">,</span> serialDO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">SerialPort</span> serialPort <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token comment\">// è·å–æŒ‡å®šç«¯å£å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token class-name\">CommPortIdentifier</span> portIdentifier <span class=\"token operator\">=</span> <span class=\"token class-name\">CommPortIdentifier</span><span class=\"token punctuation\">.</span><span class=\"token function\">getPortIdentifier</span><span class=\"token punctuation\">(</span>serialDO<span class=\"token punctuation\">.</span><span class=\"token function\">getPortName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// æ‰“å¼€æŒ‡å®šç«¯å£ï¼ŒåŒæ—¶æŒ‡å®šè¶…æ—¶æ—¶é—´</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token class-name\">CommPort</span> commPort <span class=\"token operator\">=</span> portIdentifier<span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span>serialDO<span class=\"token punctuation\">.</span><span class=\"token function\">getPortName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// åˆ¤æ–­ç«¯å£æ˜¯å¦æ˜¯ä¸²å£</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>commPort <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">SerialPort</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰“å¼€ä¸²å£:&#123;&#125;\"</span><span class=\"token punctuation\">,</span> serialDO<span class=\"token punctuation\">.</span><span class=\"token function\">getPortName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                serialPort <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SerialPort</span><span class=\"token punctuation\">)</span> commPort<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                serialMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>serialDO<span class=\"token punctuation\">.</span><span class=\"token function\">getPortName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> serialPort<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                globalPortName <span class=\"token operator\">=</span> serialDO<span class=\"token punctuation\">.</span><span class=\"token function\">getPortName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token comment\">// æ·»åŠ ä¸²å£ç›‘å¬äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                serialPort<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SerialPortListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token comment\">// è®¾ç½®ä¸²å£å‚æ•°</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                serialPort<span class=\"token punctuation\">.</span><span class=\"token function\">setSerialPortParams</span><span class=\"token punctuation\">(</span>serialDO<span class=\"token punctuation\">.</span><span class=\"token function\">getBaudrate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> serialDO<span class=\"token punctuation\">.</span><span class=\"token function\">getDataBits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> serialDO<span class=\"token punctuation\">.</span><span class=\"token function\">getStopBits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> serialDO<span class=\"token punctuation\">.</span><span class=\"token function\">getParity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token comment\">// å½“æœ‰æ•°æ®åˆ°è¾¾æ—¶å”¤é†’æ•°æ®æ¥æ”¶çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                serialPort<span class=\"token punctuation\">.</span><span class=\"token function\">notifyOnDataAvailable</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token comment\">// å½“ä¸²å£è¿æ¥ä¸­æ–­æ—¶å”¤é†’ä¸­æ–­çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                serialPort<span class=\"token punctuation\">.</span><span class=\"token function\">notifyOnBreakInterrupt</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                serialPort<span class=\"token punctuation\">.</span><span class=\"token function\">notifyOnCarrierDetect</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                serialPort<span class=\"token punctuation\">.</span><span class=\"token function\">notifyOnDSR</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>SUCCESS<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆåŠŸæ‰“å¼€ä¸²å£\"</span> <span class=\"token operator\">+</span> serialDO<span class=\"token punctuation\">.</span><span class=\"token function\">getPortName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                result<span class=\"token punctuation\">.</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>serialPort<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>FAIL<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœªæ‰¾åˆ°æŒ‡å®šä¸²å£ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NoSuchPortException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">NoSuchPortException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>FAIL<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœªæ‰¾åˆ°æŒ‡å®šä¸²å£ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœªæ‰¾åˆ°æŒ‡å®šä¸²å£ï¼\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">PortInUseException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>FAIL<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸²å£è¢«å ç”¨ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸²å£è¢«å ç”¨ï¼\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UnsupportedCommOperationException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>FAIL<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰“å¼€ä¸²å£å‡ºé”™ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰“å¼€ä¸²å£å‡ºé”™ï¼\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">TooManyListenersException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>FAIL<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸²å£ç›‘å¬å®ä¾‹è¿‡å¤šï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸²å£ç›‘å¬å®ä¾‹è¿‡å¤šï¼\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"ç»™ä¸²å£å‘é€æ¶ˆæ¯\"><a class=\"anchor\" href=\"#ç»™ä¸²å£å‘é€æ¶ˆæ¯\">#</a> ç»™ä¸²å£å‘é€æ¶ˆæ¯</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * å‘é€æ¶ˆæ¯ç»™æŒ‡å®šä¸²å£</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * @param portName ä¸²å£å</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * @param msg      æ¥æ”¶å‰ç«¯æ¶ˆæ¯</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/sendMsgToPort\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Result</span> <span class=\"token function\">sendMsgToPort</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> portName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Result</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">SerialPort</span> serialPort <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SerialPort</span><span class=\"token punctuation\">)</span> serialMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>portName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">OutputStream</span> outputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            outputStream <span class=\"token operator\">=</span> serialPort<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            outputStream<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StandardCharsets</span><span class=\"token punctuation\">.</span>UTF_8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            outputStream<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>SUCCESS<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å‘é€æˆåŠŸï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘é€æ¶ˆæ¯ç»™ä¸²å£&#123;&#125;:&#123;&#125;\"</span><span class=\"token punctuation\">,</span> portName<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘é€æ¶ˆæ¯å¼‚å¸¸ï¼\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘é€æ¶ˆæ¯å¼‚å¸¸ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>FAIL<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                outputStream<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘é€æ¶ˆæ¯å…³é—­æµå¼‚å¸¸ï¼\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"ä»ä¸²å£è¯»å–æ•°æ®\"><a class=\"anchor\" href=\"#ä»ä¸²å£è¯»å–æ•°æ®\">#</a> ä»ä¸²å£è¯»å–æ•°æ®</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * ä»æŒ‡å®šä¸²å£è¯»å–æ•°æ®</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * @param portName ä¸²å£å</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/readMsgFromPort\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Result</span> <span class=\"token function\">readMsgFromPort</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> portName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">Result</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">SerialPort</span> serialPort <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SerialPort</span><span class=\"token punctuation\">)</span> serialMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>portName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">InputStream</span> inputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> msgBytes <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            inputStream <span class=\"token operator\">=</span> serialPort<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">int</span> msgLength <span class=\"token operator\">=</span> inputStream<span class=\"token punctuation\">.</span><span class=\"token function\">available</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>inputStream<span class=\"token punctuation\">.</span><span class=\"token function\">available</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                msgBytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span>msgLength<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                inputStream<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>msgBytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                msgLength <span class=\"token operator\">=</span> inputStream<span class=\"token punctuation\">.</span><span class=\"token function\">available</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token operator\">!=</span> msgBytes<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä»ä¸²å£&#123;&#125;æ¥æ”¶åˆ°æ•°æ®:&#123;&#125;\"</span><span class=\"token punctuation\">,</span> portName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>msgBytes<span class=\"token punctuation\">,</span> <span class=\"token string\">\"GBK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>SUCCESS<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆåŠŸæ¥å—åˆ°æ•°æ®ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                result<span class=\"token punctuation\">.</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>msgBytes<span class=\"token punctuation\">,</span> <span class=\"token string\">\"GBK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>FAIL<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯»å–æ•°æ®å¼‚å¸¸ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯»å–æ•°æ®å¼‚å¸¸ï¼&#123;&#125;\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                inputStream<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>FAIL<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯»å–æ•°æ®æ—¶è¾“å…¥æµå…³é—­å¤±è´¥ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯»å–æ•°æ®æ—¶è¾“å…¥æµå…³é—­å¤±è´¥ï¼&#123;&#125;\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>SUCCESS<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯æ¥æ”¶ä¸­...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"å…³é—­ä¸²å£\"><a class=\"anchor\" href=\"#å…³é—­ä¸²å£\">#</a> å…³é—­ä¸²å£</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * å…³é—­ä¸²å£</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * @param portName</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/closePort\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@ResponseBody</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Result</span> <span class=\"token function\">closePort</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> portName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">Result</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">SerialPort</span> serialPort <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SerialPort</span><span class=\"token punctuation\">)</span> serialMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>portName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token operator\">!=</span> serialPort<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            serialPort<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸²å£&#123;&#125;å·²å…³é—­ï¼\"</span><span class=\"token punctuation\">,</span> portName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>SUCCESS<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸²å£\"</span> <span class=\"token operator\">+</span> portName <span class=\"token operator\">+</span> <span class=\"token string\">\"å·²å…³é—­ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸²å£é”™è¯¯ï¼Œæœªæ‰¾åˆ°æŒ‡å®šä¸²å£&#123;&#125;\"</span><span class=\"token punctuation\">,</span> portName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StateCodeEnum</span><span class=\"token punctuation\">.</span>FAIL<span class=\"token punctuation\">.</span><span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            result<span class=\"token punctuation\">.</span><span class=\"token function\">setMsg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœªæ‰¾åˆ°æŒ‡å®šä¸²å£\"</span><span class=\"token operator\">+</span>portName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"ä¸²å£äº‹ä»¶\"><a class=\"anchor\" href=\"#ä¸²å£äº‹ä»¶\">#</a> ä¸²å£äº‹ä»¶</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>listener</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Result</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>controller<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SerialController</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>websocket<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CustomerWebSocketServer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">gnu<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">gnu<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SerialPortEventListener</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>java_websocket<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebSocket</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>java_websocket<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebSocketServer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Logger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Component</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Collection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"20\"></td><td><pre> * ä¸²å£äº‹ä»¶ç›‘å¬</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"22\"></td><td><pre> * @Description:</pre></td></tr><tr><td data-num=\"23\"></td><td><pre> * @Author: Fan</pre></td></tr><tr><td data-num=\"24\"></td><td><pre> * @Date: 2021/7/11 20:27</pre></td></tr><tr><td data-num=\"25\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"26\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SerialPortListener</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SerialPortEventListener</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Logger</span> LOGGER <span class=\"token operator\">=</span> <span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SerialPortListener</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token class-name\">Result</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Result</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">SerialPortListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token class-name\">WebSocketServer</span> webSocketServer<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">serialEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SerialPortEvent</span> serialPortEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>serialPortEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getEventType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token comment\">// ç›‘å¬ä¸²å£ï¼Œå½“æ¥æ”¶åˆ°æ•°æ®æ—¶è§¦å‘</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">.</span>DATA_AVAILABLE<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                result <span class=\"token operator\">=</span> <span class=\"token class-name\">SerialController</span><span class=\"token punctuation\">.</span><span class=\"token function\">readMsgFromPort</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SerialController</span><span class=\"token punctuation\">.</span>globalPortName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token comment\">// TODO æ¨é€ç»™å‰ç«¯</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                webSocketServer<span class=\"token punctuation\">.</span><span class=\"token function\">broadcast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> result<span class=\"token punctuation\">.</span><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">.</span>OUTPUT_BUFFER_EMPTY<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å‘é€æ¶ˆæ¯ç¼“å†²åŒºä¸ºç©ºï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">.</span>CTS<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¾…å‘é€æ•°æ®å·²æ¸…é™¤ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">.</span>DSR<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¾…å‘é€æ•°æ®å·²å°±ç»ªï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">.</span>RI<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æŒ¯é“ƒæŒ‡ç¤ºï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">.</span>CD<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è½½æ³¢æ£€æµ‹ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">.</span>OE<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä½æº¢å‡ºï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">.</span>PE<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¥‡å¶æ ¡éªŒé”™è¯¯ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">.</span>FE<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¸§é”™è¯¯ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token class-name\">SerialPortEvent</span><span class=\"token punctuation\">.</span>BI<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"é€šè®¯ä¸­æ–­!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            <span class=\"token keyword\">default</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"websocketæœåŠ¡ç«¯åˆ›å»º\"><a class=\"anchor\" href=\"#websocketæœåŠ¡ç«¯åˆ›å»º\">#</a> WebSocket æœåŠ¡ç«¯åˆ›å»º</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>websocket</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>java_websocket<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebSocket</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>java_websocket<span class=\"token punctuation\">.</span>handshake<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ClientHandshake</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>java_websocket<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebSocketServer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Logger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Component</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * websocket æœåŠ¡å™¨</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @Description:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @Author: Fan</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> * @Date: 2021/7/13 0:46</pre></td></tr><tr><td data-num=\"20\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomerWebSocketServer</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSocketServer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Logger</span> LOGGER <span class=\"token operator\">=</span> <span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CustomerWebSocketServer</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">WebSocket</span> webSocket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CustomerWebSocketServer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InetSocketAddress</span> address<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onOpen</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocket</span> conn<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ClientHandshake</span> handshake<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// ç‚¹å¯¹ç‚¹å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        conn<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Welcome to the server!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setWebSocket</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token comment\">// å¹¿æ’­æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token function\">broadcast</span><span class=\"token punctuation\">(</span> <span class=\"token string\">\"new connection: \"</span> <span class=\"token operator\">+</span> handshake<span class=\"token punctuation\">.</span><span class=\"token function\">getResourceDescriptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¸å®¢æˆ·ç«¯&#123;&#125;å»ºç«‹äº†è¿æ¥\"</span><span class=\"token punctuation\">,</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onClose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocket</span> conn<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> code<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> reason<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> remote<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å®¢æˆ·ç«¯&#123;&#125;æ–­å¼€è¿æ¥ï¼Œé”™è¯¯ç =&#123;&#125;ï¼ŒåŸå› ï¼š&#123;&#125;\"</span><span class=\"token punctuation\">,</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">,</span> reason<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocket</span> conn<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä»å®¢æˆ·ç«¯&#123;&#125;æ¥æ”¶åˆ°æ¶ˆæ¯&#123;&#125;\"</span><span class=\"token punctuation\">,</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onMessage</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">WebSocket</span> conn<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ByteBuffer</span> message <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä»å®¢æˆ·ç«¯&#123;&#125;æ¥æ”¶åˆ°æ¶ˆæ¯&#123;&#125;\"</span><span class=\"token punctuation\">,</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocket</span> conn<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socketè¿æ¥é”™è¯¯ï¼š&#123;&#125;\"</span><span class=\"token punctuation\">,</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ex<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        LOGGER<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆåŠŸå¼€å¯socketæœåŠ¡ç«¯ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">WebSocket</span> <span class=\"token function\">getWebSocket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token keyword\">return</span> webSocket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setWebSocket</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocket</span> webSocket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>webSocket <span class=\"token operator\">=</span> webSocket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>     * æµ‹è¯•</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>     * @param args</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token class-name\">String</span> host <span class=\"token operator\">=</span> <span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>        <span class=\"token keyword\">int</span> port <span class=\"token operator\">=</span> <span class=\"token number\">8887</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token class-name\">WebSocketServer</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomerWebSocketServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        server<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®ä¾‹åŒ– WebSocket æœåŠ¡ç«¯å®ä¾‹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>websocket</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>websocket<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CustomerWebSocketServer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>java_websocket<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebSocketServer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configurable</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Component</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * åˆå§‹åŒ– websocket æœåŠ¡å™¨</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @Description:</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * @Author: Fan</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @Date: 2021/7/12 0:14</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebSocketConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">WebSocketServer</span> <span class=\"token function\">webSocketServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">String</span> host <span class=\"token operator\">=</span> <span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">int</span> port <span class=\"token operator\">=</span> <span class=\"token number\">8887</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">WebSocketServer</span> webSocketServer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomerWebSocketServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        webSocketServer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">return</span> webSocketServer<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"å‰ç«¯å®ç°\"><a class=\"anchor\" href=\"#å‰ç«¯å®ç°\">#</a> å‰ç«¯å®ç°</h3>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>th</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.thymeleaf.org<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">th:</span>block</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>include</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>include :: header(<span class=\"token punctuation\">'</span>Love And Peace Serial Tool<span class=\"token punctuation\">'</span>)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>all<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-row</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-tooltip</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">manual</span> <span class=\"token attr-name\">v-model</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serial_show<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">effect</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dark<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placement</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>right<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:hide-after</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>5000<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-button</span> <span class=\"token attr-name\">icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el-icon-search<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>success<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">plain</span> <span class=\"token attr-name\"><span class=\"token namespace\">v-on:</span>click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>selectSerials<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>æŸ¥è¯¢<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>content<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>(item, index) in serials<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>index<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                    <span class=\"token comment\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-tooltip</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">v-if</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serial_show?false:true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el-icon-info<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>æŸ¥è¯¢ç³»ç»Ÿå½“å‰æ­£åœ¨ä½¿ç”¨çš„ä¸²å£ï¼<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-row</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-row</span> <span class=\"token attr-name\">:gutter</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-col</span> <span class=\"token attr-name\">:span</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el-icon-info<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>è¯·è¾“å…¥è¦æ‰“å¼€æˆ–è€…å…³é—­çš„ä¸²å£ï¼<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-input</span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>åªéœ€è¾“å…¥æ•°å­—å³å¯ï¼Œå¦‚1ã€2ã€3...<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                          <span class=\"token attr-name\">v-model</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serial_port<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                          <span class=\"token attr-name\">clearable</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>COM<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-input</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el-icon-info<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>è¯·è¾“å…¥æ³¢ç‰¹ç‡ï¼<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-input</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                        <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>å¦‚115200ã€9600<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                        <span class=\"token attr-name\">v-model</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serial_baudrate<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                        <span class=\"token attr-name\">clearable</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-input</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el-icon-info<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>è¯·é€‰æ‹©æ•°æ®ä½ï¼<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-select</span> <span class=\"token attr-name\">v-model</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serial_databits<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">clearable</span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>è¯·é€‰æ‹©æ•°æ®ä½<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-option</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                            <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item in serial_databits_select<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                            <span class=\"token attr-name\">:key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.value<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                            <span class=\"token attr-name\">:label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.label<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                            <span class=\"token attr-name\">:value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.value<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-option</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el-icon-info<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>è¯·é€‰æ‹©åœæ­¢ä½ï¼<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-select</span> <span class=\"token attr-name\">v-model</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serial_stopbits<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">clearable</span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>è¯·é€‰æ‹©åœæ­¢ä½<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-option</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                            <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item in serial_stopbits_select<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                            <span class=\"token attr-name\">:key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.value<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                            <span class=\"token attr-name\">:label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.label<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                            <span class=\"token attr-name\">:value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.value<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-option</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el-icon-info<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>è¯·é€‰æ‹©æ ¡éªŒä½ï¼<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-select</span> <span class=\"token attr-name\">v-model</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serial_parity<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">clearable</span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>è¯·é€‰æ‹©æ ¡éªŒä½<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-option</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                            <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item in serial_parity_select<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                            <span class=\"token attr-name\">:key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.value<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                            <span class=\"token attr-name\">:label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.label<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                            <span class=\"token attr-name\">:value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.value<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-option</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-select</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>openButton<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">v-show</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>!serial_state<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-button</span> <span class=\"token attr-name\">icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el-icon-circle-check<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>primary<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">plain</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                               <span class=\"token attr-name\">@click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>openOrCloseSerial<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>æ‰“å¼€ä¸²å£<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">v-show</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serial_state<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-button</span> <span class=\"token attr-name\">icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el-icon-circle-close<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>warning<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">plain</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                               <span class=\"token attr-name\">@click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>openOrCloseSerial<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>å…³é—­ä¸²å£<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-col</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-col</span> <span class=\"token attr-name\">:span</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>textarea</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>grid-content bg-purple-light<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">v-model</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serial_send_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                          <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>è¯·è¾“å…¥è¦å‘é€çš„å†…å®¹<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>textarea</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>primary<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">round</span> <span class=\"token attr-name\">@click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serialSend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el-icon-check<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>å‘é€<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-col</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-col</span> <span class=\"token attr-name\">:span</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>textarea</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>grid-content bg-purple-light<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">v-model</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>serial_receive_content<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                          <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>æ¥æ”¶åˆ°çš„å†…å®¹ä¸º<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>textarea</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-col</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-row</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">th:</span>block</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>include</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>include :: footer<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>    <span class=\"token keyword\">var</span> prefix <span class=\"token operator\">=</span> ctx <span class=\"token operator\">+</span> <span class=\"token string\">\"serial\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>        el<span class=\"token operator\">:</span> <span class=\"token string\">'#app'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>        <span class=\"token function-variable function\">data</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                serials<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                serial_show<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>                serial_state<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                serial_port<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>                serial_baudrate<span class=\"token operator\">:</span> <span class=\"token string\">'9600'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>                serial_databits<span class=\"token operator\">:</span> <span class=\"token string\">'8'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>                serial_stopbits<span class=\"token operator\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>                serial_parity<span class=\"token operator\">:</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>                serial_send_content<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>                serial_receive_content<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>                serial_databits_select<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'8'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'8bit'</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'7'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'7bit'</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'6'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'6bit'</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'5'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'5bit'</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                serial_stopbits_select<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'1bit'</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'1.5'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'1.5bit'</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'2bit'</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>                serial_parity_select<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'ä¸æ ¡éªŒ'</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'å¥‡æ ¡éªŒ'</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'å¶æ ¡éªŒ'</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'æ ¡éªŒä½å§‹ç»ˆä¸º1'</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>                    value<span class=\"token operator\">:</span> <span class=\"token string\">'4'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>                    label<span class=\"token operator\">:</span> <span class=\"token string\">'æ ¡éªŒä½å§‹ç»ˆä¸º0'</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>        methods<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>            <span class=\"token comment\">/* æŸ¥è¯¢å½“å‰ç³»ç»Ÿæ­£åœ¨ä½¿ç”¨çš„ä¸²å£ */</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>            <span class=\"token function\">selectSerials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>                <span class=\"token keyword\">var</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>                $<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>                    url<span class=\"token operator\">:</span> prefix <span class=\"token operator\">+</span> <span class=\"token string\">\"/listPorts\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>                    type<span class=\"token operator\">:</span> <span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>                    dataType<span class=\"token operator\">:</span> <span class=\"token string\">\"json\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>                    contentType<span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>                    async<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>                    <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>                        res <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre>                        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serials<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>                    <span class=\"token comment\">/*complete: function (xmlhttp) &#123;</pre></td></tr><tr><td data-num=\"163\"></td><td><pre>                        if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)</pre></td></tr><tr><td data-num=\"164\"></td><td><pre>                        &#123;</pre></td></tr><tr><td data-num=\"165\"></td><td><pre>                            console.log(xmlhttp.responseText);</pre></td></tr><tr><td data-num=\"166\"></td><td><pre>                        &#125;</pre></td></tr><tr><td data-num=\"167\"></td><td><pre>                    &#125;*/</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serials <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_show <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>                <span class=\"token comment\">/*var xmlhttp = xmlhttp=new XMLHttpRequest();</pre></td></tr><tr><td data-num=\"172\"></td><td><pre>                xmlhttp.open(\"GET\",prefix + \"/listPorts\",false);</pre></td></tr><tr><td data-num=\"173\"></td><td><pre>                xmlhttp.send();</pre></td></tr><tr><td data-num=\"174\"></td><td><pre>                this.serials = JSON.parse(xmlhttp.responseText).data;</pre></td></tr><tr><td data-num=\"175\"></td><td><pre>                this.serial_show = true;</pre></td></tr><tr><td data-num=\"176\"></td><td><pre>                console.log(xmlhttp.responseText);</pre></td></tr><tr><td data-num=\"177\"></td><td><pre>                console.log(this.serials );*/</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre></pre></td></tr><tr><td data-num=\"180\"></td><td><pre>            <span class=\"token comment\">/* æ‰“å¼€æˆ–å…³é—­ä¸²å£ */</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre>            <span class=\"token function\">openOrCloseSerial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre>                <span class=\"token keyword\">const</span> h <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$createElement<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_port <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$notify<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>                        title<span class=\"token operator\">:</span> <span class=\"token string\">'é”™è¯¯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>                        message<span class=\"token operator\">:</span> <span class=\"token string\">'ç«¯å£å·ä¸èƒ½ä¸ºç©ºï¼'</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_baudrate <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$notify<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>                        title<span class=\"token operator\">:</span> <span class=\"token string\">'é”™è¯¯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>                        message<span class=\"token operator\">:</span> <span class=\"token string\">'è¯·é€‰æ‹©æ³¢ç‰¹ç‡ï¼'</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_databits <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$notify<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"199\"></td><td><pre>                        title<span class=\"token operator\">:</span> <span class=\"token string\">'é”™è¯¯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre>                        message<span class=\"token operator\">:</span> <span class=\"token string\">'è¯·é€‰æ‹©æ•°ä½ï¼'</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre>                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_stopbits <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$notify<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre>                        title<span class=\"token operator\">:</span> <span class=\"token string\">'é”™è¯¯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre>                        message<span class=\"token operator\">:</span> <span class=\"token string\">'è¯·é€‰æ‹©åœæ­¢ä½ï¼'</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre>                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_parity <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$notify<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"213\"></td><td><pre>                        title<span class=\"token operator\">:</span> <span class=\"token string\">'é”™è¯¯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"214\"></td><td><pre>                        message<span class=\"token operator\">:</span> <span class=\"token string\">'è¯·é€‰æ‹©æ ¡éªŒä½ï¼'</span></pre></td></tr><tr><td data-num=\"215\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"216\"></td><td><pre>                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre>                <span class=\"token keyword\">var</span> url<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"219\"></td><td><pre>                <span class=\"token keyword\">var</span> send_data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_state<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"221\"></td><td><pre>                    url <span class=\"token operator\">=</span> prefix <span class=\"token operator\">+</span> <span class=\"token string\">'/openPort'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre>                    send_data <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre>                        <span class=\"token string\">\"portName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">'COM'</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_port<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"224\"></td><td><pre>                        <span class=\"token string\">\"baudrate\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_baudrate<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre>                        <span class=\"token string\">\"dataBits\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_databits<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre>                        <span class=\"token string\">\"stopBits\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_stopbits<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"227\"></td><td><pre>                        <span class=\"token string\">\"parity\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_parity</pre></td></tr><tr><td data-num=\"228\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"229\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre>                    url <span class=\"token operator\">=</span> prefix <span class=\"token operator\">+</span> <span class=\"token string\">'/closePort'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"231\"></td><td><pre>                    send_data <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"232\"></td><td><pre>                        <span class=\"token string\">\"portName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">'COM'</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_port</pre></td></tr><tr><td data-num=\"233\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"234\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"235\"></td><td><pre>                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>send_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"236\"></td><td><pre>                <span class=\"token keyword\">let</span> that <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"237\"></td><td><pre>                $<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre>                    url<span class=\"token operator\">:</span> url<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"239\"></td><td><pre>                    type<span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"240\"></td><td><pre>                    dataType<span class=\"token operator\">:</span> <span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"241\"></td><td><pre>                    data<span class=\"token operator\">:</span> send_data<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"242\"></td><td><pre>                    async<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre>                    <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre>                        that<span class=\"token punctuation\">.</span><span class=\"token function\">startSocket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"245\"></td><td><pre>                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"246\"></td><td><pre>                            that<span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"247\"></td><td><pre>                                title<span class=\"token operator\">:</span> <span class=\"token string\">'æ¸©é¦¨æç¤ºï¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"248\"></td><td><pre>                                message<span class=\"token operator\">:</span> <span class=\"token function\">h</span><span class=\"token punctuation\">(</span><span class=\"token string\">'i'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>style<span class=\"token operator\">:</span> <span class=\"token string\">'color: teal'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span>msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"249\"></td><td><pre>                            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"250\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"251\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"252\"></td><td><pre>                    <span class=\"token function-variable function\">error</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"253\"></td><td><pre>                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"254\"></td><td><pre>                            that<span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"255\"></td><td><pre>                                title<span class=\"token operator\">:</span> <span class=\"token string\">'æ¸©é¦¨æç¤ºï¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"256\"></td><td><pre>                                message<span class=\"token operator\">:</span> <span class=\"token function\">h</span><span class=\"token punctuation\">(</span><span class=\"token string\">'i'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>style<span class=\"token operator\">:</span> <span class=\"token string\">'color: teal'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"257\"></td><td><pre>                            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"258\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"259\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"260\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"261\"></td><td><pre>                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_state <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_state<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"262\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"263\"></td><td><pre></pre></td></tr><tr><td data-num=\"264\"></td><td><pre>            <span class=\"token comment\">/* ç»™ä¸²å£å‘é€æ¶ˆæ¯ */</span></pre></td></tr><tr><td data-num=\"265\"></td><td><pre>            <span class=\"token function\">serialSend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"266\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>portName <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"267\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$notify<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"268\"></td><td><pre>                        title<span class=\"token operator\">:</span> <span class=\"token string\">'é”™è¯¯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"269\"></td><td><pre>                        message<span class=\"token operator\">:</span> <span class=\"token string\">'ç«¯å£å·ä¸èƒ½ä¸ºç©ºï¼'</span></pre></td></tr><tr><td data-num=\"270\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"271\"></td><td><pre>                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"272\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"273\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_send_content <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"274\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$notify<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"275\"></td><td><pre>                        title<span class=\"token operator\">:</span> <span class=\"token string\">'é”™è¯¯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"276\"></td><td><pre>                        message<span class=\"token operator\">:</span> <span class=\"token string\">'å‘é€å†…å®¹ä¸èƒ½ä¸ºç©ºï¼'</span></pre></td></tr><tr><td data-num=\"277\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"278\"></td><td><pre>                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"279\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"280\"></td><td><pre>                <span class=\"token keyword\">let</span> that <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"281\"></td><td><pre>                $<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"282\"></td><td><pre>                    url<span class=\"token operator\">:</span> prefix <span class=\"token operator\">+</span> <span class=\"token string\">'/sendMsgToPort'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"283\"></td><td><pre>                    type<span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"284\"></td><td><pre>                    dataType<span class=\"token operator\">:</span> <span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"285\"></td><td><pre>                    async<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"286\"></td><td><pre>                    data<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"287\"></td><td><pre>                        <span class=\"token string\">\"portName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">'COM'</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_port<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"288\"></td><td><pre>                        <span class=\"token string\">\"msg\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_send_content</pre></td></tr><tr><td data-num=\"289\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"290\"></td><td><pre>                    <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"291\"></td><td><pre>                        that<span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"292\"></td><td><pre>                            title<span class=\"token operator\">:</span> <span class=\"token string\">'æ¸©é¦¨æç¤ºï¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"293\"></td><td><pre>                            message<span class=\"token operator\">:</span> result<span class=\"token punctuation\">.</span>msg<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"294\"></td><td><pre>                            type<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span></pre></td></tr><tr><td data-num=\"295\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"296\"></td><td><pre>                        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"297\"></td><td><pre>                        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_receive_content <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"298\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"299\"></td><td><pre>                    <span class=\"token function-variable function\">error</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"300\"></td><td><pre>                        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"301\"></td><td><pre>                        that<span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"302\"></td><td><pre>                            title<span class=\"token operator\">:</span> <span class=\"token string\">'æ¸©é¦¨æç¤ºï¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"303\"></td><td><pre>                            message<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>msg<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"304\"></td><td><pre>                            type<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span></pre></td></tr><tr><td data-num=\"305\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"306\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"307\"></td><td><pre>                    <span class=\"token comment\">/*complete() &#123;</pre></td></tr><tr><td data-num=\"308\"></td><td><pre>                        that.serialReceive();</pre></td></tr><tr><td data-num=\"309\"></td><td><pre>                    &#125;*/</span></pre></td></tr><tr><td data-num=\"310\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"311\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"312\"></td><td><pre></pre></td></tr><tr><td data-num=\"313\"></td><td><pre>            <span class=\"token comment\">/* ä»ä¸²å£æ¥æ”¶æ¶ˆæ¯ */</span></pre></td></tr><tr><td data-num=\"314\"></td><td><pre>            <span class=\"token function\">serialReceive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"315\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>portName <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"316\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$notify<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"317\"></td><td><pre>                        title<span class=\"token operator\">:</span> <span class=\"token string\">'é”™è¯¯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"318\"></td><td><pre>                        message<span class=\"token operator\">:</span> <span class=\"token string\">'ç«¯å£å·ä¸èƒ½ä¸ºç©ºï¼'</span></pre></td></tr><tr><td data-num=\"319\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"320\"></td><td><pre>                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"321\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"322\"></td><td><pre>                <span class=\"token keyword\">let</span> that <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"323\"></td><td><pre>                $<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"324\"></td><td><pre>                    url<span class=\"token operator\">:</span> prefix <span class=\"token operator\">+</span> <span class=\"token string\">'/readMsgFromPort'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"325\"></td><td><pre>                    type<span class=\"token operator\">:</span> <span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"326\"></td><td><pre>                    dataType<span class=\"token operator\">:</span> <span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"327\"></td><td><pre>                    async<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"328\"></td><td><pre>                    data<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"329\"></td><td><pre>                        <span class=\"token string\">\"portName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">'COM'</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_port</pre></td></tr><tr><td data-num=\"330\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"331\"></td><td><pre>                    <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"332\"></td><td><pre>                        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"333\"></td><td><pre>                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>data <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"334\"></td><td><pre>                            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serial_receive_content <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"335\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"336\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"337\"></td><td><pre>                    <span class=\"token function-variable function\">error</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"338\"></td><td><pre>                        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"339\"></td><td><pre>                        that<span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"340\"></td><td><pre>                            title<span class=\"token operator\">:</span> <span class=\"token string\">'æ¸©é¦¨æç¤ºï¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"341\"></td><td><pre>                            message<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>msg<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"342\"></td><td><pre>                            type<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span></pre></td></tr><tr><td data-num=\"343\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"344\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"345\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"346\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"347\"></td><td><pre></pre></td></tr><tr><td data-num=\"348\"></td><td><pre>            <span class=\"token comment\">/* å»ºç«‹ socket è¿æ¥ */</span></pre></td></tr><tr><td data-num=\"349\"></td><td><pre>            <span class=\"token function\">startSocket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"350\"></td><td><pre>                <span class=\"token keyword\">let</span> that <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"351\"></td><td><pre>                <span class=\"token keyword\">var</span> socket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"352\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> <span class=\"token punctuation\">(</span>WebSocket<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"353\"></td><td><pre>                    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ WebSocket\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"354\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"355\"></td><td><pre>                    socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ws://localhost:8887\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"356\"></td><td><pre>                    socket<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onopen</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"357\"></td><td><pre>                        that<span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"358\"></td><td><pre>                            title<span class=\"token operator\">:</span> <span class=\"token string\">'æ¸©é¦¨æç¤ºï¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"359\"></td><td><pre>                            message<span class=\"token operator\">:</span> <span class=\"token string\">\"socketå·²è¿æ¥ï¼\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"360\"></td><td><pre>                            type<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span></pre></td></tr><tr><td data-num=\"361\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"362\"></td><td><pre>                        socket<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ \"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"-\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"363\"></td><td><pre>                        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"364\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"365\"></td><td><pre>                    socket<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"366\"></td><td><pre>                        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¥æ”¶åˆ°æœåŠ¡ç«¯æ¶ˆæ¯ï¼š\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"367\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"368\"></td><td><pre>                    socket<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclose</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"369\"></td><td><pre>                        that<span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"370\"></td><td><pre>                            title<span class=\"token operator\">:</span> <span class=\"token string\">'æ¸©é¦¨æç¤ºï¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"371\"></td><td><pre>                            message<span class=\"token operator\">:</span> <span class=\"token string\">\"socketè¿æ¥å·²æ–­å¼€ï¼\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"372\"></td><td><pre>                            type<span class=\"token operator\">:</span> <span class=\"token string\">'warning'</span></pre></td></tr><tr><td data-num=\"373\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"374\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"375\"></td><td><pre>                    socket<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"376\"></td><td><pre>                        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socketé”™è¯¯ï¼š\"</span> <span class=\"token operator\">+</span> event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"377\"></td><td><pre>                        that<span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"378\"></td><td><pre>                            title<span class=\"token operator\">:</span> <span class=\"token string\">'è­¦å‘Šï¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"379\"></td><td><pre>                            message<span class=\"token operator\">:</span> <span class=\"token string\">\"socketå·²æ–­å¼€ï¼Œè¯·åˆ·æ–°é¡µé¢ï¼\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"380\"></td><td><pre>                            type<span class=\"token operator\">:</span> <span class=\"token string\">'warning'</span></pre></td></tr><tr><td data-num=\"381\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"382\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"383\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"384\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"385\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"386\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"387\"></td><td><pre></pre></td></tr><tr><td data-num=\"388\"></td><td><pre></pre></td></tr><tr><td data-num=\"389\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"390\"></td><td><pre></pre></td></tr><tr><td data-num=\"391\"></td><td><pre><span class=\"token comment\">&lt;!-- è¿æ¥ socket æœåŠ¡å™¨ --></span></pre></td></tr><tr><td data-num=\"392\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"393\"></td><td><pre></pre></td></tr><tr><td data-num=\"394\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"395\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"396\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\"></pre></td></tr><tr><td data-num=\"397\"></td><td><pre>    <span class=\"token selector\">.all</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"398\"></td><td><pre>        <span class=\"token property\">margin-top</span><span class=\"token punctuation\">:</span> 50px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"399\"></td><td><pre>        <span class=\"token property\">margin-left</span><span class=\"token punctuation\">:</span> 50px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"400\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"401\"></td><td><pre></pre></td></tr><tr><td data-num=\"402\"></td><td><pre>    <span class=\"token selector\">.row</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"403\"></td><td><pre>        <span class=\"token property\">margin-bottom</span><span class=\"token punctuation\">:</span> 60px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"404\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"405\"></td><td><pre></pre></td></tr><tr><td data-num=\"406\"></td><td><pre>    <span class=\"token selector\">.font</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"407\"></td><td><pre>        <span class=\"token property\">margin-top</span><span class=\"token punctuation\">:</span> 4px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"408\"></td><td><pre>        <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> 2px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"409\"></td><td><pre>        <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> #C0C4CC<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"410\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"411\"></td><td><pre></pre></td></tr><tr><td data-num=\"412\"></td><td><pre>    <span class=\"token selector\">.bg-purple-light</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"413\"></td><td><pre>        <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> #303133<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"414\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"415\"></td><td><pre></pre></td></tr><tr><td data-num=\"416\"></td><td><pre>    <span class=\"token selector\">.grid-content</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"417\"></td><td><pre>        <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> white<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"418\"></td><td><pre>        <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Arial Narrow\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"419\"></td><td><pre>        <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> 20px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"420\"></td><td><pre>        <span class=\"token property\">margin-top</span><span class=\"token punctuation\">:</span> 10px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"421\"></td><td><pre>        <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 10px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"422\"></td><td><pre>        <span class=\"token property\">min-height</span><span class=\"token punctuation\">:</span> 200px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"423\"></td><td><pre>        <span class=\"token property\">min-width</span><span class=\"token punctuation\">:</span> 378.13px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"424\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"425\"></td><td><pre></pre></td></tr><tr><td data-num=\"426\"></td><td><pre>    <span class=\"token selector\">.openButton</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"427\"></td><td><pre>        <span class=\"token property\">margin-top</span><span class=\"token punctuation\">:</span> 20px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"428\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"429\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"430\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"ä»£ç åœ°å€\"><a class=\"anchor\" href=\"#ä»£ç åœ°å€\">#</a> ä»£ç åœ°å€</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vYmZhbmZhbmZhbi9zZXJpYWwtZ28=\">https://gitee.com/bfanfanfan/serial-go</span></p>\n<p>ä¸ªäººåšå®¢ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iZmFuZmFuZmFuLmdpdGVlLmlvL2ZhbmZhbmZhbg==\">ä¹¦é™¢åå››å…ˆç”Ÿ</span></p>\n<p>å¾®ä¿¡å…¬ä¼—å·ï¼šä¸€åªå°ç™½çŒ¿</p>\n<p>å¾®ä¿¡è¡¨æƒ…ï¼šæ–‡å­—æœ‰å£°</p>\n<p>å”±å§ï¼šbf19960618</p>\n<h2 id=\"é—ç•™çš„é—®é¢˜\"><a class=\"anchor\" href=\"#é—ç•™çš„é—®é¢˜\">#</a> é—ç•™çš„é—®é¢˜</h2>\n<p>åœ¨æµ‹è¯•æ—¶å‘ç°ï¼Œä¸²å£ç›‘å¬äº‹ä»¶ç±»ä¸­æ³¨å…¥çš„ WebSocketServer å®ä¾‹ä½ç©ºï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥å®ä¾‹å¹¶æ²¡æœ‰åˆå§‹åŒ–æˆåŠŸï¼Œå¯¼è‡´æ— æ³•è°ƒç”¨è¯¥å®ä¾‹çš„å‘é€æ–¹æ³•å‘å‰ç«¯å»å®æ–½æ¨é€æ¥æ”¶åˆ°çš„ä¸²å£æ¶ˆæ¯ã€‚è¯¥é—®é¢˜ç›®å‰ä»æ— æ³•è§£å†³ï¼Œå¦‚æœæœ‰è§£å†³æ–¹æ³•çš„åŒå­¦ï¼Œè®°å¾—ç•™è¨€ï¼</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210717163115.png\" alt=\"image-20210717163113839\" /></p>\n<h2 id=\"å‚è€ƒ\"><a class=\"anchor\" href=\"#å‚è€ƒ\">#</a> å‚è€ƒ</h2>\n<pre><code>ã€1ã€‘https://blog.csdn.net/wu_boy/article/details/112062071\nã€2ã€‘https://blog.csdn.net/qq_32523587/article/details/73605751?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_baidulandingword-1&amp;spm=1001.2101.3001.4242\n</code></pre>\n",
            "tags": [
                "å·¥å…·",
                "Java",
                "å‰ç«¯",
                "å·¥å…·",
                "Vue",
                "Java",
                "WebSocket"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/Nginx/nginx%E5%AE%9E%E6%88%98/",
            "url": "https://baiyezi.vip/java/Nginx/nginx%E5%AE%9E%E6%88%98/",
            "title": "nginxå®æˆ˜",
            "date_published": "2021-09-15T12:12:01.000Z",
            "content_html": "<h2 id=\"nginxè¡ç”Ÿç‰ˆæœ¬\"><a class=\"anchor\" href=\"#nginxè¡ç”Ÿç‰ˆæœ¬\">#</a> Nginx è¡ç”Ÿç‰ˆæœ¬</h2>\n<p>Nginx plus å•†ä¸šç‰ˆ <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmdpbnguY29tLw==\">https://www.nginx.com/</span></p>\n<p>Nginx å¼€æºç‰ˆ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9uZ2lueC5vcmcv\">https://nginx.org/</span></p>\n<p>OpenResty</p>\n<p>Tengine</p>\n<h3 id=\"å…¶ä»–webæœåŠ¡å™¨\"><a class=\"anchor\" href=\"#å…¶ä»–webæœåŠ¡å™¨\">#</a> å…¶ä»– web æœåŠ¡å™¨</h3>\n<p>IISã€Apache Httpd1/2ã€lighttpd</p>\n<h2 id=\"å®‰è£…\"><a class=\"anchor\" href=\"#å®‰è£…\">#</a> å®‰è£…</h2>\n<p>ä¸‹è½½ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9uZ2lueC5vcmcvZW4vZG93bmxvYWQuaHRtbA==\">https://nginx.org/en/download.html</span></p>\n<pre><code class=\"language-sh\">tar -zxvf nginx-1.21.1.tar.gz \n\n[root@localhost nginx-1.21.1]# ./configure --prefix=/usr/local/nginx\n./configure: error: the HTTP rewrite module requires the PCRE library.\nYou can either disable the module by using --without-http_rewrite_module\noption, or install the PCRE library into the system, or build the PCRE library\nstatically from the source with nginx by using --with-pcre=&lt;path&gt; option.\n\n# å®‰è£…ç¼ºå¤±çš„ç±»åº“\n[root@localhost nginx-1.21.1]# yum install -y pcre pcre-devel\n#å†æ¬¡å®‰è£…\n[root@localhost nginx-1.21.1]# ./configure --prefix=/usr/local/nginx\n./configure: error: the HTTP gzip module requires the zlib library.\nYou can either disable the module by using --without-http_gzip_module\noption, or install the zlib library into the system, or build the zlib library\nstatically from the source with nginx by using --with-zlib=&lt;path&gt; option.\n\n#æš—è½¬ä»¥ä¸Šç¼ºå¤±çš„ç±»åº“ã€\n[root@localhost nginx-1.21.1]# yum install -y zlib zlib-devel\n\n#å†æ¬¡å®‰è£…\n[root@localhost nginx-1.21.1]# ./configure --prefix=/usr/local/nginx\nConfiguration summary\n  + using system PCRE library\n  + OpenSSL library is not used\n  + using system zlib library\n\n  nginx path prefix: &quot;/usr/local/nginx&quot;\n  nginx binary file: &quot;/usr/local/nginx/sbin/nginx&quot;\n  nginx modules path: &quot;/usr/local/nginx/modules&quot;\n  nginx configuration prefix: &quot;/usr/local/nginx/conf&quot;\n  nginx configuration file: &quot;/usr/local/nginx/conf/nginx.conf&quot;\n  nginx pid file: &quot;/usr/local/nginx/logs/nginx.pid&quot;\n  nginx error log file: &quot;/usr/local/nginx/logs/error.log&quot;\n  nginx http access log file: &quot;/usr/local/nginx/logs/access.log&quot;\n  nginx http client request body temporary files: &quot;client_body_temp&quot;\n  nginx http proxy temporary files: &quot;proxy_temp&quot;\n  nginx http fastcgi temporary files: &quot;fastcgi_temp&quot;\n  nginx http uwsgi temporary files: &quot;uwsgi_temp&quot;\n  nginx http scgi temporary files: &quot;scgi_temp&quot;\n\n#ç¼–è¯‘\n[root@localhost nginx-1.21.1]# make\n[root@localhost nginx-1.21.1]# make install\n\n#å¯åŠ¨nginx\n[root@localhost nginx-1.21.1]# cd /usr/local/nginx/\n[root@localhost nginx]# ls\nconf  html  logs  sbin\n[root@localhost nginx]# cd sbin/\n[root@localhost sbin]# ls\nnginx\n[root@localhost sbin]# ./nginx \n\n\n</code></pre>\n<p>éœ€è¦å…³é—­é˜²ç«å¢™æˆ–è€…å¼€å¯æŒ‡å®šç«¯å£ï¼Œä¹‹åè®¿é—®æµè§ˆå™¨æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</p>\n<pre><code class=\"language-sh\">#å…³é—­é˜²ç«å¢™\nsystemctl stop firewalld.service\n#ç¦æ­¢é˜²ç«å¢™å¼€æœºå¯åŠ¨\nsystemctl disabled firewalld.service\n#å°†æŒ‡å®šç«¯å£åŠ å…¥é˜²ç«å¢™\nfirewall-cmd --zone=public --add-port=80/tcp --permanent \n#é‡å¯é˜²ç«å¢™\nfirewall-cmd --reload\n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210726214357.png\" alt=\"image-20210726214355029\" /></p>\n<h3 id=\"å°†nginxå®‰è£…ä¸ºç³»ç»ŸæœåŠ¡\"><a class=\"anchor\" href=\"#å°†nginxå®‰è£…ä¸ºç³»ç»ŸæœåŠ¡\">#</a> å°† nginx å®‰è£…ä¸ºç³»ç»ŸæœåŠ¡</h3>\n<pre><code class=\"language-sh\">[root@localhost ~]# vim /usr/lib/systemd/system/nginx.service\n[Unit]\nDescription=nginx - web server\nAfter=network.target remote-fs.target nss-lookup.target\n\n[Service]\nType=forking\nPIDFile=/usr/local/nginx/logs/nginx.pid\nExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf\nExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\nExecReload=/usr/local/nginx/sbin/nginx -s reload\nExecStop=/usr/local/nginx/sbin/nginx -s stop\nExecQuit=/usr/local/nginx/sbin/nginx -s quit\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n\n#é‡æ–°åŠ è½½ç³»ç»Ÿ æœåŠ¡\n[root@localhost ~]# systemctl daemon-reload\n\n#åœæ­¢nginxæœåŠ¡\n[root@localhost ~]# ps -ef | grep nginx\nroot      35548      1  0 05:42 ?        00:00:00 nginx: master process ./nginx\nnobody    35549  35548  0 05:42 ?        00:00:00 nginx: worker process\nroot      35844   2300  0 06:12 pts/0    00:00:00 grep --color=auto nginx\n[root@localhost ~]# /usr/local/nginx/sbin/nginx -s stop\n[root@localhost ~]# ps -ef | grep nginx\nroot      35863   2300  0 06:13 pts/0    00:00:00 grep --color=auto nginx\n #ä½¿ç”¨å‘½ä»¤å¯åŠ¨\n [root@localhost ~]# systemctl  start nginx.service \n[root@localhost ~]# ps -ef | grep nginx\nroot      35907      1  0 06:14 ?        00:00:00 nginx: master process /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\nnobody    35908  35907  0 06:14 ?        00:00:00 nginx: worker process\nroot      35910   2300  0 06:14 pts/0    00:00:00 grep --color=auto nginx\n\n[root@localhost ~]# systemctl  status nginx.service \nâ— nginx.service - nginx - web server\n   Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)\n   Active: active (running) since Tue 2021-07-27 06:14:51 CST; 1min 7s ago\n  Process: 35905 ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf (code=exited, status=0/SUCCESS)\n  Process: 35904 ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf (code=exited, status=0/SUCCESS)\n Main PID: 35907 (nginx)\n    Tasks: 2 (limit: 23858)\n   Memory: 1.7M\n   CGroup: /system.slice/nginx.service\n           â”œâ”€35907 nginx: master process /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\n           â””â”€35908 nginx: worker process\n\n7æœˆ 27 06:14:51 localhost.localdomain systemd[1]: /usr/lib/systemd/system/nginx.service:12: Unknown lvalue 'ExecQuit' in section 'Service'\n7æœˆ 27 06:14:51 localhost.localdomain systemd[1]: Starting nginx - web server...\n7æœˆ 27 06:14:51 localhost.localdomain nginx[35904]: nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok\n7æœˆ 27 06:14:51 localhost.localdomain nginx[35904]: nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful\n7æœˆ 27 06:14:51 localhost.localdomain systemd[1]: nginx.service: Failed to parse PID from file /usr/local/nginx/logs/nginx.pid: Invalid argument\n7æœˆ 27 06:14:51 localhost.localdomain systemd[1]: Started nginx - web server.\n\n#å¼€æœºè‡ªåŠ¨å¯åŠ¨nginx\n[root@localhost ~]# systemctl enable nginx.service \nCreated symlink /etc/systemd/system/multi-user.target.wants/nginx.service â†’ /usr/lib/systemd/system/nginx.service.\n\n</code></pre>\n<h2 id=\"åŸŸåè§£æ\"><a class=\"anchor\" href=\"#åŸŸåè§£æ\">#</a> åŸŸåè§£æ</h2>\n<p>åŸŸå -&gt; ä¸»æœºçš„ hosts æ–‡ä»¶ï¼Œå¦‚æœæœ‰åŸŸååŒ¹é…åˆ° ipï¼Œåˆ™ç›´æ¥è¿”å› ipï¼Œå¦‚æœæ²¡æœ‰å°±å»æœ¬æœºç‰©ç†ç½‘å¡æ‰€é…ç½®çš„åŸŸåï¼ˆDNS</p>\n<p>ï¼‰æœåŠ¡å™¨ä¸­æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å› ipï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±å»å½“å‰åŸŸåé…ç½®çš„ DNS æœåŠ¡å™¨æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°å°±è¿”å› ipã€‚</p>\n<p>@è§£æçš„æ˜¯é¡¶çº§åŸŸåï¼Œå¦‚ 666.com æ˜¯é¡¶çº§åŸŸåï¼Œaa.666.com å°±æ˜¯é¡¶çº§åŸŸåçš„äºŒçº§åŸŸåï¼Œå¯ä»¥æœ‰å¤šçº§åŸŸåã€‚</p>\n<h2 id=\"ç®€å•ç½‘ç«™æ­å»º\"><a class=\"anchor\" href=\"#ç®€å•ç½‘ç«™æ­å»º\">#</a> ç®€å•ç½‘ç«™æ­å»º</h2>\n<p>nginx ä¸»è¦ç›®å½•æœ‰ confã€htmlã€logsã€sbinï¼Œç½‘ç«™å…¥å£æ–‡ä»¶åœ¨ html ç›®å½•ä¸‹ï¼Œå¯ä»¥åœ¨è¯¥ç›®å½•ä¸‹æ–°å»º html æ–‡ä»¶ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬åœ¨ html ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª html ç›®å½•ï¼Œåœ¨è¯¥æ–°å»ºçš„ html ç›®å½•ä¸‹æ–°å»ºä¸¤ä¸ªç›®å½• test1ã€test2ï¼Œåœ¨è¿™ä¸¤ä¸ªç›®å½•ä¸‹å„æ–°å»ºä¸€ä¸ª index.html æ–‡ä»¶</p>\n<pre><code class=\"language-sh\">[root@localhost html]# pwd\n/usr/local/nginx/html/html\n[root@localhost html]# ls\ntest1  test2\n</code></pre>\n<p>æ¥ä¸‹æ¥æ›´æ”¹ conf ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ nginx.conf</p>\n<p>ä¸€ä¸ª server åŒ…è£¹ä¸‹çš„å†…å®¹ä»£è¡¨é…ç½®çš„æ˜¯ä¸€å°ä¸»æœºï¼Œæ„å‘³ç€å¯ä»¥é…ç½®å¤šå°ä¸»æœº</p>\n<pre><code>\nserver &#123;\n        listen       81;\n        server_name  localhost; #å¯ä»¥è‡ªå®šä¹‰ï¼ˆåŸŸåæˆ–è€…ä¸»æœºåï¼‰\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / &#123;\n            root   html/html/test1; #è¯·æ±‚çš„å…¥å£\n            index  index.html index.htm; #indexä»£è¡¨ç´¢å¼•\n        &#125;\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n\nserver &#123;\n        listen       82;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / &#123;\n            root   html/html/test2;\n            index  index.html index.htm;\n        &#125;\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n</code></pre>\n<p>é‡æ–°åŠ è½½ nginx é…ç½®ï¼šsystemctl reload nginx.serviceï¼Œæˆ–è€…é‡å¯ nginxï¼šsystemctl restart nginx.serviceã€‚å¯ä»¥ä½¿ç”¨ systemctl status nginx.service -l æ¥è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p>\n<p>æµè§ˆå™¨è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTM3LjEyODo4MS8=\">http://192.168.137.128:81/</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210802195840.png\" alt=\"image-20210802195837343\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210802195858.png\" alt=\"image-20210802195856610\" /></p>\n<p>ä¹Ÿå¯ä»¥å°† index å¯¹åº”çš„ html æ–‡ä»¶æ”¹åä¸ºå…¶ä»–åå­—ï¼Œå¦‚ 1.html</p>\n<pre><code>server &#123;\n        listen       81;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / &#123;\n            root   html/html/test1;\n            index  1.html index.htm;\n        &#125;\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n</code></pre>\n<pre><code class=\"language-sh\">[root@localhost test1]# mv index.html 1.html\n[root@localhost test1]# ls\n1.html\n</code></pre>\n<p>é‡å¯ nginx è®¿é—®</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210802223715.png\" alt=\"image-20210802223714004\" /></p>\n<p>ä¹Ÿå¯ä»¥æ›´æ”¹ server_nameï¼Œ<span class=\"exturl\" data-url=\"aHR0cDovL3huLS02NjYtaGIwZTgxc3dsZzA3YzgwOWNldHIuY29t\">æ¯”å¦‚ä½¿ç”¨åŸŸå 666.com</span>ï¼Œå‰ææ˜¯è¦åœ¨æœ¬åœ° hosts æ–‡ä»¶ä¸­æ·»åŠ è¯¥åŸŸåçš„è§£æï¼Œå°† 666.com è§£æåˆ°æœ¬åœ°</p>\n<pre><code>192.168.137.128 666.com\n</code></pre>\n<pre><code>server &#123;\n        listen       81;\n        server_name  666.com;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / &#123;\n            root   html/html/test1;\n            index  1.html index.htm;\n        &#125;\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210802225645.png\" alt=\"image-20210802225643759\" /></p>\n<h2 id=\"æ­£å‘ä»£ç†ä¸åå‘ä»£ç†\"><a class=\"anchor\" href=\"#æ­£å‘ä»£ç†ä¸åå‘ä»£ç†\">#</a> æ­£å‘ä»£ç†ä¸åå‘ä»£ç†</h2>\n<p>æŸ¥çœ‹ nginx æ˜¯å¦å¯åŠ¨</p>\n<pre><code class=\"language-sh\">[root@localhost test1]# netstat -lnp|grep 80\ntcp        0      0 127.0.0.1:6380          0.0.0.0:*               LISTEN      1055/redis-server 1 \ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      45534/nginx: master \n\n[root@localhost test1]# netstat -lnp|grep nginx\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      45534/nginx: master \ntcp        0      0 0.0.0.0:81              0.0.0.0:*               LISTEN      45534/nginx: master \ntcp        0      0 0.0.0.0:82              0.0.0.0:*               LISTEN      45534/nginx: master \n\n#åœæ­¢æŸä¸€ä¸ªæœåŠ¡\nsystemctl stop nginx\n</code></pre>\n<p>åå‘ä»£ç†ï¼ŒåŒæ ·æˆ‘ä»¬ç°åœ¨ä¸»æœºçš„ hosts æ–‡ä»¶ä¸­å°†æœ¬æœº ip æ˜ å°„åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„åŸŸåï¼Œç„¶åé€šè¿‡è®¿é—®æœ¬æœºçš„ 82 ç«¯å£ï¼Œè¯¥ 82 ç«¯å£å°†è¢«æˆ‘ä»¬è‡ªå®šä¹‰çš„åŸŸåä»£ç†</p>\n<pre><code>192.168.137.128 www.666.com\n</code></pre>\n<pre><code>server &#123;\n        listen       82;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / &#123;\n            proxy_pass http://www.666.com; #åå‘ä»£ç†\n        &#125;\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n</code></pre>\n<p>é‡å¯ nginx æµ‹è¯• <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTM3LjEyODo4Mi8=\">http://192.168.137.128:82/</span></p>\n<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€å° nginx ä»£ç†å¤šå° nginxï¼Œå³è´Ÿè½½å‡è¡¡ï¼Œè¿™é‡Œä»¥ä¸€å° nginx ä»£ç†ä¸¤å° nginx ä¸ºä¾‹</p>\n<pre><code class=\"language-sh\">[root@localhost nginx]# cd conf/\n[root@localhost conf]# ls\nfastcgi.conf          fastcgi_params          koi-utf  mime.types          nginx.conf          scgi_params          uwsgi_params          win-utf\nfastcgi.conf.default  fastcgi_params.default  koi-win  mime.types.default  nginx.conf.default  scgi_params.default  uwsgi_params.default\n[root@localhost conf]# cp nginx.conf nginx-88.conf\n[root@localhost conf]# cp nginx.conf nginx-99.conf\n[root@localhost conf]# vim nginx-88.conf \n[root@localhost conf]# vim nginx-99.conf \n[root@localhost conf]# cd ..\n[root@localhost nginx]# cd html/\n[root@localhost html]# vim index-88.html\n[root@localhost html]# vim index-99.html\n\n</code></pre>\n<pre><code>server &#123;\n        listen       88;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / &#123;\n            root   html;\n            index  index-88.html index.htm;\n        &#125;\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n&#125;\n</code></pre>\n<pre><code> server &#123;\n        listen       99;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / &#123;\n            root   html;\n            index  index-99.html index.htm;\n        &#125;\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n&#125;\n</code></pre>\n<p>å¯åŠ¨è¿™ä¸¤å° nginx</p>\n<pre><code class=\"language-sh\">[root@localhost nginx]# cd sbin/\n[root@localhost sbin]# ls\nnginx\n[root@localhost sbin]# ./nginx -c  conf/nginx-88.conf #nginx -s stopåœæ­¢æ‰€æœ‰nginxæœåŠ¡\n[root@localhost sbin]# ./nginx -c  conf/nginx-99.conf\n\n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210803223157.png\" alt=\"image-20210803223154448\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210803223231.png\" alt=\"image-20210803223230428\" /></p>\n<p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨å¦å¤–çš„ä¸€å° nginx ä»£ç† (ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨) ä»¥ä¸Šçš„ä¸¤å° nginx</p>\n<pre><code>upstream test &#123;\n        server 192.168.137.128:88;\n        server 192.168.137.128:99;\n&#125;\n\nserver &#123;\n        listen       80;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / &#123;\n            proxy_pass http://test; #testéœ€è¦ä¸ä»¥ä¸Šupstreamåé¢çš„åå­—è¦ä¸€è‡´\n        &#125;\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n</code></pre>\n<p>é‡å¯ nginxï¼Œæ­¤æ—¶é‡å¯åå¯èƒ½å¯¼è‡´ä¹‹å‰å¯åŠ¨çš„ä¸¤å° nginx è¢«å…³é—­</p>\n<pre><code class=\"language-sh\">root@localhost nginx]# systemctl restart nginx.service \n[root@localhost nginx]# ps -ef | grep nginx\nroot      49296      1  0 22:30 ?        00:00:00 nginx: master process ./nginx -c conf/nginx-88.conf\nnobody    49297  49296  0 22:30 ?        00:00:00 nginx: worker process\nroot      49838      1  0 23:19 ?        00:00:00 nginx: master process /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\nnobody    49839  49838  0 23:19 ?        00:00:00 nginx: worker process\nroot      49842  48245  0 23:19 pts/0    00:00:00 grep --color=auto nginx\n[root@localhost nginx]# cd sbin/\n[root@localhost sbin]# ./nginx -c conf/nginx-99.conf\n[root@localhost sbin]# ps -ef | grep nginx\nroot      49296      1  0 22:30 ?        00:00:00 nginx: master process ./nginx -c conf/nginx-88.conf\nnobody    49297  49296  0 22:30 ?        00:00:00 nginx: worker process\nroot      49838      1  0 23:19 ?        00:00:00 nginx: master process /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\nnobody    49839  49838  0 23:19 ?        00:00:00 nginx: worker process\nroot      49853      1  0 23:20 ?        00:00:00 nginx: master process ./nginx -c conf/nginx-99.conf\nnobody    49854  49853  0 23:20 ?        00:00:00 nginx: worker process\nroot      49856  48245  0 23:20 pts/0    00:00:00 grep --color=auto nginx\n\n</code></pre>\n<p>è®¿é—®æµ‹è¯• <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTM3LjEyOC8lRUYlQkMlOEMlRTUlOEYlQUYlRTQlQkIlQTUlRTclOUMlOEIlRTUlODglQjAlRTQlQjklOEIlRTUlODklOEQlRTUlOTAlQUYlRTUlOEElQTglRTclOUElODQlRTQlQjglQTQlRTUlOEYlQjBuZ2lueCVFNCVCQyU5QSVFOCVBMiVBQiVFNCVCQSVBNCVFNiU5QiVCRiVFOCVBRSVCRiVFOSU5NyVBRSVFNSU4OCVCMA==\">http://192.168.137.128/ï¼Œå¯ä»¥çœ‹åˆ°ä¹‹å‰å¯åŠ¨çš„ä¸¤å° nginx ä¼šè¢«äº¤æ›¿è®¿é—®åˆ°</span></p>\n<h3 id=\"æƒé‡\"><a class=\"anchor\" href=\"#æƒé‡\">#</a> æƒé‡</h3>\n<p>æ­¤å¤–ï¼Œå¯ä»¥é…ç½®è®¿é—®çš„æƒé‡</p>\n<pre><code>upstream test &#123;\n        server 192.168.137.128:88 weight=1;\n        server 192.168.137.128:99 weight=10;\n&#125;\n</code></pre>\n<h2 id=\"httpsé…ç½®\"><a class=\"anchor\" href=\"#httpsé…ç½®\">#</a> HTTPS é…ç½®</h2>\n<p>åœ¨ nginx ä¸­é…ç½® HTTPS éœ€è¦ SSL è¯ä¹¦ï¼Œæˆ‘è¿™é‡Œå·²ç»ç”³è¯·å¥½äº†ä¸€ä¸ªåŸŸåä»¥åŠåŸŸåå¯¹åº”çš„è¯ä¹¦ï¼Œæ¥ä¸‹æ¥æŠŠåŸŸåé…ç½®åœ¨æœ¬åœ°ä¸»æœºçš„ hosts æ–‡ä»¶ä¸­</p>\n<pre><code>192.168.137.128 www.baiyezi.vip\n</code></pre>\n<p>ç„¶åå°†ç”³è¯·å¥½çš„ SSL è¯ä¹¦ä¸‹è½½ï¼ˆæˆ‘è¿™é‡Œä½¿ç”¨è…¾è®¯äº‘çš„å…è´¹è¯ä¹¦ï¼‰å¹¶ä¸Šä¼ åˆ° nginx çš„ conf ç›®å½•ä¸‹ï¼Œæœ€åéœ€è¦é…ç½® nginx.confï¼Œå¹¶åœ¨ html ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª htmlï¼Œæ¯”å¦‚ index-https.html</p>\n<pre><code> # HTTPS server\n    server &#123;\n        listen       443 ssl;\n        server_name  www.baiyezi.vip;\n\n        ssl_certificate      www.baiyezi.vip.crt;\n        ssl_certificate_key  www.baiyezi.vip.key;\n\n        ssl_session_cache    shared:SSL:1m;\n        ssl_session_timeout  5m;\n\n        #ssl_ciphers  HIGH:!aNULL:!MD5;\n        #ssl_prefer_server_ciphers  on;\n\n        location / &#123;\n            root   html;\n            index  index-https.html;\n        &#125;\n    &#125;\n</code></pre>\n<p>æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æˆåŠŸ</p>\n<pre><code class=\"language-sh\">[root@localhost conf]# ../sbin/nginx -t\nnginx: [emerg] the &quot;ssl&quot; parameter requires ngx_http_ssl_module in /usr/local/nginx/conf/nginx.conf:101\nnginx: configuration file /usr/local/nginx/conf/nginx.conf test failed\n\n</code></pre>\n<p>æŠ¥é”™åŸå› ï¼šç¼ºå°‘ SSL æ¨¡å—</p>\n<pre><code class=\"language-sh\">[root@localhost conf]# cd ..\n[root@localhost nginx]# cd sbin/\n#æŸ¥çœ‹å®‰è£…nginxæ—¶å®‰è£…çš„å…¶ä»–æ¨¡å—\n[root@localhost sbin]# ./nginx -V\nnginx version: nginx/1.21.1\nbuilt by gcc 8.3.1 20191121 (Red Hat 8.3.1-5) (GCC) \nconfigure arguments: --prefix=/usr/local/nginx\n[root@localhost sbin]# cd ..\n[root@localhost nginx]# systemctl stop nginx.service \n[root@localhost nginx]# ps -ef | grep nginx\nroot      49296      1  0 19:09 ?        00:00:00 nginx: master process ./nginx -c conf/nginx-88.conf\nnobody    49297  49296  0 19:09 ?        00:00:00 nginx: worker process\nroot      49853      1  0 19:58 ?        00:00:00 nginx: master process ./nginx -c conf/nginx-99.conf\nnobody    49854  49853  0 19:58 ?        00:00:00 nginx: worker process\nroot      51885  50173  0 23:36 pts/1    00:00:00 grep --color=auto nginx\n[root@localhost nginx]# cd ~\n[root@localhost ~]# ls\n anaconda-ks.cfg  'index.html?id=498903'   java   mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz   nginx-1.21.1.tar.gz   test\n arthas-boot.jar   initial-setup-ks.cfg    logs   nginx-1.21.1                                 redis-6.0.9.tar.gz    testsocket\n[root@localhost ~]# cd nginx-1.21.1/\n[root@localhost nginx-1.21.1]# ls\nauto  CHANGES  CHANGES.ru  conf  configure  contrib  html  LICENSE  Makefile  man  objs  README  src\n#ä¿è¯æœ‰OpenSSLåº“\n[root@localhost nginx-1.21.1]#yum -y install openssl openssl-devel\n#å†æ¬¡å®‰è£…nginxæ—¶å®‰è£…SSLæ¨¡å—\n[root@localhost nginx-1.21.1]# ./configure --prefix=/usr/local/nginx --with-http_ssl_module\n#ç¼–è¯‘ã€‚æ³¨æ„ä¸è¦ä½¿ç”¨make installï¼Œå¦åˆ™ä¼šæŠŠä¹‹å‰çš„å·²æœ‰çš„é…ç½®å…¨éƒ¨è¦†ç›–æ‰\n[root@localhost nginx-1.21.1]# make\n#å°†ç¼–è¯‘å¥½çš„nginxæ›¿æ¢æ‰sbinç›®å½•ä¸‹çš„nginxï¼ˆæ­¤æ—¶ï¼Œæ‰€æœ‰nginxæœåŠ¡è¦åœæ‰ï¼‰\n[root@localhost nginx-1.21.1]# cp ./objs/nginx /usr/local/nginx/sbin/\ncpï¼šæ˜¯å¦è¦†ç›–'/usr/local/nginx/sbin/nginx'ï¼Ÿ y\ncp: æ— æ³•åˆ›å»ºæ™®é€šæ–‡ä»¶'/usr/local/nginx/sbin/nginx': æ–‡æœ¬æ–‡ä»¶å¿™\n[root@localhost nginx-1.21.1]# ps -ef | grep nginx\nroot      49296      1  0 19:09 ?        00:00:00 nginx: master process ./nginx -c conf/nginx-88.conf\nnobody    49297  49296  0 19:09 ?        00:00:00 nginx: worker process\nroot      49853      1  0 19:58 ?        00:00:00 nginx: master process ./nginx -c conf/nginx-99.conf\nnobody    49854  49853  0 19:58 ?        00:00:00 nginx: worker process\nroot      89512  50173  0 23:52 pts/1    00:00:00 grep --color=auto nginx\n[root@localhost nginx-1.21.1]# kill -9 1\n[root@localhost nginx-1.21.1]# ps -ef | grep nginx\nroot      49296      1  0 19:09 ?        00:00:00 nginx: master process ./nginx -c conf/nginx-88.conf\nnobody    49297  49296  0 19:09 ?        00:00:00 nginx: worker process\nroot      49853      1  0 19:58 ?        00:00:00 nginx: master process ./nginx -c conf/nginx-99.conf\nnobody    49854  49853  0 19:58 ?        00:00:00 nginx: worker process\nroot      89514  50173  0 23:52 pts/1    00:00:00 grep --color=auto nginx\n[root@localhost nginx-1.21.1]# kill -9 49296\n[root@localhost nginx-1.21.1]# kill -9 49853\n[root@localhost nginx-1.21.1]# ps -ef | grep nginx\nnobody    49297      1  0 19:09 ?        00:00:00 nginx: worker process\nnobody    49854      1  0 19:58 ?        00:00:00 nginx: worker process\nroot      89524  50173  0 23:52 pts/1    00:00:00 grep --color=auto nginx\n[root@localhost nginx-1.21.1]# kill -9 49297\n[root@localhost nginx-1.21.1]# kill -9 49854\n[root@localhost nginx-1.21.1]# ps -ef | grep nginx\nroot      89531  50173  0 23:53 pts/1    00:00:00 grep --color=auto nginx\n[root@localhost nginx-1.21.1]# cp ./objs/nginx /usr/local/nginx/sbin/\ncpï¼šæ˜¯å¦è¦†ç›–'/usr/local/nginx/sbin/nginx'ï¼Ÿ y\n\n[root@localhost nginx-1.21.1]# cd /usr/local/nginx/sbin/\n[root@localhost sbin]# ./nginx -V\nnginx version: nginx/1.21.1\nbuilt by gcc 8.3.1 20191121 (Red Hat 8.3.1-5) (GCC) \nbuilt with OpenSSL 1.1.1g FIPS  21 Apr 2020\nTLS SNI support enabled\nconfigure arguments: --prefix=/usr/local/nginx --with-http_ssl_module\n#å¯åŠ¨nginx\n[root@localhost sbin]# ./nginx\n[root@localhost sbin]# \n\n</code></pre>\n<p>è®¿é—®æµ‹è¯• <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmFpeWV6aS52aXAv\">https://www.baiyezi.vip/</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210805000216.png\" alt=\"image-20210805000213904\" /></p>\n<h2 id=\"éƒ¨ç½²é¡¹ç›®\"><a class=\"anchor\" href=\"#éƒ¨ç½²é¡¹ç›®\">#</a> éƒ¨ç½²é¡¹ç›®</h2>\n<p>è¿™é‡Œå°†ä¸€ä¸ª SpringBoot é¡¹ç›®æ‰“åŒ…åä¸Šä¼ åˆ° linux ä¸‹ï¼ŒåŒæ—¶ç»™ä¸»æœºé…ç½®æˆ‘ä¹‹å‰ç”³è¯·çš„åŸŸåï¼Œåœ¨ linux ä¸‹å¯åŠ¨é¡¹ç›®å¹¶è®¿é—®</p>\n<pre><code>192.168.137.128 www.baiyezi.vip\n</code></pre>\n<pre><code class=\"language-sh\">[root@localhost local]# ls\napollo  bin  etc  games  include  lib  lib64  libexec  mysql5.7  nginx  redis-6.0.9  sbin  serial-go-0.0.1-SNAPSHOT.jar  share  src\n[root@localhost local]# java -jar serial-go-0.0.1-SNAPSHOT.jar \n\n  .   ____          _            __ _ _\n /\\\\ / ___'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\\n( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\\n \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )\n  '  |____| .__|_| |_|_| |_\\__, | / / / /\n =========|_|==============|___/=/_/_/_/\n :: Spring Boot ::                (v2.5.2)\n...\n</code></pre>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5iYWl5ZXppLnZpcDo4MDgwLyVFRiVCQyU4QyVFNSU4RiVBRiVFNCVCQiVBNSVFNyU5QyU4QiVFNSU4OCVCMCVFNyU4RSVCMCVFNSU5QyVBOCVFNSU4RiVBQSVFOCU4MyVCRCVFNCVCQiVBNWh0dHAlRTYlOTYlQjklRTUlQkMlOEYlRTglQUUlQkYlRTklOTclQUUlRTklQTElQjklRTclOUIlQUU=\">http://www.baiyezi.vip:8080/ï¼Œå¯ä»¥çœ‹åˆ°ç°åœ¨åªèƒ½ä»¥ http æ–¹å¼è®¿é—®é¡¹ç›®</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210805223521.png\" alt=\"image-20210805223520396\" /></p>\n<p>SpringBoot é¡¹ç›®å†…ç½®çš„æ˜¯ Tomcat æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ nginx çš„åå‘ä»£ç†æ¥å°†è¯·æ±‚ä»£ç†åˆ° nginx</p>\n<pre><code># HTTPS server\n    server &#123;\n        listen       443 ssl;\n        server_name  www.baiyezi.vip;\n\n        ssl_certificate      www.baiyezi.vip.crt;\n        ssl_certificate_key  www.baiyezi.vip.key;\n\n        #ssl_session_cache    shared:SSL:1m;\n        #ssl_session_timeout  5m;\n\n        #ssl_ciphers  HIGH:!aNULL:!MD5;\n        #ssl_prefer_server_ciphers  on;\n\n        location / &#123;\n            proxy_pass http://127.0.0.1:8080; #å°†è¯·æ±‚åå‘ä»£ç†åˆ°é¡¹ç›®ç«¯å£8080\n            #root   html;\n            #index  index-https.html;\n        &#125;\n    &#125;\n\n</code></pre>\n<p>æ­¤æ—¶ï¼Œè®¿é—® <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmFpeWV6aS52aXAvJUVGJUJDJThDJUU1JThGJUFGJUU0JUJCJUE1JUU3JTlDJThCJUU1JTg4JUIwJUU3JTk0JUIxJUU1JThFJTlGJUU2JTlEJUE1JUU3JTlBJTg0aHRwcCVFOCVBRiVCNyVFNiVCMSU4MiVFNSU4RiU5OCVFNCVCOCVCQSVFNCVCQSU4NiVFNSVBRSU4OSVFNSU4NSVBOCVFNyU5QSU4NGh0dHBzJUU4JUFGJUI3JUU2JUIxJTgyJUUzJTgwJTgyJUU4JUJGJTk5JUU2JTk3JUI2JUU1JThGJUFGJUU0JUJCJUE1JUU3JTlCJUI0JUU2JThFJUE1JUU1JTlDJUE4JUU5JTk4JUIyJUU3JTgxJUFCJUU1JUEyJTk5JUU1JUIwJTg2ODA4MCVFNyVBQiVBRiVFNSU4RiVBMyVFNSU4NSVCMyVFOSU5NyVBRCVFRiVCQyU4QyVFOSU5OCVCMiVFNiVBRCVBMiVFNyU5NCVBOCVFNiU4OCVCNyVFNCVCQiVBNWh0dHAlRTclOUElODQ4MDgwJUU3JUFCJUFGJUU1JThGJUEzJUU4JUFFJUJGJUU5JTk3JUFFJUU5JUExJUI5JUU3JTlCJUFFJUUzJTgwJTgyJUU4JUJGJTlCJUU0JUI4JTgwJUU2JUFEJUE1JUU1JThGJUFGJUU0JUJCJUE1JUU0JUJEJUJGJUU3JTk0JUE4bmdpbnglRTQlQkQlOUMlRTglQjQlOUYlRTglQkQlQkQlRTUlOUQlODclRTglQTElQTElRTMlODAlODI=\">https://www.baiyezi.vip/ï¼Œå¯ä»¥çœ‹åˆ°ç”±åŸæ¥çš„ htpp è¯·æ±‚å˜ä¸ºäº†å®‰å…¨çš„ https è¯·æ±‚ã€‚è¿™æ—¶å¯ä»¥ç›´æ¥åœ¨é˜²ç«å¢™å°† 8080 ç«¯å£å…³é—­ï¼Œé˜²æ­¢ç”¨æˆ·ä»¥ http çš„ 8080 ç«¯å£è®¿é—®é¡¹ç›®ã€‚è¿›ä¸€æ­¥å¯ä»¥ä½¿ç”¨ nginx ä½œè´Ÿè½½å‡è¡¡ã€‚</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210805224408.png\" alt=\"image-20210805224405671\" /></p>\n<h2 id=\"åŠ¨é™åˆ†ç¦»\"><a class=\"anchor\" href=\"#åŠ¨é™åˆ†ç¦»\">#</a> åŠ¨é™åˆ†ç¦»</h2>\n<p>é¡¹ç›®ä¸­çš„ cssã€jsã€å›¾ç‰‡ç­‰é™æ€èµ„æºåœ¨åŠ è½½æ—¶æ€»ä¼šæ‹–æ…¢é¡¹ç›®çš„è®¿é—®é€Ÿåº¦ï¼Œæ‰€ä»¥æœ‰å¿…è¦å°†é™æ€èµ„æºçš„è¯·æ±‚ä¸åç«¯ä¸šåŠ¡åˆ†ç¦»å¼€æ¥ï¼Œå³è®¿é—®é™æ€èµ„æºä¸å†é€šè¿‡ Tomcatï¼Œè€Œæ˜¯é€šè¿‡ nginxã€‚</p>\n<p>é¦–å…ˆé…ç½®é¡¹ç›®çš„åå‘ ä»£ç†ï¼Œä¹‹åé…ç½®å¤šä¸ª locationï¼Œç”¨äºè®¿é—®å•ç‹¬çš„é™æ€æ–‡ä»¶èµ„æº</p>\n<pre><code>server &#123;\n        listen       80;\n        server_name  localhost;\n\n        location / &#123;\n            proxy_pass http://127.0.0.1:8080; #é¡¹ç›®çš„åå‘ä»£ç†\n        &#125;\n        \n        location /css &#123; # /cssçš„ç²¾å‡†åŒ¹é…ä¼˜å…ˆäº / çš„åŒ¹é…\n        \troot /usr/local/nginx/static; #å°†é¡¹ç›®ä¸­çš„cssé™æ€æ–‡ä»¶ä¸Šä¼ åˆ°è¯¥ç›®å½•ä¸‹\n        &#125;\n        \n        location /js &#123;\n        \troot /usr/local/nginx/static; #å°†é¡¹ç›®ä¸­çš„jsæ–‡ä»¶ä¸Šä¼ åˆ°è¯¥ç›®å½•ä¸‹\n        &#125;\n        \n        location /images &#123;\n        \troot /usr/local/nginx/static; #å°†é¡¹ç›®ä¸­çš„å›¾ç‰‡ä¸Šä¼ åˆ°è¯¥ç›®å½•ä¸‹\n        &#125;\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n</code></pre>\n<p>location åé¢æ”¯æŒæ­£åˆ™åŒ¹é…</p>\n<pre><code>location ~*/(css|images|js) &#123;\n        \troot /usr/local/nginx/static; #å°†é¡¹ç›®ä¸­çš„jsæ–‡ä»¶ä¸Šä¼ åˆ°è¯¥ç›®å½•ä¸‹\n        &#125;\n</code></pre>\n<h3 id=\"location-å‰ç¼€\"><a class=\"anchor\" href=\"#location-å‰ç¼€\">#</a> location å‰ç¼€</h3>\n<hr />\n<p>æ²¡æœ‰å‰ç¼€         åŒ¹é…ä»¥æŒ‡å®šæ¨¡å¼å¼€å¤´çš„ location</p>\n<hr />\n<p>=              ç²¾å‡†åŒ¹é…ï¼Œä¸æ˜¯ä»¥æŒ‡å®šæ¨¡å¼å¼€å¤´</p>\n<hr />\n<p>~              æ­£åˆ™åŒ¹é…ï¼ŒåŒºåˆ†å¤§å°å†™</p>\n<hr />\n<p>~*              æ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™</p>\n<hr />\n<p>^~              éæ­£åˆ™åŒ¹é…ï¼ŒåŒ¹é…ä»¥æŒ‡å®šæ¨¡å¼å¼€å¤´çš„ location</p>\n<p><strong>location åŒ¹é…é¡ºåº</strong></p>\n<ul>\n<li>\n<p>å¤šä¸ªæ­£åˆ™ location ç›´æ¥æŒ‰ä¹¦å†™é¡ºåºåŒ¹é…ï¼ŒæˆåŠŸåå°±ä¸ä¼šç»§ç»­å¾€åé¢åŒ¹é…</p>\n</li>\n<li>\n<p>æ™®é€šï¼ˆéæ­£åˆ™ï¼‰location ä¼šä¸€ç›´å¾€ä¸‹ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…åº¦æœ€é«˜çš„ï¼ˆæœ€å¤§å‰ç¼€åŒ¹é…ï¼‰</p>\n</li>\n<li>\n<p>å½“æ™®é€š location ä¸æ­£åˆ™ location åŒæ—¶å­˜åœ¨ï¼Œå¦‚æœæ­£åˆ™åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸ä¼šå†æ‰§è¡Œæ™®é€šåŒ¹é…</p>\n</li>\n<li>\n<p>æ‰€æœ‰ç±»å‹ location å­˜åœ¨æ—¶ï¼Œâ€œ=â€ åŒ¹é…  &gt;  â€œ^~â€ åŒ¹é…  &gt;  æ­£åˆ™åŒ¹é…  &gt;  æ™®é€šï¼ˆæœ€å¤§å‰ç¼€åŒ¹é…ï¼‰</p>\n</li>\n</ul>\n<h3 id=\"aliasä¸root\"><a class=\"anchor\" href=\"#aliasä¸root\">#</a> alias ä¸ root</h3>\n<p>root åœ¨åŒ¹é…æ—¶ä¼šè‡ªåŠ¨åŠ ä¸Š location åé¢çš„è·¯å¾„</p>\n<pre><code>location /css &#123;\n        \troot /usr/local/nginx/static; #å®é™…è®¿é—®çš„æ˜¯/usr/local/nginx/static/css\n        &#125;\n</code></pre>\n<p>è€Œ alias ä¸ä¼šåŠ ä¸Š location åé¢çš„è·¯å¾„ï¼Œéœ€è¦é¢å¤–æ·»åŠ è·¯å¾„</p>\n<pre><code> location /css &#123;\n        alias /usr/local/nginx/static/css;\n    &#125;\n</code></pre>\n<p>1ï¼‰alias æŒ‡å®šçš„ç›®å½•æ˜¯å‡†ç¡®çš„ï¼Œå³ location åŒ¹é…è®¿é—®çš„ path ç›®å½•ä¸‹çš„æ–‡ä»¶ç›´æ¥æ˜¯åœ¨ alias ç›®å½•ä¸‹æŸ¥æ‰¾çš„ï¼›<br />\n2ï¼‰root æŒ‡å®šçš„ç›®å½•æ˜¯ location åŒ¹é…è®¿é—®çš„ path ç›®å½•çš„ä¸Šä¸€çº§ç›®å½•ï¼Œè¿™ä¸ª path ç›®å½•ä¸€å®šè¦æ˜¯çœŸå®å­˜åœ¨ root æŒ‡å®šç›®å½•ä¸‹çš„ï¼›<br />\n3ï¼‰ä½¿ç”¨ alias æ ‡ç­¾çš„ç›®å½•å—ä¸­ä¸èƒ½ä½¿ç”¨ rewrite çš„ breakï¼ˆå…·ä½“åŸå› ä¸æ˜ï¼‰ï¼›å¦å¤–ï¼Œalias æŒ‡å®šçš„ç›®å½•åé¢å¿…é¡»è¦åŠ ä¸Š &quot;/&quot; ç¬¦\t\tå·ï¼ï¼<br />\n4ï¼‰alias è™šæ‹Ÿç›®å½•é…ç½®ä¸­ï¼Œlocation åŒ¹é…çš„ path ç›®å½•å¦‚æœåé¢ä¸å¸¦ &quot;/&quot;ï¼Œé‚£ä¹ˆè®¿é—®çš„ url åœ°å€ä¸­è¿™ä¸ª path ç›®å½•åé¢åŠ ä¸\t\tåŠ  &quot;/&quot; ä¸å½±å“è®¿é—®ï¼Œè®¿é—®æ—¶å®ƒä¼šè‡ªåŠ¨åŠ ä¸Š &quot;/&quot;ï¼›ä½†æ˜¯å¦‚æœ location åŒ¹é…çš„ path ç›®å½•åé¢åŠ ä¸Š &quot;/&quot;ï¼Œé‚£ä¹ˆè®¿é—®çš„ url åœ°å€ä¸­è¿™ä¸ª\t\tpath ç›®å½•å¿…é¡»è¦åŠ ä¸Š &quot;/&quot;ï¼Œè®¿é—®æ—¶å®ƒä¸ä¼šè‡ªåŠ¨åŠ ä¸Š &quot;/&quot;ã€‚å¦‚æœä¸åŠ ä¸Š &quot;/&quot;ï¼Œè®¿é—®å°±ä¼šå¤±è´¥ï¼<br />\n5ï¼‰root ç›®å½•é…ç½®ä¸­ï¼Œlocation åŒ¹é…çš„ path ç›®å½•åé¢å¸¦ä¸å¸¦ &quot;/&quot;ï¼Œéƒ½ä¸ä¼šå½±å“è®¿é—®ã€‚</p>\n<h2 id=\"urlé‡å†™\"><a class=\"anchor\" href=\"#urlé‡å†™\">#</a> URL é‡å†™</h2>\n<p>å¯ä»¥é€šè¿‡ nginx é…ç½®æ–‡ä»¶çš„ rewrite å±æ€§æ¥å®ç°ã€‚</p>\n<pre><code>rewriteæ˜¯å®ç°URLé‡å†™çš„å…³é”®æŒ‡ä»¤ï¼Œæ ¹æ®regex (æ­£åˆ™è¡¨è¾¾å¼)éƒ¨åˆ†å†…å®¹ï¼Œ\né‡å®šå‘åˆ°replacementï¼Œç»“å°¾æ˜¯flagæ ‡è®°ã€‚\n\nrewrite    &lt;regex&gt;    &lt;replacement&gt;    [flag];\nå…³é”®å­—      æ­£åˆ™        æ›¿ä»£å†…å®¹         flagæ ‡è®°\n\nå…³é”®å­—ï¼šå…¶ä¸­å…³é”®å­—error_logä¸èƒ½æ”¹å˜\næ­£åˆ™ï¼šperlå…¼å®¹æ­£åˆ™è¡¨è¾¾å¼è¯­å¥è¿›è¡Œè§„åˆ™åŒ¹é…ï¼Œå³è¯·æ±‚çš„åœ°å€\næ›¿ä»£å†…å®¹ï¼šå°†æ­£åˆ™åŒ¹é…çš„å†…å®¹æ›¿æ¢æˆreplacementï¼Œå³é¡¹ç›®ä¸­çœŸæ­£å­˜åœ¨çš„è¯·æ±‚åœ°å€\nflagæ ‡è®°ï¼šrewriteæ”¯æŒçš„flagæ ‡è®°\n\nrewriteå‚æ•°çš„æ ‡ç­¾æ®µä½ç½®ï¼š\nserver,location,if\n\nflagæ ‡è®°è¯´æ˜ï¼š\nlast  #æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåï¼Œç»§ç»­å‘ä¸‹åŒ¹é…æ–°çš„location URIè§„åˆ™\nbreak  #æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆå³ç»ˆæ­¢ï¼Œä¸å†åŒ¹é…åé¢çš„ä»»ä½•è§„åˆ™\nredirect  #è¿”å›302ä¸´æ—¶é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€ä¼šæ˜¾ç¤ºè·³è½¬åçš„URLåœ°å€\npermanent  #è¿”å›301æ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„URLåœ°å€\n</code></pre>\n<pre><code>#å‡åœ°å€ä¸­çš„æ­£åˆ™éœ€è¦ç”¨æ‹¬å·æ‹¬èµ·æ¥\nserver &#123;\n\trewrite ^å‡åœ°å€$ çœŸåœ°å€ flag\n&#125;\n</code></pre>\n<pre><code>rewrite   ^/account/list-([0-9]+).html$  /account/list?pageNum=$1  last;\nrewrite   ^/account/(.+)/list-([0-9]+).html$     /account/list?pageNum=$1     last;\n</code></pre>\n<h3 id=\"çŸ­ç½‘å€\"><a class=\"anchor\" href=\"#çŸ­ç½‘å€\">#</a> çŸ­ç½‘å€</h3>\n<p>ä½¿ç”¨ nginx çš„ rewrite å¯ä»¥å®ç°çŸ­ç½‘å€çš„åŠŸèƒ½</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210807123150.png\" alt=\"image-20210807123148632\" /></p>\n<h2 id=\"ç«™ç‚¹æ­å»º\"><a class=\"anchor\" href=\"#ç«™ç‚¹æ­å»º\">#</a> ç«™ç‚¹æ­å»º</h2>\n<h3 id=\"phpä¸€ç«™å¼ç¯å¢ƒ\"><a class=\"anchor\" href=\"#phpä¸€ç«™å¼ç¯å¢ƒ\">#</a> PHP ä¸€ç«™å¼ç¯å¢ƒ</h3>\n<p>ä¸€ç«™å¼å®‰è£…åŒ…ä¸‹è½½ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9vbmVpbnN0YWNrLmNvbS8=\">https://oneinstack.com/</span></p>\n<pre><code class=\"language-sh\">[root@localhost ~]# wget -c http://mirrors.linuxeye.com/oneinstack-full.tar.gz\n--2021-08-08 10:13:33--  http://mirrors.linuxeye.com/oneinstack-full.tar.gz\næ­£åœ¨è§£æä¸»æœº mirrors.linuxeye.com (mirrors.linuxeye.com)... 1.81.5.180, 1.81.5.177, 1.81.5.178, ...\næ­£åœ¨è¿æ¥ mirrors.linuxeye.com (mirrors.linuxeye.com)|1.81.5.180|:80... å·²è¿æ¥ã€‚\nå·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 200 OK\né•¿åº¦ï¼š345002307 (329M) [application/octet-stream]\næ­£åœ¨ä¿å­˜è‡³: â€œoneinstack-full.tar.gzâ€\n\noneinstack-full.tar.gz                  100%[============================================================================&gt;] 329.02M  4.26MB/s  ç”¨æ—¶ 1m 59s  \n\n2021-08-08 10:15:32 (2.76 MB/s) - å·²ä¿å­˜ â€œoneinstack-full.tar.gzâ€ [345002307/345002307])\n\n#åˆ é™¤åŸæœ‰çš„nginxï¼ˆå¯ä»¥å…ˆåšå¤‡ä»½ï¼‰\n[root@localhost ~]# rm -rf /usr/local/nginx/\n[root@localhost ~]# ls\n anaconda-ks.cfg  'index.html?id=498903'   java   mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz   nginx-1.21.1.tar.gz      redis-6.0.9.tar.gz   testsocket\n arthas-boot.jar   initial-setup-ks.cfg    logs   nginx-1.21.1                                 oneinstack-full.tar.gz   test\n #è§£å‹\n[root@localhost ~]# tar -zxvf oneinstack-full.tar.gz \n\n[root@localhost ~]# cd oneinstack/\n[root@localhost oneinstack]# ls\naddons.sh        backup.sh  include  install.sh  options.conf       README.md                  src    uninstall.sh  versions.txt\nbackup_setup.sh  config     init.d   LICENSE     pureftpd_vhost.sh  reset_db_root_password.sh  tools  upgrade.sh    vhost.sh\n#æ‰§è¡Œå®‰è£…è„šæœ¬\n[root@localhost oneinstack]# ./install.sh \nPlease input SSH port(Default: 22): \n\nDo you want to enable iptables? [y/n]: n\n\nDo you want to install Web server? [y/n]: y\n\nPlease select Nginx server:\n\t1. Install Nginx\n\t2. Install Tengine\n\t3. Install OpenResty\n\t4. Do not install\nPlease input a number:(Default 1 press Enter) \n#æ­¤å¤„å®‰è£…apacheçš„åŸå› ä¸€èˆ¬æ˜¯ä¸ºäº†æ”¯æŒçŸ­ç½‘å€ï¼Œä½†æ˜¯ç°åœ¨nginxçš„rewriteä¹Ÿå¯ä»¥å®ç°çŸ­ç½‘å€ï¼Œæ‰€ä»¥ä¸å†å®‰è£…apache\nDo you want to install Apache? [y/n]: n\n\nPlease select tomcat server:\n\t1. Install Tomcat-10\n\t2. Install Tomcat-9\n\t3. Install Tomcat-8\n\t4. Install Tomcat-7\n\t5. Do not install\nPlease input a number:(Default 5 press Enter) 5\n#æˆ‘çš„linuxä¸Šæœ‰æ•°æ®åº“ï¼Œæ‰€ä»¥ä¸å†å®‰è£…\nDo you want to install Database? [y/n]: n\n\nDo you want to install PHP? [y/n]: y\n\nPlease select a version of the PHP:\n\t 1. Install php-5.3\n\t 2. Install php-5.4\n\t 3. Install php-5.5\n\t 4. Install php-5.6\n\t 5. Install php-7.0\n\t 6. Install php-7.1\n\t 7. Install php-7.2\n\t 8. Install php-7.3\n\t 9. Install php-7.4\n\t10. Install php-8.0\nPlease input a number:(Default 7 press Enter) \n\nDo you want to install opcode cache of the PHP? [y/n]: n\n\nPlease select PHP extensions:\n\t 0. Do not install\n\t 1. Install zendguardloader(PHP&lt;=5.6)\n\t 2. Install ioncube\n\t 3. Install sourceguardian(PHP&lt;=7.2)\n\t 4. Install imagick\n\t 5. Install gmagick\n\t 6. Install fileinfo\n\t 7. Install imap\n\t 8. Install ldap\n\t 9. Install phalcon(PHP&gt;=5.5)\n\t10. Install yaf(PHP&gt;=7.0)\n\t11. Install redis\n\t12. Install memcached\n\t13. Install memcache\n\t14. Install mongodb\n\t15. Install swoole\n\t16. Install xdebug(PHP&gt;=5.5)\nPlease input numbers:(Default '4 11 12' press Enter) \n\nDo you want to install Nodejs? [y/n]: n\n\nDo you want to install Pure-FTPd? [y/n]: n\n\nDo you want to install phpMyAdmin? [y/n]: y\n\nDo you want to install redis-server? [y/n]: n\n\nDo you want to install memcached-server? [y/n]: n\n\n#ç­‰å¾…è‹¥å¹²åˆ†é’Ÿåã€‚ã€‚ã€‚\nBuild complete.\nDon't forget to run 'make test'.\n\nInstalling shared extensions:     /usr/local/php/lib/php/extensions/no-debug-non-zts-20170718/\nPHP Redis module installed successfully! \n[xprober.php] found\n####################Congratulations########################\nTotal OneinStack Install Time: 42 minutes\n\nNginx install dir:              /usr/local/nginx\n\nPHP install dir:                /usr/local/php\n\nphpMyAdmin dir:                 /data/wwwroot/default/phpMyAdmin\nphpMyAdmin Control Panel URL:   http://192.168.137.128/phpMyAdmin\n\nIndex URL:                      http://192.168.137.128/\n\nPlease restart the server and see if the services start up fine.\nDo you want to restart OS ? [y/n]: n\n\n#å¯åŠ¨nginx\n[root@localhost oneinstack]# cd /usr/local/nginx/\n[root@localhost nginx]# ls\nclient_body_temp  conf  fastcgi_temp  html  logs  proxy_temp  sbin  scgi_temp  uwsgi_temp\n[root@localhost nginx]# cd sbin/\n[root@localhost sbin]# ls\nnginx\n[root@localhost sbin]# ./nginx \n\n</code></pre>\n<p>è®¿é—® <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTM3LjEyOC8=\">http://192.168.137.128/</span></p>\n<p>phpMyAdmin å¯ä»¥è®¿é—®æ•°æ®åº“å¹¶æ“ä½œæ•°æ®åº“</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808113846.png\" alt=\"image-20210808113838821\" /></p>\n<h3 id=\"bbsæ­å»º\"><a class=\"anchor\" href=\"#bbsæ­å»º\">#</a> BBS æ­å»º</h3>\n<p>æœ‰äº†ä»¥ä¸Šç¯å¢ƒåï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„æ­å»ºä¸€ä¸ª BBS è®ºå›ï¼Œæºç å¯ä»¥ç›´æ¥ä¸‹è½½å¼€æºçš„ <span class=\"exturl\" data-url=\"aHR0cDovL2Rvd24uY2hpbmF6LmNvbS9zb2Z0LzM0MDk0Lmh0bQ==\">http://down.chinaz.com/soft/34094.htm</span></p>\n<p>ä¸‹è½½å®Œæˆä¹‹åå°†å‹ç¼©åŒ…ä¸­çš„ upload æ–‡ä»¶ä¸Šä¼ åˆ°  /data/wwwroot/default/</p>\n<pre><code class=\"language-sh\">[root@localhost sbin]# cd /data/wwwroot/default/\n[root@localhost default]# ls\nindex.html  phpinfo.php  phpMyAdmin  upload  xprober.php\n[root@localhost default]# mv upload bbs\n[root@localhost default]# ls\nbbs  index.html  phpinfo.php  phpMyAdmin  xprober.php\n# å°†è¯¥æºç ç›®å½•èµ‹äºˆè¯»å†™å¯æ‰§è¡Œæƒé™ï¼Œå¦åˆ™å®‰è£…æ—¶æŠ¥é”™\n[root@localhost default]# chmod -R 777 bbs/\n</code></pre>\n<p>ç›´æ¥è®¿é—® <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTM3LjEyOC9iYnM=\">http://192.168.137.128/bbs</span> æŒ‰ç…§æç¤ºå®‰è£…å³å¯</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808115046.png\" alt=\"image-20210808115044795\" /></p>\n<p>æŠ¥é”™ï¼Œæç¤ºä¸€äº›ç›®å½•ä¸å­˜åœ¨ï¼ŒåŸå› æ˜¯ Discuz ç‰ˆæœ¬çš„é—®é¢˜ï¼Œé‡æ–°ä¸‹è½½ä¸€ä¸ªä½ç‰ˆæœ¬å³å¯ï¼Œè¿™é‡Œä¸º Discuz_X3.4_SC_UTF8_20210320</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808120045.png\" alt=\"image-20210808120042991\" /></p>\n<p>ä¸‹ä¸€æ­¥ï¼Œé€‰æ‹©å…¨æ–°å®‰è£…</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808120637.png\" alt=\"image-20210808120635416\" /></p>\n<p>å¡«å†™æ•°æ®åº“ä¿¡æ¯ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808120757.png\" alt=\"image-20210808120754499\" /></p>\n<p>å®‰è£…å®Œæˆï¼Œè®¿é—®æµ‹è¯•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808120819.png\" alt=\"image-20210808120818311\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808121041.png\" alt=\"image-20210808121039733\" /></p>\n<p><img data-src=\"C:/Users/samsung/Desktop/img/blog/20210808121136.png\" alt=\"image-20210808121134171\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808121221.png\" alt=\"image-20210808121220113\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808121236.png\" alt=\"image-20210808121234049\" /></p>\n<h3 id=\"åšå®¢æ­å»º\"><a class=\"anchor\" href=\"#åšå®¢æ­å»º\">#</a> åšå®¢æ­å»º</h3>\n<p>é™¤äº†ä»¥ä¸Šçš„ BBS è®ºå›æ­å»ºå¤–ï¼Œè¿˜å¯ä»¥è¿›è¡Œåšå®¢æ­å»ºï¼Œè¿™é‡Œä½¿ç”¨ wordpress åšå®¢æ­å»ºã€‚</p>\n<p>wordpress ä¸‹è½½ <span class=\"exturl\" data-url=\"aHR0cHM6Ly93b3JkcHJlc3Mub3JnL2Rvd25sb2FkLyNkb3dubG9hZC1pbnN0YWxs\">https://wordpress.org/download/#download-install</span></p>\n<p>å°†ä¸‹è½½è§£å‹åçš„æ–‡ä»¶æ”¾åœ¨ /data/wwwroot/default/ ç›®å½•ä¸‹</p>\n<pre><code class=\"language-sh\">[root@localhost default]# wget -c https://wordpress.org/latest.tar.gz\n[root@localhost default]# tar -zxvf latest.tar.gz\n[root@localhost default]# ls\nbbs  index.html  latest.tar.gz  phpinfo.php  phpMyAdmin  wordpress  xprober.php\n# wordpressé»˜è®¤ç”¨æˆ·æ˜¯wwwï¼Œå°†wordpressç›®å½•æƒé™èµ‹äºˆè¯¥ç”¨æˆ·ã€‚å¦åˆ™åœ¨ç•Œé¢ä¸‹è½½æ’ä»¶æ—¶è¦æ±‚è¾“å…¥ä¸»æœºåŸŸåä»¥åŠç”¨æˆ·åå¯†ç \n[root@localhost default]# chown -R www:www wordpress/\n[root@localhost plugins]# ps -ef | grep &quot;php-fpm&quot;\nroot      25086      1  0 11:19 ?        00:00:00 php-fpm: master process (/usr/local/php/etc/php-fpm.conf)\nwww       74315  25086  0 11:34 ?        00:00:01 php-fpm: pool www\nwww       74316  25086  0 11:34 ?        00:00:01 php-fpm: pool www\nwww       74317  25086  0 11:34 ?        00:00:01 php-fpm: pool www\nwww       74318  25086  0 11:34 ?        00:00:01 php-fpm: pool www\n\n</code></pre>\n<p>ç›´æ¥è®¿é—® <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTM3LjEyOC93b3JkcHJlc3M=\">http://192.168.137.128/wordpress</span> è¿›è¡Œå®‰è£…</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808141238.png\" alt=\"image-20210808141237585\" /></p>\n<p>è¿™é‡Œçš„æ•°æ®åº“ä¸ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œéœ€è¦äº‹å…ˆåˆ›å»ºå¥½ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ä»¥ä¸Šçš„ phpMyAdmin æ“ä½œ</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808141855.png\" alt=\"image-20210808141853483\" /></p>\n<p>æç¤ºç¼ºå°‘ä¸€ä¸ª php é…ç½®æ–‡ä»¶ wp-config.phpï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºå¹¶å†™å…¥æç¤ºçš„å†…å®¹</p>\n<pre><code class=\"language-sh\">[root@localhost wordpress]# ls\nindex.php    wp-activate.php     wp-comments-post.php  wp-cron.php        wp-load.php   wp-settings.php   xmlrpc.php\nlicense.txt  wp-admin            wp-config-sample.php  wp-includes        wp-login.php  wp-signup.php\nreadme.html  wp-blog-header.php  wp-content            wp-links-opml.php  wp-mail.php   wp-trackback.php\n[root@localhost wordpress]# vim wp-config.php\n&lt;?php\n/**\n * The base configuration for WordPress\n *\n * The wp-config.php creation script uses this file during the installation.\n * You don't have to use the web site, you can copy this file to &quot;wp-config.php&quot;\n * and fill in the values.\n *\n * This file contains the following configurations:\n *\n * * MySQL settings\n * * Secret keys\n * * Database table prefix\n * * ABSPATH\n *\n * @link https://wordpress.org/support/article/editing-wp-config-php/\n *\n * @package WordPress\n */\n\n// ** MySQL settings - You can get this info from your web host ** //\n/** The name of the database for WordPress */\ndefine( 'DB_NAME', 'wordpress' );\n\n/** MySQL database username */\ndefine( 'DB_USER', 'root' );\n\n/** MySQL database password */\ndefine( 'DB_PASSWORD', '123456' );\n\n/** MySQL hostname */\ndefine( 'DB_HOST', 'localhost' );\n\n/** Database charset to use in creating database tables. */\ndefine( 'DB_CHARSET', 'utf8mb4' );\n\n/** The database collate type. Don't change this if in doubt. */\ndefine( 'DB_COLLATE', '' );\n\n/**#@+\n * Authentication unique keys and salts.\n *\n * Change these to different unique phrases! You can generate these using\n * the &#123;@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service&#125;.\n *\n * You can change these at any point in time to invalidate all existing cookies.\n * This will force all users to have to log in again.\n *\n * @since 2.6.0\n */\ndefine( 'AUTH_KEY',         ';CP*TiW,p(];LIEdQwLR%?)Um+F?ME2BVpJ%99`)lSQrran+jdrSr?-~J.bf0JHo' );\ndefine( 'SECURE_AUTH_KEY',  'V3lV&#123;z(X%a)JCEoN1XR0&#123;^^Im|pK&amp;jr^%e90&#125;2:Wj-_J:q41;-yHr=IAX-!/EaYA' );\ndefine( 'LOGGED_IN_KEY',    'Xkoq-*Hc8WH|46z$4FW^yTnBGeNcG[%~k~A$?+%Y_SA`-C9W95v,*= oW &lt;L=y)]' );\ndefine( 'NONCE_KEY',        ',Byfk==+l]4s~ )&lt;%iUiB 5lIZ%1eu4&lt;!$wXk7EujwHC)x)~vt@Uk1^U8StFtaBy' );\ndefine( 'AUTH_SALT',        'z&#125;7Iq3E&#125;VL4B&#125;#kU&gt;2|4Y36^[xJPxR.l&#123;t2aUlAn@qx;Vqv~t`!e&#125;.YY:HuMuBu=' );\ndefine( 'SECURE_AUTH_SALT', '`p7cL6DpIWfFs%fhGGF;@sn|3mm*&#123;jM9=)PH|X^jYtG&gt;[&gt;?oL^9+N]!#Yk!g78p@' );\ndefine( 'LOGGED_IN_SALT',   '1|M&#123;bK6JD[F/=A/ ?!YP*q-K(Y~+?7JeJ$C_i%fXs%2Mx;1a~&gt;K8)%&lt;k.8b#32f(' );\ndefine( 'NONCE_SALT',       '6:Pqb,WgNs6U.pOs=I0zcYk?=:]0i*nr^Q(vBOYNLzla`V3#Al) 7EJb@oEzDT?!' );\n\n/**#@-*/\n\n/**\n * WordPress database table prefix.\n *\n * You can have multiple installations in one database if you give each\n * a unique prefix. Only numbers, letters, and underscores please!\n */\n$table_prefix = 'wp_';\n\n/**\n * For developers: WordPress debugging mode.\n *\n * Change this to true to enable the display of notices during development.\n * It is strongly recommended that plugin and theme developers use WP_DEBUG\n * in their development environments.\n *\n * For information on other constants that can be used for debugging,\n * visit the documentation.\n *\n * @link https://wordpress.org/support/article/debugging-in-wordpress/\n */\ndefine( 'WP_DEBUG', false );\n\n/* Add any custom values between this line and the &quot;stop editing&quot; line. */\n\n\n\n/* That's all, stop editing! Happy publishing. */\n\n/** Absolute path to the WordPress directory. */\nif ( ! defined( 'ABSPATH' ) ) &#123;\n\tdefine( 'ABSPATH', __DIR__ . '/' );\n&#125;\n\n/** Sets up WordPress vars and included files. */\nrequire_once ABSPATH . 'wp-settings.php';\n\n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808142616.png\" alt=\"image-20210808142612882\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808142850.png\" alt=\"image-20210808142848720\" /></p>\n<p>ç™»å½•æµ‹è¯•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808142940.png\" alt=\"image-20210808142937065\" /></p>\n<p>å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼Œè¿™æ ·åœ¨ç•Œé¢å°±å¯ä»¥é€‰æ‹©é»˜è®¤è¯­è¨€ä¸ºç®€ä½“ä¸­æ–‡</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'WPLANG'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'zh_CN'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808153910.png\" alt=\"image-20210808153906961\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808152700.png\" alt=\"image-20210808152654223\" /></p>\n<p><img data-src=\"C:/Users/samsung/Desktop/img/blog/20210808155448.png\" alt=\"image-20210808155446826\" /></p>\n<h3 id=\"cmsæ­å»º\"><a class=\"anchor\" href=\"#cmsæ­å»º\">#</a> CMS æ­å»º</h3>\n<p>æ­¤å¤–è¿˜å¯ä»¥æ­å»º CMS åå°ç®¡ç†ç³»ç»Ÿï¼Œå¯ä»¥ä¸‹è½½å¼€æºè½¯ä»¶ <span class=\"exturl\" data-url=\"aHR0cDovL2RlZGVjbXMuY29tLw==\">http://dedecms.com/</span></p>\n<pre><code class=\"language-sh\">[root@localhost default]# wget -c http://updatenew.dedecms.com/base-v57/package/DedeCMS-V5.7-UTF8-SP2.tar.gz\n[root@localhost default]# ls\nbbs  DedeCMS-V5.7-UTF8-SP2.tar.gz  index.html  phpinfo.php  phpMyAdmin  wordpress  xprober.php\n[root@localhost default]# tar -zxvf DedeCMS-V5.7-UTF8-SP2.tar.gz \n[root@localhost default]# ls\nbbs  DedeCMS-V5.7-UTF8-SP2.tar.gz  docs  index.html  phpinfo.php  phpMyAdmin  uploads  wordpress  xprober.php\n[root@localhost default]# mv uploads/ cms\n[root@localhost default]# chmod -R 777 cms/\n[root@localhost default]# ls\nbbs  cms  DedeCMS-V5.7-UTF8-SP2.tar.gz  docs  index.html  phpinfo.php  phpMyAdmin  wordpress  xprober.php\n\n</code></pre>\n<p>ç›´æ¥è®¿é—® <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTM3LjEyOC9jbXM=\">http://192.168.137.128/cms</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808160558.png\" alt=\"image-20210808160556736\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808160811.png\" alt=\"image-20210808160809981\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808160905.png\" alt=\"image-20210808160903614\" /></p>\n<p><img data-src=\"C:/Users/samsung/Desktop/img/blog/20210808160931.png\" alt=\"image-20210808160929461\" /></p>\n<h2 id=\"lua\"><a class=\"anchor\" href=\"#lua\">#</a> Lua</h2>\n<h3 id=\"openrestyå®‰è£…\"><a class=\"anchor\" href=\"#openrestyå®‰è£…\">#</a> openresty å®‰è£…</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcGVucmVzdHkub3JnL2NuLw==\">https://openresty.org/cn/</span></p>\n<p>ä½ å¯ä»¥åœ¨ä½ çš„ CentOS ç³»ç»Ÿä¸­æ·»åŠ   <code>openresty</code>  ä»“åº“ï¼Œè¿™æ ·å°±å¯ä»¥ä¾¿äºæœªæ¥å®‰è£…æˆ–æ›´æ–°æˆ‘ä»¬çš„è½¯ä»¶åŒ…ï¼ˆé€šè¿‡  <code>yum check-update</code>  å‘½ä»¤ï¼‰ã€‚ è¿è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥æ·»åŠ æˆ‘ä»¬çš„ä»“åº“ï¼ˆå¯¹äº CentOS 8 æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼Œåº”å°†ä¸‹é¢çš„  <code>yum</code>  éƒ½æ›¿æ¢æˆ  <code>dnf</code> ï¼‰ï¼š</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># add the yum repo:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">wget</span> https://openresty.org/package/centos/openresty.repo</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> openresty.repo /etc/yum.repos.d/</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># update the yum index:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">sudo</span> yum check-update</pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·å®‰è£…è½¯ä»¶åŒ…ï¼Œæ¯”å¦‚  <code>openresty</code> ï¼š</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> -y openresty</pre></td></tr></table></figure><p>é»˜è®¤è¢«å®‰è£…åœ¨ /usr/local/openresty</p>\n<pre><code class=\"language-sh\">[root@localhost openresty]# pwd\n/usr/local/openresty\n[root@localhost openresty]# ls\nbin  COPYRIGHT  luajit  lualib  nginx  openssl111  pcre  site  zlib\n</code></pre>\n<pre><code class=\"language-sh\">#å¯åŠ¨openresty\n[root@localhost yum.repos.d]# systemctl start openresty.service \n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808182108.png\" alt=\"image-20210808182107175\" /></p>\n<h3 id=\"luaå¼€å‘\"><a class=\"anchor\" href=\"#luaå¼€å‘\">#</a> lua å¼€å‘</h3>\n<p>å¯ä»¥ç›´æ¥åœ¨ openresty ç›®å½•ä¸‹çš„ nginx ä¸­ç¼–å†™ lua è„šæœ¬</p>\n<pre><code>    server &#123; \n        listen       80; \n        server_name  localhost; \n \n        #charset koi8-r; \n \n        #access_log  logs/host.access.log  main; \n \n        location / &#123; \n            root   html; \n            index  index.html index.htm; \n        &#125; \n \n\t\tlocation /lua &#123; \n\t\t\tdefault_type text/html; \n        \tcontent_by_lua 'ngx.say(&quot;&lt;b&gt;hello world~&lt;/b&gt;&quot;)'; \n\t\t&#125; \n\n&#125;\n</code></pre>\n<pre><code class=\"language-sh\">#é‡æ–°åŠ è½½é…ç½®\n[root@localhost conf]# systemctl reload openresty.service \n</code></pre>\n<p>è®¿é—®æµ‹è¯•  <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTM3LjEyOC9sdWE=\">http://192.168.137.128/lua</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808183502.png\" alt=\"image-20210808183500784\" /></p>\n<p>å¯ä»¥åœ¨å¼•å…¥å•ç‹¬çš„ lua æ–‡ä»¶</p>\n<pre><code class=\"language-sh\">[root@localhost conf]# vim 001.lua\nngx.say(&quot;&lt;b&gt;hello world~&lt;/b&gt;&quot;)\n</code></pre>\n<pre><code>location /lua1 &#123;  \n            default_type text/html;  \n            content_by_lua_file conf/001.lua;  \n        &#125;  \n</code></pre>\n<p>é‡æ–°åŠ è½½é…ç½®åè®¿é—®æµ‹è¯•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808184712.png\" alt=\"image-20210808184710811\" /></p>\n<p>å¯ä»¥å†™ä¸€ä¸ª lua é…ç½®ï¼Œç„¶å nginx å¼•å…¥è¯¥é…ç½®</p>\n<pre><code class=\"language-sh\">root@localhost conf]# vim lua.conf\ncontent_by_lua_file conf/001.lua;\n</code></pre>\n<pre><code>location /lua2 &#123;   \n            default_type text/html;   \n            include lua.conf;   \n        &#125; \n</code></pre>\n<p>è®¿é—®æµ‹è¯•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808185335.png\" alt=\"image-20210808185334044\" /></p>\n<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥åœ¨ nginx é…ç½®æ–‡ä»¶ä¸­å†™ lua ä»£ç å—</p>\n<pre><code>location /lua3 &#123;    \n            default_type text/html;    \n            content_by_lua_block &#123; \n                 ngx.say(&quot;hello world~&lt;br&gt;&quot;)     \n                 ngx.say(&quot;lua_block&quot;)\n                &#125;    \n        &#125;  \n</code></pre>\n<p>é‡æ–°åŠ è½½é…ç½®åæµ‹è¯•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808190044.png\" alt=\"+\" /></p>\n<p>include å¯ä»¥ä¸å†™åœ¨ location ä¸­ï¼Œnginx.conf</p>\n<pre><code>location /lua2 &#123;   \n            default_type text/html;   \n            include lua.conf;   \n        &#125; \n \n        include lua1.conf; \n\n</code></pre>\n<p>lua1.conf</p>\n<pre><code>location /lua4 &#123; \n        default_type text/html; \n        content_by_lua_file conf/001.lua;  \n&#125;\n</code></pre>\n<p>é‡æ–°åŠ è½½é…ç½®åè®¿é—®</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808221211.png\" alt=\"image-20210808221210320\" /></p>\n<p>location åœ¨åŒ¹é… uri æ—¶ / ä»£è¡¨æœ€å¤§å‰ç¼€åŒ¹é…ï¼Œæ‰€ä»¥ä»¥ä¸Š lua4 ä¹‹åéšæ„åŠ ä¸Šå­—ç¬¦ä¹Ÿå¯ä»¥è®¿é—®åˆ°</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808221531.png\" alt=\"image-20210808221529823\" /></p>\n<p>å¦‚æœåœ¨ location åé¢åŠ äº† =ï¼Œé‚£ä¹ˆå°±æ˜¯ç²¾å‡†åŒ¹é…</p>\n<pre><code>location =/lua4 &#123; \n        default_type text/html; \n        content_by_lua_file conf/001.lua;  \n&#125;\n</code></pre>\n<h3 id=\"è·å–nginx-uriä¸­çš„å•ä¸€å˜é‡\"><a class=\"anchor\" href=\"#è·å–nginx-uriä¸­çš„å•ä¸€å˜é‡\">#</a> è·å– nginx uri ä¸­çš„å•ä¸€å˜é‡</h3>\n<pre><code> location /lua5.php &#123;     \n            default_type text/html;     \n            content_by_lua_block &#123;  \n                 ngx.say(ngx.var.arg_a) \n                &#125;     \n        &#125;  \n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808222734.png\" alt=\"image-20210808222733371\" /></p>\n<h3 id=\"luaé…ç½®çƒ­åŠ è½½\"><a class=\"anchor\" href=\"#luaé…ç½®çƒ­åŠ è½½\">#</a> lua é…ç½®çƒ­åŠ è½½</h3>\n<pre><code>  server &#123; \n        listen       80; \n        server_name  localhost; \n \n # å°†ç¼“å­˜å…³é—­ï¼Œä½¿å¾—æ¯æ¬¡æ›´æ”¹éƒ½ä¸ç”¨æ‰‹åŠ¨é‡æ–°åŠ è½½é…ç½®\n        lua_code_cache off;\n&#125;\n</code></pre>\n<p>é‡å¯ openresty</p>\n<pre><code class=\"language-sh\">[root@localhost conf]# systemctl restart openresty.service\n</code></pre>\n<p>æ­¤å¤–ï¼Œlua çƒ­åŠ è½½åªå¯¹å¤–éƒ¨æ–‡ä»¶çš„æ›´æ”¹æœ‰æ•ˆï¼Œå¯¹äº nginx é…ç½®æ–‡ä»¶çš„æœ‰å…³æ›´æ”¹ä»ç„¶éœ€è¦é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</p>\n<pre><code>  location /lua6 &#123;   \n            default_type text/html;   \n            content_by_lua_file conf/002.lua;   \n        &#125;  \n</code></pre>\n<p>002.lua</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>ngx<span class=\"token punctuation\">.</span>var<span class=\"token punctuation\">.</span>arg_name<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808225447.png\" alt=\"image-20210808225442713\" /></p>\n<p>æ­¤æ—¶æ›´æ”¹ 002.luaï¼Œç„¶åä¸é‡æ–°åŠ è½½é…ç½®ï¼Œæµ‹è¯•è®¿é—®æ›´æ”¹æ˜¯å¦ç”Ÿæ•ˆ</p>\n<h3 id=\"è·å–nginx-uriä¸­çš„æ‰€æœ‰å˜é‡\"><a class=\"anchor\" href=\"#è·å–nginx-uriä¸­çš„æ‰€æœ‰å˜é‡\">#</a> è·å– nginx uri ä¸­çš„æ‰€æœ‰å˜é‡</h3>\n<p>003.lua</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> uri_args <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">get_uri_args</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span> v <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>uri_args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token function\">type</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"table\"</span> <span class=\"token keyword\">then</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span> <span class=\"token string\">\":\"</span><span class=\"token punctuation\">,</span> table<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">,</span> <span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">else</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span> <span class=\"token string\">\":\"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">end</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><p>nginx.conf</p>\n<pre><code> location /lua7 &#123;    \n            default_type text/html;    \n            content_by_lua_file conf/003.lua;    \n        &#125; \n</code></pre>\n<p>æµ‹è¯• <span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTM3LjEyOC9sdWE3P25hbWU9dG9tJmFtcDthZ2U9MjAmYW1wO2dlbmRlcj1tYW4=\">http://192.168.137.128/lua7?name=tom&amp;age=20&amp;gender=man</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210808234530.png\" alt=\"image-20210808234526657\" /></p>\n<h3 id=\"è·å–nginxè¯·æ±‚å¤´ä¿¡æ¯\"><a class=\"anchor\" href=\"#è·å–nginxè¯·æ±‚å¤´ä¿¡æ¯\">#</a> è·å– nginx è¯·æ±‚å¤´ä¿¡æ¯</h3>\n<p>004.lua</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">local</span> headers <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">get_headers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>                         </pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Host : \"</span><span class=\"token punctuation\">,</span> headers<span class=\"token punctuation\">[</span><span class=\"token string\">\"Host\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user-agent : \"</span><span class=\"token punctuation\">,</span> headers<span class=\"token punctuation\">[</span><span class=\"token string\">\"user-agent\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user-agent : \"</span><span class=\"token punctuation\">,</span> headers<span class=\"token punctuation\">.</span>user_agent<span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span>v <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>headers<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token function\">type</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"table\"</span> <span class=\"token keyword\">then</span>  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span> <span class=\"token string\">\" : \"</span><span class=\"token punctuation\">,</span> table<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">,</span> <span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">else</span>  </pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span> <span class=\"token string\">\" : \"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">end</span>  </pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><pre><code>   location /lua8 &#123;     \n            default_type text/html;     \n            content_by_lua_file conf/004.lua;     \n        &#125;    \n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210809230045.png\" alt=\"image-20210809230043837\" /></p>\n<h3 id=\"è·å–postè¯·æ±‚å‚æ•°\"><a class=\"anchor\" href=\"#è·å–postè¯·æ±‚å‚æ•°\">#</a> è·å– post è¯·æ±‚å‚æ•°</h3>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ngx<span class=\"token punctuation\">.</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">read_body</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"post args begin\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">local</span> post_args <span class=\"token operator\">=</span> ngx<span class=\"token punctuation\">.</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">get_post_args</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span> v <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>post_args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token function\">type</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"table\"</span> <span class=\"token keyword\">then</span>  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span> <span class=\"token string\">\" : \"</span><span class=\"token punctuation\">,</span> table<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">,</span> <span class=\"token string\">\", \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">else</span>  </pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span> <span class=\"token string\">\": \"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">end</span>  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">end</span></pre></td></tr></table></figure><h3 id=\"httpåè®®ç‰ˆæœ¬\"><a class=\"anchor\" href=\"#httpåè®®ç‰ˆæœ¬\">#</a> http åè®®ç‰ˆæœ¬</h3>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ngx.req.http_version : \"</span><span class=\"token punctuation\">,</span> ngx<span class=\"token punctuation\">.</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">http_version</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"è¯·æ±‚æ–¹æ³•\"><a class=\"anchor\" href=\"#è¯·æ±‚æ–¹æ³•\">#</a> è¯·æ±‚æ–¹æ³•</h3>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ngx.req.get_method : \"</span><span class=\"token punctuation\">,</span> ngx<span class=\"token punctuation\">.</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">get_method</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"åŸå§‹çš„è¯·æ±‚å¤´å†…å®¹\"><a class=\"anchor\" href=\"#åŸå§‹çš„è¯·æ±‚å¤´å†…å®¹\">#</a> åŸå§‹çš„è¯·æ±‚å¤´å†…å®¹</h3>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ngx.req.raw_header : \"</span><span class=\"token punctuation\">,</span>  ngx<span class=\"token punctuation\">.</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">raw_header</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"bodyå†…å®¹ä½“\"><a class=\"anchor\" href=\"#bodyå†…å®¹ä½“\">#</a> body å†…å®¹ä½“</h3>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ngx.req.get_body_data() : \"</span><span class=\"token punctuation\">,</span> ngx<span class=\"token punctuation\">.</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">get_body_data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;br/>\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "Java",
                "Java",
                "Nginx"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/io/Netty/",
            "url": "https://baiyezi.vip/java/io/Netty/",
            "title": "Netty",
            "date_published": "2021-08-16T13:15:10.000Z",
            "content_html": "<h2 id=\"nettyapiç®€å•ä½¿ç”¨\"><a class=\"anchor\" href=\"#nettyapiç®€å•ä½¿ç”¨\">#</a> NettyAPI ç®€å•ä½¿ç”¨</h2>\n<h3 id=\"å®¢æˆ·ç«¯å•ç‹¬æµ‹è¯•\"><a class=\"anchor\" href=\"#å®¢æˆ·ç«¯å•ç‹¬æµ‹è¯•\">#</a> å®¢æˆ·ç«¯å•ç‹¬æµ‹è¯•</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * å®¢æˆ·ç«¯</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     * 1ã€ä¸»åŠ¨å‘æ•°æ®</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * 2ã€ç­‰å¾…åˆ«äººå‘æ•°æ®ï¼Œéœ€è¦ä» selector è·å–ç›¸åº”çš„äº‹ä»¶ï¼Œæ‰èƒ½åˆ¤æ–­åˆ«äººæ˜¯å¦ç»™è‡ªå·±å‘é€æ•°æ®</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     * æœåŠ¡ç«¯å¼€å¯ [root@localhost local]# nc -l 192.168.20.105 9090</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">clientMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">NioEventLoopGroup</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// å®¢æˆ·ç«¯æ¨¡å¼</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">NioSocketChannel</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioSocketChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// å°†å®¢æˆ·ç«¯çš„ channelï¼ˆä¸­çš„äº‹ä»¶ï¼‰æ³¨å†Œåˆ° NioEventLoopGroup ä¸­çš„ selectorã€‚epoll_ctl</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        thread<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">//netty é€šè¿‡ pipeline æ¥å¤„ç† selector ä¸­çš„äº‹ä»¶ï¼ˆè¯»å†™ç­‰ï¼‰</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">ChannelPipeline</span> pipeline <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        pipeline<span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// è¿æ¥æœåŠ¡ç«¯</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">ChannelFuture</span> connect <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.20.105\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9090</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// ç­‰å¾…è¿æ¥æˆåŠŸåæ‰å¾€ä¸‹æ‰§è¡Œä»£ç </span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">ChannelFuture</span> sync <span class=\"token operator\">=</span> connect<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">ByteBuf</span> byteBuf <span class=\"token operator\">=</span> <span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">copiedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello server\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">ChannelFuture</span> channelFuture <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>byteBuf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// ç­‰å¾…æ¶ˆæ¯å‘é€æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        channelFuture<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">// ç­‰å¾…å…³é—­</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        sync<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">closeFuture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client over...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    \tå®¢æˆ·ç«¯äº‹ä»¶</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    */</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client registed...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelActive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client active...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelInactive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client inactive...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token comment\">//buf çš„ read ä¼šç§»åŠ¨ buf ä¸­çš„ç´¢å¼•æŒ‡é’ˆï¼ŒæŒ‡é’ˆèµ°è¿‡çš„æ•°æ®å°±ä¸å†å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token comment\">//            CharSequence charSequence = buf.readCharSequence(buf.readableBytes(), CharsetUtil.UTF_8);</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token class-name\">CharSequence</span> charSequence <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">getCharSequence</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">readableBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CharsetUtil</span><span class=\"token punctuation\">.</span>UTF_8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>charSequence<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            <span class=\"token comment\">// æ¥æ”¶åˆ°çš„å†å‘é€å›å»</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å…ˆå¼€å¯ä¸€ä¸ªæœåŠ¡ç«¯</p>\n<pre><code class=\"language-sh\">[root@localhost ~]# nc -l 192.168.20.105 9090\nhello server\n</code></pre>\n<p>æ§åˆ¶å°æ‰“å°</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210901142959046.png\" alt=\"image-20210901142959046\" /></p>\n<h3 id=\"æœåŠ¡ç«¯å•ç‹¬æµ‹è¯•\"><a class=\"anchor\" href=\"#æœåŠ¡ç«¯å•ç‹¬æµ‹è¯•\">#</a> æœåŠ¡ç«¯å•ç‹¬æµ‹è¯•</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * æœåŠ¡ç«¯</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     * @throws InterruptedException</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     */</span>\t</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">serverMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">NioEventLoopGroup</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">NioServerSocketChannel</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioServerSocketChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å°† server çš„ channel æ³¨å†Œåœ¨ NioEventLoopGroup çš„ selectorï¼Œæ­¤æ—¶ server å¤„äº listen çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        thread<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ChannelPipeline</span> pipeline <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// æ¥æ”¶å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”æ³¨å†Œåœ¨ selectorã€‚å“åº”å¼</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        pipeline<span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyAcceptHandler</span><span class=\"token punctuation\">(</span>thread<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">ChannelFuture</span> channelFuture <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.20.154\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9090</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// ç­‰å¾…ç«¯å£ç»‘å®šä»¥åŠ channel å…³é—­</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        channelFuture<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">closeFuture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"server closed...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     * æœåŠ¡ç«¯äº‹ä»¶</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyAcceptHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">EventLoopGroup</span> selector<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ChannelHandler</span> handler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token class-name\">MyAcceptHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EventLoopGroup</span> thread<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ChannelHandler</span> myHandler<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>selector <span class=\"token operator\">=</span> thread<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handler <span class=\"token operator\">=</span> myHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"server registed..\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token comment\">//server å¤„äº listen çŠ¶æ€æ—¶é¦–å…ˆ accept çš„æ˜¯å®¢æˆ·ç«¯çš„ channelï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ã€‚æ­¤å¤„ accept ç”± netty å†…éƒ¨å®Œæˆ</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token comment\">// 1ã€å°†æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯æ³¨å†Œåˆ°æœåŠ¡ç«¯çš„ selector</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            selector<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token comment\">// 2ã€æ·»åŠ å®¢æˆ·ä½†çš„å“åº”å¼çš„ handlerï¼Œå³å®¢æˆ·ç«¯çš„äº‹ä»¶å¤„ç†</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span>handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>     *  å®¢æˆ·ç«¯äº‹ä»¶</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>   <span class=\"token comment\">// @ChannelHandler.Sharable// ä»£è¡¨è¯¥äº‹ä»¶å¤„ç†å™¨å¯ä»¥è¢«å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥å…±äº«</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client registed...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelActive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client active...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelInactive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client inactive...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            <span class=\"token comment\">//buf çš„ read ä¼šç§»åŠ¨ buf ä¸­çš„ç´¢å¼•æŒ‡é’ˆï¼ŒæŒ‡é’ˆèµ°è¿‡çš„æ•°æ®å°±ä¸å†å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token comment\">//            CharSequence charSequence = buf.readCharSequence(buf.readableBytes(), CharsetUtil.UTF_8);</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            <span class=\"token class-name\">CharSequence</span> charSequence <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">getCharSequence</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">readableBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CharsetUtil</span><span class=\"token punctuation\">.</span>UTF_8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>charSequence<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>            <span class=\"token comment\">// æ¥æ”¶åˆ°çš„å†å‘é€å›å»</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¿æ¥ä»¥ä¸ŠæœåŠ¡ç«¯</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># nc 192.168.20.154 9090</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>svsvs</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>svsvs</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>gulgul</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>gulgul</pre></td></tr></table></figure><p>æ§åˆ¶å°æ‰“å°</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210901142735605.png\" alt=\"image-20210901142735605\" /></p>\n<p>æ­¤æ—¶æœåŠ¡ç«¯åªå…è®¸ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œå¦‚æœå¤šè¿æ¥ä¸€ä¸ªå®¢æˆ·ç«¯åˆ™æŠ¥é”™ï¼šå®¢æˆ·ç«¯çš„äº‹ä»¶å¤„ç†é»˜è®¤åªèƒ½è¢«ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ä½¿ç”¨ã€‚ä¸ºæ­¤å¯ä»¥åœ¨å®¢æˆ·ç«¯çš„å¤„ç†å™¨åŠ ä¸Šæ³¨è§£ @ChannelHandler.Sharable ï¼Œæ­¤æ—¶å¯ä»¥è§£å†³å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœå®¢æˆ·ç«¯å¤„ç†å™¨æœ‰å…¶ä»–è¦æ“ä½œçš„å±æ€§ï¼Œè¢«å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶ä½¿ç”¨æ—¶ä¸å®‰å…¨ï¼Œæ‰€ä»¥åŠ æ³¨è§£å¹¶ä¸èƒ½è§£å†³æ ¹æœ¬çš„é—®é¢˜ã€‚</p>\n<pre><code class=\"language-cmd\">[nioEventLoopGroup-2-1] WARN io.netty.channel.DefaultChannelPipeline - An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.\nio.netty.channel.ChannelPipelineException: com.fan.netty_1.MyNetty$MyHandler is not a @Sharable handler, so can't be added or removed multiple times.\n\tat io.netty.channel.DefaultChannelPipeline.checkMultiplicity(DefaultChannelPipeline.java:600)\n\tat io.netty.channel.DefaultChannelPipeline.addLast(DefaultChannelPipeline.java:202)\n\tat io.netty.channel.DefaultChannelPipeline.addLast(DefaultChannelPipeline.java:381)\n\tat io.netty.channel.DefaultChannelPipeline.addLast(DefaultChannelPipeline.java:370)\n\tat com.fan.netty_1.MyNetty$MyAcceptHandler.channelRead(MyNetty.java:165)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n\tat io.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:93)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.lang.Thread.run(Thread.java:748)\n</code></pre>\n<p>å¯ä»¥è€ƒè™‘å°†å®¢æˆ·ç«¯äº‹ä»¶å•ç‹¬æ‹å‡ºæ¥ï¼Œå³æœ‰å®¢æˆ·ç«¯è¿æ¥å°±ç›¸åº”çš„åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯äº‹ä»¶</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * æœåŠ¡ç«¯</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     * @throws InterruptedException</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">serverMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">NioEventLoopGroup</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">NioServerSocketChannel</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioServerSocketChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// å°† server çš„ channel æ³¨å†Œåœ¨ NioEventLoopGroup çš„ selectorï¼Œæ­¤æ—¶ server å¤„äº listen çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        thread<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">ChannelPipeline</span> pipeline <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// æ¥æ”¶å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”æ³¨å†Œåœ¨ selectorã€‚å“åº”å¼</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        pipeline<span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyAcceptHandler</span><span class=\"token punctuation\">(</span>thread<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">ChannelFuture</span> channelFuture <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.20.154\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9090</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// ç­‰å¾…ç«¯å£ç»‘å®šä»¥åŠ channel å…³é—­</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        channelFuture<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">closeFuture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"server closed...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     * æœåŠ¡ç«¯äº‹ä»¶</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyAcceptHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">EventLoopGroup</span> selector<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ChannelHandler</span> handler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token class-name\">MyAcceptHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">EventLoopGroup</span> thread<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ChannelHandler</span> myHandler<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>selector <span class=\"token operator\">=</span> thread<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handler <span class=\"token operator\">=</span> myHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"server registed..\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token comment\">//server å¤„äº listen çŠ¶æ€æ—¶é¦–å…ˆ accept çš„æ˜¯å®¢æˆ·ç«¯çš„ channelï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ã€‚æ­¤å¤„ accept ç”± netty å†…éƒ¨å®Œæˆ</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token comment\">// æ·»åŠ å®¢æˆ·ä½†çš„å“åº”å¼çš„ handlerï¼Œå³å®¢æˆ·ç«¯çš„äº‹ä»¶å¤„ç†</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span>handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token comment\">// å°†æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯æ³¨å†Œåˆ°æœåŠ¡ç«¯çš„ selector</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            selector<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>     * æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥è¿›æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯çš„äº‹ä»¶å¤„ç†å™¨ã€‚</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token annotation punctuation\">@ChannelHandler.Sharable</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChannelInit</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token class-name\">Channel</span> client <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            <span class=\"token class-name\">ChannelPipeline</span> pipeline <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            pipeline<span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token comment\">//pipeline ä¸­æ·»åŠ å®¢æˆ·ç«¯çš„äº‹ä»¶å¤„ç†å™¨ä¸”æ³¨å†Œåœ¨æœåŠ¡ç«¯çš„ selector åå°±ä¸å†éœ€è¦è¯¥äº‹ä»¶å¤„ç†å™¨ï¼Œå¯ä»¥ç›´æ¥ç§»é™¤ï¼Œå³åªè´Ÿè´£åˆ›å»ºäº‹ä»¶å¤„ç†å™¨ï¼Œb</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t<span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>     *  å®¢æˆ·ç«¯äº‹ä»¶</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client registed...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelActive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client active...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelInactive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client inactive...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>            <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>            <span class=\"token comment\">//buf çš„ read ä¼šç§»åŠ¨ buf ä¸­çš„ç´¢å¼•æŒ‡é’ˆï¼ŒæŒ‡é’ˆèµ°è¿‡çš„æ•°æ®å°±ä¸å†å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token comment\">//            CharSequence charSequence = buf.readCharSequence(buf.readableBytes(), CharsetUtil.UTF_8);</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>            <span class=\"token class-name\">CharSequence</span> charSequence <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">getCharSequence</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">readableBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CharsetUtil</span><span class=\"token punctuation\">.</span>UTF_8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>charSequence<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>            <span class=\"token comment\">// æ¥æ”¶åˆ°çš„å†å‘é€å›å»</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"nettyç®€å•ä½¿ç”¨\"><a class=\"anchor\" href=\"#nettyç®€å•ä½¿ç”¨\">#</a> Netty ç®€å•ä½¿ç”¨</h2>\n<h3 id=\"å®¢æˆ·ç«¯\"><a class=\"anchor\" href=\"#å®¢æˆ·ç«¯\">#</a> å®¢æˆ·ç«¯</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>netty_2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>netty_1<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyNetty</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>bootstrap<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bootstrap</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span>socket<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span>socket<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NioSocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CharsetUtil</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @Author fan</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> * @Date 2021-09-01 17:00</pre></td></tr><tr><td data-num=\"20\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NettyClient</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">nettyClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">NioEventLoopGroup</span> group <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">Bootstrap</span> bootstrap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">ChannelFuture</span> connect <span class=\"token operator\">=</span> bootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">group</span><span class=\"token punctuation\">(</span>group<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NioSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">//                .handler(new ChannelInit())</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">handler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInitializer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> ch<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        ch<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.20.105\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9090</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token class-name\">Channel</span> client <span class=\"token operator\">=</span> connect<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token class-name\">ByteBuf</span> byteBuf <span class=\"token operator\">=</span> <span class=\"token class-name\">Unpooled</span><span class=\"token punctuation\">.</span><span class=\"token function\">copiedBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello server\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token class-name\">ChannelFuture</span> channelFuture <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>byteBuf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token comment\">// ç­‰å¾…æ¶ˆæ¯å‘é€æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        channelFuture<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token comment\">// ç­‰å¾…å…³é—­</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">closeFuture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>     * æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥è¿›æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯çš„äº‹ä»¶å¤„ç†å™¨ã€‚</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token annotation punctuation\">@ChannelHandler.Sharable</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChannelInit</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token class-name\">Channel</span> client <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token class-name\">ChannelPipeline</span> pipeline <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            pipeline<span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token comment\">//pipeline ä¸­æ·»åŠ å®¢æˆ·ç«¯çš„äº‹ä»¶å¤„ç†å™¨åå°±ä¸å†è¢«éœ€è¦ï¼Œå¯ä»¥ç›´æ¥ç§»é™¤</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>     *  å®¢æˆ·ç«¯äº‹ä»¶</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client registed...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelActive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client active...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelInactive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client inactive...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>            <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>            <span class=\"token comment\">//buf çš„ read ä¼šç§»åŠ¨ buf ä¸­çš„ç´¢å¼•æŒ‡é’ˆï¼ŒæŒ‡é’ˆèµ°è¿‡çš„æ•°æ®å°±ä¸å†å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token comment\">//            CharSequence charSequence = buf.readCharSequence(buf.readableBytes(), CharsetUtil.UTF_8);</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>            <span class=\"token class-name\">CharSequence</span> charSequence <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">getCharSequence</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">readableBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CharsetUtil</span><span class=\"token punctuation\">.</span>UTF_8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>charSequence<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>            <span class=\"token comment\">// æ¥æ”¶åˆ°çš„å†å‘é€å›å»</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"æœåŠ¡ç«¯\"><a class=\"anchor\" href=\"#æœåŠ¡ç«¯\">#</a> æœåŠ¡ç«¯</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>netty_2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>bootstrap<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerBootstrap</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span>socket<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span>socket<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span>socket<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NioServerSocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span>socket<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NioSocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>netty<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CharsetUtil</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @Author fan</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> * @Date 2021-09-01 17:23</pre></td></tr><tr><td data-num=\"20\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NettyServer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">nettyServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">NioEventLoopGroup</span> group <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NioEventLoopGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">ServerBootstrap</span> serverBootstrap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerBootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">ChannelFuture</span> bind <span class=\"token operator\">=</span> serverBootstrap<span class=\"token punctuation\">.</span><span class=\"token function\">group</span><span class=\"token punctuation\">(</span>group<span class=\"token punctuation\">,</span> group<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NioServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">//                .childHandler(new ChannelInit())</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">childHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelInitializer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">NioSocketChannel</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initChannel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NioSocketChannel</span> ch<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        <span class=\"token class-name\">ChannelPipeline</span> pipeline <span class=\"token operator\">=</span> ch<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                        pipeline<span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.20.154\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9090</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        bind<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">closeFuture</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>     * æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥è¿›æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯çš„äº‹ä»¶å¤„ç†å™¨ã€‚</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token annotation punctuation\">@ChannelHandler.Sharable</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChannelInit</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token class-name\">Channel</span> client <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token class-name\">ChannelPipeline</span> pipeline <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            pipeline<span class=\"token punctuation\">.</span><span class=\"token function\">addLast</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>            <span class=\"token comment\">//pipeline ä¸­æ·»åŠ å®¢æˆ·ç«¯çš„äº‹ä»¶å¤„ç†å™¨åå°±ä¸å†è¢«éœ€è¦ï¼Œå¯ä»¥ç›´æ¥ç§»é™¤</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>     *  å®¢æˆ·ç«¯äº‹ä»¶</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ChannelInboundHandlerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRegistered</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client registed...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelActive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client active...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelInactive</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client inactive...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">channelRead</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ChannelHandlerContext</span> ctx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> msg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>            <span class=\"token class-name\">ByteBuf</span> buf <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuf</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            <span class=\"token comment\">//buf çš„ read ä¼šç§»åŠ¨ buf ä¸­çš„ç´¢å¼•æŒ‡é’ˆï¼ŒæŒ‡é’ˆèµ°è¿‡çš„æ•°æ®å°±ä¸å†å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token comment\">//            CharSequence charSequence = buf.readCharSequence(buf.readableBytes(), CharsetUtil.UTF_8);</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>            <span class=\"token class-name\">CharSequence</span> charSequence <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">getCharSequence</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> buf<span class=\"token punctuation\">.</span><span class=\"token function\">readableBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CharsetUtil</span><span class=\"token punctuation\">.</span>UTF_8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>charSequence<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>            <span class=\"token comment\">// æ¥æ”¶åˆ°çš„å†å‘é€å›å»</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">writeAndFlush</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"rpcå®ç°\"><a class=\"anchor\" href=\"#rpcå®ç°\">#</a> RPC å®ç°</h2>\n",
            "tags": [
                "Java",
                "Java",
                "NIO",
                "Netty"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka-%E6%90%AD%E5%BB%BA/",
            "url": "https://baiyezi.vip/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka-%E6%90%AD%E5%BB%BA/",
            "title": "Kafka-æ­å»º",
            "date_published": "2021-08-16T12:12:05.000Z",
            "content_html": "<h2 id=\"kafkaé›†ç¾¤æ­å»º\"><a class=\"anchor\" href=\"#kafkaé›†ç¾¤æ­å»º\">#</a> kafka é›†ç¾¤æ­å»º</h2>\n<h3 id=\"kafkaå®‰è£…\"><a class=\"anchor\" href=\"#kafkaå®‰è£…\">#</a> kafka å®‰è£…</h3>\n<p>1ã€å®‰è£… Zookeeper</p>\n<p>2ã€å®‰è£… kafka</p>\n<p>kafka é…ç½®</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827155941535.png\" alt=\"image-20210827155941535\" /></p>\n<p>å¯åŠ¨ kafka</p>\n<p><img data-src=\"%E6%90%AD%E5%BB%BA.assets/image-20210827162017476.png\" alt=\"image-20210827162017476\" /></p>\n<h3 id=\"åˆ›å»ºtopicä»¥åŠåˆ†åŒº\"><a class=\"anchor\" href=\"#åˆ›å»ºtopicä»¥åŠåˆ†åŒº\">#</a> åˆ›å»º topic ä»¥åŠåˆ†åŒº</h3>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827155654819.png\" alt=\"image-20210827155654819\" /></p>\n<p>--zookeeper èŠ‚ç‚¹ IP: ç«¯å£</p>\n<p>--topic åˆ†åŒºåå­—</p>\n<p>--partitions åˆ†åŒºä¸ªæ•°</p>\n<p>--replication-factor æ¯ä¸ªåˆ†åŒºå‰¯æœ¬æ•°</p>\n<p>æŸ¥çœ‹åˆ›å»ºçš„ topic</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827160300214.png\" alt=\"image-20210827160300214\" /></p>\n<p>æŸ¥çœ‹æŸä¸ª topic å…·ä½“çš„ä¿¡æ¯</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827161120903.png\" alt=\"image-20210827161120903\" /></p>\n<h3 id=\"consumerè®¢é˜…topic\"><a class=\"anchor\" href=\"#consumerè®¢é˜…topic\">#</a> consumer è®¢é˜… topic</h3>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827161900979.png\" alt=\"image-20210827161900979\" /></p>\n<p>--bootstrap-server è®¢é˜…çš„ kafka èŠ‚ç‚¹ (å³ broker èŠ‚ç‚¹)</p>\n<p>--group å®šä¹‰è¯¥ consumer æ‰€å±çš„ç»„</p>\n<p>åŒä¸€ä¸ªç»„çš„ consumer ä¼šè½®è¯¢æ¥æ”¶åˆ°æ¨é€æ¶ˆæ¯ã€‚å½“åªæœ‰ä¸€ä¸ª consumer æ—¶ä¼šæ¥æ”¶åˆ°æ‰€æœ‰åˆ†åŒºçš„æ¨é€æ¶ˆæ¯ï¼Œå½“æœ‰å¤šä¸ª consumer æ—¶ï¼Œæ¯ä¸ª consumer ä¸ä¼šæ¥æ”¶åˆ°åŒä¸€ä¸ªåˆ†åŒºçš„åŒä¸€æ¡æ¨é€æ¶ˆæ¯ã€‚</p>\n<h3 id=\"produceræ¨é€æ•°æ®åˆ°topic\"><a class=\"anchor\" href=\"#produceræ¨é€æ•°æ®åˆ°topic\">#</a> producer æ¨é€æ•°æ®åˆ° topic</h3>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827162925107.png\" alt=\"image-20210827162925107\" /></p>\n<p>--broker-list è¦æ¨é€åˆ°çš„ kafka èŠ‚ç‚¹</p>\n<p>--topic æ¨é€åˆ°æŒ‡å®šçš„ topic</p>\n<p>æ¨é€æ¶ˆæ¯ 12345678</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827165443085.png\" alt=\"image-20210827165443085\" /></p>\n<p>ç¬¬ä¸€ä¸ª consumer æ‹¿åˆ°äº† 1357</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827165545646.png\" alt=\"image-20210827165545646\" /></p>\n<p>ç¬¬äºŒä¸ª consumer æ‹¿åˆ°äº† 2468</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827165605614.png\" alt=\"image-20210827165605614\" /></p>\n<p>ä»ä»¥ä¸Šç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆæ¯æ¨é€ç»™åŒä¸€ç»„çš„æ¶ˆè´¹è€…æ—¶æ˜¯è½®è¯¢æ¨é€çš„</p>\n<h3 id=\"ç»„æ“ä½œ\"><a class=\"anchor\" href=\"#ç»„æ“ä½œ\">#</a> ç»„æ“ä½œ</h3>\n<p>æŸ¥çœ‹æŒ‡å®šèŠ‚ç‚¹çš„æ¶ˆè´¹è€…ç»„</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827170018141.png\" alt=\"image-20210827170018141\" /></p>\n<p>æŸ¥çœ‹æŒ‡å®šç»„çš„æ¶ˆè´¹è€…ä¿¡æ¯</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827170300545.png\" alt=\"image-20210827170300545\" /></p>\n<p>å…¶ä¸­ï¼Œoffset ç»´æŠ¤åœ¨äº† kafka é›†ç¾¤å†…éƒ¨ä¸­çš„ä¸€ä¸ª topicï¼Œå³_consumer_offsets</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827170701827.png\" alt=\"image-20210827170701827\" /></p>\n<p>ä¸€ä¸ª topic é»˜è®¤æœ‰ 50 ä¸ªåˆ†åŒºï¼Œ50 ä¸ªåˆ†åŒºåˆ†å¸ƒåœ¨æŒ‡å®šçš„ kafka èŠ‚ç‚¹ä¸­</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827171206181.png\" alt=\"image-20210827171206181\" /></p>\n<h2 id=\"æ¶ˆæ¯\"><a class=\"anchor\" href=\"#æ¶ˆæ¯\">#</a> æ¶ˆæ¯</h2>\n<p>å¦‚æœæ¶ˆæ¯ç§ç±»è¾ƒå¤šï¼Œä¸”æ¶ˆè´¹è€…éœ€è¦ä¸€ç±»æ¶ˆæ¯çš„æœ‰åºæ€§æ¶ˆè´¹æ—¶å°±éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</p>\n<p>æ¯”å¦‚ï¼Œæ¶ˆæ¯æ˜¯ (K,V) å‹çš„ï¼Œå¯ä»¥è®©ç›¸åŒçš„ key æ¨é€åˆ°åŒä¸€ä¸ªåˆ†åŒºé‡Œä¸” broker ä¼šä¿è¯æ¨é€çš„æ¶ˆæ¯çš„é¡ºåºï¼Œä½†ä¸€ä¸ªåˆ†åŒºé‡Œå¯èƒ½æœ‰ä¸åŒçš„ keyï¼Œä¸”ä¸åŒçš„ key æ˜¯äº¤å‰çš„ï¼Œè¿™å°±ä¼šä½¿å¾—ç›¸åŒçš„ key åœ¨ä¸€ä¸ªåˆ†åŒºé‡Œæ²¡æœ‰æ’åˆ—åœ¨ä¸€èµ·</p>\n",
            "tags": [
                "Java",
                "Java",
                "æ¶ˆæ¯ä¸­é—´ä»¶",
                "Kafka"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/io/%E7%BD%91%E7%BB%9CIO%E6%A8%A1%E5%9E%8B/",
            "url": "https://baiyezi.vip/java/io/%E7%BD%91%E7%BB%9CIO%E6%A8%A1%E5%9E%8B/",
            "title": "ç½‘ç»œIOæ¨¡å‹",
            "date_published": "2021-08-15T11:54:25.000Z",
            "content_html": "<h2 id=\"bio\"><a class=\"anchor\" href=\"#bio\">#</a> BIO</h2>\n<h3 id=\"tcpçš„ä¸€äº›å‚æ•°\"><a class=\"anchor\" href=\"#tcpçš„ä¸€äº›å‚æ•°\">#</a> TCP çš„ä¸€äº›å‚æ•°</h3>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">lsof</span> -p </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹è¿æ¥çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">netstat</span> -natp</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#æŠ“å–ç½‘ç»œé€šè®¯åŒ…</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tcpdump</pre></td></tr></table></figure><p>socket æœåŠ¡ç«¯ï¼ˆipï¼š192.168.137.131ï¼‰</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InputStream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Socket</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * BIO  å¤šçº¿ç¨‹çš„æ–¹å¼</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SocketIOPropertites</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">//server socket listen property:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> RECEIVE_BUFFER <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> SO_TIMEOUT <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> REUSE_ADDR <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> BACK_LOG <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">//client socket listen property on server endpoint:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// æ˜¯å¦æ˜¯é•¿è¿æ¥</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> CLI_KEEPALIVE <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> CLI_OOB <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> CLI_REC_BUF <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> CLI_REUSE_ADDR <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> CLI_SEND_BUF <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> CLI_LINGER <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> CLI_LINGER_N <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> CLI_TIMEOUT <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> CLI_NO_DELAY <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    StandardSocketOptions.TCP_NODELAY</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    StandardSocketOptions.SO_KEEPALIVE</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    StandardSocketOptions.SO_LINGER</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    StandardSocketOptions.SO_RCVBUF</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    StandardSocketOptions.SO_SNDBUF</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    StandardSocketOptions.SO_REUSEADDR</pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token class-name\">ServerSocket</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token number\">9090</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BACK_LOG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">setReceiveBufferSize</span><span class=\"token punctuation\">(</span>RECEIVE_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">setReuseAddress</span><span class=\"token punctuation\">(</span>REUSE_ADDR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">setSoTimeout</span><span class=\"token punctuation\">(</span>SO_TIMEOUT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"server up use 9090!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>               <span class=\"token comment\">// é˜»å¡ï¼Œç­‰å¾…è¾“å…¥ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å‘è¿‡æ¥çš„æ¶ˆæ¯ä¼šè¢«æ”¾å…¥å†…æ ¸çš„ç¼“å­˜ä¸­ï¼Œç›´åˆ°è¯¥æœåŠ¡ç«¯æ‰§è¡Œä»¥ä¸‹çš„ accept ()</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token comment\">// æ—¶ï¼Œæ­¤æ—¶å†…æ ¸ç¼“å­˜ä¸­çš„æ•°æ®ä¼šå‘é€ç»™æœåŠ¡ç«¯</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token class-name\">Socket</span> client <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// é˜»å¡çš„ï¼Œæ²¡æœ‰ -1  ä¸€ç›´å¡ç€ä¸åŠ¨  accept (4,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client port: \"</span> <span class=\"token operator\">+</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setKeepAlive</span><span class=\"token punctuation\">(</span>CLI_KEEPALIVE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setOOBInline</span><span class=\"token punctuation\">(</span>CLI_OOB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setReceiveBufferSize</span><span class=\"token punctuation\">(</span>CLI_REC_BUF<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setReuseAddress</span><span class=\"token punctuation\">(</span>CLI_REUSE_ADDR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setSendBufferSize</span><span class=\"token punctuation\">(</span>CLI_SEND_BUF<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setSoLinger</span><span class=\"token punctuation\">(</span>CLI_LINGER<span class=\"token punctuation\">,</span> CLI_LINGER_N<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setSoTimeout</span><span class=\"token punctuation\">(</span>CLI_TIMEOUT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setTcpNoDelay</span><span class=\"token punctuation\">(</span>CLI_NO_DELAY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                <span class=\"token comment\">//client.read   // é˜»å¡   æ²¡æœ‰  -1 0</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                        <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                                <span class=\"token class-name\">InputStream</span> in <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                                <span class=\"token class-name\">BufferedReader</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                                <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                                    <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> reader<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>                                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client read some data is :\"</span> <span class=\"token operator\">+</span> num <span class=\"token operator\">+</span> <span class=\"token string\">\" val :\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>                                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client readed nothing!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>                                        <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>                                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>                                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client readed -1...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>                                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>                                        client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>                                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>                                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>                            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>                server<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Socket å®¢æˆ·ç«¯ï¼ˆipï¼š192.168.137.128ï¼‰</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Socket</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SocketClient</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">// è¿æ¥æœåŠ¡ç«¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">Socket</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.137.131\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">9090</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">setSendBufferSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">setTcpNoDelay</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token class-name\">OutputStream</span> out <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> in <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token class-name\">BufferedReader</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token class-name\">String</span> line <span class=\"token operator\">=</span> reader<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>line <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bb <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">byte</span> b <span class=\"token operator\">:</span> bb<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                        out<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#å¯åŠ¨ Socket æœåŠ¡ç«¯</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost testsocket<span class=\"token punctuation\">]</span><span class=\"token comment\"># java SocketIOPropertites </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server up use <span class=\"token number\">9090</span><span class=\"token operator\">!</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -natp</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Active Internet connections <span class=\"token punctuation\">(</span>servers and established<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#å¯ä»¥çœ‹åˆ°ç«¯å£ 9090 å¤„äºç›‘å¬çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::9090                 :::*                    LISTEN      <span class=\"token number\">4626</span>/java           </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::111                  :::*                    LISTEN      <span class=\"token number\">1</span>/systemd</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># jps</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">4626</span> SocketIOPropertites</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">4645</span> Jps</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹ä»¥ä¸Š Socket æœåŠ¡ç«¯è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># lsof -p 4626</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>java    <span class=\"token number\">4626</span> root    7u  IPv6              <span class=\"token number\">71164</span>      0t0      TCP *:websm <span class=\"token punctuation\">(</span>LISTEN<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#ç›‘å¬æŒ‡å®šç½‘å¡çš„ç«¯å£</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># tcpdump -nn -i ens33 port 9090</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>tcpdump: verbose output suppressed, use -v or -vv <span class=\"token keyword\">for</span> full protocol decode</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>listening on ens33, link-type EN10MB <span class=\"token punctuation\">(</span>Ethernet<span class=\"token punctuation\">)</span>, capture size <span class=\"token number\">262144</span> bytes</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#å¯åŠ¨å®¢æˆ·ç«¯</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost testsocket<span class=\"token punctuation\">]</span><span class=\"token comment\"># java SocketClient</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -natp</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Active Internet connections <span class=\"token punctuation\">(</span>servers and established<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name     </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tcp6       <span class=\"token number\">1</span>      <span class=\"token number\">0</span> :::9090                 :::*                    LISTEN      <span class=\"token number\">4626</span>/java           </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::111                  :::*                    LISTEN      <span class=\"token number\">1</span>/systemd    <span class=\"token comment\">#æœåŠ¡ç«¯ 131 ä¸å®¢æˆ·ç«¯ 128 å»ºç«‹äº†è¿æ¥ï¼Œä½†å¹¶æ²¡æœ‰ pidï¼Œå› ä¸ºæœåŠ¡ç«¯åœ¨é˜»å¡ç­‰å¾…è¾“å…¥</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">192.168</span>.137.131:9090    <span class=\"token number\">192.168</span>.137.128:55058   ESTABLISHED -</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#æ•°æ®åŒ…æŸ¥çœ‹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># tcpdump -nn -i ens33 port 9090</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>tcpdump: verbose output suppressed, use -v or -vv <span class=\"token keyword\">for</span> full protocol decode</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>listening on ens33, link-type EN10MB <span class=\"token punctuation\">(</span>Ethernet<span class=\"token punctuation\">)</span>, capture size <span class=\"token number\">262144</span> bytes</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#å¯ä»¥çœ‹åˆ° 131 ä¸ 128 æœ‰ä¸‰æ¬¡æ¡æ‰‹</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">17</span>:48:07.627589 IP <span class=\"token number\">192.168</span>.137.128.55058 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.131.9090: Flags <span class=\"token punctuation\">[</span>S<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">377241970</span>, win <span class=\"token number\">29200</span>, options <span class=\"token punctuation\">[</span>mss <span class=\"token number\">1460</span>,sackOK,TS val <span class=\"token number\">202063491</span> ecr <span class=\"token number\">0</span>,nop,wscale <span class=\"token number\">7</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">17</span>:48:07.627992 IP <span class=\"token number\">192.168</span>.137.131.9090 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.128.55058: Flags <span class=\"token punctuation\">[</span>S.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">2901635676</span>, ack <span class=\"token number\">377241971</span>, win <span class=\"token number\">1152</span>, options <span class=\"token punctuation\">[</span>mss <span class=\"token number\">1460</span>,sackOK,TS val <span class=\"token number\">1965980806</span> ecr <span class=\"token number\">202063491</span>,nop,wscale <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">17</span>:48:07.628870 IP <span class=\"token number\">192.168</span>.137.128.55058 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.131.9090: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">1</span>, win <span class=\"token number\">229</span>, options <span class=\"token punctuation\">[</span>nop,nop,TS val <span class=\"token number\">202063493</span> ecr <span class=\"token number\">1965980806</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">0</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost testsocket<span class=\"token punctuation\">]</span><span class=\"token comment\"># java SocketClient </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1111</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#æœåŠ¡ç«¯åœ¨é˜»å¡ç­‰å¾…è¾“å…¥ï¼Œæ‰€ä»¥æ— æ³•æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost testsocket<span class=\"token punctuation\">]</span><span class=\"token comment\"># java SocketIOPropertites </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server up use <span class=\"token number\">9090</span><span class=\"token operator\">!</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># tcpdump -nn -i ens33 port 9090</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>tcpdump: verbose output suppressed, use -v or -vv <span class=\"token keyword\">for</span> full protocol decode</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>listening on ens33, link-type EN10MB <span class=\"token punctuation\">(</span>Ethernet<span class=\"token punctuation\">)</span>, capture size <span class=\"token number\">262144</span> bytes</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">17</span>:48:07.627589 IP <span class=\"token number\">192.168</span>.137.128.55058 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.131.9090: Flags <span class=\"token punctuation\">[</span>S<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">377241970</span>, win <span class=\"token number\">29200</span>, options <span class=\"token punctuation\">[</span>mss <span class=\"token number\">1460</span>,sackOK,TS val <span class=\"token number\">202063491</span> ecr <span class=\"token number\">0</span>,nop,wscale <span class=\"token number\">7</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">17</span>:48:07.627992 IP <span class=\"token number\">192.168</span>.137.131.9090 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.128.55058: Flags <span class=\"token punctuation\">[</span>S.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">2901635676</span>, ack <span class=\"token number\">377241971</span>, win <span class=\"token number\">1152</span>, options <span class=\"token punctuation\">[</span>mss <span class=\"token number\">1460</span>,sackOK,TS val <span class=\"token number\">1965980806</span> ecr <span class=\"token number\">202063491</span>,nop,wscale <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">17</span>:48:07.628870 IP <span class=\"token number\">192.168</span>.137.128.55058 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.131.9090: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">1</span>, win <span class=\"token number\">229</span>, options <span class=\"token punctuation\">[</span>nop,nop,TS val <span class=\"token number\">202063493</span> ecr <span class=\"token number\">1965980806</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#æœ‰æ•°æ®åŒ…</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">17</span>:51:00.374704 IP <span class=\"token number\">192.168</span>.137.128.55058 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.131.9090: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1</span>:2, ack <span class=\"token number\">1</span>, win <span class=\"token number\">229</span>, options <span class=\"token punctuation\">[</span>nop,nop,TS val <span class=\"token number\">202236239</span> ecr <span class=\"token number\">1965980806</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">17</span>:51:00.374760 IP <span class=\"token number\">192.168</span>.137.131.9090 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.128.55058: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">2</span>, win <span class=\"token number\">1151</span>, options <span class=\"token punctuation\">[</span>nop,nop,TS val <span class=\"token number\">1966153553</span> ecr <span class=\"token number\">202236239</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">17</span>:51:00.374830 IP <span class=\"token number\">192.168</span>.137.128.55058 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.131.9090: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">2</span>:3, ack <span class=\"token number\">1</span>, win <span class=\"token number\">229</span>, options <span class=\"token punctuation\">[</span>nop,nop,TS val <span class=\"token number\">202236239</span> ecr <span class=\"token number\">1965980806</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">17</span>:51:00.374875 IP <span class=\"token number\">192.168</span>.137.128.55058 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.131.9090: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">3</span>:4, ack <span class=\"token number\">1</span>, win <span class=\"token number\">229</span>, options <span class=\"token punctuation\">[</span>nop,nop,TS val <span class=\"token number\">202236239</span> ecr <span class=\"token number\">1965980806</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">17</span>:51:00.375174 IP <span class=\"token number\">192.168</span>.137.128.55058 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.131.9090: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">4</span>:5, ack <span class=\"token number\">1</span>, win <span class=\"token number\">229</span>, options <span class=\"token punctuation\">[</span>nop,nop,TS val <span class=\"token number\">202236239</span> ecr <span class=\"token number\">1966153553</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">17</span>:51:00.385449 IP <span class=\"token number\">192.168</span>.137.128.55058 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.131.9090: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">4</span>:5, ack <span class=\"token number\">1</span>, win <span class=\"token number\">229</span>, options <span class=\"token punctuation\">[</span>nop,nop,TS val <span class=\"token number\">202236246</span> ecr <span class=\"token number\">1966153553</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">17</span>:51:00.385932 IP <span class=\"token number\">192.168</span>.137.131.9090 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.137.128.55058: Flags <span class=\"token punctuation\">[</span>.<span class=\"token punctuation\">]</span>, ack <span class=\"token number\">5</span>, win <span class=\"token number\">1148</span>, options <span class=\"token punctuation\">[</span>nop,nop,TS val <span class=\"token number\">1966153564</span> ecr <span class=\"token number\">202236239</span>,nop,nop,sack <span class=\"token number\">1</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">4</span>:5<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span>, length <span class=\"token number\">0</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -natp</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Active Internet connections <span class=\"token punctuation\">(</span>servers and established<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tcp6       <span class=\"token number\">1</span>      <span class=\"token number\">0</span> :::9090                 :::*                    LISTEN      <span class=\"token number\">4626</span>/java           </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::111                  :::*                    LISTEN      <span class=\"token number\">1</span>/systemd    <span class=\"token comment\">#å¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯æ— æ³•æ¥æ”¶æ¶ˆæ¯æ—¶ï¼Œå†…æ ¸ä¼šç¼“å­˜å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œè¿™é‡Œä¸º 4 å­—èŠ‚ï¼ˆ1111ï¼‰</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tcp6       <span class=\"token number\">4</span>      <span class=\"token number\">0</span> <span class=\"token number\">192.168</span>.137.131:9090    <span class=\"token number\">192.168</span>.137.128:55058   ESTABLISHED -</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># jps</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">4626</span> SocketIOPropertites</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">4734</span> Jps</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># lsof -p 4626</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>COMMAND  PID <span class=\"token environment constant\">USER</span>   FD   TYPE             DEVICE SIZE/OFF     NODE NAME</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#ç”±äºæœåŠ¡ç«¯é˜»å¡ï¼Œæ‰€ä»¥æ–‡ä»¶æè¿°ç¬¦ä»ç„¶å¤„äºç›‘å¬çŠ¶æ€ï¼Œè€Œä¸æ˜¯å»ºç«‹è¿æ¥çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>java    <span class=\"token number\">4626</span> root    7u  IPv6              <span class=\"token number\">71164</span>      0t0      TCP *:websm <span class=\"token punctuation\">(</span>LISTEN<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#æœåŠ¡ç«¯å›è½¦ï¼Œç»“æŸé˜»å¡</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost testsocket<span class=\"token punctuation\">]</span><span class=\"token comment\"># java SocketIOPropertites </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server up use <span class=\"token number\">9090</span><span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#å›è½¦åï¼Œç«‹å³æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>client port: <span class=\"token number\">55058</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>client <span class=\"token builtin class-name\">read</span> some data is :4 val :1111</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -natp</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Active Internet connections <span class=\"token punctuation\">(</span>servers and established<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::9090                 :::*                    LISTEN      <span class=\"token number\">4626</span>/java           </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::111                  :::*                    LISTEN      <span class=\"token number\">1</span>/systemd   </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#æœåŠ¡ç«¯ç»“æŸé˜»å¡åï¼Œå†…æ ¸ç¼“å­˜çš„æ•°æ®å‘é€ç»™äº†æœåŠ¡ç«¯ï¼Œæ­¤æ—¶ä¸å®¢æˆ·ç«¯æ­£å¼å»ºç«‹ socket è¿æ¥</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">192.168</span>.137.131:9090    <span class=\"token number\">192.168</span>.137.128:55058   ESTABLISHED <span class=\"token number\">4626</span>/java</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># lsof -p 4626</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>COMMAND  PID <span class=\"token environment constant\">USER</span>   FD   TYPE             DEVICE SIZE/OFF     NODE NAME</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>java    <span class=\"token number\">4626</span> root    7u  IPv6              <span class=\"token number\">71164</span>      0t0      TCP *:websm <span class=\"token punctuation\">(</span>LISTEN<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>java    <span class=\"token number\">4626</span> root    8u  IPv6              <span class=\"token number\">72314</span>      0t0      TCP localhost.localdomain:websm-<span class=\"token operator\">></span><span class=\"token number\">192.168</span>.137.128:55058 <span class=\"token punctuation\">(</span>ESTABLISHED<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>ç»¼ä¸Šæ‰€è¿°ï¼ŒTCP æ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„ï¼ˆack ç¡®è®¤æœºåˆ¶ï¼‰ç½‘ç»œä¼ è¾“åè®®ã€‚ä¸‰æ¬¡æ¡æ‰‹ä¹‹åï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å‡åœ¨å†…æ ¸å¼€è¾Ÿèµ„æºåˆ†é…æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥èµ„æºå°±ä»£è¡¨è¿æ¥ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210428195054.png\" alt=\"image-20210428185837128\" /></p>\n<h3 id=\"socket\"><a class=\"anchor\" href=\"#socket\">#</a> Socket</h3>\n<p>socket æ˜¯ä¸€ä¸ªå”¯ä¸€çš„å››å…ƒç»„ï¼Œå³å®¢æˆ·ç«¯ IPã€å®¢æˆ·ç«¯ç«¯å£ã€æœåŠ¡ç«¯ IPã€æœåŠ¡ç«¯ç«¯å£ï¼Œæ¯ä¸€ä¸ªå››å…ƒç»„åœ¨å†…æ ¸ä¸­ä¼šåˆ†é…ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ FDã€‚socket æ˜¯å†…æ ¸çº§åˆ«çš„ï¼ŒTCP å»ºç«‹çš„è¿æ¥è¿‡ç¨‹ä¸­ä¼šåœ¨å†…æ ¸å¼€è¾Ÿèµ„æºï¼Œè¿™ä¸ªèµ„æºå°±åŒ…æ‹¬äº†å››å…ƒç»„ã€‚</p>\n<p>æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯åœ¨å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆå„è‡ªåœ¨å†…æ ¸ä¸­å¼€è¾Ÿèµ„æºåˆ†é…æ–‡ä»¶æè¿°ç¬¦ï¼Œéšåå¿«é€Ÿå®Œæˆä¸‰æ¬¡æ¡æ‰‹å»ºç«‹åŒæ–¹çš„è¿æ¥</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210505115111.png\" alt=\"image-20210505115108320\" /></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">strace</span> -ff -o out å‘½ä»¤ <span class=\"token comment\">#è·Ÿè¸ªå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#ä½¿ç”¨ netstat -natp æŸ¥çœ‹è¿æ¥çŠ¶æ€æ—¶ï¼Œå…¶ä¸­ LISTEN çš„çŠ¶æ€éœ€è¦åœ¨å†…æ ¸ä¸­å®Œæˆä»¥ä¸‹ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>socket <span class=\"token operator\">=</span> fd3</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>bind<span class=\"token punctuation\">(</span>fd3,port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>listen<span class=\"token punctuation\">(</span>fd3<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>accept<span class=\"token punctuation\">(</span>fd3,<span class=\"token punctuation\">)</span><span class=\"token comment\">#é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>recv<span class=\"token punctuation\">(</span>fd5<span class=\"token punctuation\">)</span><span class=\"token comment\">#é˜»å¡è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯</span></pre></td></tr></table></figure><h3 id=\"socketåº•å±‚è°ƒç”¨å‡½æ•°æŸ¥çœ‹\"><a class=\"anchor\" href=\"#socketåº•å±‚è°ƒç”¨å‡½æ•°æŸ¥çœ‹\">#</a> socket åº•å±‚è°ƒç”¨å‡½æ•°æŸ¥çœ‹</h3>\n<pre><code>man 2 socket #è¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚socket=fd3\n \t  bind #ç»‘å®šæ–‡ä»¶æè¿°ç¬¦ä»¥åŠç«¯å£ï¼Œbind(fd3, 8090)\n      listen #ç›‘å¬æè¿°ç¬¦ï¼Œlisten(fd3)ï¼Œæ­¤æ—¶ä½¿ç”¨ netstat -natp å¯ä»¥çœ‹åˆ°0.0.0.0:8090 0.0.0.0.* LISTEN\n\t  accept #é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼Œaccept(fd3,)ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯ä»¥æ–‡ä»¶æè¿°ç¬¦fd5æ¥è¿æ¥fd3ï¼Œä¸¤è€…é€šè¿‡æ–‡ä»¶æè¿°ç¬¦äº¤æ¢æ¶ˆæ¯\n\t  recv #é˜»å¡æ¥æ”¶å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚ä»æ–‡ä»¶æè¿°ç¬¦fd5æ¥æ¥æ”¶å®¢æˆ·ç«¯çš„æ¶ˆæ¯recv(fd5,)\n</code></pre>\n<p>ä½¿ç”¨å…‹éš†æ¥è§£å†³ä»¥ä¸Šçš„é˜»å¡ï¼Œå°† accept ä¸ recv åˆ†å¼€ï¼Œaccept å·¥ä½œåœ¨ä¸»çº¿ç¨‹ä¸”åªè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œrecv å·¥ä½œåœ¨å…‹éš†çº¿ç¨‹ä¸”åªè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦ accept äº†ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆå°±ä¼š clone å‡ºä¸€ä¸ªå¯¹åº”çš„å­çº¿ç¨‹å»æ¥æ”¶è¯¥å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œé˜²æ­¢ recv é˜»å¡è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯æ—¶å½±å“ accept æ¥æ”¶æ–°çš„å®¢æˆ·ç«¯è¿æ¥ã€‚ä½† clone çš„åŒæ—¶ä¹Ÿä¼šæ‹–æ…¢ä¸‹ä¸ªå®¢æˆ·ç«¯è¿æ¥çš„æ—¶é—´ï¼ˆåªæœ‰æœ¬æ¬¡ clone å®Œæˆåæ‰ä¼šå…è®¸ä¸‹ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥è¿›æ¥ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ BIO æ…¢çš„åŸå› ï¼ˆå³å†…æ ¸æœ¬èº«çš„åŸå› ï¼‰ï¼Œæ‰€ä»¥å¼•è¿›äº† NIOã€‚å¯ä»¥é€šè¿‡ socket çš„å‚æ•° SOCK_NONBLOCK æ¥è®¾ç½®ç›‘å¬æ–‡ä»¶æè¿°ç¬¦ä»¥åŠå®¢æˆ·ç«¯è¿æ¥æè¿°ç¬¦ä¸ºéé˜»å¡ã€‚</p>\n<h3 id=\"c10ké—®é¢˜\"><a class=\"anchor\" href=\"#c10ké—®é¢˜\">#</a> c10k é—®é¢˜</h3>\n<p>c10k é—®é¢˜ <span class=\"exturl\" data-url=\"aHR0cDovL2tlZ2VsLmNvbS9jMTBrLmh0bWw=\">http://kegel.com/c10k.html</span></p>\n<p>NIO çš„ä¼˜åŠ¿æ˜¯å¯ä»¥ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥è§£å†³ N ä¸ª IO çš„è¿æ¥ï¼Œä½†æ˜¯éšç€å®¢æˆ·ç«¯è¿æ¥æ•°é‡çš„å¢å¤šï¼ŒæœåŠ¡ç«¯å¾ªç¯æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯æ—¶ï¼ˆrecv (fd,)ï¼‰çš„å¤æ‚åº¦æé«˜ï¼Œä¸º O (n)ï¼Œè¿™å…¶ä¸­æœ‰å¤§é‡çš„æ— æ„ä¹‰çš„å¾ªåå»è¿›è¡Œç³»ç»Ÿè°ƒç”¨ recvï¼Œå³æ— æ„ä¹‰çš„å†…æ ¸æ€ä¸ç”¨æˆ·æ€ä¹‹é—´çš„åˆ‡æ¢ï¼Œé€ æˆèµ„æºçš„æµªè´¹ï¼Œè€Œå¤šè·¯å¤ç”¨å™¨å¯ä»¥è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>\n<p>å®¢æˆ·ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LinkedList</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">C10Kclient</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">></span></span> clients <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token class-name\">InetSocketAddress</span> serverAddr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.150.11\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9090</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// ç«¯å£å·çš„é—®é¢˜ï¼š65535</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">//  windows</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">65000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token class-name\">SocketChannel</span> client1 <span class=\"token operator\">=</span> <span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token class-name\">SocketChannel</span> client2 <span class=\"token operator\">=</span> <span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                linux ä¸­ä½ çœ‹åˆ°çš„è¿æ¥å°±æ˜¯ï¼š</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                client...port: 10508</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                client...port: 10508</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                 */</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                client1<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.150.1\"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token comment\">//  192.168.150.1ï¼š10000   192.168.150.11ï¼š9090</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                client1<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>serverAddr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                clients<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>client1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                client2<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.110.100\"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token comment\">//  192.168.110.100ï¼š10000  192.168.150.11ï¼š9090</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                client2<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>serverAddr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                clients<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>client2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"clients \"</span><span class=\"token operator\">+</span> clients<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InputStream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Socket</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SocketIOPropertites</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">//server socket listen property:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> RECEIVE_BUFFER <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> SO_TIMEOUT <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> REUSE_ADDR <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> BACK_LOG <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">//client socket listen property on server endpoint:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> CLI_KEEPALIVE <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> CLI_OOB <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> CLI_REC_BUF <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> CLI_REUSE_ADDR <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> CLI_SEND_BUF <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> CLI_LINGER <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> CLI_LINGER_N <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> CLI_TIMEOUT <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">boolean</span> CLI_NO_DELAY <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    StandardSocketOptions.TCP_NODELAY</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    StandardSocketOptions.SO_KEEPALIVE</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    StandardSocketOptions.SO_LINGER</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    StandardSocketOptions.SO_RCVBUF</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    StandardSocketOptions.SO_SNDBUF</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    StandardSocketOptions.SO_REUSEADDR</pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token class-name\">ServerSocket</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token number\">9090</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BACK_LOG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">setReceiveBufferSize</span><span class=\"token punctuation\">(</span>RECEIVE_BUFFER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">setReuseAddress</span><span class=\"token punctuation\">(</span>REUSE_ADDR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">setSoTimeout</span><span class=\"token punctuation\">(</span>SO_TIMEOUT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"server up use 9090!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token comment\">// System.in.read ();  // åˆ†æ°´å²­ï¼š</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token class-name\">Socket</span> client <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// é˜»å¡çš„ï¼Œæ²¡æœ‰ -1  ä¸€ç›´å¡ç€ä¸åŠ¨  accept (4,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client port: \"</span> <span class=\"token operator\">+</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setKeepAlive</span><span class=\"token punctuation\">(</span>CLI_KEEPALIVE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setOOBInline</span><span class=\"token punctuation\">(</span>CLI_OOB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setReceiveBufferSize</span><span class=\"token punctuation\">(</span>CLI_REC_BUF<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setReuseAddress</span><span class=\"token punctuation\">(</span>CLI_REUSE_ADDR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setSendBufferSize</span><span class=\"token punctuation\">(</span>CLI_SEND_BUF<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setSoLinger</span><span class=\"token punctuation\">(</span>CLI_LINGER<span class=\"token punctuation\">,</span> CLI_LINGER_N<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setSoTimeout</span><span class=\"token punctuation\">(</span>CLI_TIMEOUT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">setTcpNoDelay</span><span class=\"token punctuation\">(</span>CLI_NO_DELAY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token comment\">//BIO æ—¶éœ€è¦é¢å¤–çš„çº¿ç¨‹å»è¯»å†™å®¢æˆ·ç«¯</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                <span class=\"token comment\">//client.read   // é˜»å¡   æ²¡æœ‰  -1 0</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                        <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                                <span class=\"token class-name\">InputStream</span> in <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                                <span class=\"token class-name\">BufferedReader</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                                <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                                    <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> reader<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client read some data is :\"</span> <span class=\"token operator\">+</span> num <span class=\"token operator\">+</span> <span class=\"token string\">\" val :\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client readed nothing!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                                        <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>                                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client readed -1...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>                                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                                        client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>                                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>                                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>                            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>                                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>                server<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ 192.168.110.100ã€192.168.150.1 åŒæ—¶å»è¿æ¥æœåŠ¡ç«¯ 192.168.150.11ï¼Œå½“æœåŠ¡ç«¯ç»™ 192.168.110.100 å›å¤æ—¶æ— æ³•å»ºç«‹è¿æ¥ï¼Œå› ä¸ºå’ŒæœåŠ¡ç«¯çš„ç½‘å…³ä¸åŒï¼Œæ­¤æ—¶å¯ä»¥åœ¨æœåŠ¡ç«¯åŠ ä¸€æ¡è·¯ç”±è§„åˆ™ï¼Œä½¿å¾—å®¢æˆ·ç«¯ 192.168.110.100 çš„ç½‘å…³å’ŒæœåŠ¡ç«¯èƒ½å»ºç«‹è¿æ¥</p>\n<pre><code>route add -host 192.168.110.100 gw 192.168.150.1\nroute -n\n</code></pre>\n<h2 id=\"nio\"><a class=\"anchor\" href=\"#nio\">#</a> NIO</h2>\n<p>NIO ä¸­çš„ N åœ¨ JDK æŒ‡çš„æ˜¯ New IOï¼Œåœ¨ Linux æ“ä½œç³»ç»Ÿä¸­æŒ‡çš„æ˜¯ NONBLOCKINGï¼Œå³éé˜»å¡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StandardSocketOptions</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LinkedList</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SocketNIO</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">></span></span> clients <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">ServerSocketChannel</span> ss <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// æœåŠ¡ç«¯å¼€å¯ç›‘å¬ï¼šæ¥å—å®¢æˆ·ç«¯</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        ss<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span><span class=\"token number\">9090</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        ss<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// é‡ç‚¹ï¼Œå°†æœåŠ¡ç«¯è®¾ç½®ä¸ºéé˜»å¡ï¼Œå³ NIOï¼Œ  OS  NONBLOCKING!!!  // åªè®©æ¥å—å®¢æˆ·ç«¯  ä¸é˜»å¡ã€‚æ­¤å¤„è®¾ç½®çš„æ˜¯ listen é˜¶æ®µçš„ socket ä¸é˜»å¡ã€‚</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//        ss.setOption(StandardSocketOptions.TCP_NODELAY, false);</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//        StandardSocketOptions.TCP_NODELAY</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">//        StandardSocketOptions.SO_KEEPALIVE</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">//        StandardSocketOptions.SO_LINGER</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">//        StandardSocketOptions.SO_RCVBUF</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">//        StandardSocketOptions.SO_SNDBUF</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//        StandardSocketOptions.SO_REUSEADDR</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\">// æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> ss<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç”±äºä»¥ä¸Šè®¾ç½®äº† ss.configureBlocking (false)ï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">//accept  è°ƒç”¨å†…æ ¸äº†ï¼šæ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥è¿›æ¥ï¼Œè¿”å›å€¼ï¼Ÿåœ¨ BIO çš„æ—¶å€™ä¸€ç›´å¡ç€ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œä½†æ˜¯åœ¨ NIO ï¼Œä¸å¡ç€ï¼Œè¿”å› - 1ï¼ˆæ“ä½œç³»ç»Ÿå±‚é¢ï¼‰ï¼ŒNULLï¼ˆjava å±‚é¢ï¼‰</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæ¥å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œaccept è¿”å›çš„æ˜¯è¿™ä¸ªå®¢æˆ·ç«¯çš„ fdï¼ˆæ“ä½œç³»ç»Ÿå±‚é¢ï¼‰ï¼Œclient  objectï¼ˆjava å±‚é¢ï¼‰</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token comment\">//NONBLOCKING å°±æ˜¯ä»£ç èƒ½å¾€ä¸‹èµ°äº†ï¼Œåªä¸è¿‡æœ‰ä¸åŒçš„æƒ…å†µ</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>client <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>             <span class=\"token comment\">//   System.out.println(\"null.....\");</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token comment\">// ä¸º false æ—¶ï¼Œæ¥æ”¶å·²ç»è¿æ¥çš„å®¢æˆ·ç«¯çš„æ¶ˆæ¯ä¸ä¼šé˜»å¡ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥å‘é€æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// é‡ç‚¹ï¼Œå°†å®¢æˆ·ç«¯è®¾ç½®ä¸ºéé˜»å¡ï¼Œå³ NIOï¼Œ  socketï¼ˆæœåŠ¡ç«¯çš„ listen socket&lt; è¿æ¥è¯·æ±‚ä¸‰æ¬¡æ¡æ‰‹åï¼Œå¾€æˆ‘è¿™é‡Œæ‰”ï¼Œæˆ‘å»é€šè¿‡ accept å¾—åˆ°  è¿æ¥çš„ socket>ï¼Œè¿æ¥ socket&lt; è¿æ¥åçš„æ•°æ®è¯»å†™ä½¿ç”¨çš„ > ï¼‰ã€‚æ­¤å¤„æ˜¯å°†å·²ç»è¿æ¥çš„ socket è®¾ç½®ä¸ºä¸é˜»å¡ï¼Œä½¿å¾—è¯»å–æ¶ˆæ¯æ—¶ä¸é˜»å¡ã€‚</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token keyword\">int</span> port <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">socket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client..port: \"</span> <span class=\"token operator\">+</span> port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                clients<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocateDirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">4096</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// å¯ä»¥åœ¨å †é‡Œ   å †å¤–</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token comment\">// éå†å·²ç»é“¾æ¥è¿›æ¥çš„å®¢æˆ·ç«¯èƒ½ä¸èƒ½è¯»å†™æ•°æ®ï¼Ÿå¯ä»¥çš„</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token comment\">//BIO æ—¶ accept å®¢æˆ·ç«¯è¿æ¥åï¼Œéœ€è¦ç”¨å¦å¤–çš„çº¿ç¨‹å»æ¥æ”¶å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œç°åœ¨ NIO åªéœ€è¦ä¸€ä¸ªçº¿ç¨‹æ—¢å¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œåˆå¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯çš„æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span> c <span class=\"token operator\">:</span> clients<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>   <span class=\"token comment\">// ä¸²è¡ŒåŒ–ï¼ï¼ï¼ï¼  å¤šçº¿ç¨‹ï¼ï¼</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// >0  -1  0   // ä¸ä¼šé˜»å¡</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                    buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> aaa <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    buffer<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>aaa<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                    <span class=\"token class-name\">String</span> b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>aaa<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span><span class=\"token function\">socket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getPort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" : \"</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                    buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Š c10k çš„å®¢æˆ·ç«¯ä»£ç æ¥è¿æ¥è¯¥æœåŠ¡ç«¯ï¼Œå¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯çš„è¿æ¥æ•°é‡å–å†³äºæ¯ä¸ª cpu å†…æ ¸å¯æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼ˆæ¯”å¦‚å››æ ¸å…«è¿›ç¨‹å¯æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ä¸º 4x8x1024ï¼‰</p>\n<pre><code class=\"language-sh\">[root@localhost ~]# ulimit -a\ncore file size          (blocks, -c) unlimited\ndata seg size           (kbytes, -d) unlimited\nscheduling priority             (-e) 0\nfile size               (blocks, -f) unlimited\npending signals                 (-i) 10995\nmax locked memory       (kbytes, -l) 16384\nmax memory size         (kbytes, -m) unlimited\nopen files                      (-n) 1024 #å•ä¸ªå†…æ ¸ï¼ˆè¿›ç¨‹ï¼‰å¯æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼Œé»˜è®¤ä¸º1024\npipe size            (512 bytes, -p) 8\nPOSIX message queues     (bytes, -q) 819200\nreal-time priority              (-r) 0\nstack size              (kbytes, -s) 8192\ncpu time               (seconds, -t) unlimited\nmax user processes              (-u) 10995\nvirtual memory          (kbytes, -v) unlimited\nfile locks                      (-x) unlimited\n[root@localhost ~]# ulimit -SHn 500000 #è®¾ç½®å•ä¸ªå†…æ ¸å¯ä»¥æ‰“å¼€äº”åä¸‡æè¿°ç¬¦ï¼Œä½†å…¶å®æ— æ³•è¾¾åˆ°è¿™ä¹ˆå¤šï¼Œå—file-maxé™åˆ¶\n[root@localhost ~]# ulimit -n\n500000\n\n#å†…æ ¸çº§åˆ«çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼Œéšç€å†…å­˜çš„å¢å¤§è€Œå¢å¤§ï¼Œ1GBå¤§çº¦10ä¸‡æè¿°ç¬¦\n[root@localhost ~]# cat /proc/sys/fs/file-max\n279691\n\n</code></pre>\n<p>è™½ç„¶å•è¿›ç¨‹çš„é»˜è®¤æ–‡ä»¶æè¿°ç¬¦æ•°é‡ä¸º 1024ï¼Œä½†æ˜¯ root ç”¨æˆ·ä¼šçªç ´è¯¥é™åˆ¶ï¼Œæ™®é€šç”¨æˆ·åˆ™ä¸ä¼š</p>\n<h3 id=\"å•çº¿ç¨‹çš„å¤šè·¯å¤ç”¨å™¨\"><a class=\"anchor\" href=\"#å•çº¿ç¨‹çš„å¤šè·¯å¤ç”¨å™¨\">#</a> å•çº¿ç¨‹çš„å¤šè·¯å¤ç”¨å™¨</h3>\n<p>å¤šè·¯å¤ç”¨å™¨çš„åº•å±‚æ˜¯ epollï¼Œç›¸å¯¹äºåŸç”Ÿçš„ NIO æ¥è¯´æ€§èƒ½ä¼šæœ‰æ‰€æé«˜ï¼Œè€Œ Netty æ˜¯å¤šçº¿ç¨‹çš„å¤šè·¯å¤ç”¨å™¨ã€‚å¤šè·¯å¤ç”¨å™¨æ˜¯æŒ‡å¤šä¸ª IO è¿æ¥å¤ç”¨ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨æ¥ä¼ é€’ IO çŠ¶æ€ï¼ˆç„¶åç¨‹åºè‡ªå·±å¯¹æœ‰çŠ¶æ€çš„ IO è¿›è¡Œè¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šè·¯å¤ç”¨å™¨ä¼ é€’çš„æ˜¯å„ä¸ª IO è¿æ¥çš„çŠ¶æ€ï¼‰ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè¿æ¥å ç”¨ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„åˆ‡æ¢ã€‚è¿™æ ·ï¼Œå¯¹äºç¨‹åºæ¥è¯´ï¼ŒIO æ¨¡å‹å°±æ˜¯åŒæ­¥çš„ï¼ˆå³ IO è¿æ¥æ˜¯åŒæ­¥çš„ï¼Œä½†å¯¹ IO è¯»å–åˆ°çš„æ•°æ®çš„å¤„ç†å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼‰ã€‚ä¹‹å‰åœ¨ç¨‹åºä¸­éœ€è¦å¾ªç¯æŸ¥çœ‹æ˜¯å¦ç”±å®¢æˆ·ç«¯å‘é€ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼Œåˆ™ä¼šè¿”å›è¿æ¥çš„æ–‡ä»¶æè¿°ç¬¦ï¼‰ï¼Œç°åœ¨å˜ä¸ºäº†è®©å¤šè·¯å¤ç”¨å™¨å»è¯¢é—®è¿æ¥çš„çŠ¶æ€ï¼Œå³æ˜¯å¦å‡†å¤‡å¥½äº†æ–‡ä»¶æè¿°ç¬¦æ¥è¿›è¡Œè¯»å†™ã€‚</p>\n<p>åŒæ­¥ï¼šç¨‹åºè‡ªå·±çš„è¯»å†™</p>\n<p>å¼‚æ­¥ï¼šç”± kernel å®Œæˆå‘ buffer çš„è¯»å†™ï¼Œç¨‹åºè®¿é—® buffer è·å–æ•°æ®</p>\n<p>é˜»å¡ï¼šBLOCKING</p>\n<p>éé˜»å¡ï¼šNONBLOCKING</p>\n<p>åŒæ­¥é˜»å¡ï¼šç¨‹åºè‡ªå·±è¯»å–ï¼Œè°ƒç”¨äº†æ–¹æ³•ä¸€ç›´ç­‰å¾…æœ‰æ•ˆè¿”å›ç»“æœ</p>\n<p>åŒæ­¥éé˜»å¡ï¼šç¨‹åºè‡ªå·±è¯»å–ï¼Œè°ƒç”¨æ–¹æ³•ä¸€ç¬é—´ï¼Œç»™å‡ºæ˜¯å¦è¯»åˆ°ï¼ˆè‡ªå·±è¦è§£å†³ä¸‹ä¸€æ¬¡å•¥æ—¶å€™å†å»è¯»ï¼‰</p>\n<p>å¼‚æ­¥é˜»å¡ï¼š</p>\n<p>å¼‚æ­¥éé˜»å¡ï¼šæ— æ„ä¹‰</p>\n<p>å¤šè·¯å¤ç”¨å™¨å¯ä»¥æ˜¯ SELECTã€POLLã€EPOLLï¼Œéƒ½æ˜¯åŒæ­¥éé˜»å¡æ¨¡å‹ã€‚Linux ç›®å‰æ²¡æœ‰å†…æ ¸çº§çš„å¼‚æ­¥è§£å†³æ–¹æ³•ã€‚</p>\n<h3 id=\"selectpoll\"><a class=\"anchor\" href=\"#selectpoll\">#</a> SELECT/POLL</h3>\n<p>synchronous I/O multiplexing</p>\n<p>FD_SETSIZE æ–‡ä»¶æè¿°ç¬¦æ•°é‡æœ€å¤§ä¸º 1024ï¼Œè¿™ä¹Ÿæ˜¯ SELECT è¢«æ·˜æ±°çš„åŸå› ä¹‹ä¸€ï¼ŒPOLL å’Œ EPOLL æ²¡æœ‰é™åˆ¶</p>\n<pre><code>  int select(int nfds, fd_set *readfds, fd_set *writefds,\n                  fd_set *exceptfds, struct timeval *timeout);\n\n\nselect()  and pselect() allow a program to monitor multiple file descriptors, waiting until one or more of the file descriptors become &quot;ready&quot; for some class of I/O operation (e.g., input possible).  A file descriptor  is considered  ready  if it is possible to perform a corresponding I/O operation (e.g., read(2) without blocking,or a sufficiently small write(2)).\n       select() can monitor only file descriptors numbers that are less than FD_SETSIZE; poll(2) does not  have  this limitation.  See BUGS.\n\n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210816191011452.png\" alt=\"image-20210816191011452\" /></p>\n<p>æ— è®ºæ˜¯ NIO è¿˜æ˜¯ SELECTã€POLL éƒ½æ˜¯éå†æ‰€æœ‰çš„ IOï¼Œè¯¢é—®çŠ¶æ€ã€‚åªä¸è¿‡åœ¨ NIO ä¸­éå†çš„æˆæœ¬æ˜¯å†…æ ¸æ€ä¸ç”¨æˆ·æ€é—´çš„é¢‘ç¹åˆ‡æ¢ï¼Œè€Œåœ¨ SELECTã€POLL ä¸­ï¼Œéå†çš„è¿‡ç¨‹åªè§¦å‘äº†ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æˆ·æ€å†…æ ¸æ€åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼ŒæŠŠ fds ä¼ é€’ç»™å†…æ ¸ï¼Œå†…æ ¸é‡æ–°æ ¹æ®ç”¨æˆ·æœ¬æ¬¡è°ƒç”¨ä¼ è¿‡æ¥çš„ fds æ¥éå†ä¿®æ”¹çŠ¶æ€ã€‚ä¸€ä¸ª IO è¿æ¥å¯¹åº”ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p>\n<p>SELECTã€POLL çš„å¼Šç«¯ï¼š</p>\n<p>1ã€æ¯æ¬¡éƒ½è¦é‡æ–°ä¼ é€’ fds</p>\n<p>2ã€æ¯æ¬¡å†…æ ¸è¢«è°ƒç”¨åï¼Œè§¦å‘ä¸€ä¸ªéå† fds å…¨é‡çš„å¤æ‚åº¦</p>\n<h4 id=\"ç¨‹åºè°ƒç”¨å†…æ ¸è¿‡ç¨‹\"><a class=\"anchor\" href=\"#ç¨‹åºè°ƒç”¨å†…æ ¸è¿‡ç¨‹\">#</a> ç¨‹åºè°ƒç”¨å†…æ ¸è¿‡ç¨‹</h4>\n<p>è½¯ä¸­æ–­ï¼šå½“ç¨‹åºè°ƒç”¨å†…æ ¸æ—¶ï¼Œä¼šç”± CPU è§¦å‘ä¸€ä¸ªä¸­æ–­æŒ‡ä»¤ï¼Œç„¶åå»æŸ¥è¯¢ä¸­æ–­å‘é‡è¡¨è¿›è¡Œç›¸åº”çš„å›è°ƒ</p>\n<p>ç¡¬ä¸­æ–­ï¼šå¦‚æ—¶é’Ÿä¸­æ–­</p>\n<p>IO ä¸­æ–­ï¼šIO è®¾å¤‡ï¼ˆç½‘å¡ã€é”®ç›˜ã€é¼ æ ‡ç­‰ï¼‰</p>\n<p>å½“ä¸­æ–­æ¥äº†åï¼ˆå¯¹äºç¨‹åºæ¥è¯´ï¼ŒR/W å°±æ˜¯ä¸€æ¬¡ IO ä¸­æ–­ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘ epoll_waitï¼‰ä¼šæœ‰ç›¸åº”çš„å›è°ƒä»¥åŠäº‹ä»¶ï¼Œåœ¨ EPOLL ä¹‹å‰ï¼Œå›è°ƒåªæ˜¯å®Œæˆäº†å°†ç½‘å¡å‘æ¥çš„æ•°æ®ï¼Œèµ°å†…æ ¸ç½‘ç»œåè®®æ ˆæœ€ç»ˆå…³è”åˆ° FD çš„ bufferã€‚æ‰€ä»¥ï¼ŒæŸä¸€æ—¶é—´ç¨‹åºè¯¢é—®å†…æ ¸æŸäº› FD æ˜¯å¦å¯è¯»å†™æ—¶ä¼šæœ‰çŠ¶æ€è¿”å›ã€‚å¦‚æœï¼Œå†…æ ¸åœ¨å›è°ƒå¤„ç†ä¸­åŠ å…¥é¢å¤–çš„å¤„ç†ï¼ˆEPOLL åœ¨å†…æ ¸ä¸­å¼€è¾Ÿäº†çº¢é»‘æ ‘ç©ºé—´ä»¥åŠ listï¼Œçº¢é»‘æ ‘ç”¨æ¥å­˜å‚¨ FDï¼Œå¦‚æœ FD å¯è¯»å†™ï¼Œé‚£ä¹ˆå°±æ”¾åœ¨ list ä¸­ä¾›ç¨‹åºç›´æ¥è°ƒç”¨ï¼Œç¨‹åºä¸ç”¨å†éå†æ¯ä¸ª FD è¯¢é—®çŠ¶æ€ï¼‰ï¼Œé‚£ä¹ˆå°±æ˜¯ EPOLLã€‚</p>\n<h3 id=\"epoll\"><a class=\"anchor\" href=\"#epoll\">#</a> EPOLL</h3>\n<h4 id=\"epollç»„æˆ\"><a class=\"anchor\" href=\"#epollç»„æˆ\">#</a> EPOLL ç»„æˆ</h4>\n<pre><code class=\"language-sh\">[root@localhost ~]# man epoll\nNAME\n       epoll - I/O event notification facility\n\nSYNOPSIS\n       #include &lt;sys/epoll.h&gt;\n\nDESCRIPTION\n       The epoll API performs a similar task to poll(2): monitoring multiple file descriptors to see if I/O is possiâ€\n       ble on any of them.  The epoll API can be used either as an edge-triggered or a level-triggered interface  and\n       scales  well  to large numbers of watched file descriptors.  The following system calls are provided to create\n       and manage an epoll instance:\n\n       *  epoll_create(2) creates a new epoll instance and returns a file  descriptor  referring  to  that  instance.\n          (The more recent epoll_create1(2) extends the functionality of epoll_create(2).)\n\n       *  Interest  in  particular file descriptors is then registered via epoll_ctl(2).  The set of file descriptors\n          currently registered on an epoll instance is sometimes called an epoll set.\n\n       *  epoll_wait(2) waits for I/O events, blocking the calling thread if no events are currently available.\n\n</code></pre>\n<p><strong>epoll_create</strong></p>\n<p>å½“æœåŠ¡ç«¯ç¨‹åºè¿›è¡Œå®Œ listen åå°±è°ƒç”¨ epoll_createï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚epoll_create åœ¨å†…æ ¸ä¸­å¼€è¾Ÿäº†ç©ºé—´ï¼Œç”¨äºå­˜æ”¾çº¢é»‘æ ‘ï¼Œè€Œçº¢é»‘æ ‘å­˜æ”¾çš„å°±æ˜¯å®¢æˆ·ç«¯è¿æ¥çš„ FDã€‚è¯¥è¿‡ç¨‹åœ¨å»ºç«‹è¿æ¥æ—¶åªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚</p>\n<pre><code class=\"language-sh\">[root@localhost ~]# man 2 epoll_create\n\nNAME\n       epoll_create, epoll_create1 - open an epoll file descriptor\n\nSYNOPSIS\n       #include &lt;sys/epoll.h&gt;\n\n       int epoll_create(int size);\n       int epoll_create1(int flags);\n\nDESCRIPTION\n       epoll_create()  creates a new epoll(7) instance.  Since Linux 2.6.8, the size argument is ignored, but must be\n       greater than zero; see NOTES below.\n\n       epoll_create() returns a file descriptor referring to the new epoll instance.  This file  descriptor  is  used\n       for all the subsequent calls to the epoll interface.  When no longer required, the file descriptor returned by\n       epoll_create() should be closed by using close(2).  When all file descriptors referring to an  epoll  instance\n       have been closed, the kernel destroys the instance and releases the associated resources for reuse.\n\n   epoll_create1()\n       If  flags  is  0, then, other than the fact that the obsolete size argument is dropped, epoll_create1() is the\n       same as epoll_create().  The following value can be included in flags to obtain different behavior:\n\n       EPOLL_CLOEXEC\n              Set the close-on-exec (FD_CLOEXEC) flag on the  new  file  descriptor.   See  the  description  of  the\n              O_CLOEXEC flag in open(2) for reasons why this may be useful.\n\nRETURN VALUE\n       On  success,  these system calls return a nonnegative file descriptor.  On error, -1 is returned, and errno is\n       set to indicate the error.\n\n</code></pre>\n<p><strong>epoll_ctl</strong></p>\n<p>è¯¥è¿‡ç¨‹ä¼šè¢«é¢‘ç¹è°ƒç”¨ï¼Œç”¨æ¥åœ¨ epoll_create åˆ›å»ºçš„çº¢é»‘æ ‘ä¸­æ·»åŠ æˆ–ç§»é™¤ FDï¼Œæ­¤å¤–è¿˜ä¼šå‘ epoll æ³¨å†Œ fd çš„è¯»å†™ç­‰äº‹ä»¶</p>\n<pre><code class=\"language-sh\">[root@localhost ~]# man 2 epoll_ctl\n\nNAME\n       epoll_ctl - control interface for an epoll file descriptor\n\nSYNOPSIS\n       #include &lt;sys/epoll.h&gt;\n\t\t# å®¢æˆ·ç«¯fd æ“ä½œç±»å‹ï¼ˆaddã€modã€delï¼‰æœåŠ¡ç«¯fd äº‹ä»¶ï¼ˆè¯»å†™ï¼‰\n       int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event);\n\nDESCRIPTION\n       This system call performs control operations on the epoll(7) instance referred to by the file descriptor epfd.\n       It requests that the operation op be performed for the target file descriptor, fd.\n\n       Valid values for the op argument are:\n\n       EPOLL_CTL_ADD\n              Register the target file descriptor fd on the epoll instance referred to by the  file  descriptor  epfd\n              and associate the event event with the internal file linked to fd.\n\n       EPOLL_CTL_MOD\n              Change the event event associated with the target file descriptor fd.\n\n       EPOLL_CTL_DEL\n              Remove  (deregister)  the  target  file descriptor fd from the epoll instance referred to by epfd.  The\n              event is ignored and can be NULL (but see BUGS below).\n\n</code></pre>\n<p><strong>epoll_wait</strong></p>\n<p>å½“ä¸­æ–­å‘ç”Ÿæ—¶ï¼Œç½‘å¡å°†æ•°æ®å†™å…¥æœåŠ¡ç«¯ FD çš„ buffer ä¸­ï¼ŒåŒæ—¶è°ƒç”¨ epoll_wait ç”±å†…æ ¸ä¸­çš„çº¢é»‘æ ‘ç©ºé—´å‘å¦ä¸€ä¸ªå†…æ ¸ç©ºé—´ï¼ˆé“¾è¡¨ï¼‰ä¸­è¿ç§»å·²ç»å»ºç«‹è¿æ¥çš„æœåŠ¡ç«¯çš„ FDã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå®¢æˆ·ç«¯ä¸‹æ¬¡è¿æ¥æ—¶ç›´æ¥ä»é“¾è¡¨ä¸­è·å–æœåŠ¡ç«¯çš„ FDï¼Œè§„é¿äº† SELECT å¤šè·¯å¤ç”¨å™¨å¯¹ FD çš„å…¨é‡éå†ï¼ˆåŒ…æ‹¬å·²å»ºç«‹è¿æ¥å’Œæœªå»ºç«‹è¿æ¥çš„ FDï¼‰ã€‚epoll_wait è°ƒç”¨ä¹‹åï¼Œç¨‹åºä»ç„¶éœ€è¦è‡ªå·±è°ƒç”¨ acceptã€recv</p>\n<pre><code class=\"language-sh\">[root@localhost ~]# man 2 epoll_wait\nNAME\n       epoll_wait, epoll_pwait - wait for an I/O event on an epoll file descriptor\n\nSYNOPSIS\n       #include &lt;sys/epoll.h&gt;\n\n       int epoll_wait(int epfd, struct epoll_event *events,\n                      int maxevents, int timeout);\n       int epoll_pwait(int epfd, struct epoll_event *events,\n                      int maxevents, int timeout,\n                      const sigset_t *sigmask);\n\nDESCRIPTION\n       The  epoll_wait()  system  call  waits  for events on the epoll(7) instance referred to by the file descriptor\n       epfd.  The memory area pointed to by events will contain the events that will be available for the caller.  Up\n       to maxevents are returned by epoll_wait().  The maxevents argument must be greater than zero.\n\n       The  timeout  argument  specifies  the  number of milliseconds that epoll_wait() will block.  Time is measured\n       against the CLOCK_MONOTONIC clock.  The call will block until either:\n\n       *  a file descriptor delivers an event;\n\n       *  the call is interrupted by a signal handler; or\n\n       *  the timeout expires.\n\n       Note that the timeout interval will be rounded up to the  system  clock  granularity,  and  kernel  scheduling\n       delays  mean  that  the  blocking  interval  may overrun by a small amount.  Specifying a timeout of -1 causes\n       epoll_wait() to block indefinitely, while specifying a timeout equal to  zero  cause  epoll_wait()  to  return\n       immediately, even if no events are available.\n\n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210817173527782.png\" alt=\"image-20210817173527782\" /></p>\n<pre><code># ä¸€ä¸ªç”¨æˆ·å…è®¸çš„fdè¿æ¥æ•°\ncat proc/sys/epoll/max_user_watches\n</code></pre>\n<h3 id=\"javaå¯¹äºepollçš„æŠ½è±¡\"><a class=\"anchor\" href=\"#javaå¯¹äºepollçš„æŠ½è±¡\">#</a> Java å¯¹äº EPOLL çš„æŠ½è±¡</h3>\n<p>Java ä¸­å¯¹äº EPOLL çš„å®ç°æ˜¯ java.nio.channels.Selectorï¼Œä½†æ˜¯è¯¥å®ç°å¹¶æœªå®ç°åƒå¦‚ epoll_ctl ä¸­æ‰€æœ‰çš„äº‹ä»¶ï¼Œå› ä¸º Java è¦è€ƒè™‘åˆ°è·¨å¹³å°çš„ç§»æ¤æ€§é—®é¢˜ã€‚</p>\n<h4 id=\"å•çº¿ç¨‹\"><a class=\"anchor\" href=\"#å•çº¿ç¨‹\">#</a> å•çº¿ç¨‹</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Iterator</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Set</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SocketMultiplexingSingleThreadv1</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">ServerSocketChannel</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token comment\">//linux ä¸­çš„å¤šè·¯å¤ç”¨å™¨ï¼ˆselectã€pollã€epollï¼‰</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token keyword\">int</span> port <span class=\"token operator\">=</span> <span class=\"token number\">9090</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>     * æœåŠ¡ç«¯åˆå§‹åŒ–</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>       <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>           server <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>           <span class=\"token comment\">// éé˜»å¡ï¼ŒNIO</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>           server<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>           server<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>           <span class=\"token comment\">//selectã€pollã€epollï¼Œlinux ä¼˜å…ˆé€‰æ‹© epollï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•° - D æŒ‡å®š</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>           <span class=\"token comment\">// å¦‚æœæ˜¯åœ¨ epoll æ¨¡å‹ä¸‹ï¼Œæ­¤å¤„ç›¸å½“äº epoll_createï¼Œå¦‚ epoll_create (fd4</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>           selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>           <span class=\"token comment\">// æ­¤æ—¶ server å¤„äº listen (fd) çŠ¶æ€ï¼Œå°† server æ³¨å†Œåœ¨å¤šè·¯å¤ç”¨å™¨ï¼Œå¹¶ä½¿å¤šè·¯å¤ç”¨å™¨å¼€å¯ accept äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>           <span class=\"token comment\">// å¦‚æœæ˜¯ selectã€poll æ¨¡å‹ï¼Œåˆ™åœ¨ jvm é‡Œå¼€è¾Ÿä¸€ä¸ªæ•°ç»„ï¼Œå°†æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯çš„ fd æ”¾è¿›å»ï¼Œå¦‚ fd3</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>           <span class=\"token comment\">// å¦‚æœæ˜¯ epoll æ¨¡å‹ï¼Œç›¸å½“äº epoll_ctl (fd3,ADD,fd4,EPOLL_IN)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>           server<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span>OP_ACCEPT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>       <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>           e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>       <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>     * å¯åŠ¨æœåŠ¡</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>       <span class=\"token function\">initServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>       <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡å¯åŠ¨äº†...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>       <span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>           <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>               <span class=\"token comment\">//1ã€è°ƒç”¨å¤šè·¯å¤ç”¨å™¨</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>               <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> keys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>               <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"keys=\"</span> <span class=\"token operator\">+</span> keys<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>               <span class=\"token comment\">// å¦‚æœæ˜¯ selectã€poll æ¨¡å‹ï¼Œé‚£ä¹ˆ selector.select () è°ƒç”¨çš„æ˜¯å†…æ ¸çš„ select (fd) æˆ– poll (fd)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>               <span class=\"token comment\">// å¦‚æœæ˜¯ epoll æ¨¡å‹ï¼Œé‚£ä¹ˆ selector.select ()ï¼ˆå¦‚æœå¤§äº 0ï¼Œä»£è¡¨æœ‰ IO æ—¶é—´ï¼Œåˆ™è§¦å‘ IO ä¸­æ–­ï¼‰ä»£è¡¨è§¦å‘äº†ä¸­æ–­ï¼Œè°ƒç”¨çš„æ˜¯ epoll_waitï¼Œå¤§äº 0 ä»£è¡¨æœ‰å®¢æˆ·ç«¯ fd å›è°ƒäº†äº‹ä»¶ï¼Œå¦‚è¯»å†™äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>               <span class=\"token comment\">// æœ¬è´¨ä¸Šï¼Œæ˜¯æ³¨å†Œåœ¨å¤šè·¯å¤ç”¨å™¨çš„ fdï¼ˆå®¢æˆ·ç«¯ fdï¼‰è§¦å‘äº†å›è°ƒäº‹ä»¶ï¼Œå¦‚è¯»å†™äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>               <span class=\"token comment\">// å‚æ•°ï¼šè¶…æ—¶æ—¶é—´é»˜è®¤ 500msï¼Œå¦‚æœä¸º 0ï¼Œåˆ™ä»£è¡¨é˜»å¡ï¼›selector.wakeup () å”¤é†’é˜»å¡</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>               <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">//fd æ˜¯å¦æœ‰äº‹ä»¶è§¦å‘</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                   <span class=\"token comment\">// è¿”å›æœ‰çŠ¶æ€çš„ fd é›†åˆ</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                   <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> selectionKeys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                   <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> iterator <span class=\"token operator\">=</span> selectionKeys<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                   <span class=\"token comment\">// æ— è®ºæ˜¯å“ªç§å¤šè·¯å¤ç”¨å™¨ï¼Œè¿™é‡Œåªèƒ½è·å–åˆ° fd çš„çŠ¶æ€ï¼Œç¨‹åºéœ€è¦è‡ªå·±å¤„ç† fd çš„ R/W</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                   <span class=\"token comment\">//socket çš„çŠ¶æ€åˆ†ä¸ºä¸¤ç§ï¼šä¸€æ˜¯å¤„äº listen çŠ¶æ€ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼ˆacceptï¼‰ï¼ŒäºŒæ˜¯å¤„äº R/W çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                   <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                       <span class=\"token class-name\">SelectionKey</span> key <span class=\"token operator\">=</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                       <span class=\"token comment\">// å¤„ç†è¿‡çš„ fd åå°±ä»é›†åˆç§»é™¤ï¼Œé¿å…é‡å¤å¤„ç†ï¼ˆå¹¶ä¸æ˜¯ç§»é™¤å†…æ ¸ä¸­çš„ fdï¼‰</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                       iterator<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                       <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                           <span class=\"token comment\">// å¯ä»¥ accept ä¸€ä¸ªæ–°çš„ fd è¿æ¥ï¼Œé‚£ä¹ˆå¦‚ä½•å¤„ç†æ–°çš„ fd è¿æ¥å‘¢ï¼Ÿ</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                           <span class=\"token comment\">// å¯¹äº selectã€poll æ¨¡å‹ï¼Œç”±äºä»–ä»¬åœ¨å†…æ ¸ä¸­æ²¡æœ‰ç©ºé—´ï¼Œæ‰€ä»¥å°±å°†æ–°çš„ fd æ”¾åœ¨ listen æ—¶æœŸ jvm å¼€è¾Ÿçš„æ•°ç»„ä¸­</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                           <span class=\"token comment\">// å¯¹äº epoll æ¨¡å‹ï¼Œä¼šç”± epoll_ctl (fd3,ADD,fd4,EPOLL_IN) å°†æ–°çš„ fd æ³¨å†Œåœ¨å†…æ ¸å¼€è¾Ÿçš„çº¢é»‘æ ‘ç©ºé—´ä¸­</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                           <span class=\"token function\">acceptHandler</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                       <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                           <span class=\"token comment\">// å¤šä¸ª fd å¯è¯»æ—¶ï¼Œè¯¥æ–¹æ³•å¯èƒ½ä¼šé˜»å¡ï¼Œå¯¼è‡´æ— æ³•å¤„ç†æ–°çš„ fd è¿æ¥</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                           <span class=\"token comment\">// ä¸ºæ­¤ï¼Œæå‡ºäº† IO threads å»ä¸“æ³¨å¤„ç†è¯»å†™ï¼Œè€Œæ­¤å¤„åªè´Ÿè´£å°†å¯è¯»çš„ fd äº¤ç»™ IO threadsã€‚</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                           <span class=\"token comment\">// å°† IO å’Œå¤„ç†è§£è€¦ï¼Œæé«˜å¹¶å‘æ€§</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                           <span class=\"token function\">readWriteHandler</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                       <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>               <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>           <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>       <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>       <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>     * æ–°çš„å®¢æˆ·ç«¯è¿æ¥å¤„ç†</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>     * @param key</pre></td></tr><tr><td data-num=\"90\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">acceptHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>            <span class=\"token class-name\">ServerSocketChannel</span> ssc <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>            <span class=\"token comment\">//  æ¥æ”¶æ–°çš„ fd æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> ssc<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>            <span class=\"token comment\">//fd ç”¨æ¥åœ¨ channel ä¸­è¯»å†™çš„ buffer</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">8192</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>            <span class=\"token comment\">// å’ŒæœåŠ¡ç«¯ä¸€æ ·ï¼Œå®¢æˆ·ç«¯ä¹Ÿåªä¸å¤šè·¯å¤ç”¨å™¨æ‰“äº¤é“ï¼Œåœ¨å¤šè·¯å¤ç”¨å™¨ä¸­æ³¨å†Œè‡ªå·±çš„ fd çŠ¶æ€</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæ˜¯ selectã€poll æ¨¡å‹ï¼Œåˆ™åœ¨ jvm é‡Œå¼€è¾Ÿä¸€ä¸ªæ•°ç»„ï¼Œå°†æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯ç«¯çš„ fd æ”¾è¿›å»ï¼Œå¦‚ fd3</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>            <span class=\"token comment\">// å¦‚æœæ˜¯ epoll æ¨¡å‹ï¼Œç›¸å½“äº epoll_ctl (fd3,ADD,fd4,EPOLL_IN)</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>            <span class=\"token comment\">// åŒæ—¶æ³¨å†Œå†™äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span>OP_READ<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š\"</span> <span class=\"token operator\">+</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"115\"></td><td><pre>     * è¯»å†™å®¢æˆ·ç«¯</pre></td></tr><tr><td data-num=\"116\"></td><td><pre>     * @param key</pre></td></tr><tr><td data-num=\"117\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">readWriteHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>        <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>        <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">attachment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>        <span class=\"token keyword\">int</span> read <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>                <span class=\"token comment\">// è¯»</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>                read <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>read <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>                    <span class=\"token comment\">// åè½¬ï¼ŒæœåŠ¡ç«¯å°†å®¢æˆ·ç«¯å‘é€çš„å†…å®¹å†™å›å»ç»™å®¢æˆ·ç«¯</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>                    buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>                    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">hasRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>                        <span class=\"token comment\">// å†™</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>                        client<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>                    buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>read <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>                    <span class=\"token comment\">//-1 ä»£è¡¨å®¢æˆ·ç«¯è¿æ¥æ–­å¼€ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¦‚æœæ²¡æœ‰å“åº”å®¢æˆ·ç«¯çš„è¿æ¥æ–­å¼€ï¼Œé‚£ä¹ˆå››æ¬¡æŒ¥æ‰‹å°†ä¸å®Œå…¨</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>                    client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>        <span class=\"token class-name\">SocketMultiplexingSingleThreadv1</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SocketMultiplexingSingleThreadv1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>        service<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><pre><code class=\"language-sh\">#ä½¿ç”¨pollå¤šè·¯å¤ç”¨å™¨\n#æ¼”ç¤ºå®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œä¸”æœåŠ¡ç«¯ä¸åšå¤„ç†\n[root@localhost socket-test]# javac SocketMultiplexingSingleThreadv1.java &amp;&amp; strace -ff -o poll java -Djava.nio.channels.spi.SelectorProvider=sun.nio.ch.PollSelectorProvider SocketMultiplexingSingleThreadv1\n\n\n[root@localhost socket-test]# nc localhost 9090\nsgsfgsdg\nsgsfgsdg\n^C\n[root@localhost socket-test]# \n\n[root@localhost socket-test]# netstat -natp\n#ç”±äºç¼ºå°‘ä¸¤æ¬¡æ¡æ‰‹ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å¤„äºFIN_WAIT2 ï¼ŒæœåŠ¡ç«¯å¤„äºCLOSE_WAIT \nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name  \ntcp6       0      0 ::1:40288               ::1:9090                FIN_WAIT2   -                   \ntcp6       0      0 ::1:9090                ::1:40288               CLOSE_WAIT  3859/java \n\n\n\n#ä½¿ç”¨epollå¤šè·¯å¤ç”¨å™¨ï¼ˆé»˜è®¤ä½¿ç”¨epollï¼‰\n#å®¢æˆ·ç«¯æ–­å¼€ï¼ŒæœåŠ¡ç«¯ä¸»åŠ¨å¤„ç†\n[root@localhost socket-test]# javac SocketMultiplexingSingleThreadv1.java &amp;&amp; strace -ff -o epoll java SocketMultiplexingSingleThreadv1\n[root@localhost ~]# nc localhost 9090\nsggdg\n[root@localhost socket-test]# netstat -natp\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name \ntcp6       0      0 ::1:40292               ::1:9090                ESTABLISHED 5460/nc             \ntcp6       0      0 ::1:9090                ::1:40292               ESTABLISHED 5441/java  \n[root@localhost ~]# lsof -p 5441\nCOMMAND  PID USER   FD      TYPE             DEVICE SIZE/OFF     NODE NAME\njava    5441 root   10u     IPv6              82376      0t0      TCP localhost:websm-&gt;localhost:40294 (ESTABLISHED)\n\n#æ–­å¼€å®¢æˆ·ç«¯è¿æ¥\n[root@localhost ~]# nc localhost 9090\nsggdg^C\n[root@localhost ~]# \n[root@localhost socket-test]# netstat -natp\n#å®¢æˆ·ç«¯æ–­å¼€åï¼Œç”±äºæœåŠ¡ç«¯ç¨‹åºåšäº†ä¸»åŠ¨å…³é—­å¤„ç†ï¼ŒæœåŠ¡ç«¯å¤„äºCLOSEDç¬æ—¶çŠ¶æ€ååˆç»§ç»­å¤„äºLISTENçŠ¶æ€ã€‚å®¢æˆ·ç«¯å¤„äºTIME_WAIT çŠ¶æ€ï¼Œ2MSLåï¼Œå®¢æˆ·ç«¯å°†å½»åº•æ–­å¼€ã€‚åœ¨TIME_WAITæ²¡æœ‰ç»“æŸå‰ï¼Œå†…æ ¸ä¸­çš„socketå››å…ƒç»„èµ„æºä»ç„¶è¢«å ç”¨ï¼Œå…¶ä»–è¿æ¥æ— æ³•ä½¿ç”¨ç›¸åŒçš„å››å…ƒç»„èµ„æºï¼Œæ‰€ä»¥TIME_WAITä¼šæ¶ˆè€—å››å…ƒç»„è§„åˆ™ã€‚\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name \ntcp6       0      0 :::9090                 :::*                    LISTEN      5441/java                 \ntcp6       0      0 ::1:40292               ::1:9090                TIME_WAIT   - \n\n\n[root@localhost ~]# sysctl -a | grep reuse\nnet.ipv4.tcp_tw_reuse = 2 #å°†è¯¥å€¼è®¾ç½®ä¸º1å¯ä»¥å¿«é€Ÿé‡å¤ä½¿ç”¨å·²ç»æ–­å¼€è¿æ¥çš„å®¢æˆ·ç«¯ç«¯å£\n\n</code></pre>\n<p>ä»¥ä¸Šé€šè¿‡ strace è¿½è¸ªæ‰§è¡Œè¿‡ç¨‹çš„æ—¥å¿—ä¸­å¯ä»¥å¯¹åº”åˆ° java ä»£ç </p>\n<pre><code class=\"language-sh\">OS:POLLÂ  jdkÂ  ç”¨æˆ·ç©ºé—´ä¿å­˜äº†fd\nsocket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 4 #server = ServerSocketChannel.open();æœåŠ¡ç«¯socketè·å¾—æ–‡ä»¶æè¿°ç¬¦fd4\nfcntl(4, F_SETFL, O_RDWR|O_NONBLOCK)Â = 0Â  #server.configureBlocking(false);è®¾ç½®æœåŠ¡ç«¯acceptä¸ºéé˜»å¡\nbind(4, &#123;sa_family=AF_INET, sin_port=htons(9090) #å°†9090ç«¯å£ç»‘å®šåˆ°fd4\nlisten(4, 50)\npoll([&#123;fd=5, events=POLLIN&#125;, &#123;fd=4, events=POLLIN&#125;], 2, -1) = 1Â #server.register(selector, SelectionKey.OP_ACCEPT);æ­¤å¤„å‘ç”Ÿäº†ç³»ç»Ÿè°ƒç”¨pollï¼›å°†æœåŠ¡ç«¯çš„æ–‡ä»¶æè¿°ç¬¦fd4æ”¾åœ¨jvmå¼€è¾Ÿçš„æ•°ç»„ï¼ˆfd5ï¼‰ä¸­\naccept(4,Â  Â  = 7Â  #SocketChannel client = ssc.accept();æ¥æ”¶æ–°çš„å®¢æˆ·ç«¯fd7\nfcntl(7, F_SETFL, O_RDWR|O_NONBLOCK)Â #client.configureBlocking(false);è®¾ç½®æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯recvä¸ºéé˜»å¡\npoll([&#123;fd=5, events=POLLIN&#125;, &#123;fd=4, events=POLLIN&#125;, &#123;fd=7, events=POLLIN&#125;], 3, -1)Â  = 1 #client.register(selector, SelectionKey.OP_ACCEPT);å°†æ–°è¿æ¥çš„fdç»§ç»­æ”¾åœ¨jvmå¼€è¾Ÿçš„æ•°ç»„ä¸­\n#while (selector.select() &gt; 0);ä¹Ÿä¼šè§¦å‘ç³»ç»Ÿè°ƒç”¨pollï¼Œå› ä¸ºå…¶è§¦å‘äº†ç³»ç»Ÿè°ƒç”¨pollä¸­çš„äº‹ä»¶ï¼ˆè¯»å†™ã€æ·»åŠ ã€åˆ é™¤ï¼‰\n</code></pre>\n<pre><code class=\"language-sh\">OS:EPOLL å†…æ ¸å¼€è¾Ÿç©ºé—´ï¼Œä¿å­˜fd\nsocket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 4\nfcntl(4, F_SETFL, O_RDWR|O_NONBLOCK)Â Â Â Â = 0\nbind(4, &#123;sa_family=AF_INET, sin_port=htons(9090)\nlisten(4, 50)\n\nepoll_create(256) = 7 #selector = Selector.open();epollå¼€è¾Ÿå†…æ ¸ç©ºé—´ï¼Œå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ä¸ºfd7\nepoll_ctl(7, EPOLL_CTL_ADD, 4) #server.register(selector, SelectionKey.OP_ACCEPT);å°†æœåŠ¡ç«¯çš„æ–‡ä»¶æè¿°ç¬¦fd4æ·»åŠ åˆ°epollå¼€è¾Ÿçš„å†…æ ¸ç©ºé—´fd7\nepoll_wait(7, &#123;&#123;EPOLLIN, &#123;u32=4, u64=2216749036554158084&#125;&#125;&#125;, 4096, -1) = 1Â #Â while (selector.select() &gt; 0) \naccept(4Â  =8 #æ–°è¿æ¥çš„clientçš„fd8\nfcntl(8, F_SETFL, O_RDWR|O_NONBLOCK)#client.configureBlocking(false);è®¾ç½®æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯recvä¸ºéé˜»å¡\nepoll_ctl(7, EPOLL_CTL_ADD, 8, &#123;EPOLLIN, #client.register(selector, SelectionKey.OP_ACCEPT);å°†æ–°è¿æ¥çš„fd8æ·»åŠ åˆ°epollå¼€è¾Ÿçš„å†…æ ¸ç©ºé—´fd7\nepoll_wait(7, &#123;&#123;EPOLLIN,&#123;u32=8,u64=2302962838504734728&#125;&#125;&#125;,4096,-1)=1 # while (selector.select() &gt; 0);å®¢æˆ·ç«¯fd8æœ‰æ•°æ®è¿›æ¥ï¼ŒæœåŠ¡ç«¯äº§ç”Ÿä¸­æ–­å»è°ƒç”¨ç›¸åº”çš„readäº‹ä»¶è¯»å–æ•°æ®ï¼Œè¯»å–å®Œä¹‹åå†å›åˆ°ä¸­æ–­ç°åœºä»å†…æ ¸ç©ºé—´æ‹¿å‡ºä¸­æ–­æ—¶è¿ç§»ï¼ˆçº¢é»‘æ ‘-&gt;é“¾è¡¨ï¼‰çš„æœåŠ¡ç«¯çš„fdï¼Œç»§ç»­ç­‰åˆ°å®¢æˆ·ç«¯è¿æ¥\n</code></pre>\n<p>å•ç‹¬æ³¨å†Œå†™äº‹ä»¶</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Selector</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Iterator</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Set</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SocketMultiplexingSingleThreadv1_1</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ServerSocketChannel</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//linux å¤šè·¯å¤ç”¨å™¨ï¼ˆselect poll epollï¼‰</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">int</span> port <span class=\"token operator\">=</span> <span class=\"token number\">9090</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            server <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//  select  poll  *epoll</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span>OP_ACCEPT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token function\">initServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡å™¨å¯åŠ¨äº†ã€‚ã€‚ã€‚ã€‚ã€‚\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">//                Set&lt;SelectionKey> keys = selector.keys();</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">//                System.out.println(keys.size()+\"   size\");</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token comment\">// ç”±äºè¯»äº‹ä»¶æ—¶æ³¨å†Œäº†å†™äº‹ä»¶ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡å¾ªç¯è¿›æ¥æ—¶ä¼šå‘ç° selector ä¸­å†™äº‹ä»¶è¿”å›å¤§äº 0ï¼Œæ‰€ä»¥å¯ä»¥æ‰§è¡Œ writeHandler (key);</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                    <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> selectionKeys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                    <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> iter <span class=\"token operator\">=</span> selectionKeys<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>iter<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                        <span class=\"token class-name\">SelectionKey</span> key <span class=\"token operator\">=</span> iter<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                        iter<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                            <span class=\"token function\">acceptHandler</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                            <span class=\"token function\">readHandler</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// å¤„ç†äº† read äº‹ä»¶å¹¶æ³¨å†Œè¿™ä¸ª key çš„ write äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isWritable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                            <span class=\"token comment\">// å†™äº‹ä»¶ï¼Œsend-queue åªè¦æ˜¯ç©ºçš„ï¼ˆæœ‰ç©ºé—´ï¼‰ï¼Œå°±ä¸€å®šä¼šç»™ä½ è¿”å›å¯ä»¥å†™çš„äº‹ä»¶ï¼Œå°±ä¼šé‡å¤è°ƒèµ·ä»¥ä¸‹çš„ writeHandler (key);</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                            <span class=\"token comment\">// ä»€ä¹ˆæ—¶å€™å†™ï¼Ÿå¤šè·¯å¤ç”¨å™¨èƒ½ä¸èƒ½å†™æ˜¯å‚è€ƒ send-queue æœ‰æ²¡æœ‰ç©ºé—´</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                            <span class=\"token comment\">//1ï¼Œå‡†å¤‡å¥½è¦å†™ä»€ä¹ˆ</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                            <span class=\"token comment\">//2ï¼Œå…³å¿ƒ send-queue æ˜¯å¦æœ‰ç©ºé—´</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                            <span class=\"token comment\">//3ï¼Œæ‰€ä»¥ï¼Œè¯» read å®¢æˆ·ç«¯ä¸€å¼€å§‹å°±è¦æ³¨å†Œï¼Œä½†æ˜¯ write ä¾èµ–ä»¥ä¸Šå…³ç³»ï¼Œä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆæ—¶å€™æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                            <span class=\"token comment\">//4ï¼Œå¦‚æœä¸€å¼€å§‹å°±æ³¨å†Œäº† write çš„äº‹ä»¶ï¼Œè¿›å…¥æ­»å¾ªç¯ï¼Œä¸€ç›´è°ƒèµ·ï¼ï¼ï¼</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                            <span class=\"token function\">writeHandler</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>     * æœåŠ¡ç«¯å†™å¤„ç†</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>     * @param key</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">writeHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"write handler...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">attachment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">hasRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                    client<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>            key<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">acceptHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>            <span class=\"token class-name\">ServerSocketChannel</span> ssc <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> ssc<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">8192</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span>OP_READ<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------------------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ–°å®¢æˆ·ç«¯ï¼š\"</span> <span class=\"token operator\">+</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------------------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"113\"></td><td><pre>     * æœåŠ¡ç«¯è¯»å¤„ç†</pre></td></tr><tr><td data-num=\"114\"></td><td><pre>     * @param key</pre></td></tr><tr><td data-num=\"115\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">readHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"read handler.....\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">attachment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>            <span class=\"token keyword\">int</span> read <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>                    read <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>                    <span class=\"token comment\">// å¦‚æœå®¢æˆ·ç«¯å¯è¯»ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯æ‰æ³¨å†Œå†™äº‹ä»¶åˆ°å¤šè·¯å¤ç”¨å™¨</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>read <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>                        <span class=\"token comment\">// æ³¨å†Œå†™äº‹ä»¶ï¼Œå¯ä»¥åœ¨ while (selector.select () > 0) ä¸­è¯»åˆ°</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>                        <span class=\"token comment\">//OP_WRITE å…³å¿ƒ send-queue æ˜¯ä¸æ˜¯æœ‰ç©ºé—´ï¼Œåªè¦æœ‰ç©ºé—´å°±å¯ä»¥è§¦å‘ OP_WRITE å†™äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>                        client<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">selector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span>OP_WRITE<span class=\"token punctuation\">,</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>read <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>                        client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>        <span class=\"token class-name\">SocketMultiplexingSingleThreadv1_1</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SocketMultiplexingSingleThreadv1_1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>        service<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"å¤šçº¿ç¨‹\"><a class=\"anchor\" href=\"#å¤šçº¿ç¨‹\">#</a> å¤šçº¿ç¨‹</h4>\n<p>ä»¥ä¸Šå•çº¿ç¨‹å¯¹äºè¯»å†™çš„ fd æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªçº¿æ€§å¤„ç†çš„ï¼Œåªè¦æœ‰ä¸€ä¸ª fd å¤„ç†çš„è¾ƒæ…¢ï¼Œé‚£ä¹ˆå°±ä¼šå½±å“åˆ°å…¶ä»– fd çš„å¤„ç†ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥å°†è¯»å†™äº‹ä»¶å„è‡ªæ”¾åœ¨å•ç‹¬çš„çº¿ç¨‹å»å¤„ç†</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Selector</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Iterator</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Set</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SocketMultiplexingSingleThreadv2</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ServerSocketChannel</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//linux å¤šè·¯å¤ç”¨å™¨ï¼ˆselect poll epollï¼‰ nginx  event &#123;&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">int</span> port <span class=\"token operator\">=</span> <span class=\"token number\">9090</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            server <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//  select  poll  *epoll</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span>OP_ACCEPT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token function\">initServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡å™¨å¯åŠ¨äº†ã€‚ã€‚ã€‚ã€‚ã€‚\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">//                Set&lt;SelectionKey> keys = selector.keys();</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">//                System.out.println(keys.size()+\"   size\");</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token comment\">// æ³¨å†Œåœ¨å¤šè·¯å¤ç”¨å™¨çš„ fdï¼ˆå®¢æˆ·ç«¯ fdï¼‰è§¦å‘äº†å›è°ƒäº‹ä»¶ï¼Œå¦‚è¯»å†™äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                    <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> selectionKeys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                    <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> iter <span class=\"token operator\">=</span> selectionKeys<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>iter<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                        <span class=\"token class-name\">SelectionKey</span> key <span class=\"token operator\">=</span> iter<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                        iter<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                            <span class=\"token function\">acceptHandler</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                            key<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// å…ˆåœ¨å¤šè·¯å¤ç”¨å™¨é‡ŒæŠŠ key  cancel äº†ï¼ˆåœ¨å†…æ ¸ä¸­å°† fd å‰”é™¤ï¼Œè€Œåœ¨æ“ä½œç³»ç»Ÿä¸­ä»ç„¶å­˜åœ¨ï¼‰</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                            <span class=\"token function\">readHandler</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// æ²¡æœ‰æŠŠ key cancel ä¹‹å‰ï¼Œå³ä¾¿å·²æŠ›å‡ºäº†çº¿ç¨‹å»è¯»å–ï¼Œä½†æ˜¯åœ¨æ—¶å·®é‡Œï¼Œè¿™ä¸ª key çš„ read äº‹ä»¶ä¼šè¢«é‡å¤è§¦å‘</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isWritable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                            key<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// æ²¡æœ‰æŠŠ key cancel ä¹‹å‰ï¼Œå³ä¾¿ y æŠ›å‡ºäº†çº¿ç¨‹å»è¯»å–ï¼Œä½†æ˜¯åœ¨æ—¶å·®é‡Œï¼Œè¿™ä¸ª key çš„ write äº‹ä»¶ä¼šè¢«é‡å¤è§¦å‘</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                            <span class=\"token function\">writeHandler</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">writeHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"write handler...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">attachment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">hasRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                    client<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">shutdownOutput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">acceptHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>            <span class=\"token class-name\">ServerSocketChannel</span> ssc <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> ssc<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">8192</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span>OP_READ<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------------------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ–°å®¢æˆ·ç«¯ï¼š\"</span> <span class=\"token operator\">+</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------------------------------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">readHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"read handler.....\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>            <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">attachment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>            buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>            <span class=\"token keyword\">int</span> read <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                    read <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> read<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>read <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>                        client<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">selector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span>OP_WRITE<span class=\"token punctuation\">,</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>read <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>                        client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>        <span class=\"token class-name\">SocketMultiplexingSingleThreadv2</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SocketMultiplexingSingleThreadv2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>        service<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»¥ä¸Šç¨‹åºè™½ç„¶è¯»å†™çš„ fd ä¸å†é˜»å¡ï¼Œä½†æ˜¯é¢‘ç¹è°ƒç”¨ key.cancel () æ„å‘³ç€é¢‘ç¹è°ƒç”¨ epoll/poll çš„ DEL äº‹ä»¶ï¼ˆå¦‚æœæ˜¯ epollï¼Œåˆ™è°ƒç”¨ epoll (fd,DEL,fd)ï¼‰ï¼Œä¹Ÿå°±æ„å‘³ç€ç¨‹åºå’Œå†…æ ¸ä¹‹é—´é¢‘ç¹çš„è¿›è¡Œç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´çš„è½¬æ¢ï¼Œæ€§èƒ½ä¸æ˜¯å¾ˆé«˜ã€‚</p>\n<p>æ— è®ºæ˜¯ä»¥ä¸Šå•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹çš„ä»£ç ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸æ–­å»è½®è¯¢å¤šè·¯å¤ç”¨å™¨ä¸­çš„ fd æ˜¯å¦æœ‰å¯è¯»å¯å†™çš„çŠ¶æ€ï¼ˆè¯»ï¼šå†…æ ¸å¯ä»¥åˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦æœ‰æ¶ˆæ¯åˆ°è¾¾ï¼Œå¦‚æœæœ‰é‚£ä¹ˆå¯¹åº”çš„ fd å°±æ˜¯å¯è¯»çŠ¶æ€ï¼›å†™ï¼šåªè¦å†…æ ¸ä¸­çš„ send_queue é˜Ÿåˆ—ä¸ºç©ºå°±å¯ä»¥å¾€é‡Œå†™ï¼Œå³ fd æ˜¯å¯å†™çŠ¶æ€ï¼‰ï¼Œå¦‚æœæœ‰åˆ™è¿›ä¸€æ­¥å›è°ƒ fd çš„å›è°ƒäº‹ä»¶ï¼ˆè§¦å‘å›è°ƒäº‹ä»¶åå¯ä»¥è‡ªå®šä¹‰å¤„ç†è§¦å‘åçš„åŠ¨ä½œï¼Œå¦‚å¯¹è¯»å†™çš„å¤„ç†ï¼‰ï¼Œåªä¸è¿‡å¤šçº¿ç¨‹æ˜¯å¹¶è¡Œå»å¤„ç†å›è°ƒäº‹ä»¶è¢«è§¦å‘åçš„æ“ä½œï¼ˆå¦‚è¯»å†™æ“ä½œï¼‰ã€‚</p>\n<p>å½“æœ‰ N ä¸ª fd éœ€è¦ R/W å¤„ç†æ—¶ï¼Œå¯ä»¥å°† N ä¸ª fd åˆ†ç»„ï¼Œæ¯ä¸€ç»„ fd ä½¿ç”¨ä¸€ä¸ª selectorï¼Œä¸”ä¸€ä¸ª selector å•ç‹¬å ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ selector ä¸ªæ•°å–å†³äºçº¿ç¨‹ä¸ªæ•°ï¼ˆæœ€ä½³çº¿ç¨‹ä¸ªæ•°æ˜¯ cpu æ ¸æ•°æˆ– cpu æ ¸æ•° * 2ï¼‰ã€‚è¿™æ ·æ¯ä¸ª selector ä¸­çš„ fd æ˜¯çº¿æ€§å¤„ç†çš„ï¼Œè€Œå¤šä¸ª selector æ˜¯å¹¶è¡Œå¤„ç†çš„ï¼Œæ‰€ä»¥æ€»ä½“ä¸Š fd æ˜¯è¢«å¹¶è¡Œå¤„ç†çš„ï¼Œæ­¤æ—¶å°±ä¸éœ€è¦å†é¢‘ç¹è°ƒç”¨ key.cancel () æ¥æ¸…ç†å†…æ ¸ä¸­çš„ fdï¼Œé¿å…äº†å†…æ ¸æ€ä¸ç”¨æˆ·æ€ä¹‹é—´çš„é¢‘ç¹åˆ‡æ¢ï¼Œå¤§å¤§çš„æé«˜äº†æ€§èƒ½ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å•ç‹¬æ‹¿å‡ºå…¶ä¸­çš„ä¸€ä¸ª selector ä¸“é—¨è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„ acceptï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„ fd åˆ†é…ç»™å…¶ä»–çš„ selectorï¼Œä»¥ä¸Šåšæ³•é‡‡ç”¨äº†åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ã€‚</p>\n<p><strong>ä»£ç å®ç°</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>reactor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Author fan</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Date 2021-08-23 10:39</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainThread</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// ä¸å‚ä¸ IO å’Œä¸šåŠ¡</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">//1ã€åˆ›å»º IO Thread (ä¸€ä¸ªæˆ–å¤šä¸ª)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">//server çº¿ç¨‹ç»„</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">SelectorThreadGroup</span> boss <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SelectorThreadGroup</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">//client çº¿ç¨‹ç»„</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">SelectorThreadGroup</span> worker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SelectorThreadGroup</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// æ··æ‚æ¨¡å¼ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ—¢è´Ÿè´£ acceptï¼Œåˆè´Ÿè´£ R/W</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">//        SelectorThreadGroup stg = new SelectorThreadGroup(3);</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// ä½¿å¾— server çº¿ç¨‹ç»„ boss æŒæœ‰ client çº¿ç¨‹ç»„ worker çš„å¼•ç”¨</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        boss<span class=\"token punctuation\">.</span><span class=\"token function\">setWorker</span><span class=\"token punctuation\">(</span>worker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">//2ã€å°†ç›‘å¬çš„ server æ³¨å†Œåˆ°æŸä¸€ä¸ª selectorï¼Œä»¥ä¾¿å’Œå®¢æˆ·ç«¯äº¤äº’</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">//boss ä¸­é€‰ä¸€ä¸ªçº¿ç¨‹æ³¨å†Œ listen åï¼Œè¿™ä¸ªè¢«é€‰ä¸­çš„çº¿ç¨‹éœ€è¦æŒæœ‰ worker çš„å¼•ç”¨ï¼Œå› ä¸ºè¯¥çº¿ç¨‹ä¸€æ—¦ accept å¾—åˆ°</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">//client åï¼Œéœ€è¦å» worker ä¸­è·å–ä¸€ä¸ªçº¿ç¨‹åˆ†é…ç»™ client</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        boss<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        boss<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token number\">8888</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        boss<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token number\">7777</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        boss<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token number\">6666</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>reactor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>atomic<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @Author fan</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @Date 2021-08-23 11:27</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SelectorThreadGroup</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token class-name\">SelectorThread</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> sts<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token class-name\">ServerSocketChannel</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token class-name\">AtomicInteger</span> xid <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token class-name\">SelectorThreadGroup</span> stg <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setWorker</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectorThreadGroup</span> stg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stg <span class=\"token operator\">=</span> stg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token class-name\">SelectorThreadGroup</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> threadNum<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        sts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SelectorThread</span><span class=\"token punctuation\">[</span>threadNum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> threadNum<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            sts<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SelectorThread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>sts<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> port<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            server <span class=\"token operator\">=</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            server<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InetSocketAddress</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// å°† server æ³¨å†Œåˆ°å“ªä¸ª selectorï¼Ÿ</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token function\">nextSelectorV3</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">nextSelector</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Channel</span> c<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token class-name\">SelectorThread</span> st <span class=\"token operator\">=</span> <span class=\"token function\">getSelectorThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token comment\">// 1ã€é€šè¿‡é˜Ÿåˆ—ä¼ é€’æ•°æ® æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        st<span class=\"token punctuation\">.</span>lbq<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token comment\">// 2ã€æ‰“æ–­ SelectorThread ä¸­çš„ selector.select () é˜»å¡ï¼Œè®©å¯¹åº”çš„çº¿ç¨‹åœ¨å”¤é†’ selector åå–å‡ºé˜Ÿåˆ—ä¸­çš„ server æˆ– client å®Œæˆåœ¨ selector ä¸­çš„æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        st<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token function\">wakeup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">//        //c å¯èƒ½æ˜¯ server æˆ– client</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token comment\">//        ServerSocketChannel s = (ServerSocketChannel) c;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\">//        try &#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token comment\">//            // ç”±äº SelectorThread ä¸­çš„ selector.select (); æ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥ä»¥ä¸‹çš„ register ä¸­çš„ selector æ˜¯é˜»å¡çš„ï¼Œå¯ä»¥ä½¿ç”¨ wakeup å”¤é†’é˜»å¡</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">//            s.register(st.selector, SelectionKey.OP_ACCEPT);</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">//            st.selector.wakeup();</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">//        &#125; catch (ClosedChannelException e) &#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token comment\">//            e.printStackTrace();</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token comment\">//        &#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">nextSelectorV3</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Channel</span> c<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token comment\">// å°† server æ³¨å†Œåœ¨å½“å‰çº¿ç¨‹ç»„ (boss çº¿ç¨‹ç»„) ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ä¸­</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token class-name\">SelectorThread</span> st <span class=\"token operator\">=</span> <span class=\"token function\">getSelectorThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                <span class=\"token comment\">// 1ã€é€šè¿‡é˜Ÿåˆ—ä¼ é€’æ•°æ® æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                st<span class=\"token punctuation\">.</span>lbq<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token comment\">//server çº¿ç¨‹å¼€å¯åï¼Œ æ›´æ–°è¯¥çº¿ç¨‹çš„çº¿ç¨‹ç»„</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                st<span class=\"token punctuation\">.</span><span class=\"token function\">setWorker</span><span class=\"token punctuation\">(</span>stg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                <span class=\"token comment\">// 2ã€æ‰“æ–­ SelectorThread ä¸­çš„ selector.select () é˜»å¡ï¼Œè®©å¯¹åº”çš„çº¿ç¨‹åœ¨å”¤é†’ selector åå–å‡ºé˜Ÿåˆ—ä¸­çš„ server æˆ– client å®Œæˆåœ¨ selector ä¸­çš„æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                st<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token function\">wakeup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                <span class=\"token comment\">// å°† client æ³¨å†Œåœ¨ worker çº¿ç¨‹ç»„ä¸­çš„çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                <span class=\"token class-name\">SelectorThread</span> st <span class=\"token operator\">=</span> <span class=\"token function\">getSelectorThreadV3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                <span class=\"token comment\">// 1ã€é€šè¿‡é˜Ÿåˆ—ä¼ é€’æ•°æ® æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                st<span class=\"token punctuation\">.</span>lbq<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                <span class=\"token comment\">// 2ã€æ‰“æ–­ SelectorThread ä¸­çš„ selector.select () é˜»å¡ï¼Œè®©å¯¹åº”çš„çº¿ç¨‹åœ¨å”¤é†’ selector åå–å‡ºé˜Ÿåˆ—ä¸­çš„ server æˆ– client å®Œæˆåœ¨ selector ä¸­çš„æ³¨å†Œ</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                st<span class=\"token punctuation\">.</span>selector<span class=\"token punctuation\">.</span><span class=\"token function\">wakeup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>    <span class=\"token comment\">//server ã€client éƒ½éœ€è¦é€‰æ‹©ä¸€ä¸ª selector</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SelectorThread</span> <span class=\"token function\">getSelectorThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>        <span class=\"token comment\">// å–å‡ºä¸€ä¸ª selectorï¼Œæ¯æ¬¡æ–°çš„ serverã€client æ¥éƒ½ä¼šè½®è¯¢åˆ†é…åˆ°ä¸åŒçš„ selector</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>        <span class=\"token keyword\">int</span> index <span class=\"token operator\">=</span> xid<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> sts<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>        <span class=\"token keyword\">return</span> sts<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>    <span class=\"token comment\">//worker çº¿ç¨‹ç»„ä¸­çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SelectorThread</span> <span class=\"token function\">getSelectorThreadV3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>        <span class=\"token comment\">// å–å‡ºä¸€ä¸ª selectorï¼Œæ¯æ¬¡æ–°çš„ serverã€client æ¥éƒ½ä¼šè½®è¯¢åˆ†é…åˆ°ä¸åŒçš„ selector</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>        <span class=\"token keyword\">int</span> index <span class=\"token operator\">=</span> xid<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> stg<span class=\"token punctuation\">.</span>sts<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>        <span class=\"token keyword\">return</span> stg<span class=\"token punctuation\">.</span>sts<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>reactor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Iterator</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Set</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LinkedBlockingDeque</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LinkedBlockingQueue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Author fan</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @Date 2021-08-23 10:40</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SelectorThread</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ThreadLocal</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LinkedBlockingQueue</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// æ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ª selector</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// æ¯ä¸ªå®¢æˆ·ç«¯åªç»‘å®šåˆ°å…¶ä¸­ä¸€ä¸ª selector</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token class-name\">Selector</span> selector <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">//    LinkedBlockingQueue&lt;Channel> lbq = new LinkedBlockingQueue&lt;>();</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token class-name\">LinkedBlockingQueue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Channel</span><span class=\"token punctuation\">></span></span> lbq <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token class-name\">SelectorThreadGroup</span> stg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">LinkedBlockingQueue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Channel</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">initialValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedBlockingQueue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token class-name\">SelectorThread</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectorThreadGroup</span> stg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stg <span class=\"token operator\">=</span> stg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            selector <span class=\"token operator\">=</span> <span class=\"token class-name\">Selector</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token comment\">// 1ã€select ();select æ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æ–‡ä»¶æè¿°ç¬¦æ³¨å†Œåœ¨å¤šè·¯å¤ç”¨å™¨</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\">//                System.out.println(Thread.currentThread().getName() + \" : before select...\" + selector.keys().size());</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token keyword\">int</span> select <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">//                Thread.sleep (1000); // éæ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">//                System.out.println(Thread.currentThread().getName() + \" : after select...\" + selector.keys().size());</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token comment\">// 2ã€å¤„ç† selectkeys ();</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>select <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    <span class=\"token comment\">// æœ‰äº‹ä»¶</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> keys <span class=\"token operator\">=</span> selector<span class=\"token punctuation\">.</span><span class=\"token function\">selectedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                    <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">></span></span> iter <span class=\"token operator\">=</span> keys<span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>iter<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                        <span class=\"token class-name\">SelectionKey</span> key <span class=\"token operator\">=</span> iter<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                        iter<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isAcceptable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                            <span class=\"token comment\">// æ¥æ”¶å®¢æˆ·ç«¯ï¼Œè¦æ³¨å†Œåœ¨å“ªé‡Œï¼Ÿå¦‚ä½•æ³¨å†Œï¼Ÿ</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                            <span class=\"token function\">acceptHandler</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isReadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                            <span class=\"token function\">readHandler</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">isWritable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token comment\">//3ã€å¤„ç†ä¸€äº› task</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>lbq<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                    <span class=\"token comment\">// é˜Ÿåˆ—æ˜¯å †é‡Œçš„å¯¹è±¡ï¼Œå †æ˜¯å…±äº«çš„ï¼Œåªæœ‰æ–¹æ³•çš„é€»è¾‘ã€æœ¬åœ°å˜é‡æ˜¯çº¿ç¨‹éš”ç¦»çš„ï¼Œçº¿ç¨‹çš„æ ˆæ˜¯ç‹¬ç«‹çš„</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                    <span class=\"token class-name\">Channel</span> c <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                        c <span class=\"token operator\">=</span> lbq<span class=\"token punctuation\">.</span><span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queue\"</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" : \"</span> <span class=\"token operator\">+</span> c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                        e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                        <span class=\"token class-name\">ServerSocketChannel</span> server <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">)</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                        server<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span>OP_ACCEPT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" register listen\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                        <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                        <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocateDirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">4096</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                        <span class=\"token comment\">// å°† client æ³¨å†Œåˆ° selectorï¼Œå¹¶å°† buffer ç»‘å®šåˆ° selector</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                        client<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">,</span> <span class=\"token class-name\">SelectionKey</span><span class=\"token punctuation\">.</span>OP_READ<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>                        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" register client \"</span> <span class=\"token operator\">+</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">readHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" : readHandler...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>        <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">attachment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>        <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>                <span class=\"token keyword\">int</span> read <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>read <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>                    <span class=\"token comment\">// å°†è¯»åˆ°çš„å†…å®¹ç¿»è½¬ï¼Œç„¶åç›´æ¥å†™å‡º</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>                    buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>                    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">hasRemaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>                        client<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>                    buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>read <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>read <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                    <span class=\"token comment\">// å®¢æˆ·ç«¯æ–­å¼€äº†</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"clientï¼š\"</span> <span class=\"token operator\">+</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" closed...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>                    <span class=\"token comment\">// ä»å¤šè·¯å¤ç”¨å™¨ä¸­å°† fd ç§»é™¤</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>                    key<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">acceptHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectionKey</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" : acceptHandler...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>        <span class=\"token class-name\">ServerSocketChannel</span> server <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerSocketChannel</span><span class=\"token punctuation\">)</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>            <span class=\"token class-name\">SocketChannel</span> client <span class=\"token operator\">=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">configureBlocking</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>            <span class=\"token comment\">// å°†è¿æ¥çš„å®¢æˆ·ç«¯æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸­å»å¤„ç†</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre><span class=\"token comment\">//            stg.nextSelector(client);</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>            stg<span class=\"token punctuation\">.</span><span class=\"token function\">nextSelectorV3</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setWorker</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SelectorThreadGroup</span> stgWorker<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stg <span class=\"token operator\">=</span> stgWorker<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹\"><a class=\"anchor\" href=\"#ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹\">#</a> ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</h3>\n<p>ä»¥ä¸Šçš„çŠ¶æ€æ˜¯å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ä¸­çš„çŠ¶æ€ï¼š</p>\n<p>1ã€å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ FIN æƒ³è¦æ–­å¼€è¿æ¥ï¼Œå®¢æˆ·ç«¯å¤„äº FIN WAIT1 çŠ¶æ€ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¤„äº CLOSE_WAIT1 çŠ¶æ€</p>\n<p>2ã€æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å›å¤ç¬¬ä¸€æ¡æ¶ˆæ¯ FIN_ACKï¼Œè¯·ç¨ç­‰ï¼ˆæœåŠ¡ç«¯è¦ç¡®è®¤æŠŠä¸šåŠ¡æ•°æ®å…¨éƒ¨ä¼ å®Œç»™å®¢æˆ·ç«¯ï¼‰ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº FIN WAIT2</p>\n<p>3ã€æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å›å¤ç¬¬äºŒæ¡æ¶ˆæ¯ FINï¼ŒæœåŠ¡ç«¯å·²åšå¥½æ–­å¼€å‡†å¤‡ï¼ˆç¡®ä¿ä¸šåŠ¡æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼‰ï¼ŒæœåŠ¡ç«¯å¤„äº LAST_ACK çŠ¶æ€</p>\n<p>4ã€å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å›å¤æ¶ˆæ¯ ACKï¼Œå®¢æˆ·ç«¯è¿›å…¥ TIME_WAIT çŠ¶æ€ï¼Œç­‰å¾… 2MSLï¼ˆæŠ¥æ–‡æ´»åŠ¨æ—¶é•¿çš„ 2 å€ï¼Œä¸€èˆ¬ä¸º 30sï¼‰ï¼Œç¡®ä¿ ACK åˆ°è¾¾æœåŠ¡ç«¯ï¼Œå¦‚æœåœ¨ 2MSL åï¼ŒæœåŠ¡ç«¯æ²¡æœ‰å“åº”ï¼Œé‚£ä¹ˆå°±è¯æ˜æœåŠ¡ç«¯æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ ACKï¼Œä¸”æœåŠ¡ç«¯å…³é—­äº†ï¼ŒæœåŠ¡ç«¯è¿›å…¥ç¬æ—¶çŠ¶æ€ CLOSED ååˆç»§ç»­å¤„äº LISTEN çŠ¶æ€ã€‚å¦‚æœ 2MSL å†…ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ ACKï¼Œé‚£ä¹ˆæœåŠ¡ç«¯ä¼šå†æ¬¡å‘é€ FIN ç»™å®¢æˆ·ç«¯ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯æœåŠ¡ç«¯å·²åšå¥½æ–­å¼€å‡†å¤‡ã€‚</p>\n<p>æ­¤å¤–ï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘èµ·æ–­å¼€è¯·æ±‚ï¼Œé‚£ä¹ˆåœ¨å››æ¬¡æŒ¥æ‰‹çš„æœ€åä¸€æ­¥ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šè¿›å…¥ 2MSL çš„ç­‰å¾…çŠ¶æ€ï¼Œç¡®ä¿å®¢æˆ·ç«¯æ”¶åˆ°è‡ªå·±çš„æ¶ˆæ¯åæ‰å¯ä»¥æœ€ç»ˆå…³é—­è¿æ¥ã€‚</p>\n<p>ä»¥ä¸‹æ¦‚å¿µå‚è€ƒè‡ª <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYmotbXItbGkvcC8xMTEwNjM5MC5odG1s\">https://www.cnblogs.com/bj-mr-li/p/11106390.html</span></p>\n<table>\n<thead>\n<tr>\n<th>æ ‡å¿—ä½</th>\n<th>å…¨æ‹¼å†™</th>\n<th>é‡Šä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>SYN</td>\n<td>synchronous</td>\n<td>è¯·æ±‚å»ºç«‹è¿æ¥</td>\n</tr>\n<tr>\n<td>ACK</td>\n<td>acknowledgement</td>\n<td>åˆ¤å®šç¡®è®¤å· ack æ˜¯å¦æœ‰æ•ˆï¼ŒACK=1 æ—¶æœ‰æ•ˆ</td>\n</tr>\n<tr>\n<td>FIN</td>\n<td>finish</td>\n<td>FIN=1 æ—¶è¡¨ç¤ºå‘é€æ–¹æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œè¯·æ±‚æ–­å¼€è¿æ¥</td>\n</tr>\n<tr>\n<td>PSH</td>\n<td>push</td>\n<td>æç¤ºæ¥æ”¶æ–¹ç«‹å³ä»ç¼“å†²åŒºæŠŠæ•°æ®è¯»èµ°</td>\n</tr>\n<tr>\n<td>RST</td>\n<td>reset</td>\n<td>å¯¹æ–¹è¦æ±‚é‡æ–°å»ºç«‹è¿æ¥</td>\n</tr>\n<tr>\n<td>URG</td>\n<td>urgent</td>\n<td>ç´§æ€¥æŒ‡é’ˆã€‚URG=1 æ—¶ï¼Œè¡¨ç¤ºæ•°æ®è¦è¢«ä¼˜å…ˆå¤„ç†</td>\n</tr>\n</tbody>\n</table>\n<p>æ ‡å¿—ä½çš„å€¼ä¸º 1 æˆ–ä¸º 0ï¼Œackã€seq è¡¨ç¤ºæ•°æ®çš„åºå·ï¼Œä¸” ack=seq+1ã€‚</p>\n<p>åºåˆ—å· seqï¼šå  4 ä¸ªå­—èŠ‚ï¼Œç”¨æ¥æ ‡è®°æ•°æ®æ®µçš„é¡ºåºï¼ŒTCP æŠŠè¿æ¥ä¸­å‘é€çš„æ‰€æœ‰æ•°æ®å­—èŠ‚éƒ½ç¼–ä¸Šä¸€ä¸ªåºå·ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ç”±æœ¬åœ°éšæœºäº§ç”Ÿï¼›ç»™å­—èŠ‚ç¼–ä¸Šåºå·åï¼Œå°±ç»™æ¯ä¸€ä¸ªæŠ¥æ–‡æ®µæŒ‡æ´¾ä¸€ä¸ªåºå·ï¼›åºåˆ—å· seq å°±æ˜¯è¿™ä¸ªæŠ¥æ–‡æ®µä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ç¼–å·ã€‚</p>\n<p>ç¡®è®¤å· ackï¼šå  4 ä¸ªå­—èŠ‚ï¼ŒæœŸå¾…æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„åºå·ï¼›åºåˆ—å·è¡¨ç¤ºæŠ¥æ–‡æ®µæºå¸¦æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ï¼›è€Œç¡®è®¤å·æŒ‡çš„æ˜¯æœŸæœ›æ¥æ”¶åˆ°ä¸‹ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ï¼›å› æ­¤å½“å‰æŠ¥æ–‡æ®µæœ€åä¸€ä¸ªå­—èŠ‚çš„ç¼–å· + 1 å³ä¸ºç¡®è®¤å·ã€‚</p>\n<p>ç¡®è®¤ ACKï¼šå  1 ä½ï¼Œä»…å½“ ACK=1 æ—¶ï¼Œç¡®è®¤å·å­—æ®µæ‰æœ‰æ•ˆã€‚ACK=0 æ—¶ï¼Œç¡®è®¤å·æ— æ•ˆã€‚</p>\n<p>åŒæ­¥ SYNï¼šè¿æ¥å»ºç«‹æ—¶ç”¨äºåŒæ­¥åºå·ã€‚å½“ SYN=1ï¼ŒACK=0 æ—¶è¡¨ç¤ºï¼šè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è‹¥åŒæ„è¿æ¥ï¼Œåˆ™åœ¨å“åº”æŠ¥æ–‡æ®µä¸­ä½¿å¾— SYN=1ï¼ŒACK=1ã€‚å› æ­¤ï¼ŒSYN=1 è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œæˆ–è¿æ¥æ¥å—æŠ¥æ–‡ã€‚SYN è¿™ä¸ªæ ‡å¿—ä½åªæœ‰åœ¨ TCP å»ºäº§è¿æ¥æ—¶æ‰ä¼šè¢«ç½® 1ï¼Œæ¡æ‰‹å®Œæˆå SYN æ ‡å¿—ä½è¢«ç½® 0ã€‚</p>\n<p>ç»ˆæ­¢ FINï¼šç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿æ¥ã€‚FIN=1 è¡¨ç¤ºï¼šæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿è¾“è¿æ¥ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210818161102760.png\" alt=\"image-20210818161102760\" /></p>\n<p>&lt;img src=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vYmZhbmZhbmZhbi9pbWcvcmF3L21hc3Rlci9kb2NzaWZ5LyVFNCVCOCU4OSVFNiVBQyVBMSVFNiU4RiVBMSVFNiU4OSU4QiVFNSU5QiU5QiVFNiVBQyVBMSVFNiU4QyVBNSVFNiU4OSU4QiUyMCgxKS5wbmc=\">https://gitee.com/bfanfanfan/img/raw/master/docsify/ ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ (1).png</span>&quot; style=&quot;zoom:50%;&quot; /&gt;</p>\n<p>ä»¥ä¸‹æ¦‚å¿µå‚è€ƒè‡ª <span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlOUIlOUIlRTYlQUMlQTElRTYlOEMlQTUlRTYlODklOEIvNzc5NDI4Nz9mcj1hbGFkZGlu\">https://baike.baidu.com/item/ å››æ¬¡æŒ¥æ‰‹ / 7794287?fr=aladdin</span></p>\n<p>è¿æ¥ç»ˆæ­¢åè®®ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰</p>\n<p>ç”±äº TCP è¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼Œå› æ­¤æ¯ä¸ªæ–¹å‘éƒ½å¿…é¡»å•ç‹¬è¿›è¡Œå…³é—­ã€‚è¿™åŸåˆ™æ˜¯å½“ä¸€æ–¹å®Œæˆå®ƒçš„æ•°æ®å‘é€ä»»åŠ¡åå°±èƒ½å‘é€ä¸€ä¸ª FIN æ¥ç»ˆæ­¢è¿™ä¸ªæ–¹å‘çš„è¿æ¥ã€‚æ”¶åˆ°ä¸€ä¸ª FIN åªæ„å‘³ç€è¿™ä¸€æ–¹å‘ä¸Šæ²¡æœ‰æ•°æ®æµåŠ¨ï¼Œä¸€ä¸ª TCP è¿æ¥åœ¨æ”¶åˆ°ä¸€ä¸ª FIN åä»èƒ½å‘é€æ•°æ®ã€‚é¦–å…ˆè¿›è¡Œå…³é—­çš„ä¸€æ–¹å°†æ‰§è¡Œä¸»åŠ¨å…³é—­ï¼Œè€Œå¦ä¸€æ–¹æ‰§è¡Œè¢«åŠ¨å…³é—­ã€‚</p>\n<p>ï¼ˆ1ï¼‰ TCP å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª FINï¼Œç”¨æ¥å…³é—­å®¢æˆ·åˆ°æœåŠ¡å™¨çš„<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOTUlQjAlRTYlOEQlQUUlRTQlQkMlQTAlRTklODAlODE=\">æ•°æ®ä¼ é€</span>ã€‚</p>\n<p>ï¼ˆ2ï¼‰ æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ª FINï¼Œå®ƒå‘å›ä¸€ä¸ª ACKï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ  1ã€‚å’Œ SYN ä¸€æ ·ï¼Œä¸€ä¸ª FIN å°†å ç”¨ä¸€ä¸ªåºå·ã€‚</p>\n<p>ï¼ˆ3ï¼‰ æœåŠ¡å™¨å…³é—­å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå‘é€ä¸€ä¸ª FIN ç»™å®¢æˆ·ç«¯ã€‚</p>\n<p>ï¼ˆ4ï¼‰ å®¢æˆ·ç«¯å‘å› ACK<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEElQTUlRTYlOTYlODc=\"> æŠ¥æ–‡</span>ç¡®è®¤ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ  1ã€‚</p>\n<p><strong>CLOSED</strong></p>\n<p>è¡¨ç¤ºåˆå§‹çŠ¶æ€ã€‚</p>\n<p><strong>LISTEN</strong></p>\n<p>è¿™ä¸ªä¹Ÿæ˜¯éå¸¸å®¹æ˜“ç†è§£çš„ä¸€ä¸ªçŠ¶æ€ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç«¯çš„æŸä¸ª SOCKET å¤„äº<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTclOUIlOTElRTUlOTAlQUMlRTclOEElQjYlRTYlODAlODE=\">ç›‘å¬çŠ¶æ€</span>ï¼Œå¯ä»¥æ¥å—è¿æ¥äº†ã€‚</p>\n<p><strong>SYN_RCVD</strong></p>\n<p>è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºæ¥å—åˆ°äº† SYN<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEElQTUlRTYlOTYlODc=\"> æŠ¥æ–‡</span>ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯æœåŠ¡å™¨ç«¯çš„ SOCKET åœ¨å»ºç«‹ TCP è¿æ¥æ—¶çš„<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTQlQjglODklRTYlQUMlQTElRTYlOEYlQTElRTYlODklOEI=\">ä¸‰æ¬¡æ¡æ‰‹</span>ä¼šè¯è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼Œå¾ˆçŸ­æš‚ï¼ŒåŸºæœ¬ä¸Šç”¨ netstat ä½ æ˜¯å¾ˆéš¾çœ‹åˆ°è¿™ç§çŠ¶æ€çš„ï¼Œé™¤éä½ ç‰¹æ„å†™äº†ä¸€ä¸ªå®¢æˆ·ç«¯<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlQjUlOEIlRTglQUYlOTUlRTclQTglOEIlRTUlQkElOEY=\">æµ‹è¯•ç¨‹åº</span>ï¼Œæ•…æ„å°†ä¸‰æ¬¡ TCP æ¡æ‰‹è¿‡ç¨‹ä¸­æœ€åä¸€ä¸ª ACK æŠ¥æ–‡ä¸äºˆå‘é€ã€‚å› æ­¤è¿™ç§çŠ¶æ€æ—¶ï¼Œå½“æ”¶åˆ°å®¢æˆ·ç«¯çš„ ACK æŠ¥æ–‡åï¼Œå®ƒä¼šè¿›å…¥åˆ° ESTABLISHED çŠ¶æ€ã€‚</p>\n<p><strong>SYN_SENT</strong></p>\n<p>è¿™ä¸ªçŠ¶æ€ä¸ SYN_RCVD é¥ç›¸å‘¼åº”ï¼Œå½“å®¢æˆ·ç«¯ SOCKET æ‰§è¡Œ CONNECT è¿æ¥æ—¶ï¼Œå®ƒé¦–å…ˆå‘é€ SYN<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEElQTUlRTYlOTYlODc=\"> æŠ¥æ–‡</span>ï¼Œå› æ­¤ä¹Ÿéšå³å®ƒä¼šè¿›å…¥åˆ°äº† SYN_SENT çŠ¶æ€ï¼Œå¹¶ç­‰å¾…æœåŠ¡ç«¯çš„å‘é€<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTQlQjglODklRTYlQUMlQTElRTYlOEYlQTElRTYlODklOEI=\">ä¸‰æ¬¡æ¡æ‰‹</span>ä¸­çš„ç¬¬ 2 ä¸ªæŠ¥æ–‡ã€‚SYN_SENT çŠ¶æ€è¡¨ç¤ºå®¢æˆ·ç«¯å·²å‘é€ SYN æŠ¥æ–‡ã€‚</p>\n<p><strong>ESTABLISHED</strong></p>\n<p>è¡¨ç¤ºè¿æ¥å·²ç»å»ºç«‹äº†ã€‚</p>\n<p><strong>FIN_WAIT_1</strong></p>\n<p>è¿™ä¸ªçŠ¶æ€è¦å¥½å¥½è§£é‡Šä¸€ä¸‹ï¼Œå…¶å® FIN_WAIT_1 å’Œ FIN_WAIT_2 çŠ¶æ€çš„çœŸæ­£å«ä¹‰éƒ½æ˜¯è¡¨ç¤ºç­‰å¾…å¯¹æ–¹çš„ FIN<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEElQTUlRTYlOTYlODc=\"> æŠ¥æ–‡</span>ã€‚è€Œè¿™ä¸¤ç§çŠ¶æ€çš„åŒºåˆ«æ˜¯ï¼šFIN_WAIT_1 çŠ¶æ€å®é™…ä¸Šæ˜¯å½“ SOCKET åœ¨ ESTABLISHED çŠ¶æ€æ—¶ï¼Œå®ƒæƒ³ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œå‘å¯¹æ–¹å‘é€äº† FIN æŠ¥æ–‡ï¼Œæ­¤æ—¶è¯¥ SOCKET å³è¿›å…¥åˆ° FIN_WAIT_1 çŠ¶æ€ã€‚è€Œå½“å¯¹æ–¹å›åº” ACK æŠ¥æ–‡åï¼Œåˆ™è¿›å…¥åˆ° FIN_WAIT_2 çŠ¶æ€ï¼Œå½“ç„¶åœ¨å®é™…çš„æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ— è®ºå¯¹æ–¹ä½•ç§æƒ…å†µä¸‹ï¼Œéƒ½åº”è¯¥é©¬ä¸Šå›åº” ACK æŠ¥æ–‡ï¼Œæ‰€ä»¥ FIN_WAIT_1 çŠ¶æ€ä¸€èˆ¬æ˜¯æ¯”è¾ƒéš¾è§åˆ°çš„ï¼Œè€Œ FIN_WAIT_2 çŠ¶æ€è¿˜æœ‰æ—¶å¸¸å¸¸å¯ä»¥ç”¨ netstat çœ‹åˆ°ã€‚</p>\n<p><strong>FIN_WAIT_2</strong></p>\n<p>ä¸Šé¢å·²ç»è¯¦ç»†è§£é‡Šäº†è¿™ç§çŠ¶æ€ï¼Œå®é™…ä¸Š FIN_WAIT_2 çŠ¶æ€ä¸‹çš„ SOCKETï¼Œè¡¨ç¤ºåŠè¿æ¥ï¼Œä¹Ÿå³æœ‰ä¸€æ–¹è¦æ±‚ close è¿æ¥ï¼Œä½†å¦å¤–è¿˜å‘Šè¯‰å¯¹æ–¹ï¼Œæˆ‘æš‚æ—¶è¿˜æœ‰ç‚¹æ•°æ®éœ€è¦ä¼ é€ç»™ä½ ï¼Œç¨åå†å…³é—­è¿æ¥ã€‚</p>\n<p><strong>TIME_WAIT</strong></p>\n<p>è¡¨ç¤ºæ”¶åˆ°äº†å¯¹æ–¹çš„ FIN<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEElQTUlRTYlOTYlODc=\"> æŠ¥æ–‡</span>ï¼Œå¹¶å‘é€å‡ºäº† ACK æŠ¥æ–‡ï¼Œå°±ç­‰ 2MSL åå³å¯å›åˆ° CLOSED å¯ç”¨çŠ¶æ€äº†ã€‚å¦‚æœ FIN_WAIT_1 çŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°äº†å¯¹æ–¹åŒæ—¶å¸¦ FIN æ ‡å¿—å’Œ ACK æ ‡å¿—çš„æŠ¥æ–‡æ—¶ï¼Œå¯ä»¥ç›´æ¥è¿›å…¥åˆ° TIME_WAIT çŠ¶æ€ï¼Œè€Œæ— é¡»ç»è¿‡ FIN_WAIT_2 çŠ¶æ€ã€‚</p>\n<p><strong>CLOSING</strong></p>\n<p>è¿™ç§çŠ¶æ€æ¯”è¾ƒç‰¹æ®Šï¼Œå®é™…æƒ…å†µä¸­åº”è¯¥æ˜¯å¾ˆå°‘è§ï¼Œå±äºä¸€ç§æ¯”è¾ƒç½•è§çš„ä¾‹å¤–çŠ¶æ€ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ å‘é€ FIN<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEElQTUlRTYlOTYlODc=\"> æŠ¥æ–‡</span>åï¼ŒæŒ‰ç†æ¥è¯´æ˜¯åº”è¯¥å…ˆæ”¶åˆ°ï¼ˆæˆ–åŒæ—¶æ”¶åˆ°ï¼‰å¯¹æ–¹çš„ ACK æŠ¥æ–‡ï¼Œå†æ”¶åˆ°å¯¹æ–¹çš„ FIN æŠ¥æ–‡ã€‚ä½†æ˜¯ CLOSING çŠ¶æ€è¡¨ç¤ºä½ å‘é€ FIN æŠ¥æ–‡åï¼Œå¹¶æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„ ACK æŠ¥æ–‡ï¼Œåè€Œå´æ”¶åˆ°äº†å¯¹æ–¹çš„ FIN æŠ¥æ–‡ã€‚ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°æ­¤ç§æƒ…å†µå‘¢ï¼Ÿå…¶å®ç»†æƒ³ä¸€ä¸‹ï¼Œä¹Ÿä¸éš¾å¾—å‡ºç»“è®ºï¼šé‚£å°±æ˜¯å¦‚æœåŒæ–¹å‡ ä¹åœ¨åŒæ—¶ close ä¸€ä¸ª SOCKET çš„è¯ï¼Œé‚£ä¹ˆå°±å‡ºç°äº†åŒæ–¹åŒæ—¶å‘é€ FIN æŠ¥æ–‡çš„æƒ…å†µï¼Œä¹Ÿå°±ä¼šå‡ºç° CLOSING çŠ¶æ€ï¼Œè¡¨ç¤ºåŒæ–¹éƒ½æ­£åœ¨å…³é—­ SOCKET è¿æ¥ã€‚</p>\n<p><strong>CLOSE_WAIT</strong></p>\n<p>è¿™ç§çŠ¶æ€çš„å«ä¹‰å…¶å®æ˜¯è¡¨ç¤ºåœ¨ç­‰å¾…å…³é—­ã€‚æ€ä¹ˆç†è§£å‘¢ï¼Ÿå½“å¯¹æ–¹ close ä¸€ä¸ª SOCKET åå‘é€ FIN<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEElQTUlRTYlOTYlODc=\"> æŠ¥æ–‡</span>ç»™è‡ªå·±ï¼Œä½ ç³»ç»Ÿæ¯«æ— ç–‘é—®åœ°ä¼šå›åº”ä¸€ä¸ª ACK æŠ¥æ–‡ç»™å¯¹æ–¹ï¼Œæ­¤æ—¶åˆ™è¿›å…¥åˆ° CLOSE_WAIT çŠ¶æ€ã€‚æ¥ä¸‹æ¥å‘¢ï¼Œå®é™…ä¸Šä½ çœŸæ­£éœ€è¦è€ƒè™‘çš„äº‹æƒ…æ˜¯æŸ¥çœ‹ä½ æ˜¯å¦è¿˜æœ‰æ•°æ®å‘é€ç»™å¯¹æ–¹ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œé‚£ä¹ˆä½ ä¹Ÿå°±å¯ä»¥ close è¿™ä¸ª SOCKETï¼Œå‘é€ FIN æŠ¥æ–‡ç»™å¯¹æ–¹ï¼Œä¹Ÿå³å…³é—­è¿æ¥ã€‚æ‰€ä»¥ä½ åœ¨ CLOSE_WAIT çŠ¶æ€ä¸‹ï¼Œéœ€è¦å®Œæˆçš„äº‹æƒ…æ˜¯ç­‰å¾…ä½ å»å…³é—­è¿æ¥ã€‚</p>\n<p><strong>LAST_ACK</strong></p>\n<p>è¿™ä¸ªçŠ¶æ€è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“å¥½ç†è§£çš„ï¼Œå®ƒæ˜¯è¢«åŠ¨å…³é—­ä¸€æ–¹åœ¨å‘é€ FIN<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEElQTUlRTYlOTYlODc=\"> æŠ¥æ–‡</span>åï¼Œæœ€åç­‰å¾…å¯¹æ–¹çš„ ACK æŠ¥æ–‡ã€‚å½“æ”¶åˆ° ACK æŠ¥æ–‡åï¼Œä¹Ÿå³å¯ä»¥è¿›å…¥åˆ° CLOSED å¯ç”¨çŠ¶æ€äº†ã€‚</p>\n<h2 id=\"é•¿è¿æ¥-çŸ­é“¾æ¥-é•¿è½®è¯¢-çŸ­è½®è¯¢\"><a class=\"anchor\" href=\"#é•¿è¿æ¥-çŸ­é“¾æ¥-é•¿è½®è¯¢-çŸ­è½®è¯¢\">#</a> é•¿è¿æ¥ã€çŸ­é“¾æ¥ã€é•¿è½®è¯¢ã€çŸ­è½®è¯¢</h2>\n<p>é•¿è¿æ¥ï¼šé•¿è¿æ¥ä¸çŸ­è¿æ¥æŒ‡çš„æ˜¯ TCP è¿æ¥ï¼Œå…·ä½“å®ç°æ˜¯åœ¨ HTTP ä¸­ï¼ŒHTTP1.1 é»˜è®¤æ˜¯é•¿è¿æ¥ï¼Œå³ Connection çš„å€¼ä¸º keep-aliveã€‚é•¿è¿æ¥çš„å¥½å¤„æ˜¯å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼ˆå¤šä¸ª HTTP è¯·æ±‚ï¼‰å¯ä»¥å¤ç”¨åŒä¸€ä¸ª TCP è¿æ¥ï¼Œå†æ¬¡æœ‰ HTTP è¯·æ±‚å°±ä¸ä¼šé‡å¤è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼ŒèŠ‚çœäº†ç½‘ç»œèµ„æºã€æé«˜äº†è¯·æ±‚èµ„æºçš„å“åº”é€Ÿåº¦ã€‚é•¿è¿æ¥å¹¶ä¸æ˜¯æ°¸ä¹…çš„è¿æ¥ï¼Œå¦‚æœåœ¨æŒ‡å®šè¶…æ—¶æ—¶é—´å†…æ²¡æœ‰ HTTP è¯·æ±‚ï¼Œé‚£ä¹ˆè¿æ¥ä¼šè¢«æ–­å¼€è¿›å…¥<strong> TIME_WAIT</strong> çŠ¶æ€ã€‚è¶…æ—¶æ—¶é—´åœ¨æœåŠ¡ç«¯ä¸­å¯ä»¥åœ¨ header ä¸­è®¾ç½®ã€‚</p>\n<p>çŸ­è¿æ¥ï¼šé€‚ç”¨äº HTTP è¯·æ±‚ä¸é¢‘ç¹çš„åœºæ™¯ï¼Œæ— è®ºè¯·æ±‚æ˜¯å¦æœ‰ç»“æœéƒ½ä¼šè‡ªåŠ¨æ–­å¼€è¿æ¥ã€‚</p>\n<p>é•¿è½®è¯¢ã€çŸ­è½®è¯¢ï¼šåœºè½®è¯¢ä¸çŸ­è½®è¯¢æ˜¯é€šè¿‡æœåŠ¡ç«¯çš„å˜æˆæ¥æ§åˆ¶çš„ã€‚é•¿è½®è¯¢æ˜¯æŒ‡å®¢æˆ·ç«¯å»æœåŠ¡ç«¯è¯·æ±‚æ•°æ®ï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰æ•°æ®é‚£ä¹ˆå°±ä¼šé˜»å¡ç­‰å¾…ç›´åˆ°æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯åæ–­å¼€ã€‚çŸ­è½®è¯¢æ˜¯æŒ‡å®¢æˆ·ç«¯å»æœåŠ¡ç«¯è¯·æ±‚æ•°æ®ï¼Œæ— è®ºè¯·æ±‚æ˜¯å¦æœ‰ç»“æœéƒ½å°†ç«‹å³è¿”å›ã€‚</p>\n",
            "tags": [
                "Java",
                "Java",
                "NIO",
                "IO",
                "socket",
                "BIO"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/",
            "url": "https://baiyezi.vip/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/Kafka-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/",
            "title": "Kafka-æ•´ä½“æ¶æ„",
            "date_published": "2021-08-15T10:05:22.000Z",
            "content_html": "<h2 id=\"kafkaç»„æˆ\"><a class=\"anchor\" href=\"#kafkaç»„æˆ\">#</a> kafka ç»„æˆ</h2>\n<p>å®˜ç½‘ <span class=\"exturl\" data-url=\"aHR0cDovL2thZmthLmFwYWNoZS5vcmcv\">http://kafka.apache.org/</span></p>\n<p>kafka æ˜¯ä¸€ä¸ªé«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€é«˜æ‰©å±•çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶è¿˜æœ‰ RabbitMQã€ActiveMQ ç­‰å¸¸ç”¨ä¸­é—´ä»¶ã€‚</p>\n<p>ç”±äºè¯»å†™åˆ†ç¦»å®¹æ˜“å‡ºç°ä¸€è‡´æ€§é—®é¢˜ï¼Œæ‰€ä»¥ kafka è®¾è®¡ä¸Šåªèƒ½åœ¨ä¸»ä¸Šè¿›è¡Œè¯»å†™ï¼Œä»åªè´Ÿè´£å¤‡ä»½ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827113140000.png\" alt=\"image-20210827113140000\" /></p>\n<h3 id=\"topicä¸åˆ†åŒº\"><a class=\"anchor\" href=\"#topicä¸åˆ†åŒº\">#</a> topic ä¸åˆ†åŒº</h3>\n<p>kafka æ— æ³•å¹²æ¶‰æ¶ˆæ¯è¿›å…¥ kafka çš„é¡ºåºï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ—¶é€šè¿‡åç§»é‡ offset æ¥è®°å½•æ¶ˆè´¹æ¶ˆæ¯çš„è¿›åº¦ã€‚topic æ—¶é€»è¾‘å­˜åœ¨çš„ï¼Œä¸ä¸šåŠ¡ç›¸å…³ï¼Œåˆ†åŒºæ˜¯ç‰©ç†å­˜åœ¨çš„ï¼Œä¸ä¸šåŠ¡æ•°æ®ç›¸å…³ï¼Œæ‰€ä»¥ä¸€ä¸ª topic å¯ä»¥è¢«åˆ†ä¸ºè‹¥å¹²åˆ†åŒºã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827113404059.png\" alt=\"image-20210827113404059\" /></p>\n<h3 id=\"broker\"><a class=\"anchor\" href=\"#broker\">#</a> broker</h3>\n<p>zookeeper è´Ÿè´£åˆ†å¸ƒå¼çš„åè°ƒï¼Œåœ¨ kafka ä¸­è´Ÿè´£ broker ä¹‹é—´çš„åè°ƒï¼ˆä¸»ä»é€‰æ‹©ï¼‰ã€‚kafka ä¸­å¯ä»¥æœ‰å¤šä¸ª brokerï¼Œä¸€ä¸ª broker ç›¸å½“äºä¸€ä¸ª jvm è¿›ç¨‹ï¼Œå¤šä¸ª broker å…±äº«ä¸€ä¸ª topicï¼Œtopic ä¸­çš„è‹¥å¹²åˆ†åŒºåˆ†åˆ«è¢«ä¸åŒçš„ broker æ‰€ç®¡ç†ã€‚æ‰€æœ‰ topic ä»¥åŠåˆ†åŒºçš„åˆ’åˆ†æœ€åè½åœ°æ—¶éœ€è¦ä¸€å¥— admin-api æ¥åˆ’åˆ†ï¼Œadmin-api é€šè¿‡è®¿é—® zookeeper æ¥è·å¾—ä¸»ä»å…³ç³»ï¼Œä»è€Œè¿›è¡Œåˆ’åˆ†ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827135427726.png\" alt=\"image-20210827135427726\" /></p>\n<h3 id=\"producer-consumer\"><a class=\"anchor\" href=\"#producer-consumer\">#</a> producerã€consumer</h3>\n<p>producer è´Ÿè´£æŠŠæ•°æ®æ‰“æ•£åˆ°ä¸åŒçš„åˆ†åŒºï¼Œæ—§ç‰ˆçš„ kafka ä¸­ï¼Œproducer ä» zookeeper ä¸­è·å– broker çš„ä¿¡æ¯ï¼Œå½“æ•°æ®é‡è¾ƒå¤§æ—¶å°±å¢åŠ äº† zookeeper çš„å‹åŠ›ï¼Œæ‰€ä»¥æ–°ç‰ˆä¸­éœ€è¦æ‰‹åŠ¨ç»™å‡º broker çš„ä¿¡æ¯ï¼Œproducer å†é€šè¿‡ broker å°†æ•°æ®æ‰“æ•£åˆ° broker ä¸­çš„åˆ†åŒºã€‚</p>\n<p>åˆ†åŒºå’Œ consumer å¯ä»¥æ˜¯ 1ï¼š1ï¼Œä¹Ÿå¯ä»¥æ˜¯ Nï¼š1ï¼Œä½†ä¸å…è®¸ 1ï¼šNï¼ˆæ— æ³•ä¿è¯æ•°æ®æ¶ˆè´¹çš„æœ‰åºæ€§ï¼‰</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827141326041.png\" alt=\"image-20210827141326041\" /></p>\n<h3 id=\"åˆ†ç»„\"><a class=\"anchor\" href=\"#åˆ†ç»„\">#</a> åˆ†ç»„</h3>\n<p>ä¸åŒçš„ consumer å¯ä»¥è¢«åˆ†ä¸ºä¸åŒçš„ç»„ï¼Œç»„ä¹‹é—´çš„ consumer æ˜¯éš”ç¦»çš„ï¼Œproducer çš„æ•°æ®å¯ä»¥è¢«ä¸åŒçš„ç»„é‡å¤åˆ©ç”¨ï¼Œä½†æ˜¯ä¸€ä¸ªåˆ†åŒºçš„æ•°æ®ä¸èƒ½è¢«ä¸€ä¸ªç»„å†…çš„å¤šä¸ª consumer æ¶ˆè´¹</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210827142236903.png\" alt=\"image-20210827142236903\" /></p>\n<h3 id=\"offset\"><a class=\"anchor\" href=\"#offset\">#</a> offset</h3>\n<p>åœ¨ consumer æ¶ˆè´¹æ•°æ®æ—¶ï¼Œæ‹¿åˆ°æ•°æ®å¯èƒ½è¿˜æ²¡æœ‰æ¶ˆè´¹ offset å°±ä¸¢å¤±äº†ï¼Œæ­¤æ—¶ä¼šå¯¼è‡´æ•°æ®çš„ä¸¢å¤±ï¼›æˆ–è€…æ•°æ®æ¶ˆè´¹å offset æ²¡æœ‰æ›´æ–°ï¼Œå¯¼è‡´ä¸‹æ¬¡æ‹¿åˆ°ç›¸åŒçš„æ•°æ®ï¼Œå³æ•°æ®é‡å¤ã€‚è¿™äº›å¯èƒ½çš„é”™è¯¯æºäº offset çš„å‡†ç¡®æ€§ï¼Œå³æ•°æ®æ¶ˆè´¹è¿›åº¦çš„å‡†ç¡®æ€§ã€‚</p>\n<p>kafka åœ¨è¿è¡Œæ—¶å†…å­˜ä¸­ç»´æŠ¤äº†è‡ªå·±çš„ offsetï¼ˆæ•°æ®æ¶ˆè´¹è¿›åº¦ï¼‰ï¼Œç”±äºæ˜¯åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ–­ç”µå®¹æ˜“ä¸¢å¤±ï¼Œå› æ­¤éœ€è¦æŒä¹…åŒ– offset æ¥ç»´æŠ¤ offsetã€‚å°±ç‰ˆæœ¬çš„ kafka ä¸­å°† offset ç»´æŠ¤åˆ°äº† zookeeperï¼Œä½†æ˜¯ zookeeper ä¸åº”è¯¥å‚ä¸å…·ä½“ä¸šåŠ¡ï¼Œå¦åˆ™ä¼šå½±å“åˆ†å¸ƒå¼åè°ƒçš„é€Ÿåº¦ï¼Œæ‰€ä»¥æ–°ç‰ˆæœ¬çš„ kafka è‡ªå·±ç»´æŠ¤äº† offsetï¼ˆåœ¨ topic çš„ metadata ä¸­ç»´æŠ¤ï¼Œtopic ä¸­çš„æ•°æ®æœ€ç»ˆä¼šè½åˆ°ç£ç›˜ï¼‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç»´æŠ¤åœ¨ç¬¬ä¸‰æ–¹å¦‚ redisã€mysqlï¼Œä½†æ˜¯ä¸å»ºè®®ã€‚offset ç»´æŠ¤çš„æ—¶é—´èŠ‚ç‚¹å–å†³äºä¸šåŠ¡ï¼Œconsumer æ‹‰å–åˆ°æ•°æ®åå°±ç«‹å³æ›´æ–° offset æˆ–è€…æ•°æ®æ¶ˆè´¹åå†æ›´æ–° offsetï¼Œä¸åŒçš„æ—¶é—´èŠ‚ç‚¹å†³å®šäº†å‘ç”Ÿæ•…éšœä¿®å¤åæ•°æ®æ˜¯ä¸¢å¤±æˆ–é‡å¤æ¶ˆè´¹ã€‚</p>\n",
            "tags": [
                "Java",
                "Java",
                "æ¶ˆæ¯ä¸­é—´ä»¶",
                "Kafka"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/RocketMQ/RocketMQ-%E6%B6%88%E6%81%AF%E3%80%81%E4%BA%8B%E5%8A%A1/",
            "url": "https://baiyezi.vip/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/RocketMQ/RocketMQ-%E6%B6%88%E6%81%AF%E3%80%81%E4%BA%8B%E5%8A%A1/",
            "title": "RocketMQ-æ¶ˆæ¯ã€äº‹åŠ¡",
            "date_published": "2021-08-11T13:56:12.000Z",
            "content_html": "<h2 id=\"æ¶ˆæ¯\"><a class=\"anchor\" href=\"#æ¶ˆæ¯\">#</a> æ¶ˆæ¯</h2>\n<h3 id=\"æ¶ˆæ¯æ¶ˆè´¹æ¨¡å¼\"><a class=\"anchor\" href=\"#æ¶ˆæ¯æ¶ˆè´¹æ¨¡å¼\">#</a> æ¶ˆæ¯æ¶ˆè´¹æ¨¡å¼</h3>\n<p>æ¶ˆæ¯æ¶ˆè´¹æ¨¡å¼ç”±æ¶ˆè´¹è€…æ¥å†³å®šï¼Œå¯ä»¥ç”±æ¶ˆè´¹è€…è®¾ç½® MessageModel æ¥å†³å®šæ¶ˆæ¯æ¨¡å¼ã€‚</p>\n<p>æ¶ˆæ¯æ¨¡å¼é»˜è®¤ä¸ºé›†ç¾¤æ¶ˆè´¹æ¨¡å¼</p>\n<pre><code> consumer.setMessageModel(MessageModel.BROADCASTING);\n consumer.setMessageModel(MessageModel.CLUSTERING);\n</code></pre>\n<h4 id=\"é›†ç¾¤æ¶ˆæ¯\"><a class=\"anchor\" href=\"#é›†ç¾¤æ¶ˆæ¯\">#</a> é›†ç¾¤æ¶ˆæ¯</h4>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/160707_kSpS_1469576.png\" alt=\"img\" /></p>\n<p>é›†ç¾¤æ¶ˆæ¯æ˜¯æŒ‡<strong>é›†ç¾¤åŒ–éƒ¨ç½²æ¶ˆè´¹è€…</strong>ï¼Œå½“ä½¿ç”¨é›†ç¾¤æ¶ˆè´¹æ¨¡å¼æ—¶ï¼ŒMQ è®¤ä¸ºä»»æ„ä¸€æ¡æ¶ˆæ¯åªéœ€è¦è¢«é›†ç¾¤å†…çš„ä»»æ„ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†å³å¯ã€‚</p>\n<p><strong>ç‰¹ç‚¹</strong></p>\n<ul>\n<li>æ¯æ¡æ¶ˆæ¯åªéœ€è¦è¢«å¤„ç†ä¸€æ¬¡ï¼Œbroker åªä¼šæŠŠæ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹é›†ç¾¤ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…</li>\n<li>åœ¨æ¶ˆæ¯é‡æŠ•æ—¶ï¼Œä¸èƒ½ä¿è¯è·¯ç”±åˆ°åŒä¸€å°æœºå™¨ä¸Š</li>\n<li>æ¶ˆè´¹çŠ¶æ€ç”± broker ç»´æŠ¤</li>\n</ul>\n<h4 id=\"å¹¿æ’­æ¶ˆæ¯\"><a class=\"anchor\" href=\"#å¹¿æ’­æ¶ˆæ¯\">#</a> å¹¿æ’­æ¶ˆæ¯</h4>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/160902_4AOI_1469576.png\" alt=\"img\" /></p>\n<p>å½“ä½¿ç”¨å¹¿æ’­æ¶ˆè´¹æ¨¡å¼æ—¶ï¼ŒMQ ä¼šå°†æ¯æ¡æ¶ˆæ¯æ¨é€ç»™é›†ç¾¤å†…æ‰€æœ‰æ³¨å†Œè¿‡çš„å®¢æˆ·ç«¯ï¼Œä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¯å°æœºå™¨æ¶ˆè´¹ä¸€æ¬¡ã€‚</p>\n<p><strong>ç‰¹ç‚¹</strong></p>\n<ul>\n<li>æ¶ˆè´¹è¿›åº¦ç”± consumer ç»´æŠ¤</li>\n<li>ä¿è¯æ¯ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸€æ¬¡æ¶ˆæ¯</li>\n<li>æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯ä¸ä¼šé‡æŠ•</li>\n</ul>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConsumeConcurrentlyContext</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConsumeConcurrentlyStatus</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>protocol<span class=\"token punctuation\">.</span>heartbeat<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageModel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * æ¶ˆæ¯æ¶ˆè´¹è€…</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @DateTime: 2021-06-01 14:41</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer2</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">DefaultMQPushConsumer</span> consumer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// æ¯ä¸€ä¸ª consumer å…³æ³¨ä¸€ä¸ª topic</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">//topic: å…³æ³¨çš„æ¶ˆæ¯çš„åœ°å€</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// è¿‡æ»¤å™¨: * è¡¨ç¤ºä¸è¿‡æ»¤</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myTopic001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">registerMessageListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">ConsumeConcurrentlyStatus</span> <span class=\"token function\">consumeMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">></span></span> msgs<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConsumeConcurrentlyContext</span> consumeConcurrentlyContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageExt</span> msg <span class=\"token operator\">:</span> msgs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token comment\">// é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ª consumer æ¶ˆè´¹</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœæ¶ˆæ¯è¢«æ¶ˆè´¹ï¼Œåˆ™æ¶ˆæ¯çŠ¶æ€å°†ä¿®æ”¹å¹¶è¿”å›ç»™æ¶ˆæ¯æä¾›è€…ï¼Œå‘Šè¯‰æ¶ˆæ¯æä¾›è€…æ¶ˆæ¯å·²ç»æ¶ˆè´¹</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœæš‚æ—¶ä¸æ¶ˆè´¹æ¶ˆæ¯ï¼Œåˆ™éœ€è¦è¿”å› ConsumeConcurrentlyStatus.RECONSUME_LATERï¼Œå‘Šè¯‰æ¶ˆæ¯æä¾›è€…è¿‡ä¸€ä¼šå†æ¬¡æä¾›æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token class-name\">ConsumeConcurrentlyStatus</span><span class=\"token punctuation\">.</span>CONSUME_SUCCESS<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token comment\">// å¹¿æ’­æ¶ˆæ¯ï¼Œå…¶ä»– consumer ä¹Ÿå¯ä»¥æ”¶åˆ°æ¶ˆæ¯ã€‚é»˜è®¤æ˜¯é›†ç¾¤æ¨¡å¼ï¼Œåªå¯ä»¥æ¶ˆè´¹ä¸€æ¬¡æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token comment\">// é›†ç¾¤ï¼šä¸€ç»„ consumerï¼Œæ¶ˆæ¯åªèƒ½è¢«å…¶ä¸­ä¸€ä¸ª consumer æ¶ˆè´¹ï¼Œå³æ¶ˆæ¯åªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token comment\">// å¹¿æ’­ï¼šåŒä¸€ä¸ª topic å†…çš„ consumer å‡å¯ä»¥æ¶ˆè´¹ï¼Œæ¶ˆæ¯å¯ä»¥è¢«æ¯ä¸€ä¸ª consumer æ¶ˆè´¹</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">setMessageModel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageModel</span><span class=\"token punctuation\">.</span>BROADCASTING<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Consumer start...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"å‘é€æ–¹å¼\"><a class=\"anchor\" href=\"#å‘é€æ–¹å¼\">#</a> å‘é€æ–¹å¼</h3>\n<h4 id=\"åŒæ­¥æ¶ˆæ¯\"><a class=\"anchor\" href=\"#åŒæ­¥æ¶ˆæ¯\">#</a> åŒæ­¥æ¶ˆæ¯</h4>\n<p>æ¶ˆæ¯å‘é€ä¸­è¿›å…¥åŒæ­¥ç­‰å¾…çŠ¶æ€ï¼Œå¯ä»¥ä¿è¯æ¶ˆæ¯æŠ•é€’ä¸€å®šåˆ°è¾¾</p>\n<p>å¯åŠ¨ mqnamesrv</p>\n<pre><code class=\"language-cmd\">C:\\WINDOWS\\System32&gt;mqnamesrv\nJava HotSpot(TM) 64-Bit Server VM warning: Using the DefNew young collector with the CMS collector is deprecated and will likely be removed in a future release\nJava HotSpot(TM) 64-Bit Server VM warning: UseCMSCompactAtFullCollection is deprecated and will likely be removed in a future release.\nThe Name Server boot success. serializeType=JSON\n</code></pre>\n<p>å¯åŠ¨ mqbroker</p>\n<pre><code class=\"language-cmd\">C:\\WINDOWS\\System32&gt;mqbroker -n localhost:9876 autoCreateTopicEnable=true\nThe broker[Fan, 172.20.10.3:10911] boot success. serializeType=JSON and name server is localhost:9876\n</code></pre>\n<p>å¯åŠ¨ admin ç®¡ç†ç•Œé¢</p>\n<pre><code class=\"language-cmd\">D:\\RocketMQ&gt;java -jar rocketmq-console-ng-1.0.1.jar --rocketmq.config.namesrvAddr=127.0.0.1:9876\n</code></pre>\n<p>åˆ›å»ºä¸€ä¸ª maven é¡¹ç›®ï¼Œå¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.rocketmq<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>rocketmq-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>4.6.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>æ¶ˆæ¯æä¾›æ–¹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SendResult</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Message</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>remoting<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * æ¶ˆæ¯å‘é€è€…</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @DateTime: 2021-06-01 14:04</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">DefaultMQProducer</span> producer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½® nameserver åœ°å€</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">//new Message (topic,body)ï¼štopic æ¶ˆæ¯å°†è¦å‘é€åˆ°çš„åœ°å€ï¼Œå¦‚æœæ²¡æœ‰å°±è‡ªåŠ¨åˆ›å»ºï¼›body å…·ä½“æ•°æ®</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">Message</span> msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Message</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myTopic001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// å‘é€æ¶ˆæ¯åé˜»å¡ç­‰å¾… broker è¿”å›ï¼Œå³åŒæ­¥æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">SendResult</span> sendResult <span class=\"token operator\">=</span> producer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>sendResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ¶ˆæ¯æ¶ˆè´¹æ–¹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConsumeConcurrentlyContext</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConsumeConcurrentlyStatus</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * æ¶ˆæ¯æ¶ˆè´¹è€…</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @DateTime: 2021-06-01 14:41</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">DefaultMQPushConsumer</span> consumer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// æ¯ä¸€ä¸ª consumer å…³æ³¨ä¸€ä¸ª topic</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">//topic: å…³æ³¨çš„æ¶ˆæ¯çš„åœ°å€</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// è¿‡æ»¤å™¨: * è¡¨ç¤ºä¸è¿‡æ»¤</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myTopic001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">registerMessageListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">ConsumeConcurrentlyStatus</span> <span class=\"token function\">consumeMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">></span></span> msgs<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConsumeConcurrentlyContext</span> consumeConcurrentlyContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageExt</span> msg <span class=\"token operator\">:</span> msgs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token comment\">// é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ª consumer æ¶ˆè´¹</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœæ¶ˆæ¯è¢«æ¶ˆè´¹ï¼Œåˆ™æ¶ˆæ¯çŠ¶æ€å°†ä¿®æ”¹å¹¶è¿”å›ç»™æ¶ˆæ¯æä¾›è€…ï¼Œå‘Šè¯‰æ¶ˆæ¯æä¾›è€…æ¶ˆæ¯å·²ç»æ¶ˆè´¹</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœæš‚æ—¶ä¸æ¶ˆè´¹æ¶ˆæ¯ï¼Œåˆ™éœ€è¦è¿”å› ConsumeConcurrentlyStatus.RECONSUME_LATERï¼Œå‘Šè¯‰æ¶ˆæ¯æä¾›è€…è¿‡ä¸€ä¼šå†æ¬¡æä¾›æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token class-name\">ConsumeConcurrentlyStatus</span><span class=\"token punctuation\">.</span>CONSUME_SUCCESS<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Consumer start...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"å¼‚æ­¥æ¶ˆæ¯\"><a class=\"anchor\" href=\"#å¼‚æ­¥æ¶ˆæ¯\">#</a> å¼‚æ­¥æ¶ˆæ¯</h4>\n<p>æƒ³è¦å¿«é€Ÿå‘é€æ¶ˆæ¯ï¼Œåˆä¸æƒ³ä¸¢å¤±çš„æ—¶å€™å¯ä»¥ä½¿ç”¨å¼‚æ­¥æ¶ˆæ¯</p>\n<p>å›è°ƒæ–¹å¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SendCallback</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SendResult</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Message</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>remoting<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ArrayList</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * æ¶ˆæ¯å‘é€è€…</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @DateTime: 2021-06-01 14:04</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">DefaultMQProducer</span> producer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½® nameserver åœ°å€</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">//new Message (topic,body)ï¼štopic æ¶ˆæ¯å°†è¦å‘é€åˆ°çš„åœ°å€ï¼Œå¦‚æœæ²¡æœ‰å°±è‡ªåŠ¨åˆ›å»ºï¼›body å…·ä½“æ•°æ®</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">/*Message msg = new Message (\"myTopic001\", \"hello\".getBytes ());</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        Message msg2 = new Message (\"myTopic001\", \"hello2\".getBytes ());</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        Message msg3 = new Message (\"myTopic001\", \"hello3\".getBytes ());</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        List&lt;Message> msgList = new ArrayList&lt;>();</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        msgList.add (msg);</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        msgList.add (msg2);</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        msgList.add (msg3);</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        // å‘é€æ¶ˆæ¯åé˜»å¡ç­‰å¾… broker è¿”å›</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        SendResult sendResult = producer.send (msgList);</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        System.out.println (sendResult);*/</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">// å¼‚æ­¥å¯é æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯ä¹‹åä¸ä¼šé˜»å¡ç­‰å¾… broker è¿”å›ï¼Œè€Œæ˜¯é‡‡ç”¨äº‹ä»¶ç›‘å¬çš„æ–¹å¼æ¥æ”¶ broker è¿”å›çš„ç¡®è®¤</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Message</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myTopic001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hello callback\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SendCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SendResult</span> sendResult<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>sendResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> throwable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ¶ˆæ¯å‘é€å¼‚å¸¸ï¼š\"</span> <span class=\"token operator\">+</span> throwable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">//        producer.shutdown();</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"å•å‘æ¶ˆæ¯\"><a class=\"anchor\" href=\"#å•å‘æ¶ˆæ¯\">#</a> å•å‘æ¶ˆæ¯</h4>\n<p>åªå‘é€æ¶ˆæ¯ï¼Œä¸ç­‰å¾…æœåŠ¡å™¨å“åº”ï¼Œåªå‘é€è¯·æ±‚ä¸ç­‰å¾…åº”ç­”ã€‚æ­¤æ–¹å¼å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹è€—æ—¶éå¸¸çŸ­ï¼Œä¸€èˆ¬åœ¨å¾®ç§’çº§åˆ«ã€‚</p>\n<pre><code> producer.sendOneway(message);\n</code></pre>\n<p>æ— éœ€ broker å“åº”ï¼Œå‘é€é€Ÿåº¦æœ€å¿«</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Message</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>remoting<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * æ¶ˆæ¯å‘é€è€…</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @DateTime: 2021-06-01 14:04</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer2</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">DefaultMQProducer</span> producer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½® nameserver åœ°å€</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Message</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myTopic001\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// ä¸éœ€è¦ broker å“åº”</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">sendOneway</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"æ‰¹é‡æ¶ˆæ¯å‘é€\"><a class=\"anchor\" href=\"#æ‰¹é‡æ¶ˆæ¯å‘é€\">#</a> æ‰¹é‡æ¶ˆæ¯å‘é€</h3>\n<p>å¯ä»¥å¤šæ¡æ¶ˆæ¯æ‰“åŒ…ä¸€èµ·å‘é€ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“æ¬¡æ•°æé«˜æ•ˆç‡ã€‚</p>\n<p><code>producer.send(Collection c) </code> æ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªé›†åˆ å®ç°æ‰¹é‡å‘é€</p>\n<pre><code> public SendResult send(\n        Collection&lt;Message&gt; msgs) throws MQClientException, RemotingException, MQBrokerException, InterruptedException &#123;\n        return this.defaultMQProducerImpl.send(batch(msgs));\n    &#125;\n</code></pre>\n<ul>\n<li>æ‰¹é‡æ¶ˆæ¯è¦æ±‚å¿…è¦å…·æœ‰åŒä¸€ topicã€ç›¸åŒæ¶ˆæ¯é…ç½®</li>\n<li>ä¸æ”¯æŒå»¶æ—¶æ¶ˆæ¯</li>\n<li>å»ºè®®ä¸€ä¸ªæ‰¹é‡æ¶ˆæ¯æœ€å¥½ä¸è¦è¶…è¿‡ 1MB å¤§å°</li>\n<li>å¦‚æœä¸ç¡®å®šæ˜¯å¦è¶…è¿‡é™åˆ¶ï¼Œå¯ä»¥æ‰‹åŠ¨è®¡ç®—å¤§å°åˆ†æ‰¹å‘é€</li>\n</ul>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yb2NrZXRtcS5hcGFjaGUub3JnL2RvY3MvYmF0Y2gtZXhhbXBsZS8=\">å‚è€ƒå®˜ç½‘</span></p>\n<h3 id=\"tag\"><a class=\"anchor\" href=\"#tag\">#</a> TAG</h3>\n<p>å¯ä»¥ä½¿ç”¨ tag æ¥è¿‡æ»¤æ¶ˆè´¹</p>\n<p>åœ¨ Producer ä¸­ä½¿ç”¨ Tagï¼š</p>\n<pre><code>Message msg = new Message(&quot;TopicTest&quot;,&quot;TagA&quot; ,(&quot;Hello RocketMQ &quot; ).getBytes(RemotingHelper.DEFAULT_CHARSET));\n</code></pre>\n<p>åœ¨ Consumer ä¸­è®¢é˜… Tagï¼š</p>\n<pre><code>consumer.subscribe(&quot;TopicTest&quot;, &quot;TagA||TagB&quot;);// * ä»£è¡¨è®¢é˜…Topicä¸‹çš„æ‰€æœ‰æ¶ˆæ¯\n</code></pre>\n<p>æ¶ˆæ¯æä¾›æ–¹ä½¿ç”¨ tag åˆ†ç±»æ¶ˆæ¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Message</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>remoting<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * æ¶ˆæ¯å‘é€è€…</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @DateTime: 2021-06-01 14:04</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer3</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">DefaultMQProducer</span> producer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½® nameserver åœ°å€</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">//tag ç”¨æ¥è¿‡æ»¤æ¶ˆæ¯ï¼Œæ¶ˆæ¯åˆ†ç±»</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Message</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myTopic002\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"TAG-B\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"KEY-xx\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"hello-tag\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// ä¸éœ€è¦ broker å“åº”</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">sendOneway</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ¶ˆæ¯æ¶ˆè´¹æ–¹è¿›è¡Œæ¶ˆæ¯è¿‡æ»¤</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConsumeConcurrentlyContext</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConsumeConcurrentlyStatus</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>protocol<span class=\"token punctuation\">.</span>heartbeat<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageModel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * æ¶ˆæ¯æ¶ˆè´¹è€…</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @DateTime: 2021-06-01 14:41</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer3</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">DefaultMQPushConsumer</span> consumer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// æ¯ä¸€ä¸ª consumer å…³æ³¨ä¸€ä¸ª topic</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">//topic: å…³æ³¨çš„æ¶ˆæ¯çš„åœ°å€</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">// åªæ¥æ”¶ TAG-A çš„æ¶ˆæ¯ï¼Œå…¶ä»–æ¶ˆæ¯ä¼šè¢«è¿‡æ»¤æ‰</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myTopic002\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"TAG-A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">registerMessageListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">ConsumeConcurrentlyStatus</span> <span class=\"token function\">consumeMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">></span></span> msgs<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConsumeConcurrentlyContext</span> consumeConcurrentlyContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageExt</span> msg <span class=\"token operator\">:</span> msgs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token comment\">// é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ª consumer æ¶ˆè´¹</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœæ¶ˆæ¯è¢«æ¶ˆè´¹ï¼Œåˆ™æ¶ˆæ¯çŠ¶æ€å°†ä¿®æ”¹å¹¶è¿”å›ç»™æ¶ˆæ¯æä¾›è€…ï¼Œå‘Šè¯‰æ¶ˆæ¯æä¾›è€…æ¶ˆæ¯å·²ç»æ¶ˆè´¹</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœæš‚æ—¶ä¸æ¶ˆè´¹æ¶ˆæ¯ï¼Œåˆ™éœ€è¦è¿”å› ConsumeConcurrentlyStatus.RECONSUME_LATERï¼Œå‘Šè¯‰æ¶ˆæ¯æä¾›è€…è¿‡ä¸€ä¼šå†æ¬¡æä¾›æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token class-name\">ConsumeConcurrentlyStatus</span><span class=\"token punctuation\">.</span>CONSUME_SUCCESS<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Consumer start...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210601172031824.png\" alt=\"image-20210601172031824\" /></p>\n<h3 id=\"sqlè¡¨è¾¾å¼è¿‡æ»¤\"><a class=\"anchor\" href=\"#sqlè¡¨è¾¾å¼è¿‡æ»¤\">#</a> SQL è¡¨è¾¾å¼è¿‡æ»¤</h3>\n<p>æ¶ˆè´¹è€…å°†æ”¶åˆ°åŒ…å« TAGA æˆ– TAGB æˆ– TAGB çš„æ¶ˆæ¯ã€‚ä½†é™åˆ¶æ˜¯ä¸€æ¡æ¶ˆæ¯åªèƒ½æœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œè€Œè¿™å¯¹äºå¤æ‚çš„æƒ…å†µå¯èƒ½æ— æ•ˆã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ SQL è¡¨è¾¾å¼ç­›é€‰å‡ºæ¶ˆæ¯.</p>\n<h4 id=\"é…ç½®\"><a class=\"anchor\" href=\"#é…ç½®\">#</a> é…ç½®</h4>\n<p>åœ¨ <code>broker.conf </code> ä¸­æ·»åŠ é…ç½®</p>\n<pre><code>enablePropertyFilter=true\n</code></pre>\n<p>å¯åŠ¨ broker åŠ è½½æŒ‡å®šé…ç½®æ–‡ä»¶</p>\n<pre><code>../bin/mqbroker -n 192.168.150.113:9876 -c broker.conf \n</code></pre>\n<p>éšååœ¨é›†ç¾¤é…ç½®ä¸­å¯ä»¥çœ‹åˆ°</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20200219174859476.png\" alt=\"image-20200219174859476\" /></p>\n<h4 id=\"å®ä¾‹\"><a class=\"anchor\" href=\"#å®ä¾‹\">#</a> <strong>å®ä¾‹</strong></h4>\n<pre><code>        MessageSelector selector = MessageSelector.bySql(&quot;order &gt; 5&quot;);\n        consumer.subscribe(&quot;xxoo3&quot;, selector);\n</code></pre>\n<h4 id=\"è¯­æ³•\"><a class=\"anchor\" href=\"#è¯­æ³•\">#</a> è¯­æ³•</h4>\n<p>RocketMQ åªå®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„è¯­æ³•æ¥æ”¯æŒè¿™ä¸ªåŠŸèƒ½ã€‚ ä½ ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•å®ƒ.</p>\n<ol>\n<li>æ•°å­—æ¯”è¾ƒï¼Œåƒ  <code>&gt;</code> ,  <code>&gt;=</code> ,  <code>&lt;</code> ,  <code>&lt;=</code> ,  <code>BETWEEN</code> ,  <code>=</code> ;</li>\n<li>å­—ç¬¦æ¯”è¾ƒï¼Œåƒ  <code>=</code> ,  <code>&lt;&gt;</code> ,  <code>IN</code> ;</li>\n<li><code>IS NULL</code>  æˆ–è€…  <code>IS NOT NULL</code> ;</li>\n<li>é€»è¾‘è¿ç®— <code>AND</code> ,  <code>OR</code> ,  <code>NOT</code> ;</li>\n</ol>\n<p>å¸¸é‡ç±»å‹æ˜¯:</p>\n<ol>\n<li>æ•°å­—ï¼Œåƒ 123, 3.1415;</li>\n<li>å­—ç¬¦ä¸²ï¼Œåƒâ€˜abcâ€™, å¿…é¡»ä½¿ç”¨å•å¼•å·ï¼›</li>\n<li><code>NULL</code> , ç‰¹æ®Šå¸¸æ•°ï¼›</li>\n<li>å¸ƒå°”å¸¸é‡ï¼Œ <code>TRUE</code>  æˆ– <code>FALSE</code> ;</li>\n</ol>\n<h4 id=\"demo\"><a class=\"anchor\" href=\"#demo\">#</a> demo</h4>\n<p>éœ€è¦åœ¨ RocketMQ å®‰è£…ç›®å½•ä¸‹çš„ broker.conf é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ enablePropertyFilter=true</p>\n<p>ä¹‹åé‡å¯ broker</p>\n<pre><code class=\"language-cmd\">#å¯åŠ¨æ—¶éœ€è¦æŒ‡å®šåŠ è½½broker.conf\nmqbroker -n localhost:9876 -c D:\\rocketmq\\conf\\broker.conf autoCreateTopicEnable=true\n</code></pre>\n<p>æ¶ˆæ¯æä¾›æ–¹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Message</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>remoting<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * æ¶ˆæ¯å‘é€è€…</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @DateTime: 2021-06-01 14:04</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer3</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">DefaultMQProducer</span> producer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½® nameserver åœ°å€</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token comment\">//tag ç”¨æ¥è¿‡æ»¤æ¶ˆæ¯ï¼Œæ¶ˆæ¯åˆ†ç±»</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Message</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myTopic002\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"TAG-B\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"KEY-xx\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello-tagï¼š\"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            message<span class=\"token punctuation\">.</span><span class=\"token function\">putUserProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"age\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            producer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ¶ˆæ¯æ¶ˆè´¹æ–¹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageSelector</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConsumeConcurrentlyContext</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConsumeConcurrentlyStatus</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * æ¶ˆæ¯æ¶ˆè´¹è€…</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @DateTime: 2021-06-01 14:41</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer4</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">DefaultMQPushConsumer</span> consumer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxooxx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">MessageSelector</span> messageSelector <span class=\"token operator\">=</span> <span class=\"token class-name\">MessageSelector</span><span class=\"token punctuation\">.</span><span class=\"token function\">bySql</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"age >= 18 and age &lt;=28\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myTopic002\"</span><span class=\"token punctuation\">,</span> messageSelector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">registerMessageListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">ConsumeConcurrentlyStatus</span> <span class=\"token function\">consumeMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">></span></span> msgs<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConsumeConcurrentlyContext</span> consumeConcurrentlyContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageExt</span> msg <span class=\"token operator\">:</span> msgs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token comment\">// é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ª consumer æ¶ˆè´¹</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœæ¶ˆæ¯è¢«æ¶ˆè´¹ï¼Œåˆ™æ¶ˆæ¯çŠ¶æ€å°†ä¿®æ”¹å¹¶è¿”å›ç»™æ¶ˆæ¯æä¾›è€…ï¼Œå‘Šè¯‰æ¶ˆæ¯æä¾›è€…æ¶ˆæ¯å·²ç»æ¶ˆè´¹</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœæš‚æ—¶ä¸æ¶ˆè´¹æ¶ˆæ¯ï¼Œåˆ™éœ€è¦è¿”å› ConsumeConcurrentlyStatus.RECONSUME_LATERï¼Œå‘Šè¯‰æ¶ˆæ¯æä¾›è€…è¿‡ä¸€ä¼šå†æ¬¡æä¾›æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token class-name\">ConsumeConcurrentlyStatus</span><span class=\"token punctuation\">.</span>CONSUME_SUCCESS<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Consumer start...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¾“å‡º</p>\n<pre><code class=\"language-cmd\">Consumer start...\nhello-tagï¼š19\nhello-tagï¼š18\nhello-tagï¼š20\nhello-tagï¼š21\nhello-tagï¼š22\nhello-tagï¼š23\nhello-tagï¼š24\nhello-tagï¼š25\nhello-tagï¼š26\nhello-tagï¼š27\nhello-tagï¼š28\n</code></pre>\n<h3 id=\"å»¶è¿Ÿæ¶ˆæ¯\"><a class=\"anchor\" href=\"#å»¶è¿Ÿæ¶ˆæ¯\">#</a> å»¶è¿Ÿæ¶ˆæ¯</h3>\n<p>RocketMQ ä½¿ç”¨<strong> messageDelayLevel</strong> å¯ä»¥è®¾ç½®å»¶è¿ŸæŠ•é€’</p>\n<p><strong>é»˜è®¤é…ç½®ä¸º</strong></p>\n<pre><code>messageDelayLevel\t1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h\n</code></pre>\n<h4 id=\"é…ç½®-2\"><a class=\"anchor\" href=\"#é…ç½®-2\">#</a> é…ç½®</h4>\n<p>åœ¨ <code>broker.conf </code> ä¸­æ·»åŠ é…ç½®</p>\n<pre><code>messageDelayLevel=1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h\n</code></pre>\n<p>è¿™ä¸ªé…ç½®é¡¹é…ç½®äº†ä» 1 çº§å¼€å§‹ï¼Œå„çº§å»¶æ—¶çš„æ—¶é—´ï¼Œå¯ä»¥ä¿®æ”¹è¿™ä¸ªæŒ‡å®šçº§åˆ«çš„å»¶æ—¶æ—¶é—´ï¼›</p>\n<p>æ—¶é—´å•ä½æ”¯æŒï¼šsã€mã€hã€dï¼Œåˆ†åˆ«è¡¨ç¤ºç§’ã€åˆ†ã€æ—¶ã€å¤©ï¼›</p>\n<h4 id=\"ä½¿ç”¨\"><a class=\"anchor\" href=\"#ä½¿ç”¨\">#</a> ä½¿ç”¨</h4>\n<p>å‘é€æ¶ˆæ¯æ—¶è®¾ç½®</p>\n<pre><code>message.setDelayTimeLevel(1); \n</code></pre>\n<h3 id=\"é¡ºåºæ¶ˆè´¹\"><a class=\"anchor\" href=\"#é¡ºåºæ¶ˆè´¹\">#</a> é¡ºåºæ¶ˆè´¹</h3>\n<p>é˜Ÿåˆ—å…ˆå¤©æ”¯æŒ FIFO æ¨¡å‹ï¼Œå•ä¸€ç”Ÿäº§å’Œæ¶ˆè´¹è€…ä¸‹åªè¦ä¿è¯ä½¿ç”¨ <code>MessageListenerOrderly</code>  ç›‘å¬å™¨å³å¯</p>\n<p>é¡ºåºæ¶ˆè´¹è¡¨ç¤ºæ¶ˆæ¯æ¶ˆè´¹çš„é¡ºåºåŒç”Ÿäº§è€…ä¸ºæ¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å‘é€çš„é¡ºåºä¸€è‡´ï¼Œæ‰€ä»¥å¦‚æœæ­£åœ¨å¤„ç†å…¨å±€é¡ºåºæ˜¯å¼ºåˆ¶æ€§çš„åœºæ™¯ï¼Œéœ€è¦ç¡®ä¿ä½¿ç”¨çš„ä¸»é¢˜åªæœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>\n<p>å¹¶è¡Œæ¶ˆè´¹ä¸å†ä¿è¯æ¶ˆæ¯é¡ºåºï¼Œæ¶ˆè´¹çš„æœ€å¤§å¹¶è¡Œæ•°é‡å—æ¯ä¸ªæ¶ˆè´¹è€…å®¢æˆ·ç«¯æŒ‡å®šçš„çº¿ç¨‹æ± é™åˆ¶ã€‚</p>\n<p>é‚£ä¹ˆåªè¦é¡ºåºçš„å‘é€ï¼Œå†ä¿è¯ä¸€ä¸ªçº¿ç¨‹åªå»æ¶ˆè´¹ä¸€ä¸ªé˜Ÿåˆ—ä¸Šçš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆä»–å°±æ˜¯æœ‰åºçš„ã€‚</p>\n<p>è·Ÿæ™®é€šæ¶ˆæ¯ç›¸æ¯”ï¼Œé¡ºåºæ¶ˆæ¯çš„ä½¿ç”¨éœ€è¦åœ¨ producer çš„ send () æ–¹æ³•ä¸­æ·»åŠ  MessageQueueSelector æ¥å£çš„å®ç°ç±»ï¼Œå¹¶é‡å†™ select é€‰æ‹©ä½¿ç”¨çš„é˜Ÿåˆ—ï¼Œå› ä¸ºé¡ºåºæ¶ˆæ¯å±€éƒ¨é¡ºåºï¼Œéœ€è¦å°†æ‰€æœ‰æ¶ˆæ¯æŒ‡å®šå‘é€åˆ°åŒä¸€é˜Ÿåˆ—ä¸­ã€‚</p>\n<p><strong>ä¿è¯æœ‰åºå‚ä¸å› ç´ </strong></p>\n<ul>\n<li>FIFO</li>\n<li>é˜Ÿåˆ—å†…ä¿è¯æœ‰åº</li>\n<li>æ¶ˆè´¹çº¿ç¨‹</li>\n</ul>\n<p>ä¸€ä¸ª topic é»˜è®¤ç”±å››ä¸ª queue ç»„æˆï¼Œè€Œå‘é€æ¶ˆæ¯æ—¶å¯èƒ½ä¼šè¢«å­˜è¿›ä¸åŒçš„ queue ä¸­ï¼Œè¿™å°±å¯¼è‡´äº†æ¥æ”¶çš„æ¶ˆæ¯ä¸å‘é€çš„æ¶ˆæ¯é¡ºåºä¸ä¸€è‡´ã€‚æ‰€ä»¥ï¼Œè¦æƒ³ä¿è¯æœ‰åºï¼Œé¦–å…ˆå‘é€æ—¶éœ€è¦æœ‰åºå‘é€ï¼ˆä½¿ç”¨åŒä¸€ä¸ªçº¿ç¨‹å‘é€æ¶ˆæ¯ï¼‰ï¼Œå…¶æ¬¡è¦è®¾ç½®æ¶ˆæ¯å­˜è¿›åŒä¸€ä¸ª topic çš„åŒä¸€ä¸ª queue ä¸­ï¼Œæ¶ˆè´¹æ¶ˆæ¯æ—¶éœ€è¦ä¸€ä¸ªçº¿ç¨‹æ¶ˆè´¹ä¸€ä¸ª queue é‡Œçš„æ¶ˆæ¯ã€‚å½“æœ‰å¤šä¸ª queue æ—¶ï¼Œåªèƒ½ä¿è¯æ¶ˆè´¹æ¯ä¸ª queue é‡Œçš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ã€‚</p>\n<h4 id=\"demo-2\"><a class=\"anchor\" href=\"#demo-2\">#</a> demo</h4>\n<p>æœåŠ¡æä¾›æ–¹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>transaction</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageQueueSelector</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SendResult</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Message</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageQueue</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>remoting<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * æ¶ˆæ¯å‘é€è€…</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> * @DateTime: 2021-06-01 14:04</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer2</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">DefaultMQProducer</span> producer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQProducer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pro02\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½® nameserver åœ°å€</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Message</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo06\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"hello:\"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token class-name\">SendResult</span> sendResult <span class=\"token operator\">=</span> producer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    <span class=\"token comment\">// æŒ‡å®šå‘ topic çš„å“ªä¸ª queue ä¸­å†™æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                    <span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageQueueSelector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                        <span class=\"token keyword\">public</span> <span class=\"token class-name\">MessageQueue</span> <span class=\"token function\">select</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                                <span class=\"token comment\">// å½“å‰ topic ä¸­æ‰€æœ‰ queue</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                                <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageQueue</span><span class=\"token punctuation\">></span></span> list<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                                <span class=\"token comment\">// è¦å†™å…¥ queue çš„æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                                <span class=\"token class-name\">Message</span> message<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                                <span class=\"token comment\">// å¯¹åº” send () çš„ç¬¬ä¸‰ä¸ªå‚æ•° argï¼Œå³è¦é€‰æ‹©çš„ç¬¬å‡ ä¸ª queue</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                                <span class=\"token class-name\">Object</span> arg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                            <span class=\"token comment\">// è¿”å›é€‰æ‹©çš„ queue</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                            <span class=\"token keyword\">return</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                    <span class=\"token comment\">// é€‰æ‹©ç¬¬å‡ ä¸ª queue</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                    <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\">//        producer.shutdown();</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœåŠ¡æ¶ˆè´¹æ–¹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>transaction</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>consumer<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * æ¶ˆæ¯æ¶ˆè´¹è€…</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @DateTime: 2021-06-01 14:41</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Consumer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">DefaultMQPushConsumer</span> consumer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"group02\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// æ¯ä¸€ä¸ª consumer å…³æ³¨ä¸€ä¸ª topic</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">//topic: å…³æ³¨çš„æ¶ˆæ¯çš„åœ°å€</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// è¿‡æ»¤å™¨: * è¡¨ç¤ºä¸è¿‡æ»¤</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo06\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>         * MessageListenerConcurrently å¼€å¯å¤šä¸ªçº¿ç¨‹å¹¶å‘æ¶ˆè´¹æ¶ˆæ¯ã€‚ä¸€ä¸ª queue å¯èƒ½å¯¹åº”å¤šä¸ªçº¿ç¨‹</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>         */</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">/*consumer.registerMessageListener (new MessageListenerConcurrently () &#123;</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            @Override</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            public ConsumeConcurrentlyStatus consumeMessage (List&lt;MessageExt> msgs, ConsumeConcurrentlyContext consumeConcurrentlyContext) &#123;</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                for (MessageExt msg : msgs) &#123;</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    System.out.println (new String (msg.getBody ()));</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                &#125;</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                // é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ª consumer æ¶ˆè´¹</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                // å¦‚æœæ¶ˆæ¯è¢«æ¶ˆè´¹ï¼Œåˆ™æ¶ˆæ¯çŠ¶æ€å°†ä¿®æ”¹å¹¶è¿”å›ç»™æ¶ˆæ¯æä¾›è€…ï¼Œå‘Šè¯‰æ¶ˆæ¯æä¾›è€…æ¶ˆæ¯å·²ç»æ¶ˆè´¹</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                // å¦‚æœæš‚æ—¶ä¸æ¶ˆè´¹æ¶ˆæ¯ï¼Œåˆ™éœ€è¦è¿”å› ConsumeConcurrentlyStatus.RECONSUME_LATERï¼Œå‘Šè¯‰æ¶ˆæ¯æä¾›è€…è¿‡ä¸€ä¼šå†æ¬¡æä¾›æ¶ˆæ¯</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            &#125;</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        &#125;);*/</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token comment\">// æœ€å¤§å¼€å¯æ¶ˆè´¹çº¿ç¨‹æ•°</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">//        consumer.setConsumeThreadMax(5);</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token comment\">// æœ€å°æ¶ˆè´¹çº¿ç¨‹æ•°</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">//        consumer.setConsumeThreadMin();</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>         * MessageListenerOrderly ä¸€ä¸ª queue å¯¹åº”ä¸€ä¸ªçº¿ç¨‹</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>         */</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">registerMessageListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageListenerOrderly</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">ConsumeOrderlyStatus</span> <span class=\"token function\">consumeMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">></span></span> msgs<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConsumeOrderlyContext</span> consumeOrderlyContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageExt</span> msg <span class=\"token operator\">:</span> msgs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" Thread-\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token class-name\">ConsumeOrderlyStatus</span><span class=\"token punctuation\">.</span>SUCCESS<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token comment\">// æ¶ˆè´¹æ¶ˆæ¯æ—¶å¯ä»¥é˜»å¡çš„æ—¶é—´</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token comment\">//        consumer.setConsumeTimeout();</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Consumer start...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"é‡è¯•æœºåˆ¶\"><a class=\"anchor\" href=\"#é‡è¯•æœºåˆ¶\">#</a> é‡è¯•æœºåˆ¶</h3>\n<h4 id=\"producer\"><a class=\"anchor\" href=\"#producer\">#</a> producer</h4>\n<p><strong>é»˜è®¤è¶…æ—¶æ—¶é—´</strong></p>\n<pre><code>    /**\n     * Timeout for sending messages.\n     */\n    private int sendMsgTimeout = 3000;\n</code></pre>\n<pre><code>\t// å¼‚æ­¥å‘é€æ—¶ é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ 2\n\tproducer.setRetryTimesWhenSendAsyncFailed(1);\n\t// åŒæ­¥å‘é€æ—¶ é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ 2\n\tproducer.setRetryTimesWhenSendFailed(1);\t\n\t\n\t// æ˜¯å¦å‘å…¶ä»–brokerå‘é€è¯·æ±‚ é»˜è®¤false\n\tproducer.setRetryAnotherBrokerWhenNotStoreOK(true);\n</code></pre>\n<h4 id=\"consumer\"><a class=\"anchor\" href=\"#consumer\">#</a> Consumer</h4>\n<p>æ¶ˆè´¹è¶…æ—¶ï¼Œå•ä½åˆ†é’Ÿ</p>\n<p><code>consumer.setConsumeTimeout()</code></p>\n<p>å‘é€ ackï¼Œæ¶ˆè´¹å¤±è´¥</p>\n<p><code>RECONSUME_LATER</code></p>\n<h4 id=\"brokeræŠ•é€’\"><a class=\"anchor\" href=\"#brokeræŠ•é€’\">#</a> broker æŠ•é€’</h4>\n<p>åªæœ‰åœ¨æ¶ˆæ¯æ¨¡å¼ä¸º MessageModel.CLUSTERING é›†ç¾¤æ¨¡å¼æ—¶ï¼ŒBroker æ‰ä¼šè‡ªåŠ¨è¿›è¡Œé‡è¯•ï¼Œå¹¿æ’­æ¶ˆæ¯ä¸é‡è¯•</p>\n<p>é‡æŠ•ä½¿ç”¨ <code>messageDelayLevel</code></p>\n<p>é»˜è®¤å€¼</p>\n<pre><code>messageDelayLevel\t1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h\n</code></pre>\n<h3 id=\"äº‹åŠ¡æ¶ˆæ¯\"><a class=\"anchor\" href=\"#äº‹åŠ¡æ¶ˆæ¯\">#</a> äº‹åŠ¡æ¶ˆæ¯</h3>\n<p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„äº‹åŠ¡å¯ä»¥ä½¿ç”¨ TCCï¼ˆTryã€Confirmã€Cancelï¼‰ã€2pc æ¥è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ¶ˆæ¯åŸå­æ€§</p>\n<p>RocketMQ 4.3 + æä¾›åˆ†å¸ƒäº‹åŠ¡åŠŸèƒ½ï¼Œé€šè¿‡ RocketMQ äº‹åŠ¡æ¶ˆæ¯èƒ½è¾¾åˆ°åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´</p>\n<h4 id=\"rocketmqå®ç°æ–¹å¼\"><a class=\"anchor\" href=\"#rocketmqå®ç°æ–¹å¼\">#</a> RocketMQ å®ç°æ–¹å¼</h4>\n<p>**Half Messageï¼š** é¢„å¤„ç†æ¶ˆæ¯ï¼Œå½“ broker æ”¶åˆ°æ­¤ç±»æ¶ˆæ¯åï¼Œä¼šå­˜å‚¨åˆ° RMQ_SYS_TRANS_HALF_TOPIC çš„æ¶ˆæ¯æ¶ˆè´¹é˜Ÿåˆ—ä¸­</p>\n<p>** æ£€æŸ¥äº‹åŠ¡çŠ¶æ€ï¼š**Broker ä¼šå¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¶ˆè´¹ RMQ_SYS_TRANS_HALF_TOPIC é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œæ¯æ¬¡æ‰§è¡Œä»»åŠ¡ä¼šå‘æ¶ˆæ¯å‘é€è€…ç¡®è®¤äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€ï¼ˆæäº¤ã€å›æ»šã€æœªçŸ¥ï¼‰ï¼Œå¦‚æœæ˜¯æœªçŸ¥ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡å›è°ƒã€‚</p>\n<p>** è¶…æ—¶ï¼š** å¦‚æœè¶…è¿‡å›æŸ¥æ¬¡æ•°ï¼Œé»˜è®¤å›æ»šæ¶ˆæ¯</p>\n<h4 id=\"transactionlistenerçš„ä¸¤ä¸ªæ–¹æ³•\"><a class=\"anchor\" href=\"#transactionlistenerçš„ä¸¤ä¸ªæ–¹æ³•\">#</a> TransactionListener çš„ä¸¤ä¸ªæ–¹æ³•</h4>\n<h5 id=\"executelocaltransaction\"><a class=\"anchor\" href=\"#executelocaltransaction\">#</a> executeLocalTransaction</h5>\n<p>åŠæ¶ˆæ¯å‘é€æˆåŠŸè§¦å‘æ­¤æ–¹æ³•æ¥æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</p>\n<h5 id=\"checklocaltransaction\"><a class=\"anchor\" href=\"#checklocaltransaction\">#</a> checkLocalTransaction</h5>\n<p>broker å°†å‘é€æ£€æŸ¥æ¶ˆæ¯æ¥æ£€æŸ¥äº‹åŠ¡çŠ¶æ€ï¼Œå¹¶å°†è°ƒç”¨æ­¤æ–¹æ³•æ¥è·å–æœ¬åœ°äº‹åŠ¡çŠ¶æ€</p>\n<h5 id=\"æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€\"><a class=\"anchor\" href=\"#æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€\">#</a> æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€</h5>\n<p><strong>LocalTransactionState.COMMIT_MESSAGE</strong></p>\n<p>æ‰§è¡Œäº‹åŠ¡æˆåŠŸï¼Œç¡®è®¤æäº¤</p>\n<p><strong>LocalTransactionState.ROLLBACK_MESSAGE</strong></p>\n<p>å›æ»šæ¶ˆæ¯ï¼Œbroker ç«¯ä¼šåˆ é™¤åŠæ¶ˆæ¯</p>\n<p><strong>LocalTransactionState.UNKNOW</strong></p>\n<p>æš‚æ—¶ä¸ºæœªçŸ¥çŠ¶æ€ï¼Œç­‰å¾… broker å›æŸ¥</p>\n<h4 id=\"demo-3\"><a class=\"anchor\" href=\"#demo-3\">#</a> demo</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>transaction</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>producer<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Message</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>rocketmq<span class=\"token punctuation\">.</span>remoting<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * æ¶ˆæ¯å‘é€è€…</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @DateTime: 2021-06-01 14:04</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Producer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MQBrokerException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RemotingException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">TransactionMQProducer</span> producer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransactionMQProducer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// è®¾ç½® nameserver åœ°å€</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">setNamesrvAddr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1:9876\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">// å›è°ƒ</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">setTransactionListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">TransactionListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">LocalTransactionState</span> <span class=\"token function\">executeLocalTransaction</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Message</span> msg<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> o<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token comment\">// æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"==========executeLocalTransaction\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"msg:\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"transactionId:\"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">.</span><span class=\"token function\">getTransactionId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                    <span class=\"token comment\">// å‡ºé”™å›æ»š</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                    <span class=\"token keyword\">return</span> <span class=\"token class-name\">LocalTransactionState</span><span class=\"token punctuation\">.</span>ROLLBACK_MESSAGE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token comment\">// æ¨¡æ‹ŸæœªçŸ¥ï¼Œä¹‹åä¼šè¿›å…¥ checkLocalTransaction ()</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token class-name\">LocalTransactionState</span><span class=\"token punctuation\">.</span>UNKNOW<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">LocalTransactionState</span> <span class=\"token function\">checkLocalTransaction</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageExt</span> messageExt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token comment\">//broker ç«¯å›è°ƒï¼Œæ£€æŸ¥äº‹åŠ¡</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token comment\">// å¦‚æœæ²¡æœ‰è¢« consumer æ¶ˆè´¹ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¯¥æ–¹æ³•ä¸­é‡æŠ•æ¶ˆæ¯</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"=============checkLocalTransaction\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"msg:\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>messageExt<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"transactionId:\"</span> <span class=\"token operator\">+</span> messageExt<span class=\"token punctuation\">.</span><span class=\"token function\">getTransactionId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                <span class=\"token comment\">// ä»£è¡¨äº‹åŠ¡æ‰§è¡ŒæˆåŠŸ</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token class-name\">LocalTransactionState</span><span class=\"token punctuation\">.</span>COMMIT_MESSAGE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        producer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Message</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo01\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"hello transactions\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token class-name\">SendResult</span> sendResult <span class=\"token operator\">=</span> producer<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessageInTransaction</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>sendResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token comment\">//        producer.shutdown();</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "Java",
                "Java",
                "æ¶ˆæ¯ä¸­é—´ä»¶",
                "RocketMQ"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/RocketMQ/RocketMQ-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/",
            "url": "https://baiyezi.vip/java/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/RocketMQ/RocketMQ-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/",
            "title": "RocketMQ-åŸºç¡€æ¦‚å¿µ",
            "date_published": "2021-08-10T10:24:58.000Z",
            "content_html": "<p>ä¸»æµçš„ MQ æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ ActiveMQã€RabbitMQã€RocketMQã€Kafkaã€ZeroMQ ç­‰ã€‚</p>\n<p>ä¹‹å‰é˜¿é‡Œå·´å·´ä¹Ÿæ˜¯ä½¿ç”¨ ActiveMQï¼Œéšç€ä¸šåŠ¡å‘å±•ï¼ŒActiveMQ IO æ¨¡å—å‡ºç°ç“¶é¢ˆï¼Œåæ¥é˜¿é‡Œå·´å·´ é€šè¿‡ä¸€ç³»åˆ—ä¼˜åŒ–ä½†æ˜¯è¿˜æ˜¯ä¸èƒ½å¾ˆå¥½çš„è§£å†³ï¼Œä¹‹åé˜¿é‡Œå·´å·´æŠŠæ³¨æ„åŠ›æ”¾åˆ°äº†ä¸»æµæ¶ˆæ¯ä¸­é—´ä»¶ kafka ä¸Šé¢ï¼Œä½†æ˜¯ kafka å¹¶ä¸èƒ½æ»¡è¶³ä»–ä»¬çš„è¦æ±‚ï¼Œå°¤å…¶æ˜¯ä½å»¶è¿Ÿå’Œé«˜å¯é æ€§ã€‚</p>\n<p>æ‰€ä»¥ RocketMQ æ˜¯ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼ˆkafkaï¼‰MetaQ çš„å†…æ ¸ï¼Œåˆå¯¹å…¶è¿›è¡Œäº†ä¼˜åŒ–è®©å…¶æ›´æ»¡è¶³äº’è”ç½‘å…¬å¸çš„ç‰¹ç‚¹ã€‚å®ƒæ˜¯çº¯ Java å¼€å‘ï¼Œå…·æœ‰é«˜ååé‡ã€é«˜å¯ç”¨æ€§ã€é€‚åˆå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿåº”ç”¨çš„ç‰¹ç‚¹ã€‚ RocketMQ ç›®å‰åœ¨é˜¿é‡Œé›†å›¢è¢«å¹¿æ³›åº”ç”¨äºäº¤æ˜“ã€å……å€¼ã€æµè®¡ç®—ã€æ¶ˆæ¯æ¨é€ã€æ—¥å¿—æµå¼å¤„ç†ã€binglog åˆ†å‘ç­‰åœºæ™¯ã€‚</p>\n<h2 id=\"windowsä¸Šå®‰è£…\"><a class=\"anchor\" href=\"#windowsä¸Šå®‰è£…\">#</a> Windows ä¸Šå®‰è£…</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yb2NrZXRtcS5hcGFjaGUub3JnL2RvY3MvcXVpY2stc3RhcnQv\">å®˜ç½‘</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYXBhY2hlLm9yZy9keW4vY2xvc2VyLmNnaT9wYXRoPXJvY2tldG1xLzQuOC4wL3JvY2tldG1xLWFsbC00LjguMC1iaW4tcmVsZWFzZS56aXA=\">ä¸‹è½½åœ°å€</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9yb2NrZXRtcS90cmVlL21hc3Rlci9kb2NzL2Nu\">ä¸­æ–‡æ–‡æ¡£</span></p>\n<p>é…ç½®ç¯å¢ƒå˜é‡</p>\n<pre><code class=\"language-cmd\">ROCKETMQ_HOME=&quot;D:\\rocketmq&quot;\n%ROCKETMQ_HOME%\\bin\nNAMESRV_ADDR=&quot;localhost:9876&quot;\n</code></pre>\n<p>æµ‹è¯•ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ cmd</p>\n<p>å¼€å¯ rocketmq æœåŠ¡</p>\n<pre><code class=\"language-cmd\">C:\\WINDOWS\\system32&gt;mqnamesrv\nJava HotSpot(TM) 64-Bit Server VM warning: Using the DefNew young collector with the CMS collector is deprecated and will likely be removed in a future release\nJava HotSpot(TM) 64-Bit Server VM warning: UseCMSCompactAtFullCollection is deprecated and will likely be removed in a future release.\nThe Name Server boot success. serializeType=JSON\n</code></pre>\n<p>å¼€å¯ broker</p>\n<pre><code class=\"language-cmd\">C:\\WINDOWS\\system32&gt;mqbroker -n localhost:9876 autoCreateTopicEnable=true\nThe broker[Fan, 172.20.10.3:10911] boot success. serializeType=JSON and name server is localhost:9876\n</code></pre>\n<p>å‘é€æ¶ˆæ¯</p>\n<pre><code class=\"language-cmd\">C:\\WINDOWS\\system32&gt;tools org.apache.rocketmq.example.quickstart.Producer\n14:20:11.211 [main] DEBUG i.n.u.i.l.InternalLoggerFactory - Using SLF4J as the default logging framework\nRocketMQLog:WARN No appenders could be found for logger (io.netty.util.internal.PlatformDependent0).\nRocketMQLog:WARN Please initialize the logger system properly.\nSendResult [sendStatus=SEND_OK, msgId=7F00000134C40D7163619D926ADF0000, offsetMsgId=AC140A0300002A9F0000000000000000, messageQueue=MessageQueue [topic=TopicTest, brokerName=Fan, queueId=2], queueOffset=0]\n</code></pre>\n<p>æ¥æ”¶æ¶ˆæ¯</p>\n<pre><code class=\"language-cmd\">C:\\WINDOWS\\system32&gt;tools org.apache.rocketmq.example.quickstart.Consumer\n14:20:11.292 [main] DEBUG i.n.u.i.l.InternalLoggerFactory - Using SLF4J as the default logging framework\nConsumer Started.\nConsumeMessageThread_14 Receive New Messages: [MessageExt [brokerName=Fan, queueId=2, storeSize=202, queueOffset=5, sysFlag=0, bornTimestamp=1622442018931, bornHost=/172.20.10.3:10521, storeTimestamp=1622442018939, storeHost=/172.20.10.3:10911, msgId=AC140A0300002A9F0000000000000FBE, commitLogOffset=4030, bodyCRC=548040149, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message&#123;topic='TopicTest', flag=0, properties=&#123;MIN_OFFSET=0, MAX_OFFSET=250, CONSUME_START_TIME=1622442057391, UNIQ_KEY=7F00000134C40D7163619D926C730014, CLUSTER=DefaultCluster, WAIT=true, TAGS=TagA&#125;, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 32, 50, 48], transactionId='null'&#125;]]\n</code></pre>\n<h3 id=\"å‘½ä»¤å¸®åŠ©\"><a class=\"anchor\" href=\"#å‘½ä»¤å¸®åŠ©\">#</a> å‘½ä»¤å¸®åŠ©</h3>\n<pre><code class=\"language-cmd\">C:\\WINDOWS\\system32&gt;mqadmin\nThe most commonly used mqadmin commands are:\n   updateTopic          Update or create topic\n   deleteTopic          Delete topic from broker and NameServer.\n   updateSubGroup       Update or create subscription group\n   deleteSubGroup       Delete subscription group from broker.\n   updateBrokerConfig   Update broker's config\n   updateTopicPerm      Update topic perm\n   topicRoute           Examine topic route info\n   topicStatus          Examine topic Status info\n   topicClusterList     get cluster info for topic\n   brokerStatus         Fetch broker runtime status data\n   queryMsgById         Query Message by Id\n   queryMsgByKey        Query Message by Key\n   queryMsgByUniqueKey  Query Message by Unique key\n   queryMsgByOffset     Query Message by offset\n   QueryMsgTraceById    query a message trace\n   printMsg             Print Message Detail\n   printMsgByQueue      Print Message Detail\n   sendMsgStatus        send msg to broker.\n   brokerConsumeStats   Fetch broker consume stats data\n   producerConnection   Query producer's socket connection and client version\n   consumerConnection   Query consumer's socket connection, client version and subscription\n   consumerProgress     Query consumers's progress, speed\n   consumerStatus       Query consumer's internal data structure\n   cloneGroupOffset     clone offset from other group.\n   clusterList          List all of clusters\n   topicList            Fetch all topic list from name server\n   updateKvConfig       Create or update KV config.\n   deleteKvConfig       Delete KV config.\n   wipeWritePerm        Wipe write perm of broker in all name server\n   resetOffsetByTime    Reset consumer offset by timestamp(without client restart).\n   updateOrderConf      Create or update or delete order conf\n   cleanExpiredCQ       Clean expired ConsumeQueue on broker.\n   cleanUnusedTopic     Clean unused topic on broker.\n   startMonitoring      Start Monitoring\n   statsAll             Topic and Consumer tps stats\n   allocateMQ           Allocate MQ\n   checkMsgSendRT       check message send response time\n   clusterRT            List All clusters Message Send RT\n   getNamesrvConfig     Get configs of name server.\n   updateNamesrvConfig  Update configs of name server.\n   getBrokerConfig      Get broker config by cluster or special broker!\n   queryCq              Query cq command.\n   sendMessage          Send a message\n   consumeMessage       Consume message\n   updateAclConfig      Update acl config yaml file in broker\n   deleteAccessConfig   Delete Acl Config Account in broker\n   clusterAclConfigVersion List all of acl config version information in cluster\n   updateGlobalWhiteAddr Update global white address for acl Config File in broker\n   getAccessConfigSubCommand List all of acl config information in cluster\n\nSee 'mqadmin help &lt;command&gt;' for more information on a specific command.\n\n# æŸ¥çœ‹å…·ä½“å‘½ä»¤ä½¿ç”¨æ–¹å¼\nC:\\WINDOWS\\system32&gt;mqadmin help topicList\nusage: mqadmin topicList [-c] [-h] [-n &lt;arg&gt;]\n -c,--clusterModel        clusterModel\n -h,--help                Print help\n -n,--namesrvAddr &lt;arg&gt;   Name server address list, eg: 192.168.0.1:9876;192.168.0.2:9876\n</code></pre>\n<h2 id=\"linuxä¸Šå®‰è£…\"><a class=\"anchor\" href=\"#linuxä¸Šå®‰è£…\">#</a> Linux ä¸Šå®‰è£…</h2>\n<h4 id=\"1ä¸‹è½½æºç å¹¶ä¸Šä¼ åˆ°linux\"><a class=\"anchor\" href=\"#1ä¸‹è½½æºç å¹¶ä¸Šä¼ åˆ°linux\">#</a> 1. ä¸‹è½½æºç å¹¶ä¸Šä¼ åˆ° Linux</h4>\n<p><a href=\"https://mirrors.bfsu.edu.cn/apache/rocketmq/4.8.0/rocketmq-all-4.8.0-source-release.zip\"><strong>https://mirrors.bfsu.edu.cn/apache/rocketmq/4.8.0/rocketmq-all-4.8.0-source-release.zip</strong></a></p>\n<h4 id=\"2åœ¨linuxä¸Šå®‰è£…maven\"><a class=\"anchor\" href=\"#2åœ¨linuxä¸Šå®‰è£…maven\">#</a> 2. åœ¨ Linux ä¸Šå®‰è£… Maven</h4>\n<p><strong>ä¸‹è½½ Maven</strong></p>\n<pre><code>wget https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz\n</code></pre>\n<p><strong>æ·»åŠ é˜¿é‡Œäº‘é•œåƒ</strong></p>\n<p>ä¿®æ”¹ <code>maven/conf</code>  ç›®å½•ä¸‹çš„ <code>settings.xml</code></p>\n<p>åœ¨ <code>mirrors</code>  èŠ‚ç‚¹ä¸‹æ·»åŠ </p>\n<pre><code>&lt;mirror&gt; \n    &lt;id&gt;aliyun-maven&lt;/id&gt; \n    &lt;mirrorOf&gt;*&lt;/mirrorOf&gt; \n    &lt;name&gt;aliyun maven&lt;/name&gt; \n    &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt; \n&lt;/mirror&gt;\n</code></pre>\n<p><strong>é…ç½® maven ç¯å¢ƒå˜é‡</strong></p>\n<p>ä¿®æ”¹ <code>/etc/profile</code></p>\n<pre><code>export M2_HOME=/usr/local/maven\nexport PATH=$PATH:$M2_HOME/bin\n</code></pre>\n<p><strong>é…ç½® java ç¯å¢ƒå˜é‡</strong></p>\n<pre><code>export JAVA_HOME=&quot;/usr/java/jdk1.8.0_181-amd64&quot;\nexport CLASS_PATH=&quot;$JAVA_HOME/lib&quot;\nexport PATH=&quot;.$PATH:$JAVA_HOME/bin&quot;\n</code></pre>\n<p>ç¯å¢ƒå˜é‡ä¿®å®Œæ‰§è¡Œ <code>source /etc/profile</code>  ç«‹å³ç”Ÿæ•ˆ</p>\n<p><strong>è¿›å…¥ rocketmq ä¸»ç›®å½•ç¼–è¯‘é¡¹ç›®</strong></p>\n<pre><code>mvn -Prelease-all -DskipTests clean install -U\n</code></pre>\n<h4 id=\"3å¯åŠ¨nameserver\"><a class=\"anchor\" href=\"#3å¯åŠ¨nameserver\">#</a> 3. å¯åŠ¨ nameserver</h4>\n<p><code>bin</code>  ç›®å½•ä¸‹æ‰§è¡Œ</p>\n<pre><code>./mqnamesrv\n</code></pre>\n<p>æ­£å¸¸æç¤º</p>\n<p><img data-src=\"RocketMQ%EF%BC%88%E4%B8%80%EF%BC%89.assets/image-20200218150050167.png\" alt=\"image-20200218150050167\" /></p>\n<h4 id=\"4å¯åŠ¨broker\"><a class=\"anchor\" href=\"#4å¯åŠ¨broker\">#</a> 4. å¯åŠ¨ Broker</h4>\n<pre><code>./mqbroker -n localhost:9876\n</code></pre>\n<p>æ­£å¸¸æç¤º</p>\n<p><img data-src=\"RocketMQ%EF%BC%88%E4%B8%80%EF%BC%89.assets/image-20200218150114714.png\" alt=\"image-20200218150114714\" /></p>\n<h4 id=\"5æµ‹è¯•æ¶ˆæ¯å‘é€\"><a class=\"anchor\" href=\"#5æµ‹è¯•æ¶ˆæ¯å‘é€\">#</a> 5. æµ‹è¯•æ¶ˆæ¯å‘é€</h4>\n<p>ä½¿ç”¨ <code>tool.sh</code>  è„šæœ¬æ‰§è¡Œæµ‹è¯•ç¨‹åº</p>\n<p>åœ¨ <code>bin</code>  ç›®å½•ä¸‹æ‰§è¡Œ</p>\n<pre><code>./tools.sh org.apache.rocketmq.example.quickstart.Producer\n</code></pre>\n<p>æç¤ºå¦‚ä¸‹è¡¨ç¤ºæˆåŠŸ</p>\n<p><img data-src=\"RocketMQ%EF%BC%88%E4%B8%80%EF%BC%89.assets/image-20200218145049603.png\" alt=\"image-20200218145049603\" /></p>\n<p><strong>6. æ¥å—æ¶ˆæ¯</strong></p>\n<pre><code>./tools.sh org.apache.rocketmq.example.quickstart.Consumer\n</code></pre>\n<h3 id=\"æ§åˆ¶å°rocketmq-consoleç¼–è¯‘å®‰è£…\"><a class=\"anchor\" href=\"#æ§åˆ¶å°rocketmq-consoleç¼–è¯‘å®‰è£…\">#</a> æ§åˆ¶å° rocketmq-console ç¼–è¯‘å®‰è£…</h3>\n<h4 id=\"ä¸‹è½½\"><a class=\"anchor\" href=\"#ä¸‹è½½\">#</a> ä¸‹è½½</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9yb2NrZXRtcS1leHRlcm5hbHM=\">https://github.com/apache/rocketmq-externals</span></p>\n<p><strong>ä¸­æ–‡æŒ‡å—</strong></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9yb2NrZXRtcS1leHRlcm5hbHMvYmxvYi9tYXN0ZXIvcm9ja2V0bXEtY29uc29sZS9kb2MvMV8wXzAvVXNlckd1aWRlX0NOLm1k\">https://github.com/apache/rocketmq-externals/blob/master/rocketmq-console/doc/1_0_0/UserGuide_CN.md</span></p>\n<h4 id=\"ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹ç¼©\"><a class=\"anchor\" href=\"#ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹ç¼©\">#</a> ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹ç¼©</h4>\n<h4 id=\"ç¼–è¯‘\"><a class=\"anchor\" href=\"#ç¼–è¯‘\">#</a> ç¼–è¯‘</h4>\n<p>è¿›å…¥ <code>rocketmq-console</code>  ç›®å½•</p>\n<p>æ‰§è¡Œç¼–è¯‘</p>\n<pre><code>mvn clean package -Dmaven.test.skip=true\n</code></pre>\n<h4 id=\"å¯åŠ¨\"><a class=\"anchor\" href=\"#å¯åŠ¨\">#</a> å¯åŠ¨</h4>\n<p>ç¼–è¯‘æˆåŠŸååœ¨ <code>rocketmq-console/target</code>  ç›®å½•ä¸‹æ‰§è¡Œ <code>rocketmq-console-ng-1.0.1.jar</code></p>\n<p>å¯åŠ¨æ—¶ï¼Œç›´æ¥åŠ¨æ€æ·»åŠ  <code>nameserver</code>  åœ°å€æˆ–ç¼–è¾‘ <code>application.properties</code>  æ·»åŠ å±æ€§</p>\n<pre><code>java -jar rocketmq-console-ng-1.0.1.jar --rocketmq.config.namesrvAddr=127.0.0.1:9876\n\n</code></pre>\n<p>å¯åŠ¨æˆåŠŸåè®¿é—® http://localhost:8080</p>\n<p><img data-src=\"RocketMQ%EF%BC%88%E4%B8%80%EF%BC%89.assets/image-20200218155021928.png\" alt=\"image-20200218155021928\" /></p>\n<h4 id=\"pomxmlä¾èµ–\"><a class=\"anchor\" href=\"#pomxmlä¾èµ–\">#</a> pom.xml ä¾èµ–</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.rocketmq<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>rocketmq-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>4.6.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"å®‰è£…å¯åŠ¨å¸¸è§é”™è¯¯\"><a class=\"anchor\" href=\"#å®‰è£…å¯åŠ¨å¸¸è§é”™è¯¯\">#</a> å®‰è£…å¯åŠ¨å¸¸è§é”™è¯¯</h3>\n<h4 id=\"ç¼–è¯‘æ—¶åŒ…æ— æ³•åœ¨mirrorä¸Šæ‰¾åˆ°-æç¤º502é”™è¯¯\"><a class=\"anchor\" href=\"#ç¼–è¯‘æ—¶åŒ…æ— æ³•åœ¨mirrorä¸Šæ‰¾åˆ°-æç¤º502é”™è¯¯\">#</a> ç¼–è¯‘æ—¶åŒ…æ— æ³•åœ¨ mirror ä¸Šæ‰¾åˆ° æç¤º 502 é”™è¯¯</h4>\n<p>** åŸå› ï¼š** ç½‘ç»œä¸å¥½æˆ– maven ä»“åº“æœåŠ¡å™¨å‡ºé”™</p>\n<p>é‡è¯•å³å¯ï¼Œæˆ–è€…æ¬¢è¿é•œåƒä»“åº“</p>\n<h4 id=\"å‘é€å¤±è´¥æç¤ºconnect-to-null-failed\"><a class=\"anchor\" href=\"#å‘é€å¤±è´¥æç¤ºconnect-to-null-failed\">#</a> <strong>å‘é€å¤±è´¥æç¤º connect to null failed</strong></h4>\n<pre><code> ./tools.sh org.apache.rocketmq.example.quickstart.Producer\n22:49:02.470 [main] DEBUG i.n.u.i.l.InternalLoggerFactory - Using SLF4J as the default logging framework\nRocketMQLog:WARN No appenders could be found for logger (io.netty.util.internal.PlatformDependent0).\nRocketMQLog:WARN Please initialize the logger system properly.\njava.lang.IllegalStateException: org.apache.rocketmq.remoting.exception.RemotingConnectException: connect to\n null failed\n</code></pre>\n<p>** åŸå› ï¼š** ä¸çŸ¥é“ <code>nameserver</code>  åœ¨å“ªå„¿</p>\n<p>åœ¨ <code>tools</code>  è„šæœ¬ä¸­æ·»åŠ </p>\n<pre><code>export NAMESRV_ADDR=localhost:9876\n</code></pre>\n<h4 id=\"å¯åŠ¨brokerå¤±è´¥-cannot-allocate-memory\"><a class=\"anchor\" href=\"#å¯åŠ¨brokerå¤±è´¥-cannot-allocate-memory\">#</a> å¯åŠ¨ broker å¤±è´¥ Cannot allocate memory</h4>\n<p>** åŸå› ï¼š**jvm å¯åŠ¨åˆå§‹åŒ–å†…å­˜åˆ†é…å¤§äºç‰©ç†å†…å­˜</p>\n<pre><code>[root@node-113b bin]# ./mqbroker -n localhost:9876\nJava HotSpot(TM) 64-Bit Server VM warning: INFO: os::commit_memory(0x00000005c0000000, 8589934592, 0) failed\n; error='Cannot allocate memory' (errno=12)#\n# There is insufficient memory for the Java Runtime Environment to continue.\n# Native memory allocation (mmap) failed to map 8589934592 bytes for committing reserved memory.\n# An error report file with more information is saved as:\n# /usr/local/rocketmq/bin/hs_err_pid1997.log\n\n</code></pre>\n<p>ä¿®æ”¹å¯åŠ¨è„šæœ¬ä¸­çš„ jvm å‚æ•°</p>\n<p><code>runbroker.sh</code>  broker</p>\n<p><code>runserver.sh</code>  nameserver</p>\n<p>é»˜è®¤æ•°å€¼ç»™çš„éƒ½å¾ˆå¤§ï¼Œæ”¹å°å³å¯</p>\n<pre><code>JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=64m -XX:MaxMetaspaceSize=100m&quot;\n</code></pre>\n<h4 id=\"å¯åŠ¨brokeræˆåŠŸä½†æç¤ºfailed-to-obtain-the-host-name\"><a class=\"anchor\" href=\"#å¯åŠ¨brokeræˆåŠŸä½†æç¤ºfailed-to-obtain-the-host-name\">#</a> å¯åŠ¨ broker æˆåŠŸä½†æç¤ºï¼šFailed to obtain the host name</h4>\n<pre><code>[root@node-113b bin]# ./mqbroker -n localhost:9876\n22:30:42.307 [main] ERROR RocketmqCommon - Failed to obtain the host name\njava.net.UnknownHostException: node-113b: node-113b: No address associated with hostname\n\tat java.net.InetAddress.getLocalHost(InetAddress.java:1505) ~[na:1.8.0_181]\n\tat org.apache.rocketmq.common.BrokerConfig.localHostName(BrokerConfig.java:189) [rocketmq-common-4.6\n.1.jar:4.6.1]\tat org.apache.rocketmq.common.BrokerConfig.&lt;init&gt;(BrokerConfig.java:38) [rocketmq-common-4.6.1.jar:4\n.6.1]\tat org.apache.rocketmq.broker.BrokerStartup.createBrokerController(BrokerStartup.java:110) [rocketmq\n-broker-4.6.1.jar:4.6.1]\tat org.apache.rocketmq.broker.BrokerStartup.main(BrokerStartup.java:58) [rocketmq-broker-4.6.1.jar:4\n.6.1]Caused by: java.net.UnknownHostException: node-113b: No address associated with hostname\n\tat java.net.Inet6AddressImpl.lookupAllHostAddr(Native Method) ~[na:1.8.0_181]\n\tat java.net.InetAddress$2.lookupAllHostAddr(InetAddress.java:928) ~[na:1.8.0_181]\n\tat java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1323) ~[na:1.8.0_181]\n\tat java.net.InetAddress.getLocalHost(InetAddress.java:1500) ~[na:1.8.0_181]\n\t... 4 common frames omitted\nThe broker[DEFAULT_BROKER, 192.168.150.213:10911] boot success. serializeType=JSON and name server is localh\nost:9876\n</code></pre>\n<p>** åŸå› ï¼š** æ— æ³•è§£æå½“å‰çš„ä¸»æœºå</p>\n<p>hosts é‡Œæ·»åŠ æ˜ å°„å³å¯</p>\n<pre><code>192.168.150.213 node-113b\n</code></pre>\n<h4 id=\"linuxæ—¥æœŸæ ¡å‡†\"><a class=\"anchor\" href=\"#linuxæ—¥æœŸæ ¡å‡†\">#</a> linux æ—¥æœŸæ ¡å‡†</h4>\n<p><strong>å®‰è£… ntpdate</strong></p>\n<pre><code>yum install ntpdate\n\nntpdate ntp1.aliyun.com\n</code></pre>\n<h2 id=\"rocketmq-åŠŸèƒ½-å¤§çº²\"><a class=\"anchor\" href=\"#rocketmq-åŠŸèƒ½-å¤§çº²\">#</a> RocketMQ åŠŸèƒ½ å¤§çº²</h2>\n<h3 id=\"rocketmqä»‹ç»\"><a class=\"anchor\" href=\"#rocketmqä»‹ç»\">#</a> RocketMQ ä»‹ç»</h3>\n<ul>\n<li>æ¶ˆæ¯é˜Ÿåˆ—åº”ç”¨åœºæ™¯</li>\n<li>rocketmq ä¸­çš„è§’è‰²\n<ul>\n<li>nameserver</li>\n</ul>\n</li>\n<li>å®˜ç½‘è§£è¯»</li>\n</ul>\n<h3 id=\"æ¶ˆæ¯å‘é€\"><a class=\"anchor\" href=\"#æ¶ˆæ¯å‘é€\">#</a> æ¶ˆæ¯å‘é€</h3>\n<ul>\n<li>\n<p>åŒæ­¥å‘é€</p>\n</li>\n<li>\n<p>å¼‚æ­¥å‘é€</p>\n</li>\n<li>\n<p>å•å‘å‘é€</p>\n</li>\n<li>\n<p>æ¶ˆæ¯æ‰¹é‡å‘é€</p>\n</li>\n<li>\n<p>æ¶ˆæ¯ç»“æ„</p>\n</li>\n<li>\n<p>æ¶ˆæ¯å‘é€æµç¨‹</p>\n</li>\n</ul>\n<h3 id=\"æ¶ˆæ¯å­˜å‚¨\"><a class=\"anchor\" href=\"#æ¶ˆæ¯å­˜å‚¨\">#</a> æ¶ˆæ¯å­˜å‚¨</h3>\n<ul>\n<li>å­˜å‚¨æ–¹å¼</li>\n<li>å‘é€æ¶ˆæ¯æ—¶å­˜å‚¨æµç¨‹</li>\n<li>å­˜å‚¨æ–‡ä»¶ä¸å†…å­˜æ˜ å°„</li>\n<li>åˆ·ç›˜æœºåˆ¶</li>\n<li>æ–‡ä»¶æ¢å¤ä¸è¿‡æœŸåˆ é™¤æœºåˆ¶</li>\n<li>ç´¢å¼•</li>\n</ul>\n<h3 id=\"æ¶ˆæ¯æ¶ˆè´¹\"><a class=\"anchor\" href=\"#æ¶ˆæ¯æ¶ˆè´¹\">#</a> æ¶ˆæ¯æ¶ˆè´¹</h3>\n<ul>\n<li>æ¶ˆæ¯è®¢é˜…</li>\n<li>æ¶ˆæ¯æ‹‰å–å’Œæ¨é€</li>\n<li>æ¶ˆæ¯å¤„ç†é˜Ÿåˆ—</li>\n<li>é¡ºåºæ¶ˆè´¹</li>\n<li>å®šæ—¶æ¶ˆæ¯æœºåˆ¶</li>\n<li>æ¶ˆæ¯è¿‡æ»¤ TAG ä¸ sql92</li>\n<li>FilterServer è¿‡æ»¤æœºåˆ¶</li>\n<li>å¹¶å‘æ¶ˆæ¯æ¶ˆè´¹</li>\n<li>æ¶ˆè´¹è´Ÿè½½ä¸ç®—æ³•</li>\n<li>æ¶ˆè´¹è€…åŠ¨æ€æ·»åŠ </li>\n<li>æ¶ˆæ¯æ¶ˆè´¹è¿‡ç¨‹</li>\n<li>ACK</li>\n<li>æ¶ˆè´¹è¿›åº¦ä¸ offset</li>\n</ul>\n<h3 id=\"rocketmqé›†ç¾¤-ha\"><a class=\"anchor\" href=\"#rocketmqé›†ç¾¤-ha\">#</a> Rocketmq é›†ç¾¤ HA</h3>\n<ul>\n<li>é›†ç¾¤æ­å»º</li>\n<li>ä¸»ä»åŒæ­¥å¤åˆ¶åŸç†</li>\n<li>è¯»å†™åˆ†ç¦»æœºåˆ¶</li>\n</ul>\n<h3 id=\"æ•´åˆ\"><a class=\"anchor\" href=\"#æ•´åˆ\">#</a> æ•´åˆ</h3>\n<ul>\n<li>ä½¿ç”¨ spring</li>\n<li>SpringCloud æ•´åˆ</li>\n</ul>\n<h3 id=\"ç›‘æ§ä¸è¿ç»´\"><a class=\"anchor\" href=\"#ç›‘æ§ä¸è¿ç»´\">#</a> ç›‘æ§ä¸è¿ç»´</h3>\n<ul>\n<li>rocketmq-console ç›‘æ§å¹³å°</li>\n<li>å‘½ä»¤è¡Œè¿ç»´ MQAdmin</li>\n<li>è‡ªå®šä¹‰æ—¥å¿—</li>\n</ul>\n<h2 id=\"æ¶ˆæ¯é˜Ÿåˆ—ä»‹ç»\"><a class=\"anchor\" href=\"#æ¶ˆæ¯é˜Ÿåˆ—ä»‹ç»\">#</a> æ¶ˆæ¯é˜Ÿåˆ—ä»‹ç»</h2>\n<p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ã€Šæ•°æ®ç»“æ„ã€‹ä¸­å…ˆè¿›å…ˆå‡ºçš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œåœ¨å½“å‰çš„æ¶æ„ä¸­ï¼Œä½œä¸ºä¸­é—´ä»¶æä¾›æœåŠ¡ã€‚</p>\n<h3 id=\"æ¶ˆæ¯ä¸­é—´ä»¶åŠŸèƒ½\"><a class=\"anchor\" href=\"#æ¶ˆæ¯ä¸­é—´ä»¶åŠŸèƒ½\">#</a> æ¶ˆæ¯ä¸­é—´ä»¶åŠŸèƒ½</h3>\n<h4 id=\"åº”ç”¨è§£è€¦\"><a class=\"anchor\" href=\"#åº”ç”¨è§£è€¦\">#</a> åº”ç”¨è§£è€¦</h4>\n<p>AB åº”ç”¨ä¸åœ¨äº’ç›¸ä¾èµ–</p>\n<h4 id=\"æµé‡å‰Šå³°\"><a class=\"anchor\" href=\"#æµé‡å‰Šå³°\">#</a> æµé‡å‰Šå³°</h4>\n<p>æµé‡è¾¾åˆ°é«˜å³°çš„æ—¶å€™ï¼Œé€šå¸¸ä½¿ç”¨é™æµç®—æ³•æ¥æ§åˆ¶æµé‡æ¶Œå…¥ç³»ç»Ÿï¼Œé¿å…ç³»ç»Ÿè¢«å‡»ç˜«ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æŸå¤±äº†ä¸€éƒ¨åˆ†è¯·æ±‚</p>\n<p>æ­¤æ—¶å¯ä»¥ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶æ¥ç¼“å†²å¤§é‡çš„è¯·æ±‚ï¼ŒåŒ€é€Ÿæ¶ˆè´¹ï¼Œå½“æ¶ˆæ¯é˜Ÿåˆ—ä¸­å †ç§¯æ¶ˆæ¯è¿‡å¤šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€ä¸Šçº¿å¢åŠ æ¶ˆè´¹ç«¯ï¼Œæ¥ä¿è¯ä¸ä¸¢å¤±é‡è¦è¯·æ±‚ã€‚</p>\n<h4 id=\"å¤§æ•°æ®å¤„ç†\"><a class=\"anchor\" href=\"#å¤§æ•°æ®å¤„ç†\">#</a> å¤§æ•°æ®å¤„ç†</h4>\n<p>æ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥æŠŠå„ä¸ªæ¨¡å—ä¸­äº§ç”Ÿçš„ç®¡ç†å‘˜æ“ä½œæ—¥å¿—ã€ç”¨æˆ·è¡Œä¸ºã€ç³»ç»ŸçŠ¶æ€ç­‰æ•°æ®æ–‡ä»¶ä½œä¸ºæ¶ˆæ¯æ”¶é›†åˆ°ä¸»é¢˜ä¸­</p>\n<p>æ•°æ®ä½¿ç”¨æ–¹å¯ä»¥è®¢é˜…è‡ªå·±æ„Ÿå…´è¶£çš„æ•°æ®å†…å®¹äº’ä¸å½±å“ï¼Œè¿›è¡Œæ¶ˆè´¹</p>\n<h4 id=\"å¼‚æ„ç³»ç»Ÿ\"><a class=\"anchor\" href=\"#å¼‚æ„ç³»ç»Ÿ\">#</a> å¼‚æ„ç³»ç»Ÿ</h4>\n<p>è·¨è¯­è¨€</p>\n<h3 id=\"rocketmq-è§’è‰²\"><a class=\"anchor\" href=\"#rocketmq-è§’è‰²\">#</a> RocketMQ è§’è‰²</h3>\n<p><img data-src=\"RocketMQ%EF%BC%88%E4%B8%80%EF%BC%89.assets/webp\" alt=\"img\" /></p>\n<h4 id=\"broker\"><a class=\"anchor\" href=\"#broker\">#</a> broker</h4>\n<ul>\n<li>Broker é¢å‘ producer å’Œ consumer æ¥å—å’Œå‘é€æ¶ˆæ¯</li>\n<li>å‘ nameserver æäº¤è‡ªå·±çš„ä¿¡æ¯</li>\n<li>æ˜¯æ¶ˆæ¯ä¸­é—´ä»¶çš„æ¶ˆæ¯å­˜å‚¨ã€è½¬å‘æœåŠ¡å™¨ã€‚</li>\n<li>æ¯ä¸ª Broker èŠ‚ç‚¹ï¼Œåœ¨å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šéå† NameServer åˆ—è¡¨ï¼Œä¸æ¯ä¸ª NameServer å»ºç«‹é•¿è¿æ¥ï¼Œæ³¨å†Œè‡ªå·±çš„ä¿¡æ¯ï¼Œä¹‹åå®šæ—¶ä¸ŠæŠ¥ã€‚</li>\n</ul>\n<h5 id=\"brokeré›†ç¾¤\"><a class=\"anchor\" href=\"#brokeré›†ç¾¤\">#</a> broker é›†ç¾¤</h5>\n<ul>\n<li>Broker é«˜å¯ç”¨ï¼Œå¯ä»¥é…æˆ Master/Slave ç»“æ„ï¼ŒMaster å¯å†™å¯è¯»ï¼ŒSlave åªå¯ä»¥è¯»ï¼ŒMaster å°†å†™å…¥çš„æ•°æ®åŒæ­¥ç»™ Slaveã€‚\n<ul>\n<li>ä¸€ä¸ª Master å¯ä»¥å¯¹åº”å¤šä¸ª Slaveï¼Œä½†æ˜¯ä¸€ä¸ª Slave åªèƒ½å¯¹åº”ä¸€ä¸ª Master</li>\n<li>Master ä¸ Slave çš„å¯¹åº”å…³ç³»é€šè¿‡æŒ‡å®šç›¸åŒçš„ BrokerNameï¼Œä¸åŒçš„ BrokerId æ¥å®šä¹‰ BrokerId ä¸º 0 è¡¨ç¤º Masterï¼Œé 0 è¡¨ç¤º Slave</li>\n</ul>\n</li>\n<li>Master å¤šæœºè´Ÿè½½ï¼Œå¯ä»¥éƒ¨ç½²å¤šä¸ª broker\n<ul>\n<li>æ¯ä¸ª Broker ä¸ nameserver é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæ—¶æ³¨å†Œ Topic ä¿¡æ¯åˆ°æ‰€æœ‰ nameserverã€‚</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"producer\"><a class=\"anchor\" href=\"#producer\">#</a> producer</h4>\n<ul>\n<li>æ¶ˆæ¯çš„ç”Ÿäº§è€…</li>\n<li>é€šè¿‡é›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆéšæœºé€‰æ‹©ï¼‰å»ºç«‹é•¿è¿æ¥ï¼Œè·å¾— Topic çš„è·¯ç”±ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Topic ä¸‹é¢æœ‰å“ªäº› Queueï¼Œè¿™äº› Queue åˆ†å¸ƒåœ¨å“ªäº› Broker ä¸Šç­‰</li>\n<li>æ¥ä¸‹æ¥å‘æä¾› Topic æœåŠ¡çš„ Master å»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘ Master å‘é€å¿ƒè·³</li>\n</ul>\n<h4 id=\"consumer\"><a class=\"anchor\" href=\"#consumer\">#</a> consumer</h4>\n<p>æ¶ˆæ¯çš„æ¶ˆè´¹è€…ï¼Œé€šè¿‡ NameServer é›†ç¾¤è·å¾— Topic çš„è·¯ç”±ä¿¡æ¯ï¼Œè¿æ¥åˆ°å¯¹åº”çš„ Broker ä¸Šæ¶ˆè´¹æ¶ˆæ¯ã€‚</p>\n<p>æ³¨æ„ï¼Œç”±äº Master å’Œ Slave éƒ½å¯ä»¥è¯»å–æ¶ˆæ¯ï¼Œå› æ­¤ Consumer ä¼šä¸ Master å’Œ Slave éƒ½å»ºç«‹è¿æ¥ã€‚</p>\n<h4 id=\"nameserver\"><a class=\"anchor\" href=\"#nameserver\">#</a> nameserver</h4>\n<p>åº•å±‚ç”± netty å®ç°ï¼Œæä¾›äº†è·¯ç”±ç®¡ç†ã€æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°çš„åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€èŠ‚ç‚¹</p>\n<p><strong>nameserver æ˜¯æœåŠ¡å‘ç°è€…</strong>ï¼Œé›†ç¾¤ä¸­å„ä¸ªè§’è‰²ï¼ˆproducerã€brokerã€consumer ç­‰ï¼‰éƒ½éœ€è¦å®šæ—¶æƒ³ nameserver ä¸ŠæŠ¥è‡ªå·±çš„çŠ¶æ€ï¼Œä»¥ä¾¿äº’ç›¸å‘ç°å½¼æ­¤ï¼Œè¶…æ—¶ä¸ä¸ŠæŠ¥çš„è¯ï¼Œnameserver ä¼šæŠŠå®ƒä»åˆ—è¡¨ä¸­å‰”é™¤</p>\n<p><strong>nameserver å¯ä»¥éƒ¨ç½²å¤šä¸ª</strong>ï¼Œå½“å¤šä¸ª nameserver å­˜åœ¨çš„æ—¶å€™ï¼Œå…¶ä»–è§’è‰²åŒæ—¶å‘ä»–ä»¬ä¸ŠæŠ¥ä¿¡æ¯ï¼Œä»¥ä¿è¯é«˜å¯ç”¨ï¼Œ</p>\n<p><strong>NameServer é›†ç¾¤é—´äº’ä¸é€šä¿¡</strong>ï¼Œæ²¡æœ‰ä¸»å¤‡çš„æ¦‚å¿µ</p>\n<p><strong>nameserver å†…å­˜å¼å­˜å‚¨</strong>ï¼Œnameserver ä¸­çš„ brokerã€topic ç­‰ä¿¡æ¯é»˜è®¤ä¸ä¼šæŒä¹…åŒ–</p>\n<p><strong>ä¸ºä»€ä¹ˆä¸ç”¨ zookeeperï¼Ÿ</strong>ï¼šrocketmq å¸Œæœ›ä¸ºäº†æé«˜æ€§èƒ½ï¼ŒCAP å®šç†ï¼Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</p>\n<h3 id=\"å¯¹æ¯”jsmä¸­çš„topicå’Œqueue\"><a class=\"anchor\" href=\"#å¯¹æ¯”jsmä¸­çš„topicå’Œqueue\">#</a> å¯¹æ¯” JSM ä¸­çš„ Topic å’Œ Queue</h3>\n<p>Topic æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå®é™…ä¸Š Message æ˜¯åœ¨æ¯ä¸ª Broker ä¸Šä»¥ Queue çš„å½¢å¼è®°å½•ã€‚</p>\n<p><img data-src=\"RocketMQ%EF%BC%88%E4%B8%80%EF%BC%89.assets/1090617-20190626173042073-147043337.jpg\" alt=\"img\" /></p>\n<p>å¯¹åº”åˆ° JMS ä¸­çš„ topic å®ç°æ˜¯ç”±å®¢æˆ·ç«¯æ¥å®Œæˆçš„</p>\n<pre><code>        consumer.setMessageModel(MessageModel.BROADCASTING);\n</code></pre>\n",
            "tags": [
                "Java",
                "Java",
                "æ¶ˆæ¯ä¸­é—´ä»¶",
                "RocketMQ"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/HTTPS/",
            "url": "https://baiyezi.vip/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/HTTPS/",
            "title": "HTTPS",
            "date_published": "2021-08-04T09:55:16.000Z",
            "content_html": "<h2 id=\"ssltls\"><a class=\"anchor\" href=\"#ssltls\">#</a> SSL/TLS</h2>\n<p>TLS (Transport Layer Security) æ˜¯ SSL (Secure Socket Layer) çš„åç»­ç‰ˆæœ¬</p>\n<h2 id=\"åŠ å¯†ç®—æ³•\"><a class=\"anchor\" href=\"#åŠ å¯†ç®—æ³•\">#</a> åŠ å¯†ç®—æ³•</h2>\n<h3 id=\"å¯¹ç§°åŠ å¯†\"><a class=\"anchor\" href=\"#å¯¹ç§°åŠ å¯†\">#</a> å¯¹ç§°åŠ å¯†</h3>\n<p>å¦‚ AESã€DESã€3DES ç­‰ï¼Œå¯†é’¥åªæœ‰ä¸€ä¸ªä¸ºç§é’¥</p>\n<h3 id=\"éå¯¹ç§°åŠ å¯†\"><a class=\"anchor\" href=\"#éå¯¹ç§°åŠ å¯†\">#</a> éå¯¹ç§°åŠ å¯†</h3>\n<p>å¯†é’¥åˆ†ä¸ºå…¬é’¥å’Œç§é’¥ï¼š</p>\n<p>æ˜æ–‡é€šè¿‡å…¬é’¥åŠ å¯†åå¾—åˆ°å¯†æ–‡ï¼Œè¯¥å¯†æ–‡å¯ä»¥é€šè¿‡ç§é’¥è§£å¯†åå¾—åˆ°æ˜æ–‡ï¼›</p>\n<p>æ˜æ–‡é€šè¿‡ç§é’¥åŠ å¯†åå¾—åˆ°å¯†æ–‡ï¼Œè¯¥å¯†æ–‡å¯ä»¥é€šè¿‡å…¬é’¥è§£å¯†åå¾—åˆ°æ˜æ–‡ï¼›</p>\n<p>å…¬é’¥ç”±æœåŠ¡ç«¯çš„ç§é’¥ç”Ÿæˆå¹¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚å…¬é’¥å­˜æ”¾äºå®¢æˆ·ç«¯ï¼Œç”¨äºåŠ å¯†å‘é€ç»™æœåŠ¡ç«¯çš„æ•°æ®ä»¥åŠè§£å¯†æ¥æ”¶åˆ°çš„æœåŠ¡ç«¯çš„æ•°æ®ï¼›ç§é’¥å­˜æ”¾äºæœåŠ¡ç«¯ï¼Œç”¨äºè§£å¯†æ¥æ”¶åˆ°çš„å®¢æˆ·çš„æ•°æ®ä»¥åŠåŠ å¯†å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®ã€‚</p>\n<p>å¦‚æœå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´å­˜åœ¨ä»£ç†æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå…¬ç§å¯†é’¥éƒ½å¯ä»¥è¢«ä»£ç†æœåŠ¡å™¨ç¯¡æ”¹ã€‚</p>\n<h3 id=\"æ‘˜è¦ç®—æ³•\"><a class=\"anchor\" href=\"#æ‘˜è¦ç®—æ³•\">#</a> æ‘˜è¦ç®—æ³•</h3>\n<p>Hash ç®—æ³•</p>\n<h2 id=\"æ•°å­—ç­¾å\"><a class=\"anchor\" href=\"#æ•°å­—ç­¾å\">#</a> æ•°å­—ç­¾å</h2>\n<p>å…¶åŸç†æ˜¯å¯¹å…¬é’¥è¿›è¡Œ Hash ç®—æ³•å¾—åˆ°å¯¹åº”çš„ç­¾å / æ‘˜è¦ï¼Œä¸ºäº†é˜²æ­¢è¢«ä»£ç†æœåŠ¡å™¨ç¯¡æ”¹ï¼Œè¿˜éœ€è¦åœ¨å®¢æˆ·ç«¯ä»¥åŠæœåŠ¡ç«¯ä¸Šå„è‡ªå­˜æ”¾ä¸€ä»½è¯ä¹¦ï¼Œè¯¥è¯ä¹¦æ˜¯ç”±ç¬¬ä¸‰æ–¹å¯¹å·²æœ‰çš„å…¬ç§é’¥è¿›è¡ŒäºŒæ¬¡åŠ å¯†æœ€ååŠ ä¸Šç­¾åå¾—åˆ°çš„ï¼Œä¸”ç¬¬ä¸‰æ–¹æ˜¯å€¼å¾—è¢«ä¿¡ä»»çš„ï¼Œè¿™æ ·å°±èƒ½å¾ˆå¥½çš„é˜²æ­¢å…¬ç§é’¥è¢«ç¯¡æ”¹ã€‚å…·ä½“åšæ³•æ˜¯ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç§é’¥ï¼ˆç¬¬ä¸‰æ–¹çš„ç§é’¥å­˜æ”¾äºæœåŠ¡ç«¯ï¼Œå…¬é’¥å­˜æ”¾äºå®¢æˆ·ç«¯ï¼Œä¸”ä¸åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´ä¼ è¾“ï¼‰å¯¹æœåŠ¡ç«¯ç§é’¥ç”Ÿæˆçš„å…¬é’¥è¿›è¡ŒåŠ å¯†å¾—åˆ°å¯†æ–‡ï¼Œå…¶æ¬¡å¯¹æœåŠ¡ç«¯ç§é’¥ç”Ÿæˆçš„å…¬é’¥è¿›è¡Œ Hash ç®—æ³•å¾—åˆ°ç­¾åï¼Œè¿™æ ·å…¬é’¥çš„å¯†æ–‡åŠ ä¸Šå…¬é’¥çš„ç­¾åå°±å¾—åˆ°äº†è¯ä¹¦ï¼Œç„¶åå°†è¯ä¹¦ä¸‹å‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°è¯ä¹¦åä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å…¬é’¥è§£å¯†è¯ä¹¦å¾—åˆ°æœåŠ¡ç«¯çš„å…¬é’¥ä»¥åŠç­¾åï¼Œç„¶åé€šè¿‡å’ŒæœåŠ¡ç«¯ä¸€æ ·çš„ç­¾åç®—æ³•å¯¹è§£å¯†å¾—åˆ°çš„å…¬é’¥è¿›è¡Œè¿ç®—åå¾—åˆ°ç­¾åï¼Œä½¿ç”¨è¯¥ç­¾åä¸è§£å¯†å¾—åˆ°çš„ç­¾åè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œé‚£ä¹ˆä¸‹å‘çš„è¯ä¹¦å°±æ˜¯æœ‰æ•ˆçš„ï¼Œå³å…¬é’¥æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</p>\n<p>è¿™é‡Œçš„ç¬¬ä¸‰æ–¹æŒ‡ CA æœºæ„ï¼Œå®¢æˆ·ç«¯å¦‚æµè§ˆå™¨ä¸€èˆ¬éƒ½å†…åµŒäº†ä¿¡èµ–çš„ CA æœºæ„çš„å…¬é’¥ï¼ˆæˆ–è€…ä»æ“ä½œç³»ç»Ÿå†…åµŒçš„è¯ä¹¦ä¸­è·å–ï¼‰ï¼Œåªæœ‰è¿™äº›å…¬é’¥æ‰å¯è§£å¼€è¯ä¹¦ã€‚</p>\n<p>æµè§ˆå™¨å‘æœåŠ¡å™¨ï¼ˆé»˜è®¤æ˜¯ 80 ç«¯å£ï¼‰è¯·æ±‚ä¿¡æ¯çš„å››æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ï¼š</p>\n<p>æµè§ˆå™¨é¦–å…ˆé€šè¿‡ 443 ç«¯å£å‘ŠçŸ¥æœåŠ¡å™¨ï¼Œæµè§ˆå™¨è‡ªèº«æ”¯æŒçš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¦‚æœæœåŠ¡å™¨ä¸æ”¯æŒè¿™äº›åŠ å¯†ç®—æ³•ï¼Œé‚£ä¹ˆå°±ä¸ä¼šä¸‹å‘ CA è¯ä¹¦ï¼›</p>\n<p>æœåŠ¡å™¨å‘æµè§ˆå™¨ä¸‹å‘ CA è¯ä¹¦ï¼›</p>\n<p>æµè§ˆå™¨æ ¸å¯¹è¯ä¹¦ä¿¡æ¯ï¼Œä»æ“ä½œç³»ç»Ÿå†…ç½®çš„ CA ç»“æ„è§£å¯† CA è¯ä¹¦ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°èƒ½è§£å¯†è¯ä¹¦çš„ CA æœºæ„ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šæç¤ºè¯ä¹¦ä¸å®‰å…¨ï¼›</p>\n<p>æµè§ˆå™¨å¯¹è¯ä¹¦æ ¡éªŒæˆåŠŸåå°±ä¼šç”Ÿæˆä¸€ä¸ªéšæœºçš„å­—ç¬¦ä¸²ï¼ˆå³å¯¹ç§°åŠ å¯†çš„ç›ï¼‰å¹¶ä½¿ç”¨æœåŠ¡ç«¯å‘é€æ¥çš„å…¬é’¥å¯¹è¯¥å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†å¾—åˆ°å¯†æ–‡ï¼Œè¯¥å¯†æ–‡åªæœ‰æœåŠ¡ç«¯çš„ç§é’¥èƒ½è§£å¼€ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°å¯†æ–‡åè¿›è¡Œè§£å¯†å¾—åˆ°å­—ç¬¦ä¸²ï¼ŒæœåŠ¡ç«¯é€šè¿‡è¯¥å­—ç¬¦ä¸²ä»¥åŠå¯¹ç§°åŠ å¯†ç®—æ³•å°±å¯ä»¥è¿›ä¸€æ­¥åæ¨å‡ºæ¥å¯†é’¥ï¼Œä¸æœåŠ¡ç«¯è‡ªèº«å¯†é’¥æ¯”å¯¹åå¦‚æœæ­£ç¡®ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥ä¸æµè§ˆå™¨åœ¨ 80 ç«¯å£ä¸Šå®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œä¸­é—´è¿‡ç¨‹çš„éå¯¹ç§°åŠ è§£å¯†ä»¥åŠè¯ä¹¦çš„é¢å‘éƒ½æ˜¯ä¸ºäº†ä¿æŠ¤æµè§ˆå™¨ç”Ÿæˆçš„éšæœºå­—ç¬¦ä¸²ä¸è¢«æˆªå–ç ´è§£ã€‚</p>\n<h2 id=\"è¯ä¹¦ç”Ÿæˆä»¥åŠè‡ªç­¾åè¯ä¹¦\"><a class=\"anchor\" href=\"#è¯ä¹¦ç”Ÿæˆä»¥åŠè‡ªç­¾åè¯ä¹¦\">#</a> è¯ä¹¦ç”Ÿæˆä»¥åŠè‡ªç­¾åè¯ä¹¦</h2>\n<p>æŸ¥çœ‹ç³»ç»Ÿå·²å­˜è¯ä¹¦ï¼šcertmgr.msc</p>\n<h3 id=\"è¯ä¹¦ç»„æˆ\"><a class=\"anchor\" href=\"#è¯ä¹¦ç»„æˆ\">#</a> è¯ä¹¦ç»„æˆ</h3>\n<p><strong>CSR</strong>ï¼šè¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶</p>\n<p><strong>CRT</strong>ï¼šè¯ä¹¦</p>\n<p><strong>KEY</strong>ï¼šç§é’¥</p>\n<p>é€šè¿‡ç§é’¥ç”Ÿæˆå¾…ç­¾åçš„ CSR ç­¾åè¯·æ±‚æ–‡ä»¶ï¼Œç­¾åä¹‹åä¾¿å¾—åˆ°äº†è¯ä¹¦ CRT</p>\n<h3 id=\"æœåŠ¡å™¨ç«¯è¯ä¹¦ç”Ÿæˆ\"><a class=\"anchor\" href=\"#æœåŠ¡å™¨ç«¯è¯ä¹¦ç”Ÿæˆ\">#</a> æœåŠ¡å™¨ç«¯è¯ä¹¦ç”Ÿæˆ</h3>\n<p>ä»¥ä¸‹ä½¿ç”¨ OpenSSL ç”Ÿæˆè¯ä¹¦</p>\n<h4 id=\"ä¸‹è½½\"><a class=\"anchor\" href=\"#ä¸‹è½½\">#</a> ä¸‹è½½</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3NscHJvd2ViLmNvbS9wcm9kdWN0cy9XaW4zMk9wZW5TU0wuaHRtbA==\">http://slproweb.com/products/Win32OpenSSL.html</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210528093939441.png\" alt=\"image-20210528093939441\" /></p>\n<h4 id=\"ç”Ÿæˆç§é’¥\"><a class=\"anchor\" href=\"#ç”Ÿæˆç§é’¥\">#</a> ç”Ÿæˆç§é’¥</h4>\n<p>å®‰è£…å®Œæˆä¹‹åï¼Œè¿›å…¥å®‰è£…ç›®å½•ä¸‹çš„ bin ç›®å½•ï¼Œé€šè¿‡ openssl.exe ç”Ÿæˆç§é’¥</p>\n<pre><code class=\"language-cmd\">#des3ä»£è¡¨å¯¹ç§°åŠ å¯†ç®—æ³•\nD:\\ins\\OpenSSL-Win64\\bin&gt;openssl.exe genrsa -des3 -out d:/ins/server.key\nGenerating RSA private key, 2048 bit long modulus (2 primes)\n.......................................................................................+++++\n............................................................................................................................................................................................+++++\ne is 65537 (0x010001)\nEnter pass phrase for d:/ins/server.key: #è¾“å…¥è¦ç”Ÿæˆçš„ç§é’¥çš„ç›ï¼Œç›åªå‚ä¸åŠ å¯†ç®—æ³•çš„è¿ç®—ï¼Œå¹¶ä¸åœ¨ç”Ÿæˆçš„ç§é’¥ä¸­ã€‚è¦ç ´è§£ç”Ÿæˆçš„ç§é’¥ï¼Œç›å°±æ˜¯å…³é”®\nVerifying - Enter pass phrase for d:/ins/server.key: #å†æ¬¡è¾“å…¥\n</code></pre>\n<p>è¿™æ ·å°±åœ¨æŒ‡å®šç›®å½•ä¸‹ç”Ÿæˆäº†ç§é’¥</p>\n<pre><code class=\"language-cmd\">-----BEGIN RSA PRIVATE KEY-----\nProc-Type: 4,ENCRYPTED\nDEK-Info: DES-EDE3-CBC,33238A7C3FCEA4CE\n\nmoShb15bLGOO1BMTf96oA/G8FSyCYgwKokEak3R6/Z+RNGBIMbmRdk/UK9KdFdhC\nlkyNAwDaKkJ/tC0rC4Jnr/ghP91wfe9EU5ghqxGRCGfLNKt8ZJYjWpNHSTogXiVS\ndB9gGv6cBMjZ6O+Sy/l+v3XNY7FvMMtfXTFIGXCun0cpu77Kvdauw3jsY5bcetSb\n1S4yvO1vtw5+M55xhE0scrzP8kP1OCfzsrj6a001EB6PWHY1gqK4QZkrqFOoyApT\n6KIu+jOwlBq/3czOEgsxK9k6nGv5pDwjriLA3RLcMDbfAu/jd5FUauea/wEouzT1\nkexK9MV0BsyintPz08gWwFZxIilFwASYMian8Do3OHUe5Hb2BuZnxx95ers9PH5e\ndata3xs7DDa0bAVNkSchAaZBtgKREukWbZTdfHcKZNgNPdj2DJ3oRBioDraRfiwu\n2edcdATtuJSNa9cYB63LB5hENTCuwONUMRzvTUVgJJnb9G1Iap5N1AQ0mBbo5R6F\nhmBLIATlnaV5nDkGFaz+IYUR7MdA0Aup77XSIsf8l6gyRRN2UPqcG1cI5x2t/IOv\nWDgLIse5FcdykhlUN8nh6/0wsaUi653lnhYLx3ZcWUgCczYzKENLu5XP6GY2bVEj\nXQ0nj6uCAsMCF4RYPZNRFS0EFFr24ngBy2Gx5WJ2aVPq5MvxxcYcQTWeZWJ7JEWW\nAGBXX6b9/EwUHWQed5yArf8JTuxKXleH0fnlpz2IJ2gZ7s2o/WmSwk1UXqpiKWwX\nMiaCaEI734oISjEAVyp9lk9OGDSt/3LijMjTLP2G0VuVmekcisECZWRS7+1hj4VP\nrHp/MBuVk+R8VHPm5QNUygpygXXU8FVNne128ScrmA94hw8iijhJJX129N0JVVTa\nRVC+4b73R0RbagSfNXuhm9toJ20aTZL3WUxVJdn0e0EvkStSioZOCIDWu6jKhWUJ\nuPl8KednvpjUcT64KnpwJ6HrzdWiYwhtwBhYEOAOX48P7tDmoroXbueaWfA5Upis\n4csy+GwqEtr4ZYvixC73aDhpI5dhTYCTgyP5R8nyqBSJylR2iJCPvVsq0vBb6Mu5\nRB8v36Sj+Hr7r8OS1eobMwLwzS7xwDpsv7t1dWNU3W+gaZJO8F6OFRrnnsls+muW\n+lpGmpaKFomLY8bG3hWkbPbxNevkt/pZd7M7lN/gCo4k8l4ZlGEokXwwzInm/CSJ\nQBSXciPDAETWBnOgzQcmhhX0RzYo8wPQN6aoS/TYUEtkDFXqBte1kD0lMPf46ciR\nZGUiLqo5gBAsdhKbfZB8lZeL0S/7krAqVBEBG5xKZ/xbyphpRrMDq+TAWsnU9qRf\ntJwLI1O44CBjk8L1pJQHFyl6jhkL5PMJ5ScXlqznZx15GaggfBHXWdZi6W0ffURR\nVHtK3rPS+VQzJN7LRHYdGMBQXp06+/b8EWRBriSc1gwisXpniPYWCQlAazHPDDQf\nb+TwPlRr8YzBhex0+Rcwtkmc5ihgT4489Uxq0oQ6Kupv+W7b+vtQayPfCLlDI+eh\n65nz/zU+DQVpPP8rVBtT+e5QjZre7cWwPBOMaK1YElRZ1mpdiX4cQW5wq/tud7Ud\n-----END RSA PRIVATE KEY-----\n</code></pre>\n<h4 id=\"ç”Ÿæˆcsr\"><a class=\"anchor\" href=\"#ç”Ÿæˆcsr\">#</a> ç”Ÿæˆ CSR</h4>\n<pre><code class=\"language-cmd\">#keyä»£è¡¨ä¸Šä¸€æ­¥ç”Ÿæˆçš„ç§é’¥\nD:\\ins\\OpenSSL-Win64\\bin&gt;openssl.exe req -new -key d:/ins/server.key -out d:/ins/server.csr\nEnter pass phrase for d:/ins/server.key: #è¾“å…¥ç§é’¥çš„ç›ï¼Œæœ€å°‘4ä¸ºï¼Œæœ€å¤š1023ä½\n7536:error:2406F079:random number generator:RAND_load_file:Cannot open file:crypto\\rand\\randfile.c:98:Filename=./.rnd\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [AU]:CN #å›½å®¶\nState or Province Name (full name) [Some-State]:Shanghai #çœä»½\nLocality Name (eg, city) []:Shanghai #åŸå¸‚\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:test #å…¬å¸\nOrganizational Unit Name (eg, section) []:test #éƒ¨é—¨\nCommon Name (e.g. server FQDN or YOUR name) []:test #å¯ä»¥å†™è‡ªå·±çš„åå­—æˆ–è€…åŸŸåï¼Œå¦‚æœè¦æ”¯æŒhttpsï¼ŒCommon Nameåº”è¯¥ä¸åŸŸåä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šå¼•èµ·æµè§ˆå™¨è­¦å‘Šã€‚\nEmail Address []:test@qq.com #é‚®ç®±\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:000000 #è¿™é‡Œå¯ä»¥éšæ„å¡«å†™\nAn optional company name []:test\n\n#æŸ¥çœ‹ç”Ÿæˆçš„CSR\nD:\\ins\\OpenSSL-Win64\\bin&gt;openssl.exe req -text -in d:/ins/server.csr -noout\nCertificate Request:\n    Data:\n        Version: 1 (0x0)\n        Subject: C = CN, ST = Shanghai, L = Shanghai, O = test, OU = test, CN = test, emailAddress = test@qq.com\n        Subject Public Key Info:\n            Public Key Algorithm: rsaEncryption\n                RSA Public-Key: (2048 bit)\n                Modulus:\n                    00:96:a3:b4:c0:06:b5:6b:15:fc:fe:77:7e:1f:0c:\n                    b5:7b:f7:d9:47:b7:c3:f2:3c:e9:b9:9e:ec:40:54:\n                    71:ea:48:68:b7:e9:cd:b7:4a:0d:e0:23:1c:5e:68:\n                    8d:dc:e8:90:4b:9d:64:24:54:9b:7b:d5:4c:24:0c:\n                    95:52:94:7a:94:81:78:00:60:5b:0a:e9:93:b5:f2:\n                    b9:06:08:28:66:11:66:9f:18:9e:5e:14:61:f5:a0:\n                    f9:43:93:fd:45:9f:82:d6:25:81:1f:20:76:63:ff:\n                    ae:f1:93:f9:72:7f:5c:3f:c8:85:0c:ae:99:6e:68:\n                    f7:72:e3:78:7e:44:e7:9b:71:a1:b2:23:f0:90:0e:\n                    2d:e9:52:29:83:cf:cc:58:63:a9:ff:0a:a8:d7:ed:\n                    f0:46:75:a5:c6:a8:31:fe:92:49:26:b2:9c:65:29:\n                    64:03:24:21:24:84:91:a0:12:c1:88:a9:2f:78:f1:\n                    f0:59:0f:c1:cc:88:2f:b4:44:23:86:4b:9f:cb:71:\n                    0a:1e:e1:85:f9:41:e5:e6:aa:78:6c:cc:56:03:40:\n                    14:69:b7:72:0f:a9:a8:d0:54:ea:67:43:61:35:a5:\n                    a0:8c:eb:fd:ca:86:12:cc:ec:18:e4:39:34:c9:9a:\n                    d0:d9:36:34:02:c3:13:f1:83:4a:a6:b9:14:91:79:\n                    6e:19\n                Exponent: 65537 (0x10001)\n        Attributes:\n            unstructuredName         :test\n            challengePassword        :000000\n    Signature Algorithm: sha256WithRSAEncryption\n         3d:d4:e8:5b:4f:85:bb:39:4e:8c:9f:a5:ec:5c:34:4b:a5:74:\n         b1:88:89:9e:d1:11:d5:a8:45:66:6a:f3:66:9d:91:11:98:40:\n         17:28:dc:d5:7a:75:1d:89:95:3b:e3:c5:49:2c:af:7d:45:ac:\n         2a:bf:aa:67:f3:39:4c:e2:4d:9c:cf:db:2d:59:7a:a9:cd:71:\n         d3:9c:2d:66:f9:ea:b2:f0:0f:22:b6:a0:53:f8:1a:d8:c2:aa:\n         c8:08:34:81:6b:c1:6e:9b:e6:3a:96:a6:58:db:0b:08:8a:6a:\n         99:92:68:da:2f:6b:c7:6b:92:f5:c2:b5:36:52:72:e4:fa:5a:\n         3a:68:5a:2e:06:db:e6:6f:7a:7f:b1:f5:bc:80:4e:be:21:cd:\n         1b:a9:c7:e8:d0:22:0c:26:67:90:cc:ec:c5:a9:f6:38:a9:29:\n         eb:54:be:0c:38:9c:f9:38:1e:63:04:2f:26:a3:71:4b:ec:c6:\n         d9:ac:c5:a3:f8:03:21:29:c5:c9:73:52:b0:ca:f0:80:12:cc:\n         a1:d4:bb:17:c8:f9:a5:20:6d:a4:f3:d6:bf:67:d6:53:cd:1a:\n         f0:38:b4:29:0f:96:21:41:83:8c:94:35:0c:1f:d9:c4:a7:a1:\n         00:2f:bf:a4:3d:b4:da:32:8c:c8:8d:d5:ae:c6:4f:67:4d:5d:\n         23:0b:b7:a1\n</code></pre>\n<ul>\n<li>Country Name (2 letter code) [XX]:CN   #è¯·æ±‚ç­¾ç½²äººçš„å›½å®¶ä¿¡æ¯</li>\n<li>State or Province Name (full name) []: #è¯·æ±‚ç­¾ç½²äººçš„çœä»½åå­—</li>\n<li>Locality Name (eg, city) [Default City]:# è¯·æ±‚ç­¾ç½²äººçš„åŸå¸‚åå­—</li>\n<li>Organization Name (eg, company) [Default Company Ltd]:# è¯·æ±‚ç­¾ç½²äººçš„å…¬å¸åå­—</li>\n<li>Organizational Unit Name (eg, section) []:# è¯·æ±‚ç­¾ç½²äººçš„éƒ¨é—¨åå­—</li>\n<li>Common Name (eg, your name or your server's hostname) []:# è¿™é‡Œä¸€èˆ¬å¡«å†™è¯·æ±‚äººçš„çš„æœåŠ¡å™¨åŸŸåï¼Œ</li>\n</ul>\n<p>æ¥ä¸‹æ¥éœ€è¦ CA æœºæ„å¯¹ä»¥ä¸Šç”Ÿæˆçš„å¾…ç­¾åçš„ CSR æ–‡ä»¶è¿›è¡Œç­¾åè®¤è¯ï¼Œç”Ÿæˆæµè§ˆå™¨æˆ–æ“ä½œç³»ç»Ÿè®¤å¯çš„è¯ä¹¦ï¼Œè¿™æ ·ç½‘ç«™å°±ä¸ä¼šè¢«æµè§ˆå™¨æç¤ºä¸å®‰å…¨ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥é€šè¿‡ OpenSSL ç”Ÿæˆä¸€ä¸ª CAï¼Œé€šè¿‡è‡ªå·±ç”Ÿæˆçš„ CA å¯¹æœåŠ¡å™¨ç«¯çš„ CSR æ–‡ä»¶è¿›è¡Œç­¾åè®¤è¯ã€‚</p>\n<h3 id=\"è‡ªå»ºca\"><a class=\"anchor\" href=\"#è‡ªå»ºca\">#</a> è‡ªå»º CA</h3>\n<p>æˆ‘ä»¬ç”¨çš„æ“ä½œç³»ç»Ÿï¼ˆwindows, linux, unix ,android, ios ç­‰ï¼‰éƒ½é¢„ç½®äº†å¾ˆå¤šä¿¡ä»»çš„æ ¹è¯ä¹¦ï¼Œæ¯”å¦‚æˆ‘çš„ windows ä¸­å°±åŒ…å« VeriSign çš„æ ¹è¯ä¹¦ï¼Œé‚£ä¹ˆæµè§ˆå™¨è®¿é—®æœåŠ¡å™¨æ¯”å¦‚æ”¯ä»˜å® www.alipay.com æ—¶ï¼ŒSSL åè®®æ¡æ‰‹æ—¶æœåŠ¡å™¨å°±ä¼šæŠŠå®ƒçš„æœåŠ¡å™¨è¯ä¹¦å‘ç»™ç”¨æˆ·æµè§ˆå™¨ï¼Œè€Œè¿™æœ¬æœåŠ¡å™¨è¯ä¹¦åˆæ˜¯æ¯”å¦‚ VeriSign é¢å‘çš„ï¼Œè‡ªç„¶å°±éªŒè¯é€šè¿‡äº†ã€‚</p>\n<p>ç”Ÿæˆ CA æ ¹è¯ä¹¦ï¼Œå†…åµŒåœ¨æµè§ˆå™¨æˆ–æ“ä½œç³»ç»Ÿä¸­ï¼Œå–å¾—å…¶ä¿¡ä»»</p>\n<pre><code class=\"language-cmd\">#åˆ›å»ºCAç§é’¥\nD:\\ins\\OpenSSL-Win64\\bin&gt;openssl.exe genrsa -out d:/ins/myca.key 2048\nGenerating RSA private key, 2048 bit long modulus (2 primes)\n......+++++\n.............+++++\ne is 65537 (0x010001)\n\n#ç”ŸæˆCAå¾…ç­¾åè¯ä¹¦\nD:\\ins\\OpenSSL-Win64\\bin&gt;openssl.exe req -new -key d:/ins/myca.key -out d:/ins/myca.csr\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [AU]:CN\nState or Province Name (full name) [Some-State]:Shanghai\nLocality Name (eg, city) []:Shanghai\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:test\nOrganizational Unit Name (eg, section) []:test\nCommon Name (e.g. server FQDN or YOUR name) []:test\nEmail Address []:test@qq.com\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:000000\nAn optional company name []:test\n\n#ç”ŸæˆCAæ ¹è¯ä¹¦\nD:\\ins\\OpenSSL-Win64\\bin&gt;openssl.exe x509 -req -in d:/ins/myca.csr -extensions v3_ca -signkey d:/ins/myca.key -out myca.crt\nSignature ok\nsubject=C = CN, ST = Shanghai, L = Shanghai, O = test, OU = test, CN = test, emailAddress = test@qq.com\nGetting Private key\n\n#é€šè¿‡ç”Ÿæˆçš„CAå¯¹æœåŠ¡å™¨ç«¯çš„CSRæ–‡ä»¶ç­¾å\nD:\\ins\\OpenSSL-Win64_1\\bin&gt;openssl x509 -days 365 -req -in d:/ins/server.csr -extensions v3_req -CAkey d:/ins/myca.key -CA d:/ins/myca.crt -CAcreateserial -out d:/ins/server.crt\nSignature ok\nsubject=C = CN, ST = Shanghai, L = Shanghai, O = fan, OU = fan, CN = fan, emailAddress = fan@qq.com\nGetting CA Private Key\n</code></pre>\n<p>åŒå‡» CA è¯ä¹¦ myca.crtï¼Œå°†è¯¥è¯ä¹¦å®‰è£…åœ¨æ“ä½œç³»ç»Ÿä¸­</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210528141125857.png\" alt=\"image-20210528141125857\" /></p>\n<h3 id=\"nginxé…ç½®\"><a class=\"anchor\" href=\"#nginxé…ç½®\">#</a> Nginx é…ç½®</h3>\n<pre><code>server &#123;\n\t\tlisten 443 ssl;\n\t\tserver_name fan.com;\n\t\tssl_certificate D:\\ins\\server.crt;\n\t\tssl_certificate_key D:\\ins\\server.key;\n\t&#125;\n</code></pre>\n<p>é‡æ–°åŠ è½½ nginx é…ç½®</p>\n<pre><code class=\"language-cmd\">D:\\ins\\nginx-1.18.0\\nginx-1.18.0&gt;nginx.exe -s reload\nEnter PEM pass phrase: #ç›\n</code></pre>\n<p>æ­¤æ—¶ï¼Œå¯åŠ¨ nginxï¼Œéœ€è¦è¾“å…¥å¯†ç ï¼Œå›è½¦åæŸ¥çœ‹æ—¥å¿—ï¼ŒæŠ¥é”™ï¼š</p>\n<pre><code class=\"language-cmd\">the event &quot;ngx_master_8208&quot; was not signaled for 5s\n</code></pre>\n<p>åŸå› ï¼šwindows ä¸‹ nginx é…ç½® ssl çš„ key æ˜¯ä¸èƒ½å­˜å‚¨å¯†ç çš„ï¼Œå¦åˆ™å¯åŠ¨æ—¶ä¼šæç¤ºè¾“å…¥å¯†ç  ï¼Œè¾“å…¥åä¹Ÿæ— æ³•å¯åŠ¨ nginx</p>\n<p>è§£å†³ï¼šå°†æœåŠ¡ç«¯çš„ç§é’¥ key å‰”é™¤å¯†ç ï¼Œä¹‹åå†é€šè¿‡ CA ä¸ºæœåŠ¡ç«¯çš„ CSR æ–‡ä»¶ç­¾å</p>\n<pre><code class=\"language-cmd\">D:\\ins\\OpenSSL-Win64_1\\bin&gt;openssl rsa -in d:/ins/server.key -out d:/ins/server_nopass.key\nEnter pass phrase for d:/ins/server.key:\nwriting RSA key\n</code></pre>\n<p>åŒæ—¶ä¿®æ”¹ä¹‹å‰çš„ nginx é…ç½®</p>\n<pre><code class=\"language-conf\"># HTTPS server\n    #\n    server &#123;\n        listen       443 ssl; #443ç«¯å£ç”¨äºCAè¯ä¹¦é‰´æƒ\n        server_name  fan.com;\n\n        ssl_certificate      D:\\ins\\server.crt;\n        ssl_certificate_key  D:\\ins\\server_nopass.key; #è¯¥keyä¸å¯ä»¥æœ‰å¯†ç \n\n        ssl_session_cache    shared:SSL:1m;\n        ssl_session_timeout  5m;\n\n        ssl_ciphers  HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers  on;\n\n        location / &#123;\n            root   html;\n            index  login.html login.htm; #éšä¾¿å†™ä¸€ä¸ªhtmlä½œä¸ºç™»å½•åè·³è½¬çš„é¡µé¢\n        &#125;\n    &#125;\n</code></pre>\n<p>æ­¤æ—¶å¯ä»¥è®¿é—® <span class=\"exturl\" data-url=\"aHR0cHM6Ly9sb2NhbGhvc3Q=\">https://localhost</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210528151253183.png\" alt=\"image-20210528151253183\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è®¿é—® https åï¼Œæç¤ºä¸å®‰å…¨ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ“ä½œç³»ç»Ÿè™½ç„¶é…ç½®äº† CA è¯ä¹¦ï¼Œä½†æµè§ˆå™¨å¹¶ä¸è®¤è¯†è¯¥ CA è¯ä¹¦ï¼Œéœ€è¦èŠ±é’±å»æŒ‡å®šæœºæ„è®¤è¯</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210528151918101.png\" alt=\"image-20210528151918101\" /></p>\n<h3 id=\"å›¾å½¢åŒ–å·¥å…·\"><a class=\"anchor\" href=\"#å›¾å½¢åŒ–å·¥å…·\">#</a> å›¾å½¢åŒ–å·¥å…·</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb3VyY2Vmb3JnZS5uZXQvcHJvamVjdHMveGNhLw==\">https://sourceforge.net/projects/xca/</span></p>\n<p>xca åœ¨ GitHub ä¸Šä»¥å¼€æº</p>\n<h2 id=\"æœåŠ¡å™¨æ­å»º\"><a class=\"anchor\" href=\"#æœåŠ¡å™¨æ­å»º\">#</a> æœåŠ¡å™¨æ­å»º</h2>\n<p>æœåŠ¡å™¨æ­å»ºé¦–é€‰ CN2ã€GIA</p>\n<h3 id=\"æœåŠ¡å™¨è´­ä¹°\"><a class=\"anchor\" href=\"#æœåŠ¡å™¨è´­ä¹°\">#</a> æœåŠ¡å™¨è´­ä¹°</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2dpZ3NnaWdzY2xvdWQuY29t\">gigsgigscloud.com</span></p>\n<h3 id=\"åŸŸåè´­ä¹°\"><a class=\"anchor\" href=\"#åŸŸåè´­ä¹°\">#</a> åŸŸåè´­ä¹°</h3>\n<p>dns.mba</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2p1bWluZy5jb20=\">juming.com</span></p>\n<h3 id=\"è¯ä¹¦ç”Ÿæˆ\"><a class=\"anchor\" href=\"#è¯ä¹¦ç”Ÿæˆ\">#</a> è¯ä¹¦ç”Ÿæˆ</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mcmVlc3NsLmNu\">https://freessl.cn</span>  å…è´¹ç­¾å</p>\n<p>è¯¥ç«™ç‚¹å¯ä»¥å¯¹å·²æœ‰çš„ CSR æ–‡ä»¶è¿›è¡Œç­¾ååç”Ÿæˆä¸€ä¸ªå¯ä¿¡èµ–çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦å¯ä»¥è¢«æµè§ˆå™¨ä¿¡ä»»</p>\n",
            "tags": [
                "Java",
                "Java",
                "HTTPS",
                "CAè¯ä¹¦",
                "OpenSSL",
                "æ•°å­—ç­¾å"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89/",
            "url": "https://baiyezi.vip/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89/",
            "title": "å¾®æœåŠ¡ä¸­çš„ä¼šè¯ç®¡ç†ï¼ˆäºŒï¼‰",
            "date_published": "2021-08-03T12:15:32.000Z",
            "content_html": "<h2 id=\"oauth20\"><a class=\"anchor\" href=\"#oauth20\">#</a> OAuth2.0</h2>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/160fd879095d008.jpg\" alt=\"\" /></p>\n<p><strong>OAuth çš„æ ¸å¿ƒå°±æ˜¯å‘ç¬¬ä¸‰æ–¹åº”ç”¨é¢å‘ä»¤ç‰Œ</strong>ï¼Œå¦‚åœ¨å…¶ä»– app ä¸Šä½¿ç”¨å¾®ä¿¡ç™»å½•ï¼Œé‚£ä¹ˆè¯¥ app å°±éœ€è¦å‘å¾®ä¿¡è·å–æ­¤æ¬¡ç™»å½•çš„ tokenï¼Œè€Œæ˜¯å¦èƒ½ä½¿ç”¨å¾®ä¿¡ç™»å½•æˆåŠŸå–å†³äº app åœ¨å¾®ä¿¡æ˜¯å¦ç»è¿‡è®¤è¯ä»¥åŠç”¨æˆ·æ˜¯å¦æˆæƒä½¿ç”¨å¾®ä¿¡ç™»å½• appã€‚OAuth2 ä» RFC 6749 å¼€å§‹</p>\n<p>èµ„æºï¼š</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vYXV0aC5uZXQvMi8=\">https://oauth.net/2/</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzY3NDk=\">https://tools.ietf.org/html/rfc6749</span></p>\n<h3 id=\"åº”ç”¨åœºæ™¯\"><a class=\"anchor\" href=\"#åº”ç”¨åœºæ™¯\">#</a> åº”ç”¨åœºæ™¯</h3>\n<h4 id=\"sso\"><a class=\"anchor\" href=\"#sso\">#</a> SSO</h4>\n<p>å•ç‚¹ç™»å½•ã€‚<em>SSO</em> æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªç”¨æˆ·åœ¨é‰´æƒæœåŠ¡å™¨ç™»é™†è¿‡ä¸€æ¬¡ä»¥åï¼Œå¯ä»¥åœ¨ä»»ä½•åº”ç”¨ä¸­ç•…é€šæ— é˜»ï¼Œä¸€æ¬¡ç™»é™†ï¼Œå¤šç³»ç»Ÿè®¿é—®</p>\n<h4 id=\"ç¬¬ä¸‰æ–¹ç™»å½•\"><a class=\"anchor\" href=\"#ç¬¬ä¸‰æ–¹ç™»å½•\">#</a> ç¬¬ä¸‰æ–¹ç™»å½•</h4>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210527111021644.png\" alt=\"image-20210527111021644\" /></p>\n<p><strong>Resource Owner</strong></p>\n<p>èµ„æºæ‹¥æœ‰è€…ï¼Œå¯¹åº”å¾®ä¿¡çš„æ¯ä¸ªç”¨æˆ·å¾®ä¿¡ä¸Šè®¾ç½®çš„ä¸ªäººä¿¡æ¯æ˜¯å±äºæ¯ä¸ªç”¨æˆ·çš„ï¼Œä¸å±äºè…¾è®¯ã€‚</p>\n<p><strong>Resource Server</strong></p>\n<p>èµ„æºæœåŠ¡å™¨ï¼Œä¸€èˆ¬å°±æ˜¯ç”¨æˆ·æ•°æ®çš„ä¸€äº›æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰çš„ REST APIï¼Œæ¯”å¦‚å¾®ä¿¡çš„è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯çš„æ¥å£ã€‚</p>\n<p><strong>Client Application</strong></p>\n<p>ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ï¼Œå¯¹æ¯”å¾®ä¿¡ä¸­å°±æ˜¯å„ç§å¾®ä¿¡å…¬ä¼—å·å¼€å‘çš„åº”ç”¨ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨ç»è¿‡ <code>è®¤è¯æœåŠ¡å™¨</code> æˆæƒåå³å¯è®¿é—® <code>èµ„æºæœåŠ¡å™¨</code> çš„ REST API æ¥è·å–ç”¨æˆ·çš„å¤´åƒã€æ€§åˆ«ã€åœ°åŒºç­‰åŸºæœ¬ä¿¡æ¯ã€‚</p>\n<p><strong>Authorization Server</strong></p>\n<p>è®¤è¯æœåŠ¡å™¨ï¼ŒéªŒè¯ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯æ˜¯å¦åˆæ³•ã€‚å¦‚æœåˆæ³•å°±ç»™å®¢æˆ·ç«¯é¢å¸ƒ tokenï¼Œç¬¬ä¸‰æ–¹é€šè¿‡ token æ¥è°ƒç”¨èµ„æºæœåŠ¡å™¨çš„ APIã€‚</p>\n<h3 id=\"æˆæƒç±»å‹\"><a class=\"anchor\" href=\"#æˆæƒç±»å‹\">#</a> æˆæƒç±»å‹</h3>\n<p><strong>anthorization_code</strong></p>\n<p>æˆæƒç ç±»å‹ï¼Œé€‚ç”¨äº Web Server Applicationã€‚æ¨¡å¼ä¸ºï¼šå®¢æˆ·ç«¯å…ˆè°ƒç”¨ <code>/oauth/authorize/</code>  è¿›åˆ°ç”¨æˆ·æˆæƒç•Œé¢ï¼Œç”¨æˆ·æˆæƒåè¿”å› <code>code</code> ï¼Œå®¢æˆ·ç«¯ç„¶åæ ¹æ® code å’Œ <code>appSecret</code>  è·å– <code>access token</code> ã€‚</p>\n<p><strong>implicit</strong> ç®€åŒ–ç±»å‹ï¼Œç›¸å¯¹äºæˆæƒç ç±»å‹å°‘äº†æˆæƒç è·å–çš„æ­¥éª¤ã€‚å®¢æˆ·ç«¯åº”ç”¨æˆæƒåè®¤è¯æœåŠ¡å™¨ä¼šç›´æ¥å°† access token æ”¾åœ¨å®¢æˆ·ç«¯çš„ urlã€‚å®¢æˆ·ç«¯è§£æ url è·å– tokenã€‚è¿™ç§æ–¹å¼å…¶å®æ˜¯ä¸å¤ªå®‰å…¨çš„ï¼Œå¯ä»¥é€šè¿‡<strong> https å®‰å…¨é€šé“</strong>å’Œ<strong>ç¼©çŸ­ access token çš„æœ‰æ•ˆæ—¶é—´</strong>æ¥è¾ƒå°‘é£é™©ã€‚</p>\n<p><strong>password</strong></p>\n<p>å¯†ç ç±»å‹ï¼Œå®¢æˆ·ç«¯åº”ç”¨é€šè¿‡ç”¨æˆ·çš„ username å’Œ password è· access tokenã€‚é€‚ç”¨äºèµ„æºæœåŠ¡å™¨ã€è®¤è¯æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å…·æœ‰å®Œå…¨çš„ä¿¡ä»»å…³ç³»ï¼Œå› ä¸ºè¦å°†ç”¨æˆ·è¦å°†ç”¨æˆ·çš„ç”¨æˆ·åå¯†ç ç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯åº”ç”¨ï¼Œå®¢æˆ·ç«¯åº”ç”¨é€šè¿‡ç”¨æˆ·å‘é€è¿‡æ¥çš„ç”¨æˆ·åå¯†ç è·å– tokenï¼Œç„¶åè®¿é—®èµ„æºæœåŠ¡å™¨èµ„æºã€‚æ¯”å¦‚æ”¯ä»˜å®å°±å¯ä»¥ç›´æ¥ç”¨æ·˜å®ç”¨æˆ·åå’Œå¯†ç ç™»å½•ï¼Œå› ä¸ºå®ƒä»¬å±äºåŒä¸€å®¶å…¬å¸ï¼Œå½¼æ­¤<strong>å……åˆ†ä¿¡ä»»</strong>ã€‚</p>\n<p><strong>client_credentials</strong></p>\n<p>å®¢æˆ·ç«¯ç±»å‹ï¼Œæ˜¯ä¸éœ€è¦ç”¨æˆ·å‚ä¸çš„ä¸€ç§æ–¹å¼ï¼Œç”¨äºä¸åŒæœåŠ¡ä¹‹é—´çš„å¯¹æ¥ã€‚æ¯”å¦‚è‡ªå·±å¼€å‘çš„åº”ç”¨ç¨‹åºè¦è°ƒç”¨çŸ­ä¿¡éªŒè¯ç æœåŠ¡å•†çš„æœåŠ¡ï¼Œè°ƒç”¨åœ°å›¾æœåŠ¡å•†çš„æœåŠ¡ã€è°ƒç”¨æ‰‹æœºæ¶ˆæ¯æ¨é€æœåŠ¡å•†çš„æœåŠ¡ã€‚å½“éœ€è¦è°ƒç”¨æœåŠ¡æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨æœåŠ¡å•†ç»™çš„ <code>appID</code>  å’Œ <code>appSecret</code>  æ¥è·å– tokenï¼Œå¾—åˆ° token ä¹‹åå°±å¯ä»¥ç›´æ¥è°ƒç”¨æœåŠ¡ã€‚</p>\n<h3 id=\"å…¶ä»–\"><a class=\"anchor\" href=\"#å…¶ä»–\">#</a> å…¶ä»–</h3>\n<ul>\n<li><strong>scope</strong>ï¼šè®¿é—®èµ„æºæœåŠ¡å™¨çš„å“ªäº›ä½œç”¨åŸŸã€‚ä¸€ç»„æƒé™ï¼ŒRole</li>\n<li><strong>refresh token</strong>ï¼šå½“ access token è¿‡æœŸåï¼Œå¯ä»¥é€šè¿‡ refresh token é‡æ–°è·å– access tokenã€‚</li>\n</ul>\n<h3 id=\"tokenæºå¸¦æ–¹å¼\"><a class=\"anchor\" href=\"#tokenæºå¸¦æ–¹å¼\">#</a> Token æºå¸¦æ–¹å¼</h3>\n<h4 id=\"æµè§ˆå™¨\"><a class=\"anchor\" href=\"#æµè§ˆå™¨\">#</a> æµè§ˆå™¨</h4>\n<ul>\n<li>http header</li>\n<li>url ä¸Šçš„ Get è¯·æ±‚</li>\n<li>Cookies</li>\n<li>localStorage</li>\n</ul>\n<h4 id=\"app\"><a class=\"anchor\" href=\"#app\">#</a> APP</h4>\n<ul>\n<li>æœ¬åœ°å­˜å‚¨</li>\n<li>å‰åç«¯ç­¾åï¼Œç§é’¥å­˜å‚¨</li>\n</ul>\n<h3 id=\"tokenå®‰å…¨é˜²å¾¡\"><a class=\"anchor\" href=\"#tokenå®‰å…¨é˜²å¾¡\">#</a> Token å®‰å…¨é˜²å¾¡</h3>\n<ul>\n<li>XSS é‡æ”¾æ”»å‡»</li>\n<li>CSRF è·¨åŸŸæ”»å‡»</li>\n</ul>\n<h3 id=\"å¾®ä¿¡æˆæƒ\"><a class=\"anchor\" href=\"#å¾®ä¿¡æˆæƒ\">#</a> å¾®ä¿¡æˆæƒ</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vZG9jL29wbGF0Zm9ybS9Nb2JpbGVfQXBwL1dlQ2hhdF9Mb2dpbi9EZXZlbG9wbWVudF9HdWlkZS5odG1s\">https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Development_Guide.html</span></p>\n<h3 id=\"å®ä¾‹\"><a class=\"anchor\" href=\"#å®ä¾‹\">#</a> å®ä¾‹</h3>\n<p>æ–°å»ºä¸€ä¸ª SpringBoot é¡¹ç›®ï¼Œå¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-parent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.3.11.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>relativePath</span><span class=\"token punctuation\">/></span></span> <span class=\"token comment\">&lt;!-- lookup parent from repository --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.fan<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>oauth2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>0.0.1-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>OAuth2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>description</span><span class=\"token punctuation\">></span></span>Demo project for Spring Boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>description</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>java.version</span><span class=\"token punctuation\">></span></span>1.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>java.version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>spring-cloud.version</span><span class=\"token punctuation\">></span></span>Hoxton.SR11<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>spring-cloud.version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-security<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-oauth2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusions</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.junit.vintage<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>junit-vintage-engine<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusions</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.security<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-security-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencyManagement</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-dependencies<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>$&#123;spring-cloud.version&#125;<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>type</span><span class=\"token punctuation\">></span></span>pom<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>type</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>import<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencyManagement</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugins</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-maven-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugins</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>èµ„æºæœåŠ¡å™¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EnableGlobalMethodSecurity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpSecurity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>oauth2<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EnableResourceServer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>oauth2<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ResourceServerConfigurerAdapter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * èµ„æºæœåŠ¡å™¨</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @DateTime: 2021-05-27 9:50</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@EnableGlobalMethodSecurity</span><span class=\"token punctuation\">(</span>prePostEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token annotation punctuation\">@EnableResourceServer</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ResourceServerConfiguration</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ResourceServerConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        http<span class=\"token punctuation\">.</span><span class=\"token function\">antMatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/oauth2/api/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span>GET<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/oauth2/api/read/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">access</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#oauth2.hasScope('read')\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span>GET<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/oauth2/api/write/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">access</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#oauth2.hasScope('write')\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è®¤è¯æœåŠ¡å™¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>authorization</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Qualifier</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthenticationManager</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>oauth2<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>configurers<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ClientDetailsServiceConfigurer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>oauth2<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthorizationServerConfigurerAdapter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>oauth2<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EnableAuthorizationServer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>oauth2<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configurers<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthorizationServerEndpointsConfigurer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * è®¤è¯æœåŠ¡å™¨ï¼šé€šè¿‡ codeã€secret æ¢å– token</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * @DateTime: 2021-05-27 9:36</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token annotation punctuation\">@EnableAuthorizationServer</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthorizationServerConfiguration</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AuthorizationServerConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authenticationManagerBean\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AuthenticationManager</span> authenticationManager<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClientDetailsServiceConfigurer</span> clients<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        clients<span class=\"token punctuation\">.</span><span class=\"token function\">inMemory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withClient</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// å®¢æˆ·ç«¯ idï¼Œå¦‚ appid</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">redirectUris</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost:8080/order\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">scopes</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"read\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"write\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// è¦ç»™çš„æƒé™</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">secret</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"secret\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// å¯†é’¥</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">authorizedGrantTypes</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authorization_code\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"implicit\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                        <span class=\"token string\">\"client_credentials\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// è®¤è¯ç­–ç•¥</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthorizationServerEndpointsConfigurer</span> endpoints<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        endpoints<span class=\"token punctuation\">.</span><span class=\"token function\">authenticationManager</span><span class=\"token punctuation\">(</span>authenticationManager<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>security é…ç½®</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>securituy</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthenticationManager</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthenticationManagerBuilder</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpSecurity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebSecurityConfigurerAdapter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>crypto<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">NoOpPasswordEncoder</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>crypto<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PasswordEncoder</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * security é…ç½®</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * @DateTime: 2021-05-27 9:44</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfiguration</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthenticationManagerBuilder</span> auth<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        auth<span class=\"token punctuation\">.</span><span class=\"token function\">inMemoryAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authorities</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">withUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authorities</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthenticationManager</span> <span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token class-name\">PasswordEncoder</span> <span class=\"token function\">passwordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">NoOpPasswordEncoder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ–¹åº”ç”¨</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>controller</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>sun<span class=\"token punctuation\">.</span>org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>bcel<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span>generic<span class=\"token punctuation\">.</span></span>ATHROW<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Authentication</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Controller</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GetMapping</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RestController</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * ç¬¬ä¸‰æ–¹æœåŠ¡</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @DateTime: 2021-05-27 9:56</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/oauth2/api/me\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Authentication</span> <span class=\"token function\">me</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">return</span> authentication<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/oauth2/api/read/xxoo\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Authentication</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"read\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">return</span> authentication<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/oauth2/api/write/xxoo\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Authentication</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"write\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">return</span> authentication<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210527105042169.png\" alt=\"image-20210527105042169\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210527105119698.png\" alt=\"image-20210527105119698\" /></p>\n<p>è¦ç»™å®¢æˆ·ç«¯çš„æƒé™</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210527105311556.png\" alt=\"image-20210527105311556\" /></p>\n<p>è·å–åˆ°äº† token</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210527105422603.png\" alt=\"image-20210527105422603\" /></p>\n<p>ç‚¹å‡» Use Tokenï¼Œæ­¤æ—¶ä¾¿å¯ä»¥çœ‹åˆ°è‡ªåŠ¨å¡«å……äº†è·å–åˆ°çš„ token</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210527105600446.png\" alt=\"image-20210527105600446\" /></p>\n<p>æ­¤æ—¶ä¾¿å¯ä»¥è®¿é—®æˆæƒçš„ API</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210527105725423.png\" alt=\"image-20210527105725423\" /></p>\n<p>æœªæˆæƒçš„ API åˆ™ä¸å¯ä»¥è®¿é—®</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210527105811901.png\" alt=\"image-20210527105811901\" /></p>\n<h2 id=\"openid\"><a class=\"anchor\" href=\"#openid\">#</a> OpenID</h2>\n<p>OpenID æ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ç½‘ä¸Šèº«ä»½è®¤è¯ç³»ç»Ÿã€‚å¯¹äºæ”¯æŒ OpenID çš„ç½‘ç«™ï¼Œç”¨æˆ·ä¸éœ€è¦è®°ä½åƒç”¨æˆ·åå’Œå¯†ç è¿™æ ·çš„ä¼ ç»ŸéªŒè¯æ ‡è®°ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œä»–ä»¬åªéœ€è¦é¢„å…ˆåœ¨ä¸€ä¸ªä½œä¸º OpenID èº«ä»½æä¾›è€…ï¼ˆidentity provider, IdPï¼‰çš„ç½‘ç«™ä¸Šæ³¨å†Œã€‚OpenID æ˜¯å»ä¸­å¿ƒåŒ–çš„ï¼Œä»»ä½•ç½‘ç«™éƒ½å¯ä»¥ä½¿ç”¨ OpenID æ¥ä½œä¸ºç”¨æˆ·ç™»å½•çš„ä¸€ç§æ–¹å¼ï¼Œä»»ä½•ç½‘ç«™ä¹Ÿéƒ½å¯ä»¥ä½œä¸º OpenID èº«ä»½æä¾›è€…ã€‚OpenID æ—¢è§£å†³äº†é—®é¢˜è€Œåˆä¸éœ€è¦ä¾èµ–äºä¸­å¿ƒæ€§çš„ç½‘ç«™æ¥ç¡®è®¤æ•°å­—èº«ä»½ã€‚</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcGVuaWQubmV0\">https://openid.net</span></p>\n<h3 id=\"openidä¸oauth20åŒºåˆ«\"><a class=\"anchor\" href=\"#openidä¸oauth20åŒºåˆ«\">#</a> OpenID ä¸ OAuth2.0 åŒºåˆ«</h3>\n<p>OpenIDï¼šè®¤è¯</p>\n<p>OAuth2.0ï¼šæˆæƒ</p>\n<h2 id=\"jwt\"><a class=\"anchor\" href=\"#jwt\">#</a> JWT</h2>\n<p>JSON Web Tokenã€‚JWT æ˜¯ä¸€ç§åŸºäº JSON çš„ä»¤ç‰Œå®‰å…¨éªŒè¯ (åœ¨æŸäº›ç‰¹å®šçš„åœºåˆå¯ä»¥æ›¿ä»£ Session æˆ–è€… Cookie)ï¼Œä¸€æ¬¡ç”Ÿæˆéšå¤„æ ¡éªŒã€‚Jwt æ˜¯æ— çŠ¶æ€çš„ï¼ŒæœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª Jwt ç”Ÿæˆçš„ tokenï¼ŒæœåŠ¡ç«¯ä¸å­˜å‚¨å®¢æˆ·ç«¯è¯·æ±‚çš„ tokenï¼Œåªè¦å®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„ç”¨æˆ· id ç™»å½•ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯ Jwt å°±å¯ä»¥é€šè¿‡éªŒè¯ã€‚</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qd3QuaW8v\">https://jwt.io/</span></p>\n<h3 id=\"jwtç»„æˆ\"><a class=\"anchor\" href=\"#jwtç»„æˆ\">#</a> JWT ç»„æˆ</h3>\n<h4 id=\"å¤´éƒ¨ä¿¡æ¯header\"><a class=\"anchor\" href=\"#å¤´éƒ¨ä¿¡æ¯header\">#</a> å¤´éƒ¨ä¿¡æ¯ (header)</h4>\n<p>ä½œç”¨ï¼šæŒ‡å®šè¯¥ JWT ä½¿ç”¨çš„ç­¾å</p>\n<pre><code>  &#123;\n      â€œalgâ€: â€œHS256â€,// ç­¾åç®—æ³•\n      â€œtypâ€: â€œJWTâ€ //tokenç±»å‹  \n  &#125;\n</code></pre>\n<p>å°†ä¸Šé¢çš„ jsonï¼Œç”¨ Base64URL ç®—æ³•è½¬æˆå­—ç¬¦ä¸²ï¼Œå³ä¸º headerã€‚</p>\n<h4 id=\"æ¶ˆæ¯ä½“payload\"><a class=\"anchor\" href=\"#æ¶ˆæ¯ä½“payload\">#</a> æ¶ˆæ¯ä½“ payload</h4>\n<p>ä¹Ÿå°±æ˜¯è´Ÿè½½çš„ä¿¡æ¯</p>\n<pre><code>&#123;\n&quot;exp&quot; (expiration time)ï¼šè¿‡æœŸæ—¶é—´\n&quot;sub&quot; (subject)ï¼šä¸»é¢˜,ä¸€èˆ¬ç”¨ç”¨æˆ·id,ç”¨æ¥æ ‡è¯†ç”¨æˆ·ä¼šè¯\n&quot;iat&quot; (Issued At)ï¼šç­¾å‘æ—¶é—´\n&#125;\n</code></pre>\n<p>è¿™ä¸ª JSON å¯¹è±¡ä¹Ÿè¦ä½¿ç”¨ Base64URL ç®—æ³•è½¬æˆå­—ç¬¦ä¸²ã€‚<br />\n<strong>ä½œç”¨</strong>ï¼šJWT çš„è¯·æ±‚æ•°æ®</p>\n<h4 id=\"ç­¾å-signature\"><a class=\"anchor\" href=\"#ç­¾å-signature\">#</a> ç­¾å (signature)</h4>\n<p>Signature éƒ¨åˆ†æ˜¯å¯¹å‰ä¸¤éƒ¨åˆ†çš„ç­¾åï¼Œé˜²æ­¢æ•°æ®ç¯¡æ”¹ã€‚<br />\néœ€è¦æŒ‡å®šä¸€ä¸ªå¯†é’¥ï¼ˆsecretï¼‰ã€‚è¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ã€‚ç„¶åï¼Œä½¿ç”¨ Header é‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰ï¼ŒæŒ‰ç…§ä¸‹é¢çš„å…¬å¼äº§ç”Ÿç­¾åã€‚</p>\n<pre><code>signature = HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload),secret)\ntokenæ ¼å¼ï¼šheader.payload.signature\n</code></pre>\n<p>æœ€ç»ˆï¼šæŠŠ Headerã€Payloadã€Signature ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨ &quot;ç‚¹&quot;ï¼ˆ.ï¼‰åˆ†éš”è¿åœ¨ä¸€èµ·å°±å¾—åˆ°äº†æˆ‘ä»¬è¦çš„ JWT</p>\n<h3 id=\"å®ä¾‹-2\"><a class=\"anchor\" href=\"#å®ä¾‹-2\">#</a> å®ä¾‹</h3>\n<h4 id=\"jwtå·¥å…·ç±»\"><a class=\"anchor\" href=\"#jwtå·¥å…·ç±»\">#</a> JWT å·¥å…·ç±»</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Base64</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Calendar</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>jsonwebtoken<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Claims</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>jsonwebtoken<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ExpiredJwtException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">io<span class=\"token punctuation\">.</span>jsonwebtoken<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Jwts</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JwtUtil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     * å¯†é’¥ï¼Œä»…æœåŠ¡ç«¯å­˜å‚¨</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> secret <span class=\"token operator\">=</span> <span class=\"token string\">\"ko346134h_we]rg3in_yip1!\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>     * @param subject</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     * @param issueDate ç­¾å‘æ—¶é—´</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">createToken</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Date</span> issueDate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    \t</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    \t</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">Calendar</span> c <span class=\"token operator\">=</span> <span class=\"token class-name\">Calendar</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        c<span class=\"token punctuation\">.</span><span class=\"token function\">setTime</span><span class=\"token punctuation\">(</span>issueDate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        c<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Calendar</span><span class=\"token punctuation\">.</span>DAY_OF_MONTH<span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    \t</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    \t</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token class-name\">String</span> compactJws <span class=\"token operator\">=</span> <span class=\"token class-name\">Jwts</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setSubject</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setIssuedAt</span><span class=\"token punctuation\">(</span>issueDate<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">setExpiration</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                \t\t</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">signWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token namespace\">io<span class=\"token punctuation\">.</span>jsonwebtoken<span class=\"token punctuation\">.</span></span>SignatureAlgorithm</span><span class=\"token punctuation\">.</span>HS512<span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">return</span> compactJws<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>     * è§£å¯† jwt</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>     * @param token</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>     * @throws Exception</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">parseToken</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token class-name\">Claims</span> claims <span class=\"token operator\">=</span> <span class=\"token class-name\">Jwts</span><span class=\"token punctuation\">.</span><span class=\"token function\">parser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setSigningKey</span><span class=\"token punctuation\">(</span>secret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseClaimsJws</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>claims <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token keyword\">return</span> claims<span class=\"token punctuation\">.</span><span class=\"token function\">getSubject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ExpiredJwtException</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jwtå·²è¿‡æœŸï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"pomä¾èµ–\"><a class=\"anchor\" href=\"#pomä¾èµ–\">#</a> pom ä¾èµ–</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>io.jsonwebtoken<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>jjwt<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>0.7.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h4 id=\"filteræ ¡éªŒ\"><a class=\"anchor\" href=\"#filteræ ¡éªŒ\">#</a> Filter æ ¡éªŒ</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@WebFilter</span><span class=\"token punctuation\">(</span>filterName <span class=\"token operator\">=</span> <span class=\"token string\">\"authFilter\"</span><span class=\"token punctuation\">,</span> urlPatterns <span class=\"token operator\">=</span> <span class=\"token string\">\"/**\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyFi</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Filter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">FilterChain</span> chain<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t<span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token class-name\">HttpServletRequest</span> req <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token class-name\">String</span> token <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>token <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token comment\">// åˆ¤æ–­è§£æ token æ˜¯å¦æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token class-name\">String</span> parseToken <span class=\"token operator\">=</span> <span class=\"token class-name\">JwtUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>parseToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth success\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\tchain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"auth failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FilterConfig</span> filterConfig<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t<span class=\"token comment\">// TODO Auto-generated method stub</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"init...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t<span class=\"token class-name\">Filter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>filterConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"cas\"><a class=\"anchor\" href=\"#cas\">#</a> CAS</h2>\n<p>é›†ä¸­å¼èº«ä»½éªŒ Central Authentication Service</p>\n<h2 id=\"hmac\"><a class=\"anchor\" href=\"#hmac\">#</a> HMAC</h2>\n<p>æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯¹æ•°æ®äº§ç”Ÿçš„æ‘˜è¦ï¼Œç”¨äºä¼ è¾“é˜²ç¯¡æ”¹</p>\n<h2 id=\"saml-20\"><a class=\"anchor\" href=\"#saml-20\">#</a> SAML 2.0</h2>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/5.jpg\" alt=\"img\" /></p>\n",
            "tags": [
                "Java",
                "Java",
                "OAuth2.0",
                "JWT",
                "Token",
                "SSO"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/io/%E7%A3%81%E7%9B%98IO%E4%B8%8E%E7%BD%91%E7%BB%9CIO/",
            "url": "https://baiyezi.vip/java/io/%E7%A3%81%E7%9B%98IO%E4%B8%8E%E7%BD%91%E7%BB%9CIO/",
            "title": "ç£ç›˜IOä¸ç½‘ç»œIO",
            "date_published": "2021-08-01T14:29:01.000Z",
            "content_html": "<blockquote>\n<p>Linux åŸºç¡€çŸ¥è¯†</p>\n</blockquote>\n<h2 id=\"vfs\"><a class=\"anchor\" href=\"#vfs\">#</a> VFS</h2>\n<p>å³è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œç›¸å½“äºå†…æ ¸å¯¹å¤–æä¾›çš„ä¸€ä¸ªæ ‡å‡†æ¥å£ï¼ŒæŒ‚è½½ç€ä¸åŒçš„ç¡¬ä»¶è®¾å¤‡ï¼Œè¿™äº›è®¾å¤‡çš„é©±åŠ¨å®ç°å¯ä»¥ä¸åŒ</p>\n<h2 id=\"fd\"><a class=\"anchor\" href=\"#fd\">#</a> FD</h2>\n<p>å³æ–‡ä»¶æè¿°ç¬¦ã€‚ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä»£è¡¨å¯å‘èµ·ä¸åŒçš„æ“ä½œï¼Œè€Œè¿™äº›æ“ä½œä»£è¡¨ä¸åŒçš„ä¸­æ–­</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># exec 8> bula.txt</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>total <span class=\"token number\">139796</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>-rw-------. <span class=\"token number\">1</span> root root      <span class=\"token number\">1231</span> Jan  <span class=\"token number\">7</span> <span class=\"token number\">17</span>:38 anaconda-ks.cfg</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> root root         <span class=\"token number\">0</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">14</span>:00 bula.txt</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> root root      <span class=\"token number\">1386</span> Jan  <span class=\"token number\">7</span> <span class=\"token number\">17</span>:40 initial-setup-ks.cfg</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> root root <span class=\"token number\">143142634</span> Jan  <span class=\"token number\">8</span> <span class=\"token number\">15</span>:51 jdk-8u271-linux-x64.tar.gz</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $$</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">8376</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /proc/8376/fd</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost fd<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>total <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>lrwx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">0</span> -<span class=\"token operator\">></span> /dev/pts/1 <span class=\"token comment\">#æ–‡ä»¶æè¿°ç¬¦ 0 ä»£è¡¨æ ‡å‡†è¾“å…¥</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>lrwx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">1</span> -<span class=\"token operator\">></span> /dev/pts/1 <span class=\"token comment\">#æ–‡ä»¶æè¿°ç¬¦ 1 ä»£è¡¨æ ‡å‡†è¾“å‡º</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>lrwx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">2</span> -<span class=\"token operator\">></span> /dev/pts/1 <span class=\"token comment\">#æ–‡ä»¶æè¿°ç¬¦ 2 ä»£è¡¨é”™è¯¯è¾“å‡º</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>lrwx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">255</span> -<span class=\"token operator\">></span> /dev/pts/1</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>lr-x------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">3</span> -<span class=\"token operator\">></span> /var/lib/sss/mc/passwd</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>lrwx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">4</span> -<span class=\"token operator\">></span> <span class=\"token string\">'socket:[68945]'</span> <span class=\"token comment\">#æ–‡ä»¶æè¿°ç¬¦ 4 ä»£è¡¨å†™</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>l-wx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">14</span>:03 <span class=\"token number\">8</span> -<span class=\"token operator\">></span> /root/bula.txt  <span class=\"token comment\">## æ–‡ä»¶æè¿°ç¬¦ 8 ä»£è¡¨è¯»</span></pre></td></tr></table></figure><p>0ï¼šæ ‡å‡†è¾“å…¥</p>\n<p>1ï¼šæ ‡å‡†è¾“å‡º</p>\n<p>2ï¼šæŠ¥é”™è¾“å‡º</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#proc ç›®å½•æ˜¯å†…æ ¸æ˜ å°„ç›®å½•ï¼Œæ•°å­—ä»£è¡¨è¿›ç¨‹çš„ id å·</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /proc</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost proc<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">1</span>      <span class=\"token number\">106</span>   <span class=\"token number\">1175</span>  <span class=\"token number\">1468</span>  <span class=\"token number\">22</span>    <span class=\"token number\">3389</span>  <span class=\"token number\">3476</span>  <span class=\"token number\">445</span>  <span class=\"token number\">7569</span>  <span class=\"token number\">7738</span>  <span class=\"token number\">7825</span>  <span class=\"token number\">7889</span>  <span class=\"token number\">8051</span>  <span class=\"token number\">8355</span>  <span class=\"token number\">851</span>   <span class=\"token number\">9585</span>       cmdline      kallsyms     mtrr           timer_list</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">10</span>     <span class=\"token number\">1062</span>  <span class=\"token number\">118</span>   <span class=\"token number\">1472</span>  <span class=\"token number\">23</span>    <span class=\"token number\">3393</span>  <span class=\"token number\">3510</span>  <span class=\"token number\">508</span>  <span class=\"token number\">7578</span>  <span class=\"token number\">7741</span>  <span class=\"token number\">7826</span>  <span class=\"token number\">7891</span>  <span class=\"token number\">806</span>   <span class=\"token number\">836</span>   <span class=\"token number\">852</span>   <span class=\"token number\">96</span>         consoles     kcore        net            <span class=\"token function\">tty</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">100</span>    <span class=\"token number\">107</span>   <span class=\"token number\">119</span>   <span class=\"token number\">15</span>    <span class=\"token number\">24</span>    <span class=\"token number\">3398</span>  <span class=\"token number\">3671</span>  <span class=\"token number\">517</span>  <span class=\"token number\">7588</span>  <span class=\"token number\">7744</span>  <span class=\"token number\">7829</span>  <span class=\"token number\">7892</span>  <span class=\"token number\">807</span>   <span class=\"token number\">837</span>   <span class=\"token number\">8546</span>  <span class=\"token number\">963</span>        cpuinfo      keys         pagetypeinfo   <span class=\"token function\">uptime</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1000</span>   <span class=\"token number\">108</span>   <span class=\"token number\">12</span>    <span class=\"token number\">16</span>    <span class=\"token number\">25</span>    <span class=\"token number\">3402</span>  <span class=\"token number\">4</span>     <span class=\"token number\">541</span>  <span class=\"token number\">7594</span>  <span class=\"token number\">7749</span>  <span class=\"token number\">7831</span>  <span class=\"token number\">7933</span>  <span class=\"token number\">8074</span>  <span class=\"token number\">8370</span>  <span class=\"token number\">859</span>   <span class=\"token number\">97</span>         crypto       key-users    partitions     version</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">101</span>    <span class=\"token number\">109</span>   <span class=\"token number\">120</span>   <span class=\"token number\">17</span>    <span class=\"token number\">26</span>    <span class=\"token number\">3404</span>  <span class=\"token number\">41</span>    <span class=\"token number\">546</span>  <span class=\"token number\">7601</span>  <span class=\"token number\">775</span>   <span class=\"token number\">7834</span>  <span class=\"token number\">7934</span>  <span class=\"token number\">808</span>   <span class=\"token number\">8373</span>  <span class=\"token number\">889</span>   <span class=\"token number\">979</span>        devices      kmsg         sched_debug    vmallocinfo</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">102</span>    <span class=\"token number\">11</span>    <span class=\"token number\">121</span>   <span class=\"token number\">1750</span>  <span class=\"token number\">2697</span>  <span class=\"token number\">3408</span>  <span class=\"token number\">420</span>   <span class=\"token number\">547</span>  <span class=\"token number\">7605</span>  <span class=\"token number\">7752</span>  <span class=\"token number\">7836</span>  <span class=\"token number\">7938</span>  <span class=\"token number\">811</span>   <span class=\"token number\">8376</span>  <span class=\"token number\">891</span>   <span class=\"token number\">98</span>         diskstats    kpagecgroup  schedstat      <span class=\"token function\">vmstat</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">1020</span>   <span class=\"token number\">110</span>   <span class=\"token number\">122</span>   <span class=\"token number\">18</span>    <span class=\"token number\">27</span>    <span class=\"token number\">3414</span>  <span class=\"token number\">421</span>   <span class=\"token number\">549</span>  <span class=\"token number\">7607</span>  <span class=\"token number\">7763</span>  <span class=\"token number\">7842</span>  <span class=\"token number\">7959</span>  <span class=\"token number\">8176</span>  <span class=\"token number\">838</span>   <span class=\"token number\">9</span>     <span class=\"token number\">980</span>        dma          kpagecount   scsi           zoneinfo</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">103</span>    <span class=\"token number\">1101</span>  <span class=\"token number\">123</span>   <span class=\"token number\">1813</span>  <span class=\"token number\">2712</span>  <span class=\"token number\">3422</span>  <span class=\"token number\">422</span>   <span class=\"token number\">550</span>  <span class=\"token number\">7621</span>  <span class=\"token number\">7779</span>  <span class=\"token number\">7846</span>  <span class=\"token number\">7961</span>  <span class=\"token number\">8218</span>  <span class=\"token number\">8384</span>  <span class=\"token number\">912</span>   <span class=\"token number\">982</span>        driver       kpageflags   self</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">1035</span>   <span class=\"token number\">1103</span>  <span class=\"token number\">1236</span>  <span class=\"token number\">1821</span>  <span class=\"token number\">2719</span>  <span class=\"token number\">3425</span>  <span class=\"token number\">423</span>   <span class=\"token number\">551</span>  <span class=\"token number\">7678</span>  <span class=\"token number\">778</span>   <span class=\"token number\">7851</span>  <span class=\"token number\">7968</span>  <span class=\"token number\">8223</span>  <span class=\"token number\">841</span>   <span class=\"token number\">917</span>   <span class=\"token number\">988</span>        execdomains  loadavg      slabinfo</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">10386</span>  <span class=\"token number\">111</span>   <span class=\"token number\">124</span>   <span class=\"token number\">1825</span>  <span class=\"token number\">2726</span>  <span class=\"token number\">3430</span>  <span class=\"token number\">424</span>   <span class=\"token number\">552</span>  <span class=\"token number\">7696</span>  <span class=\"token number\">7783</span>  <span class=\"token number\">7855</span>  <span class=\"token number\">7972</span>  <span class=\"token number\">8280</span>  <span class=\"token number\">842</span>   <span class=\"token number\">92</span>    <span class=\"token number\">99</span>         fb           locks        softirqs</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">104</span>    <span class=\"token number\">112</span>   <span class=\"token number\">125</span>   <span class=\"token number\">19</span>    <span class=\"token number\">28</span>    <span class=\"token number\">3437</span>  <span class=\"token number\">425</span>   <span class=\"token number\">553</span>  <span class=\"token number\">7701</span>  <span class=\"token number\">7787</span>  <span class=\"token number\">7870</span>  <span class=\"token number\">7996</span>  <span class=\"token number\">8284</span>  <span class=\"token number\">844</span>   <span class=\"token number\">93</span>    <span class=\"token number\">998</span>        filesystems  mdstat       <span class=\"token function\">stat</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">10435</span>  <span class=\"token number\">113</span>   <span class=\"token number\">126</span>   <span class=\"token number\">1967</span>  <span class=\"token number\">29</span>    <span class=\"token number\">3439</span>  <span class=\"token number\">426</span>   <span class=\"token number\">554</span>  <span class=\"token number\">7715</span>  <span class=\"token number\">7794</span>  <span class=\"token number\">7871</span>  <span class=\"token number\">8</span>     <span class=\"token number\">8299</span>  <span class=\"token number\">845</span>   <span class=\"token number\">931</span>   acpi       fs           meminfo      swaps</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">10452</span>  <span class=\"token number\">114</span>   <span class=\"token number\">127</span>   <span class=\"token number\">1971</span>  <span class=\"token number\">3</span>     <span class=\"token number\">3455</span>  <span class=\"token number\">427</span>   <span class=\"token number\">555</span>  <span class=\"token number\">7719</span>  <span class=\"token number\">7797</span>  <span class=\"token number\">7873</span>  <span class=\"token number\">802</span>   <span class=\"token number\">8318</span>  <span class=\"token number\">846</span>   <span class=\"token number\">936</span>   asound     interrupts   misc         sys</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">10453</span>  <span class=\"token number\">115</span>   <span class=\"token number\">128</span>   <span class=\"token number\">2</span>     <span class=\"token number\">3087</span>  <span class=\"token number\">3459</span>  <span class=\"token number\">428</span>   <span class=\"token number\">6</span>    <span class=\"token number\">7724</span>  <span class=\"token number\">7801</span>  <span class=\"token number\">7876</span>  <span class=\"token number\">8035</span>  <span class=\"token number\">834</span>   <span class=\"token number\">847</span>   <span class=\"token number\">937</span>   buddyinfo  iomem        modules      sysrq-trigger</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">105</span>    <span class=\"token number\">116</span>   <span class=\"token number\">13</span>    <span class=\"token number\">20</span>    <span class=\"token number\">3365</span>  <span class=\"token number\">3465</span>  <span class=\"token number\">439</span>   <span class=\"token number\">653</span>  <span class=\"token number\">7727</span>  <span class=\"token number\">7808</span>  <span class=\"token number\">7880</span>  <span class=\"token number\">8038</span>  <span class=\"token number\">8345</span>  <span class=\"token number\">849</span>   <span class=\"token number\">94</span>    bus        ioports      mounts       sysvipc</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">1056</span>   <span class=\"token number\">117</span>   <span class=\"token number\">1321</span>  <span class=\"token number\">21</span>    <span class=\"token number\">3385</span>  <span class=\"token number\">3474</span>  <span class=\"token number\">444</span>   <span class=\"token number\">689</span>  <span class=\"token number\">7736</span>  <span class=\"token number\">7817</span>  <span class=\"token number\">7884</span>  <span class=\"token number\">804</span>   <span class=\"token number\">835</span>   <span class=\"token number\">850</span>   <span class=\"token number\">95</span>    cgroups    irq          mpt          thread-self</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># $$ ä»£è¡¨å½“å‰ bashï¼ˆå½“å‰æ‰“å¼€çš„ç»ˆç«¯ç•Œé¢ï¼‰çš„ pidï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ $BASHPID æ¥ä»£æ›¿</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost proc<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd $$</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost <span class=\"token number\">8376</span><span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>attr       clear_refs       cpuset   fd       limits     mem         net        oom_score      personality  schedstat  smaps_rollup  status   timerslack_ns</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>autogroup  cmdline          cwd      fdinfo   loginuid   mountinfo   ns         oom_score_adj  projid_map   sessionid  stack         syscall  uid_map</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>auxv       <span class=\"token function\">comm</span>             environ  gid_map  map_files  mounts      numa_maps  pagemap        root         setgroups  <span class=\"token function\">stat</span>          task     wchan</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>cgroup     coredump_filter  exe      io       maps       mountstats  oom_adj    patch_state    sched        smaps      statm         timers</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹å½“å‰ bash çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost <span class=\"token number\">8376</span><span class=\"token punctuation\">]</span><span class=\"token comment\"># cd fd</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost fd<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token number\">0</span>  <span class=\"token number\">1</span>  <span class=\"token number\">2</span>  <span class=\"token number\">255</span>  <span class=\"token number\">3</span>  <span class=\"token number\">4</span>  <span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost fd<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>total <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>lrwx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">0</span> -<span class=\"token operator\">></span> /dev/pts/1</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>lrwx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">1</span> -<span class=\"token operator\">></span> /dev/pts/1</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>lrwx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">2</span> -<span class=\"token operator\">></span> /dev/pts/1</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>lrwx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">255</span> -<span class=\"token operator\">></span> /dev/pts/1</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>lr-x------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">3</span> -<span class=\"token operator\">></span> /var/lib/sss/mc/passwd</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>lrwx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">13</span>:12 <span class=\"token number\">4</span> -<span class=\"token operator\">></span> <span class=\"token string\">'socket:[68945]'</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>l-wx------. <span class=\"token number\">1</span> root root <span class=\"token number\">64</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">14</span>:03 <span class=\"token number\">8</span> -<span class=\"token operator\">></span> /root/bula.txt</pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹å½“å‰ bash çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦çš„å…·ä½“ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost fd<span class=\"token punctuation\">]</span><span class=\"token comment\"># lsof -op $$</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>lsof: WARNING: can't stat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> fuse.gvfsd-fuse <span class=\"token function\">file</span> system /run/user/1000/gvfs</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      Output information may be incomplete.</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>COMMAND  PID <span class=\"token environment constant\">USER</span>   FD   TYPE             DEVICE OFFSET     NODE NAME</pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  cwd    DIR                <span class=\"token number\">0,4</span>           <span class=\"token number\">92892</span> /proc/8376/fd</pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  rtd    DIR              <span class=\"token number\">253,0</span>             <span class=\"token number\">128</span> /</pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  txt    REG              <span class=\"token number\">253,0</span>         <span class=\"token number\">8821425</span> /usr/bin/bash</pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>         <span class=\"token number\">8813609</span> /usr/lib/locale/en_US.utf8/LC_COLLATE</pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12818715</span> /usr/lib64/libnss_files-2.28.so</pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">13451458</span> /var/lib/sss/mc/passwd</pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">13900504</span> /usr/lib64/libnss_sss.so.2</pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12818703</span> /usr/lib64/libc-2.28.so</pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12818705</span> /usr/lib64/libdl-2.28.so</pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12812861</span> /usr/lib64/libtinfo.so.6.1</pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12818696</span> /usr/lib64/ld-2.28.so</pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>         <span class=\"token number\">8813610</span> /usr/lib/locale/en_US.utf8/LC_CTYPE</pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>         <span class=\"token number\">8813613</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_NUMERIC</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12813675</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_TIME</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12813673</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_MONETARY</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12813685</span> /usr/lib/locale/en_US.utf8/LC_MESSAGES/SYS_LC_MESSAGES</pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>         <span class=\"token number\">4414616</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_PAPER</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>         <span class=\"token number\">8813612</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_NAME</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12813670</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_ADDRESS</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12813674</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_TELEPHONE</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12813672</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_MEASUREMENT</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>         <span class=\"token number\">4431007</span> /usr/lib64/gconv/gconv-modules.cache</pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>        <span class=\"token number\">12813671</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_IDENTIFICATION</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    0u   CHR              <span class=\"token number\">136,1</span>    0t0        <span class=\"token number\">4</span> /dev/pts/1</pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    1u   CHR              <span class=\"token number\">136,1</span>    0t0        <span class=\"token number\">4</span> /dev/pts/1</pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    2u   CHR              <span class=\"token number\">136,1</span>    0t0        <span class=\"token number\">4</span> /dev/pts/1</pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    3r   REG              <span class=\"token number\">253,0</span>    0t0 <span class=\"token number\">13451458</span> /var/lib/sss/mc/passwd</pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    4u  unix 0x00000000015f1ce9    0t0    <span class=\"token number\">68945</span> <span class=\"token assign-left variable\">type</span><span class=\"token operator\">=</span>STREAM</pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    8w   REG              <span class=\"token number\">253,0</span>    0t0 <span class=\"token number\">10769210</span> /root/bula.txt</pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  255u   CHR              <span class=\"token number\">136,1</span>    0t0        <span class=\"token number\">4</span> /dev/pts/1</pre></td></tr><tr><td data-num=\"77\"></td><td><pre></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹æŸä¸ªè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost fd<span class=\"token punctuation\">]</span><span class=\"token comment\"># lsof -p è¿›ç¨‹å·</span></pre></td></tr></table></figure><h2 id=\"é‡å®šå‘\"><a class=\"anchor\" href=\"#é‡å®šå‘\">#</a> é‡å®šå‘</h2>\n<p>é‡å®šå‘æ˜¯ä¸€ç§æœºåˆ¶ï¼Œè€Œä¸æ˜¯å‘½ä»¤</p>\n<p>&quot;0&lt;&quot;ï¼šè¾“å…¥é‡å®šå‘</p>\n<p>&quot;&gt;1&quot;ï¼šè¾“å‡ºé‡å®šå‘</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å°†å½“å‰ç›®å½•ä¸‹ ls å‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°æ ¹ç›®å½•çš„ test.out ä¸­</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost fd<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls ./ 1> ~/test.out</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost fd<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd ~</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim test.out </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">255</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>~</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#å°† test.out ä½œä¸º cat çš„æ ‡å‡†è¾“å…¥ï¼Œå°† cat.out ä½œä¸º cat çš„æ ‡å‡†è¾“å‡º</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat 0&lt; test.out 1>cat.out</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim cat.out</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">1</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">255</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>~</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#å°†é”®ç›˜çš„è¾“å…¥èµ‹å€¼ç»™ aï¼ŒæŒ‰å›è½¦ç»“æŸ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># read a</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>adgasgagas</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $a</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>adgasgagas</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#å°† read çš„æ ‡å‡†è¾“å…¥é‡å®šå‘åˆ° cat.outï¼Œå¹¶èµ‹å€¼ç»™ a</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># read a 0&lt; cat.out</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#å¯ä»¥çœ‹åˆ° a ä¸­åªæœ‰ cat.out æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ•°æ®ï¼Œå› ä¸ºæ ‡å‡†è¾“å…¥è¾“å‡ºé‡åˆ°æ¢è¡Œç¬¦å°±ç»“æŸ</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $a</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim cat.out</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">1</span> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">255</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">8</span></pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#å°† ls .//aaaï¼Œå³æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ aaa ç›®å½•çš„æ ‡å‡†è¾“å‡ºä»¥åŠé”™è¯¯è¾“å‡ºé‡å®šå‘åˆ° lso1.out</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls ./ /aaa  1> lso1.out 2>&amp; 1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim lso1.out </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ls: cannot access <span class=\"token string\">'/aaa'</span><span class=\"token builtin class-name\">:</span> No such <span class=\"token function\">file</span> or directory</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>./:</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>anaconda-ks.cfg</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>bula.txt</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>cat.out</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>initial-setup-ks.cfg</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>jdk-8u271-linux-x64.tar.gz</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>lso1.out</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>test.out</pre></td></tr></table></figure><h2 id=\"headtail\"><a class=\"anchor\" href=\"#headtail\">#</a> head/tail</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#æ˜¾ç¤ºæ–‡ä»¶çš„å‰åè¡Œ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># head text.txt </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>bsdbsdbsdb</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>sfbsdb</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>sdbsdb</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>sbsdb</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>sbsdfb</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>sbsdb</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>sdbsdb</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>yjrj</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>kykh</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>adaf</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#æ˜¾ç¤ºæ–‡ä»¶çš„ååè¡Œ</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># tail text.txt </span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>kykh</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>adaf</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>sfds</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>sddhr</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>gfhjf</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>yutths</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>zczx</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>eg</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>rht</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#è¯»å–æ–‡ä»¶çš„ç¬¬ä¸€è¡Œ</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># head -1 text.txt </span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>bsdbsdbsdb</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#è¯»å–æ–‡ä»¶çš„å‰ä¸¤è¡Œ</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># head -2 text.txt </span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>bsdbsdbsdb</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>sfbsdb</pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">#è¯»å–æ–‡ä»¶çš„åä¸‰è¡Œ</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># tail -3 text.txt </span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>zczx</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>eg</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>rht</pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#åªè¯»å–ç¬¬å…«è¡Œï¼Œå¯ä»¥ä»å‰å…«è¡Œä¸­å–å‡ºæœ€åä¸€è¡Œ</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># head -8 text.txt | tail -1</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>yjrj</pre></td></tr></table></figure><h2 id=\"ç®¡é“\"><a class=\"anchor\" href=\"#ç®¡é“\">#</a> ç®¡é“</h2>\n<p>å‰é¢çš„è¾“å‡ºä½œä¸ºåé¢çš„è¾“å…¥ï¼Œä¸”ç®¡é“å‰åçš„è¾“å…¥è¾“å‡ºéƒ½ä¼šå„è‡ªå¼€å¯ä¸€ä¸ªå­è¿›ç¨‹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># a=1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $a</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#ç®¡é“å‰å¼€å¯ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå°† &#123;a=9; echo \"sfsfs\";&#125; çš„è¾“å‡ºä½œä¸ºç®¡é“åå­è¿›ç¨‹ä¸­ cat çš„è¾“å…¥ï¼Œä¸”ç”±äºæ˜¯å­è¿›ç¨‹ï¼Œæ‰€ä»¥ a=9 ä¸ä¼šå½±å“çˆ¶è¿›ç¨‹ä¸­çš„å˜é‡ a</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># &#123; a=9; echo \"sfsfs\"; &#125; | cat</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>sfsfs</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $a</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr></table></figure><h2 id=\"ä¸bashpidçš„åŒºåˆ«\"><a class=\"anchor\" href=\"#ä¸bashpidçš„åŒºåˆ«\">#</a> $$ ä¸ $BASHPID çš„åŒºåˆ«</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $$</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2254</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># $$ çš„ä¼˜å…ˆçº§é«˜äºç®¡é“ï¼Œæ‰€ä»¥é¦–å…ˆå…ˆå°† $$ è§£é‡Šä¸ºè¿›ç¨‹å· 2254ï¼Œç„¶åç®¡é“å·¦å³å„å¼€å¯ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå·¦è¾¹å­è¿›ç¨‹å°† echo 2254 é€šè¿‡ç®¡é“èµ‹å€¼ç»™å­è¿›ç¨‹ cat ä½œä¸ºè¾“å‡º</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $$ | cat</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">2254</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># $BASHPID ä¼˜å…ˆçº§ä½äºç®¡é“ï¼Œæ‰€ä»¥ä¼šé¦–å…ˆåœ¨ç®¡é“å·¦å³å„å¼€å¯ä¸€ä¸ªå­è¿›ç¨‹ï¼Œ$BASHPID è®¡ç®—å­è¿›ç¨‹çš„ bash è¿›ç¨‹å·ï¼Œç„¶åå†é€šè¿‡ç®¡é“èµ‹å€¼ç»™å­è¿›ç¨‹ cat ä½œä¸ºè¾“å‡º</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $BASHPID | cat</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">2582</span></pre></td></tr></table></figure><h2 id=\"inode\"><a class=\"anchor\" href=\"#inode\">#</a> Inode</h2>\n<p>æ¯ä¸ªæ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†</p>\n<h2 id=\"pagecache\"><a class=\"anchor\" href=\"#pagecache\">#</a> PageCache</h2>\n<p>å†…æ ¸ä¸­ç»´æŠ¤çš„é¡µç¼“å­˜ï¼Œé»˜è®¤ 4kã€‚ç¨‹åºä»ç£ç›˜è¯»å–æ–‡ä»¶æ—¶ï¼Œä¼šå…ˆå­˜å…¥é¡µç¼“å­˜è¿›è¡Œç¼“å­˜ï¼Œå½“å†æ¬¡è¯»å–ç›¸åŒæ–‡ä»¶æ—¶å°±ä¼šä»é¡µç¼“å­˜ä¸­è¯»å–ï¼Œè¿™æ ·ä¸ä»…åŠ å¿«äº†è¯»å–é€Ÿåº¦ï¼Œä¹Ÿé¿å…äº†ç›¸åŒæ–‡ä»¶åœ¨å†…å­˜ä¸­é‡å¤å ç”¨å†…å­˜ç©ºé—´ï¼Œä½†ä¹Ÿå­˜åœ¨æ•°æ®ä» PageCache åˆ°ç£ç›˜çš„å»¶æ—¶é—®é¢˜ã€‚å½“ç¼“å­˜ä¸­æ•°æ®æ›´æ”¹åï¼Œæ ‡è®°ä¸º dirtyï¼Œéšåå°†æ›´æ”¹çš„ç¼“å­˜ä¸­çš„æ•°æ® flush åˆ°ç£ç›˜ï¼Œå¯ä»¥ä¸»åŠ¨é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥ flush åˆ°ç£ç›˜ï¼ˆä¸¢å¤±æ•°æ®å°‘ï¼‰ï¼Œæˆ–è€…ç­‰å¾…å†…æ ¸è‡ªå·± flush åˆ°ç£ç›˜ï¼ˆä¸¢å¤±æ•°æ®å¤šï¼‰ã€‚</p>\n<p>åœ¨ VMware Workstation ä¸­çš„ â€œå…³é—­å®¢æˆ·æœºâ€ ä¼šæŠŠ PageCache ä¸­çš„æ•°æ®åˆ·åˆ°ç£ç›˜åå†å…³æœºï¼Œè€Œ â€œå…³æœºâ€ æ˜¯ç›´æ¥æ–­ç”µï¼Œä¸ä¼šæŠŠ PageCache ä¸­çš„æ•°æ®åˆ·åˆ°ç£ç›˜ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p>\n<p>é—®é¢˜ï¼šæ‰€éœ€çš„æ–‡ä»¶æ˜¯ä¸€æ¬¡æ€§è¯»å–åˆ° PageCacheï¼Œè¿˜æ˜¯éœ€è¦å¤šå°‘è¯»å¤šå°‘ï¼Œä»€ä¹ˆæ—¶å€™æ¸…é™¤ PageCache å‘¢</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># PageCahce ä¸­çš„è„é¡µé…ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sysctl -a | grep dirty</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>vm.dirty_background_bytes <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>vm.dirty_background_ratio <span class=\"token operator\">=</span> <span class=\"token number\">10</span> <span class=\"token comment\">#ç”±å†…æ ¸ä¸­çš„åå°çº¿ç¨‹è§¦å‘ç”±å†…æ ¸å‘ç£ç›˜åˆ·æ•°æ®ï¼ŒåŒæ—¶ä¸ä¼šé˜»å¡ç¨‹åºå‘å†…æ ¸å†™æ•°æ®ã€‚å½“å†…æ ¸å¯ç”¨ç©ºé—´å‰©ä¸‹ 10% æ—¶ï¼Œå†…æ ¸ä¸­çš„åå°çº¿ç¨‹å°±å°†å†…æ ¸ä¸­çš„è„é¡µçš„æ•°æ®åˆ·å…¥åˆ°ç£ç›˜ï¼ŒåŒæ—¶ç¨‹åºå¯ä»¥ç»§ç»­å‘å†…æ ¸å†™æ•°æ®ï¼Œè¿™æ„å‘³ç€å†…æ ¸ä¸­çš„ 90% çš„å†…å­˜ä¸­çš„æ•°æ®å°±æœ‰ä¸¢å¤±çš„é£é™©ï¼Œå› ä¸ºè¾¾ä¸åˆ°è§¦å‘å†…æ ¸åå°çº¿ç¨‹ç”±å†…æ ¸å‘ç£ç›˜åˆ·æ•°æ®çš„æ¡ä»¶ï¼Œæ‰€ä»¥ç›´æ¥æ–­ç”µçš„è¯å°±ä¼šä¸¢å¤±å†…æ ¸ä¸­å·²ç»ç¼“å­˜çš„æ•°æ®</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>vm.dirty_bytes <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>vm.dirty_expire_centisecs <span class=\"token operator\">=</span> <span class=\"token number\">3000</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>vm.dirty_ratio <span class=\"token operator\">=</span> <span class=\"token number\">30</span> <span class=\"token comment\">#ç¨‹åºå‘å†…æ ¸å†™æ•°æ®ä¸æ–­åˆ†é… PageCacheï¼Œå½“ PageCache æ€»å¤§å°è¾¾åˆ°å†…æ ¸å¤§å°çš„ 30% æ—¶å°±é˜»å¡ç¨‹åºçš„å†™æ•°æ®æ“ä½œï¼Œä¿è¯å†…æ ¸ç©ºé—´çš„åˆ©ç”¨ç‡ã€‚è¯¥å€¼æ¯” vm.dirty_background_ratio çš„å€¼è¦å¤§</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>vm.dirty_writeback_centisecs <span class=\"token operator\">=</span> <span class=\"token number\">500</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>vm.dirtytime_expire_seconds <span class=\"token operator\">=</span> <span class=\"token number\">43200</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#å¦‚æœè¦ä¿®æ”¹ä»¥ä¸Šé…ç½®é¡¹ï¼Œå¯ä»¥åœ¨ä»¥ä¸‹æ–‡ä»¶çš„æœ€ååŠ ä¸Šé…ç½®é¡¹å³å¯</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/sysctl.conf</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># sysctl settings are defined through files in</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># Vendors settings live in /usr/lib/sysctl.d/.</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># To override a whole file, create a new file with the same in</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># /etc/sysctl.d/ and put new settings there. To override</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># only specific settings, add a file with a lexically later</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># name in /etc/sysctl.d/ and put new settings there.</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># For more information, see sysctl.conf(5) and sysctl.d(5).</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>~                                                                                                                                                            </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>~                                                                                           <span class=\"token comment\"># ä½¿å¾—ä¿®æ”¹çš„é…ç½®é¡¹ç”Ÿæ•ˆ</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sysctl -p</span></pre></td></tr></table></figure><p>Buffer ä¹‹æ‰€ä»¥æ¯”æ™®é€šå†™å¿«ï¼Œæ˜¯å› ä¸º JVM ä¸­çš„ Buffer å¤§å°ä¸º 8KBï¼Œæ•°æ®å†™æ»¡ Buffer åé€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘ç£ç›˜ä¸­åˆ·ä¸€æ¬¡ï¼ˆåœ¨å†…æ ¸ä¸Šä¾ç„¶æ˜¯é€šè¿‡ PageCacheï¼‰ï¼Œè€Œæ™®é€šå†™æ˜¯é€šè¿‡å†…æ ¸ä¸­çš„ PageCacheï¼ˆå¤§å°ä¸º 4KBï¼‰ï¼Œæ‰€ä»¥ Buffer çš„å†…æ ¸æ€ä¸ç”¨æˆ·æ€åˆ‡æ¢æ¬¡æ•°æ¯”æ™®é€šå†™è¦å°‘å¾ˆå¤šï¼ˆç³»ç»Ÿè°ƒç”¨æ¬¡æ•°å°‘ï¼‰ï¼Œæ‰€ä»¥é€Ÿåº¦å¿«</p>\n<h2 id=\"æŒ‚è½½\"><a class=\"anchor\" href=\"#æŒ‚è½½\">#</a> æŒ‚è½½</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># df -h</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Filesystem           Size  Used Avail Use% Mounted on</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>devtmpfs             384M     <span class=\"token number\">0</span>  384M   <span class=\"token number\">0</span>% /dev</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tmpfs                400M     <span class=\"token number\">0</span>  400M   <span class=\"token number\">0</span>% /dev/shm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tmpfs                400M  <span class=\"token number\">6</span>.7M  393M   <span class=\"token number\">2</span>% /run</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tmpfs                400M     <span class=\"token number\">0</span>  400M   <span class=\"token number\">0</span>% /sys/fs/cgroup</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>/dev/mapper/cl-root  <span class=\"token number\">8</span>.0G  <span class=\"token number\">4</span>.4G  <span class=\"token number\">3</span>.7G  <span class=\"token number\">55</span>% /</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>/dev/sda1            976M  133M  777M  <span class=\"token number\">15</span>% /boot</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>tmpfs                 80M   28K   80M   <span class=\"token number\">1</span>% /run/user/42</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>tmpfs                 80M  <span class=\"token number\">3</span>.5M   77M   <span class=\"token number\">5</span>% /run/user/1000</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>/dev/sr0             <span class=\"token number\">6</span>.7G  <span class=\"token number\">6</span>.7G     <span class=\"token number\">0</span> <span class=\"token number\">100</span>% /run/media/fan/CentOS-8-BaseOS-x86_64</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>tmpfs                 80M  <span class=\"token number\">4</span>.0K   80M   <span class=\"token number\">1</span>% /run/user/0</pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åˆ†åŒº /dev/sda1 æŒ‚è½½åˆ°äº†æ ¹ç›®å½•ä¸‹çš„ boot ç›®å½•</p>\n<h2 id=\"æ–‡ä»¶ç±»å‹\"><a class=\"anchor\" href=\"#æ–‡ä»¶ç±»å‹\">#</a> æ–‡ä»¶ç±»å‹</h2>\n<p>-ï¼šæ™®é€šæ–‡ä»¶ï¼ˆå¯æ‰§è¡Œã€å›¾ç‰‡ã€æ–‡æœ¬ï¼‰</p>\n<p>dï¼šç›®å½•</p>\n<p>lï¼šé“¾æ¥</p>\n<p>bï¼šå—è®¾å¤‡ï¼ˆè¯»å–ä¸å—çº¦æŸï¼Œå¦‚ç¡¬ç›˜ï¼‰</p>\n<p>cï¼šå­—ç¬¦è®¾å¤‡ï¼ˆè¯»å–å—çº¦æŸï¼Œå¦‚é”®ç›˜ï¼‰</p>\n<p>sï¼šsocket</p>\n<p>pï¼špipeline</p>\n<h2 id=\"ç¡¬é“¾æ¥-è½¯é“¾æ¥\"><a class=\"anchor\" href=\"#ç¡¬é“¾æ¥-è½¯é“¾æ¥\">#</a> ç¡¬é“¾æ¥ã€è½¯é“¾æ¥</h2>\n<p>statï¼šæŸ¥çœ‹æ–‡ä»¶å±æ€§</p>\n<p>lnï¼šå»ºç«‹è½¯è¿æ¥</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># stat anaconda-ks.cfg </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  File: anaconda-ks.cfg</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Size: <span class=\"token number\">1231</span>      \tBlocks: <span class=\"token number\">8</span>          IO Block: <span class=\"token number\">4096</span>   regular <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Device: fd00h/64768d\tInode: <span class=\"token number\">10769207</span>    Links: <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Access: <span class=\"token punctuation\">(</span>0600/-rw-------<span class=\"token punctuation\">)</span>  Uid: <span class=\"token punctuation\">(</span>    <span class=\"token number\">0</span>/    root<span class=\"token punctuation\">)</span>   Gid: <span class=\"token punctuation\">(</span>    <span class=\"token number\">0</span>/    root<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Context: system_u:object_r:admin_home_t:s0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Access: <span class=\"token number\">2021</span>-01-07 <span class=\"token number\">17</span>:39:45.074653805 +0800</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Modify: <span class=\"token number\">2021</span>-01-07 <span class=\"token number\">17</span>:38:05.698905841 +0800</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Change: <span class=\"token number\">2021</span>-01-07 <span class=\"token number\">17</span>:38:05.698905841 +0800</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> Birth: -</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ln anaconda-ks.cfg my.cfg</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>anaconda-ks.cfg  initial-setup-ks.cfg  jdk-8u271-linux-x64.tar.gz  my.cfg</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># stat my.cfg </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  File: my.cfg</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  Size: <span class=\"token number\">1231</span>      \tBlocks: <span class=\"token number\">8</span>          IO Block: <span class=\"token number\">4096</span>   regular <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Device: fd00h/64768d\tInode: <span class=\"token number\">10769207</span>    Links: <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Access: <span class=\"token punctuation\">(</span>0600/-rw-------<span class=\"token punctuation\">)</span>  Uid: <span class=\"token punctuation\">(</span>    <span class=\"token number\">0</span>/    root<span class=\"token punctuation\">)</span>   Gid: <span class=\"token punctuation\">(</span>    <span class=\"token number\">0</span>/    root<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Context: system_u:object_r:admin_home_t:s0</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Access: <span class=\"token number\">2021</span>-01-07 <span class=\"token number\">17</span>:39:45.074653805 +0800</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Modify: <span class=\"token number\">2021</span>-01-07 <span class=\"token number\">17</span>:38:05.698905841 +0800</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>Change: <span class=\"token number\">2021</span>-04-13 <span class=\"token number\">11</span>:02:58.665252050 +0800</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> Birth: -</pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åŒä¸€æ–‡ä»¶çš„ Inode æ˜¯ç›¸åŒçš„ï¼Œå³ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥æŒ‡å‘åŒä¸€ä»½æ–‡ä»¶ï¼Œæ›´æ”¹è½¯é“¾æ¥æŒ‡å‘çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå®é™…æ–‡ä»¶ä¹Ÿä¼šæ›´æ”¹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>total <span class=\"token number\">139800</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#å¯ä»¥çœ‹åˆ° anaconda-ks.cfgï¼ˆç¡¬è¿æ¥ï¼‰è¢«åº”ç”¨çš„æ•°é‡ä¸º 2</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>-rw-------. <span class=\"token number\">2</span> root root      <span class=\"token number\">1231</span> Jan  <span class=\"token number\">7</span> <span class=\"token number\">17</span>:38 anaconda-ks.cfg</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> root root      <span class=\"token number\">1386</span> Jan  <span class=\"token number\">7</span> <span class=\"token number\">17</span>:40 initial-setup-ks.cfg</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> root root <span class=\"token number\">143142634</span> Jan  <span class=\"token number\">8</span> <span class=\"token number\">15</span>:51 jdk-8u271-linux-x64.tar.gz</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-rw-------. <span class=\"token number\">2</span> root root      <span class=\"token number\">1231</span> Jan  <span class=\"token number\">7</span> <span class=\"token number\">17</span>:38 my.cfg</pre></td></tr></table></figure><p>å¦‚æœè½¯é“¾æ¥åŠ äº†å‚æ•° - sï¼Œé‚£ä¹ˆè¿ä¸ªæ–‡ä»¶å°±æ˜¯ä¸åŒçš„æ–‡ä»¶ï¼Œå³ Inode ä¸åŒ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ln -s anaconda-ks.cfg my.cfg</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># stat my.cfg </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  File: my.cfg -<span class=\"token operator\">></span> anaconda-ks.cfg</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  Size: <span class=\"token number\">15</span>        \tBlocks: <span class=\"token number\">0</span>          IO Block: <span class=\"token number\">4096</span>   symbolic <span class=\"token function\">link</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Device: fd00h/64768d\tInode: <span class=\"token number\">10769867</span>    Links: <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Access: <span class=\"token punctuation\">(</span>0777/lrwxrwxrwx<span class=\"token punctuation\">)</span>  Uid: <span class=\"token punctuation\">(</span>    <span class=\"token number\">0</span>/    root<span class=\"token punctuation\">)</span>   Gid: <span class=\"token punctuation\">(</span>    <span class=\"token number\">0</span>/    root<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Context: unconfined_u:object_r:admin_home_t:s0</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Access: <span class=\"token number\">2021</span>-04-13 <span class=\"token number\">11</span>:11:34.339225319 +0800</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Modify: <span class=\"token number\">2021</span>-04-13 <span class=\"token number\">11</span>:11:27.761225660 +0800</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Change: <span class=\"token number\">2021</span>-04-13 <span class=\"token number\">11</span>:11:27.761225660 +0800</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> Birth: -</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># stat anaconda-ks.cfg </span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  File: anaconda-ks.cfg</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  Size: <span class=\"token number\">1231</span>      \tBlocks: <span class=\"token number\">8</span>          IO Block: <span class=\"token number\">4096</span>   regular <span class=\"token function\">file</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Device: fd00h/64768d\tInode: <span class=\"token number\">10769207</span>    Links: <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Access: <span class=\"token punctuation\">(</span>0600/-rw-------<span class=\"token punctuation\">)</span>  Uid: <span class=\"token punctuation\">(</span>    <span class=\"token number\">0</span>/    root<span class=\"token punctuation\">)</span>   Gid: <span class=\"token punctuation\">(</span>    <span class=\"token number\">0</span>/    root<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>Context: system_u:object_r:admin_home_t:s0</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>Access: <span class=\"token number\">2021</span>-01-07 <span class=\"token number\">17</span>:39:45.074653805 +0800</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>Modify: <span class=\"token number\">2021</span>-01-07 <span class=\"token number\">17</span>:38:05.698905841 +0800</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>Change: <span class=\"token number\">2021</span>-04-13 <span class=\"token number\">11</span>:11:17.109226212 +0800</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> Birth: -</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>total <span class=\"token number\">139796</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>-rw-------. <span class=\"token number\">1</span> root root      <span class=\"token number\">1231</span> Jan  <span class=\"token number\">7</span> <span class=\"token number\">17</span>:38 anaconda-ks.cfg</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> root root      <span class=\"token number\">1386</span> Jan  <span class=\"token number\">7</span> <span class=\"token number\">17</span>:40 initial-setup-ks.cfg</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>-rw-r--r--. <span class=\"token number\">1</span> root root <span class=\"token number\">143142634</span> Jan  <span class=\"token number\">8</span> <span class=\"token number\">15</span>:51 jdk-8u271-linux-x64.tar.gz</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>lrwxrwxrwx. <span class=\"token number\">1</span> root root        <span class=\"token number\">15</span> Apr <span class=\"token number\">13</span> <span class=\"token number\">11</span>:11 my.cfg -<span class=\"token operator\">></span> anaconda-ks.cfg</pre></td></tr></table></figure><h2 id=\"whereis\"><a class=\"anchor\" href=\"#whereis\">#</a> whereis</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># whereis bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>bash: /usr/bin/bash /usr/share/man/man1/bash.1.gz /usr/share/info/bash.info.gz</pre></td></tr></table></figure><h2 id=\"ldd\"><a class=\"anchor\" href=\"#ldd\">#</a> ldd</h2>\n<p>åˆ†æç¨‹åºä¾èµ–çš„åº“</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># ldd bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tlinux-vdso.so.1 <span class=\"token punctuation\">(</span>0x00007ffc2993f000<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tlibtinfo.so.6 <span class=\"token operator\">=</span><span class=\"token operator\">></span> /lib64/libtinfo.so.6 <span class=\"token punctuation\">(</span>0x00007f7901714000<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tlibdl.so.2 <span class=\"token operator\">=</span><span class=\"token operator\">></span> /lib64/libdl.so.2 <span class=\"token punctuation\">(</span>0x00007f7901510000<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tlibc.so.6 <span class=\"token operator\">=</span><span class=\"token operator\">></span> /lib64/libc.so.6 <span class=\"token punctuation\">(</span>0x00007f790114c000<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t/lib64/ld-linux-x86-64.so.2 <span class=\"token punctuation\">(</span>0x00007f7901c5f000<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"è¿›ç¨‹æŸ¥çœ‹\"><a class=\"anchor\" href=\"#è¿›ç¨‹æŸ¥çœ‹\">#</a> è¿›ç¨‹æŸ¥çœ‹</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $$ #ä»£è¡¨å½“å‰ bash è¿›ç¨‹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2254</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># /bin/bash #å¼€å¯ä¸€ä¸ªæ–° bash</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $$</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">2282</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹è¿›ç¨‹çš„çˆ¶å­å…³ç³»</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pstree </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        â”œâ”€rsyslogdâ”€â”€â”€2*<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>rsyslogd<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        â”œâ”€rtkit-daemonâ”€â”€â”€2*<span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span>rtkit-daemon<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        â”œâ”€smartd              </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        â”œâ”€sshdâ”€â”€â”€sshdâ”€â”€â”€sshdâ”€â”€â”€bashâ”€â”€â”€bashâ”€â”€â”€pstree</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ps -ef | grep 2254</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#\t\t   çˆ¶è¿›ç¨‹  å­è¿›ç¨‹</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>root       <span class=\"token number\">2254</span>   <span class=\"token number\">2253</span>  <span class=\"token number\">0</span> <span class=\"token number\">10</span>:30 pts/0    00:00:00 -bash</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>root       <span class=\"token number\">2282</span>   <span class=\"token number\">2254</span>  <span class=\"token number\">0</span> <span class=\"token number\">10</span>:30 pts/0    00:00:00 /bin/bash</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>root       <span class=\"token number\">2337</span>   <span class=\"token number\">2282</span>  <span class=\"token number\">0</span> <span class=\"token number\">10</span>:33 pts/0    00:00:00 <span class=\"token function\">grep</span> --color<span class=\"token operator\">=</span>auto <span class=\"token number\">2254</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#é€€å‡ºå­è¿›ç¨‹ï¼Œå›åˆ°çˆ¶è¿›ç¨‹</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># exit</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $$</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token number\">2254</span></pre></td></tr></table></figure><h2 id=\"lsof\"><a class=\"anchor\" href=\"#lsof\">#</a> lsof</h2>\n<p>æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€äº†å“ªäº›æ–‡ä»¶</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹ bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost bin<span class=\"token punctuation\">]</span><span class=\"token comment\"># lsof -op $$</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>lsof: WARNING: can't stat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> fuse.gvfsd-fuse <span class=\"token function\">file</span> system /run/user/1000/gvfs</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      Output information may be incomplete.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>COMMAND  PID <span class=\"token environment constant\">USER</span>   FD   TYPE             DEVICE SIZE/OFF     NODE NAME</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  cwd    DIR              <span class=\"token number\">253,0</span>    <span class=\"token number\">40960</span>  <span class=\"token number\">8409219</span> /usr/bin</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  rtd    DIR              <span class=\"token number\">253,0</span>      <span class=\"token number\">224</span>      <span class=\"token number\">128</span> /</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  txt    REG              <span class=\"token number\">253,0</span>  <span class=\"token number\">1219272</span>  <span class=\"token number\">8821425</span> /usr/bin/bash</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>  <span class=\"token number\">2586242</span>  <span class=\"token number\">8813609</span> /usr/lib/locale/en_US.utf8/LC_COLLATE</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>    <span class=\"token number\">73264</span> <span class=\"token number\">12818715</span> /usr/lib64/libnss_files-2.28.so</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>  <span class=\"token number\">8406312</span> <span class=\"token number\">13451458</span> /var/lib/sss/mc/passwd</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>    <span class=\"token number\">42088</span> <span class=\"token number\">13900504</span> /usr/lib64/libnss_sss.so.2</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>  <span class=\"token number\">3201344</span> <span class=\"token number\">12818703</span> /usr/lib64/libc-2.28.so</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>    <span class=\"token number\">28784</span> <span class=\"token number\">12818705</span> /usr/lib64/libdl-2.28.so</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>   <span class=\"token number\">208616</span> <span class=\"token number\">12812861</span> /usr/lib64/libtinfo.so.6.1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>   <span class=\"token number\">243520</span> <span class=\"token number\">12818696</span> /usr/lib64/ld-2.28.so</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>   <span class=\"token number\">337024</span>  <span class=\"token number\">8813610</span> /usr/lib/locale/en_US.utf8/LC_CTYPE</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>       <span class=\"token number\">54</span>  <span class=\"token number\">8813613</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_NUMERIC</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>     <span class=\"token number\">3316</span> <span class=\"token number\">12813675</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_TIME</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>      <span class=\"token number\">286</span> <span class=\"token number\">12813673</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_MONETARY</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>       <span class=\"token number\">57</span> <span class=\"token number\">12813685</span> /usr/lib/locale/en_US.utf8/LC_MESSAGES/SYS_LC_MESSAGES</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>       <span class=\"token number\">34</span>  <span class=\"token number\">4414616</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_PAPER</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>       <span class=\"token number\">77</span>  <span class=\"token number\">8813612</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_NAME</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>      <span class=\"token number\">167</span> <span class=\"token number\">12813670</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_ADDRESS</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>       <span class=\"token number\">59</span> <span class=\"token number\">12813674</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_TELEPHONE</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>       <span class=\"token number\">23</span> <span class=\"token number\">12813672</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_MEASUREMENT</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>    <span class=\"token number\">26398</span>  <span class=\"token number\">4431007</span> /usr/lib64/gconv/gconv-modules.cache</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  mem    REG              <span class=\"token number\">253,0</span>      <span class=\"token number\">368</span> <span class=\"token number\">12813671</span> /usr/lib/locale/en_US.utf8/<span class=\"token environment constant\">LC_IDENTIFICATION</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    0u   CHR              <span class=\"token number\">136,1</span>      0t0        <span class=\"token number\">4</span> /dev/pts/1</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    1u   CHR              <span class=\"token number\">136,1</span>      0t0        <span class=\"token number\">4</span> /dev/pts/1</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    2u   CHR              <span class=\"token number\">136,1</span>      0t0        <span class=\"token number\">4</span> /dev/pts/1</pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    3r   REG              <span class=\"token number\">253,0</span>  <span class=\"token number\">8406312</span> <span class=\"token number\">13451458</span> /var/lib/sss/mc/passwd</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root    4u  unix 0x00000000015f1ce9      0t0    <span class=\"token number\">68945</span> <span class=\"token assign-left variable\">type</span><span class=\"token operator\">=</span>STREAM</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token function\">bash</span>    <span class=\"token number\">8376</span> root  255u   CHR              <span class=\"token number\">136,1</span>      0t0        <span class=\"token number\">4</span> /dev/pts/1</pre></td></tr></table></figure><h2 id=\"å˜é‡\"><a class=\"anchor\" href=\"#å˜é‡\">#</a> å˜é‡</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#å®šä¹‰å˜é‡ï¼Œä¸èƒ½æœ‰ç©ºæ ¼</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># x=100</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#å–åˆ°å˜é‡çš„å€¼</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $x</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#å¼€å¯ä¸€ä¸ªå­ bash</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># /bin/bash</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#å­ bash æ— æ³•å–åˆ°çˆ¶ bash ä¸­çš„å˜é‡</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $x</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#é€€å‡ºå­ bash</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># exit</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#å°†å˜é‡ x å¯¼å‡ºï¼Œä½¿å¾—ä»»ä½•å­è¿›éƒ½å¯ä»¥å–åˆ°è¯¥å˜é‡</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># export x</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#å¼€å¯å­ bash</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># /bin/bash</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#æ­¤æ—¶ï¼Œå­ bash å¯ä»¥å–åˆ° x</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo $x</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">100</span></pre></td></tr></table></figure><h2 id=\"ä»£ç å—\"><a class=\"anchor\" href=\"#ä»£ç å—\">#</a> ä»£ç å—</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#æ³¨æ„ï¼šèŠ±æ‹¬å·é‡Œå‰åéƒ½è¦åŠ ç©ºæ ¼</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># &#123; echo \"sfaf\"; echo \"sfsf\"; &#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>sfaf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>sfsf</pre></td></tr></table></figure><h2 id=\"sysctl\"><a class=\"anchor\" href=\"#sysctl\">#</a> sysctl</h2>\n<p>å†…æ ¸ä¸­çš„æ§åˆ¶é¡¹</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#åˆ—å‡ºå†…æ ¸ä¸­çš„æ‰€æœ‰æ§åˆ¶é¡¹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sysctl -a</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># æŸ¥è¯¢æŸä¸ªå…·ä½“çš„é…ç½®é¡¹</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sysctl -a | grep dirty</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>vm.dirty_background_bytes <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>vm.dirty_background_ratio <span class=\"token operator\">=</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>vm.dirty_bytes <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>vm.dirty_expire_centisecs <span class=\"token operator\">=</span> <span class=\"token number\">3000</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>vm.dirty_ratio <span class=\"token operator\">=</span> <span class=\"token number\">30</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>vm.dirty_writeback_centisecs <span class=\"token operator\">=</span> <span class=\"token number\">500</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>vm.dirtytime_expire_seconds <span class=\"token operator\">=</span> <span class=\"token number\">43200</span></pre></td></tr></table></figure><h2 id=\"ç½‘å¡è®¾ç½®å­ip\"><a class=\"anchor\" href=\"#ç½‘å¡è®¾ç½®å­ip\">#</a> ç½‘å¡è®¾ç½®å­ IP</h2>\n<pre><code>ifconfig eth0:11 192.168.160.11/24\n</code></pre>\n<h2 id=\"æ–‡ä»¶ç³»ç»Ÿçš„io\"><a class=\"anchor\" href=\"#æ–‡ä»¶ç³»ç»Ÿçš„io\">#</a> æ–‡ä»¶ç³»ç»Ÿçš„ IO</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>bjmashibing<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">.</span>io</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>junit<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Test</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BufferedOutputStream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">File</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RandomAccessFile</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MappedByteBuffer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>channels<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileChannel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OSFileIO</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> data <span class=\"token operator\">=</span> <span class=\"token string\">\"123456789\\n\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> path <span class=\"token operator\">=</span>  <span class=\"token string\">\"/root/testfileio/out.txt\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span> args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token function\">testBasicFileIO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token string\">\"1\"</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token function\">testBufferedFileIO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token string\">\"2\"</span> <span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token function\">testRandomAccessFileWrite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token keyword\">case</span> <span class=\"token string\">\"3\"</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token function\">whatByteBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">default</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token comment\">// æœ€åŸºæœ¬çš„ file å†™</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span> <span class=\"token function\">testBasicFileIO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token class-name\">File</span> file <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token class-name\">FileOutputStream</span> out <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            out<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token comment\">// æµ‹è¯• buffer æ–‡ä»¶ IO</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token comment\">//  jvm  8kB   syscall  write(8KBbyte[])</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testBufferedFileIO</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token class-name\">File</span> file <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token class-name\">BufferedOutputStream</span> out <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            out<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token comment\">// æµ‹è¯•æ–‡ä»¶ NIO</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t\t<span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testRandomAccessFileWrite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span>  <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token class-name\">RandomAccessFile</span> raf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RandomAccessFile</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token string\">\"rw\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        raf<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello mashibing\\n\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        raf<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello seanzhou\\n\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"write------------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        raf<span class=\"token punctuation\">.</span><span class=\"token function\">seek</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        raf<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ooxx\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"seek---------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>        <span class=\"token class-name\">FileChannel</span> rafchannel <span class=\"token operator\">=</span> raf<span class=\"token punctuation\">.</span><span class=\"token function\">getChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token comment\">//mapped æ˜ å°„ï¼šæ˜¯ mmap () è°ƒç”¨çš„ä¸€ä¸ªè¿›ç¨‹å’Œå†…æ ¸å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œä¸”è¿™ä¸ªå†…å­˜åŒºåŸŸæ˜¯ pagecache åˆ°ç£ç›˜ï¼ˆæ–‡ä»¶ï¼‰çš„æ˜ å°„</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        <span class=\"token class-name\">MappedByteBuffer</span> map <span class=\"token operator\">=</span> rafchannel<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FileChannel<span class=\"token punctuation\">.</span>MapMode</span><span class=\"token punctuation\">.</span>READ_WRITE<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4096</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@@@\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//put () ä¸æ˜¯ç³»ç»Ÿè°ƒç”¨  ä½†æ˜¯æ•°æ®ä¼šåˆ°è¾¾ å†…æ ¸çš„ pagecache</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>            <span class=\"token comment\">// æ›¾ç»æˆ‘ä»¬æ˜¯éœ€è¦ out.write ()  è¿™æ ·çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰èƒ½è®©ç¨‹åºçš„ data è¿›å…¥å†…æ ¸çš„ pagecache</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>            <span class=\"token comment\">// æ›¾ç»å¿…é¡»æœ‰ç”¨æˆ·æ€å†…æ ¸æ€åˆ‡æ¢</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>            <span class=\"token comment\">//mmap çš„å†…å­˜æ˜ å°„ï¼Œä¾ç„¶æ˜¯å†…æ ¸çš„ pagecache ä½“ç³»æ‰€çº¦æŸçš„ï¼ï¼ï¼</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>            <span class=\"token comment\">// æ¢è¨€ä¹‹ï¼Œä¸¢æ•°æ®</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>            <span class=\"token comment\">// ä½ å¯ä»¥å» github ä¸Šæ‰¾ä¸€äº› å…¶ä»– C ç¨‹åºå‘˜å†™çš„ jni æ‰©å±•åº“ï¼Œä½¿ç”¨ linux å†…æ ¸çš„ Direct IO</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>            <span class=\"token comment\">// ç›´æ¥ IO æ˜¯å¿½ç•¥ linux çš„ pagecache</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>            <span class=\"token comment\">// æ˜¯æŠŠ pagecache  äº¤ç»™äº†ç¨‹åºè‡ªå·±å¼€è¾Ÿä¸€ä¸ªå­—èŠ‚æ•°ç»„å½“ä½œ pagecacheï¼ŒåŠ¨ç”¨ä»£ç é€»è¾‘æ¥ç»´æŠ¤ä¸€è‡´æ€§ /dirtyã€‚ã€‚ã€‚ä¸€ç³»åˆ—å¤æ‚é—®é¢˜</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"map--put--------\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token comment\">//        map.force(); //  flush</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre></pre></td></tr><tr><td data-num=\"102\"></td><td><pre></pre></td></tr><tr><td data-num=\"103\"></td><td><pre></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>        raf<span class=\"token punctuation\">.</span><span class=\"token function\">seek</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>        <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocate</span><span class=\"token punctuation\">(</span><span class=\"token number\">8192</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token comment\">//        ByteBuffer buffer = ByteBuffer.allocateDirect(1024);</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>        <span class=\"token keyword\">int</span> read <span class=\"token operator\">=</span> rafchannel<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//buffer.put()</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span>buffer<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre></pre></td></tr><tr><td data-num=\"119\"></td><td><pre></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre></pre></td></tr><tr><td data-num=\"122\"></td><td><pre></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>    <span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">whatByteBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>\t\t\t<span class=\"token comment\">//jvm å †å†…åˆ†é…</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre><span class=\"token comment\">//        ByteBuffer buffer = ByteBuffer.allocate(1024);</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>\t\t<span class=\"token comment\">//jvm å †å¤–åˆ†é…ï¼ˆjava è¿›ç¨‹çš„å †å†…åˆ†é…ï¼‰</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>        <span class=\"token class-name\">ByteBuffer</span> buffer <span class=\"token operator\">=</span> <span class=\"token class-name\">ByteBuffer</span><span class=\"token punctuation\">.</span><span class=\"token function\">allocateDirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre></pre></td></tr><tr><td data-num=\"131\"></td><td><pre></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"postition: \"</span> <span class=\"token operator\">+</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"limit: \"</span> <span class=\"token operator\">+</span>  buffer<span class=\"token punctuation\">.</span><span class=\"token function\">limit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"capacity: \"</span> <span class=\"token operator\">+</span> buffer<span class=\"token punctuation\">.</span><span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mark: \"</span> <span class=\"token operator\">+</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"123\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------put:123......\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mark: \"</span> <span class=\"token operator\">+</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">// è¯»å†™äº¤æ›¿</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------flip......\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mark: \"</span> <span class=\"token operator\">+</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------get......\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mark: \"</span> <span class=\"token operator\">+</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">compact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------compact......\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mark: \"</span> <span class=\"token operator\">+</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>        buffer<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"-------------clear......\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mark: \"</span> <span class=\"token operator\">+</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre></pre></td></tr><tr><td data-num=\"164\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucHJvY2Vzc29uLmNvbS92aWV3L2xpbmsvNjA4OTAxMDRlMGIzNGQ0N2E3MGUzYmUw\">io åˆ†æåœ¨çº¿æŸ¥çœ‹</span></p>\n",
            "tags": [
                "Java",
                "Java",
                "IO",
                "Linux"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89/",
            "url": "https://baiyezi.vip/java/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E8%AF%9D/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89/",
            "title": "å¾®æœåŠ¡ä¸­çš„ä¼šè¯ç®¡ç†ï¼ˆä¸€ï¼‰",
            "date_published": "2021-08-01T06:02:20.000Z",
            "content_html": "<h2 id=\"sessioncookiestoken\"><a class=\"anchor\" href=\"#sessioncookiestoken\">#</a> Session/Cookies/Token</h2>\n<p>æµè§ˆå™¨è¯·æ±‚è®¿é—®æœåŠ¡ç«¯æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šä¸ºæµè§ˆå™¨çš„è¯·æ±‚ç”Ÿæˆä¸€ä¸ª session idï¼Œç”¨æ¥æ ‡è¯†æµè§ˆå™¨ä¸æœåŠ¡ç«¯ä¹‹é—´çš„ä¼šè¯ï¼Œç”Ÿæˆçš„ session id åŒæ—¶ä¼šå­˜æ”¾åœ¨æµè§ˆå™¨ä¸Šä¸€ä»½ï¼Œç§°ä¹‹ä¸º cookiesã€‚å¦‚æœä¸éœ€è¦æœåŠ¡ç«¯ç”Ÿæˆçš„ session idï¼Œé‚£ä¹ˆå¯ä»¥æ‰‹åŠ¨ç”Ÿæˆä¸€ä¸ªå”¯ä¸€æ ‡è¯†æ¥ä¿è¯ä¼šè¯çš„å”¯ä¸€æ€§ï¼Œè¿™ä¸ªå”¯ä¸€æ ‡è¯†å°±æ˜¯ Tokenã€‚</p>\n<h2 id=\"è·¨åŸŸçš„è§£å†³\"><a class=\"anchor\" href=\"#è·¨åŸŸçš„è§£å†³\">#</a> è·¨åŸŸçš„è§£å†³</h2>\n<p>æµè§ˆå™¨ä¼šå¯¹ä¸åŒåŸŸåæˆ–ä¸åŒç«¯å£çš„ URL ä¹‹é—´çš„è¯·æ±‚å½¢æˆä¸€ä¸ªå®‰å…¨ç­–ç•¥ï¼Œå³åŒæºç­–ç•¥ï¼Œå³ä¸€ä¸ªä¼šè¯å¿…é¡»å‘ç”Ÿåœ¨ç›¸åŒåè®®ã€ç›¸åŒåŸŸåï¼ˆä¸€çº§åŸŸåï¼‰ã€ç›¸åŒç«¯å£çš„ URL è¯·æ±‚ä¸‹æ‰èƒ½é¡ºåˆ©å®Œæˆè¯·æ±‚ï¼Œå¦åˆ™ä¸åŒçš„ URL ä¹‹é—´æ— æ³•å®Œæˆä»»ä½•ä¼šè¯ä¸­çš„è¯·æ±‚ï¼ˆå¦‚ js çš„å¼‚æ­¥è¯·æ±‚ç­‰ï¼‰ã€‚ä½†æ˜¯ï¼Œå¯¹äºç°åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼Œå‰ç«¯ä¸åç«¯ç”¨äºå‘é€è¯·æ±‚çš„ URL å¿…å®šæ˜¯ä¸åŒæºçš„ï¼ˆè·¨åŸŸåçš„ã€è·¨ç«¯å£çš„ï¼‰ï¼Œæ‰€ä»¥éœ€è¦çªç ´æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ä½¿å¾—ä¸åŒæºçš„ URL ä¹‹é—´çš„è¯·æ±‚èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªä¼šè¯ä¸‹è¿›è¡Œã€‚å¸¸ç”¨çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆæ˜¯ JSONPã€CORSã€‚</p>\n<ul>\n<li>JSONPï¼šæ­¤æ–¹æ³•åªèƒ½å‘èµ· GET è¯·æ±‚ï¼Œé€šè¿‡ jsonp å‘é€çš„è¯·æ±‚ï¼Œä¼šéšå¸¦ cookie ä¸€èµ·å‘é€ã€‚</li>\n<li>CORSï¼šåœ¨æµè§ˆå™¨ä¸­æŒ‡å®š Origin æ¥æºï¼Œå¦‚æœåœ¨æœåŠ¡å™¨æ¥å—èŒƒå›´ï¼Œè¯·æ±‚åˆ™æˆåŠŸã€‚CORS ä¸ JSONP çš„ä½¿ç”¨ç›®çš„ç›¸åŒï¼Œä½†æ˜¯æ¯” JSONP æ›´å¼ºå¤§ã€‚</li>\n</ul>\n<p>JSONP åªæ”¯æŒ <code>GET</code>  è¯·æ±‚ï¼ŒCORS æ”¯æŒæ‰€æœ‰ç±»å‹çš„ HTTP è¯·æ±‚ã€‚JSONP çš„ä¼˜åŠ¿åœ¨äºæ”¯æŒè€å¼æµè§ˆå™¨ï¼Œä»¥åŠå¯ä»¥å‘ä¸æ”¯æŒ CORS çš„ç½‘ç«™è¯·æ±‚æ•°æ®ã€‚</p>\n<h2 id=\"xssä¸csrf\"><a class=\"anchor\" href=\"#xssä¸csrf\">#</a> XSS ä¸ CSRF</h2>\n<h3 id=\"xss\"><a class=\"anchor\" href=\"#xss\">#</a> XSS</h3>\n<p>XSS æ”»å‡»æ˜¯æŒ‡åœ¨ html ä¸­åµŒå…¥èƒ½å‘èµ·å¤–ç«™è¯·æ±‚çš„è„šæœ¬ã€‚ä¸»è¦åº”ç”¨äºæµé‡æ”»å‡»ã€‚è§£å†³åŠæ³•ï¼šå¯ä»¥å°†å†…å®¹è¿›è¡Œè½¬ä¹‰åæ˜¾ç¤ºã€‚</p>\n<h3 id=\"csrf\"><a class=\"anchor\" href=\"#csrf\">#</a> CSRF</h3>\n<p>ä¼ªè£…è¯·æ±‚åˆ°å¦ä¸€ä¸ªç«™ç‚¹ï¼Œä¾‹å¦‚ï¼šé€šè¿‡ img æ ‡ç­¾çš„ src è¯·æ±‚åˆ°å¦ä¸€ä¸ªç«™ç‚¹ã€‚è¿™ç§æ”»å‡»éƒ½æ˜¯ get è¯·æ±‚ï¼Œæ‰€ä»¥å¯ä»¥å°†æ‰€æœ‰è¯·æ±‚æ›¿æ¢ä¸º post è¯·æ±‚æ¥é¿å… CSRF æ”»å‡»ã€‚</p>\n<p>è§£å†³æ–¹æ¡ˆï¼šæ•æ„Ÿæ“ä½œåŠ éªŒè¯ç ï¼›æ¯æ¬¡è¯·æ±‚å¸¦ä¸€ä¸ª tokenã€‚</p>\n<h2 id=\"spring-security\"><a class=\"anchor\" href=\"#spring-security\">#</a> Spring Security</h2>\n<p>åœ¨ Spring Security ä¸­å¯ä»¥é€šè¿‡ç®€å•çš„é…ç½®æ¥é˜²å¾¡ CSRF æ”»å‡»</p>\n<h3 id=\"è‡ªå®šä¹‰ç™»å½•é¡µé¢\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰ç™»å½•é¡µé¢\">#</a> è‡ªå®šä¹‰ç™»å½•é¡µé¢</h3>\n<p>æ–°å»ºä¸€ä¸ª SpringBoot é¡¹ç›®ï¼ŒåŒæ—¶å‹¾é€‰ Spring Securityã€Spring Webã€Thymeleaf</p>\n<p>æ ¸å¿ƒé…ç½®ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpSecurity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EnableWebSecurity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebSecurityConfigurerAdapter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthenticationException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthenticationFailureHandler</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>csrf<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpSessionCsrfTokenRepository</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>* @Description: TODO    </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>* @Title:  MyConfig.java </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>* @Package com.fan </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>* @author  baifan</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>* @date 2021 å¹´ 1 æœˆ 26 æ—¥ ä¸‹åˆ 1:34:37 </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>* @version V1.0   </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token annotation punctuation\">@EnableWebSecurity</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\thttp</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å“ªäº›è¯·æ±‚éœ€è¦ç™»å½•è®¤è¯ï¼ŒanyRequest () ä»£è¡¨æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦ç™»å½•è®¤è¯</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•çš„ç”¨æˆ·å¯ä»¥è®¿é—®è¯¥é¡µé¢ï¼Œä¸éœ€è¦è®¤è¯ï¼Œä¸ºæ­¤éœ€è¦é…ç½® permitAll ()</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t\t<span class=\"token comment\">//loginProcessingUrl () ä»£è¡¨ç™»å½•çš„ç”¨æˆ·åå¯†ç æ ¡éªŒçš„åœ°å€</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureForwardUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html?error\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥çš„å¤„ç†</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationFailureHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t\t\t\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t\t\t\t\texception<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å¼€å¯ csrf å°†é»˜è®¤æ‹¦æˆªæ‰€æœ‰ post è¯·æ±‚ï¼Œå¦‚æœé‡å†™äº† configure () æ–¹æ³•ï¼Œé‚£ä¹ˆå¿…é¡»æ‰‹åŠ¨å¼€å¯ csrf æˆ–è€…æ‰‹åŠ¨å…³é—­ csrfï¼ˆä½¿ç”¨ csrf ().disable (), å…³é—­åæ— æ³•è·å–_csrf.token ç­‰å€¼ï¼‰ï¼Œå¦åˆ™ç™»å½•ä¸æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">csrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpSessionCsrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>login.html</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Insert title here<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/login<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>ç”¨æˆ·å <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>å¯†ç  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;_csrf.parameterName&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;_csrf.token&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ç™»å½•<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Controller</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GetMapping</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>* @Description: TODO    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>* @Title:  MainController.java </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>* @Package com.fan </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>* @author  baifan</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>* @date 2021 å¹´ 1 æœˆ 26 æ—¥ ä¸Šåˆ 9:53:42 </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>* @version V1.0   </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"login\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>application.properties</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">spring.security.user.name</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">spring.security.user.password</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">test</span></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®åè¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸå–åˆ°äº† tokenï¼Œç”±äº Spring Security é…ç½®çš„ CSRF åªèƒ½é˜²å¾¡ post è¯·æ±‚çš„ CSRF æ”»å‡»ï¼Œæ‰€ä»¥å¯¹äº get è¯·æ±‚ï¼Œå¯ä»¥å°†è·å¾—çš„ token åŠ åœ¨æ¯ä¸ª get è¯·æ±‚çš„åé¢ï¼Œä¸”æ¯æ¬¡å‘èµ·è¯·æ±‚å°±ä¼šè·å¾—ä¸€ä¸ªä¸åŒçš„ tokenï¼Œè¿™æ ·ä¹Ÿèƒ½èµ·åˆ°é˜²å¾¡ä½œç”¨ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210127105638004.png\" alt=\"image-20210127105638004\" /></p>\n<h3 id=\"é»˜è®¤ç™»å½•ç•Œé¢\"><a class=\"anchor\" href=\"#é»˜è®¤ç™»å½•ç•Œé¢\">#</a> é»˜è®¤ç™»å½•ç•Œé¢</h3>\n<p>Spring Security æ¡†æ¶æä¾›äº†é»˜è®¤ç™»å½•ç•Œé¢</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataSource</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthenticationManagerBuilder</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpSecurity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebSecurity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EnableWebSecurity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebSecurityConfigurerAdapter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>crypto<span class=\"token punctuation\">.</span>bcrypt<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>csrf<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpSessionCsrfTokenRepository</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyUserService</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> * @Description: TODO</pre></td></tr><tr><td data-num=\"20\"></td><td><pre> * @Title: MyConfig.java</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> * @Package com.fan</pre></td></tr><tr><td data-num=\"22\"></td><td><pre> * @author baifan</pre></td></tr><tr><td data-num=\"23\"></td><td><pre> * @date 2021 å¹´ 1 æœˆ 26 æ—¥ ä¸‹åˆ 1:34:37</pre></td></tr><tr><td data-num=\"24\"></td><td><pre> * @version V1.0</pre></td></tr><tr><td data-num=\"25\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token annotation punctuation\">@EnableWebSecurity</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token class-name\">DataSource</span> datasource<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token class-name\">MyUserService</span> myUserService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token comment\">// ç™»å½•è®¤è¯ç›¸å…³é…ç½®é¡¹</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\thttp</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å“ªäº›è¯·æ±‚éœ€è¦ç™»å½•è®¤è¯ï¼ŒanyRequest () ä»£è¡¨æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦ç™»å½•è®¤è¯</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// è®°ä½æˆ‘</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">rememberMe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">csrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpSessionCsrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210201152942500.png\" alt=\"image-20210201152942500\" /></p>\n<p>å¦‚æœå‹¾é€‰äº† â€œè®°ä½æˆ‘â€ çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…å°±ä¸éœ€è¦é‡æ–°ç™»å½•ï¼Œå…¶æ¬¡ï¼Œremember me çš„å€¼æ˜¯ä¸€ä¸² base64ï¼Œè§£å¼€åå¾—åˆ°ï¼šç”¨æˆ·åï¼šè¿‡æœŸæ—¶é—´ï¼šåŠ å¯†å€¼ï¼Œè¿™ä¸ªåŠ å¯†å€¼å°±æ˜¯ signï¼ˆæ‘˜è¦ï¼‰ï¼Œç”±ç”¨æˆ·å + è¿‡æœŸæ—¶é—´ + secretï¼ˆsecret å­˜åœ¨æœåŠ¡ç«¯ï¼‰ååŠ å¯†å¾—åˆ°ã€‚è¯¥åŠŸèƒ½çš„å¥½å¤„å°±æ˜¯å¯ä»¥é€šè¿‡ä»»ä½•ä¿¡æ¯åŠ  secret å¾—å‡º signï¼Œä¸éœ€è¦ä»»ä½•æ•°æ®æºçš„æ ¡éªŒï¼Œå¦‚ JWT çš„å®ç°å°±æ˜¯è¯¥åŸç†ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210201153924996.png\" alt=\"image-20210201153924996\" /></p>\n<h3 id=\"ç”¨æˆ·åå¯†ç \"><a class=\"anchor\" href=\"#ç”¨æˆ·åå¯†ç \">#</a> ç”¨æˆ·åå¯†ç </h3>\n<p>ç™»å½•é¡µé¢çš„ç”¨æˆ·åä»¥åŠå¯†ç å­—æ®µé»˜è®¤ä¸º username å’Œ passwordï¼Œå¯ä»¥åœ¨ FormLoginConfigurer ç±»ä¸­æ‰¾åˆ°ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t * Creates a new instance</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t * @see HttpSecurity#formLogin()</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">FormLoginConfigurer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">UsernamePasswordAuthenticationFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token function\">usernameParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token function\">passwordParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è‡ªå®šä¹‰æ—¶å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// é…ç½®ç™»å½•é¡µé¢çš„ç”¨æˆ·æ°‘ä»¥åŠå¯†ç å­—æ®µï¼Œé»˜è®¤ä¸º usernameã€password</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">usernameParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"aa\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">passwordParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bb\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><blockquote>\n<p>![note]</p>\n<p>æˆ‘å¶ç„¶å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå†™æˆä¸¤ä¸ª usernameParameterï¼Œåƒè¿™æ · .usernameParameter (&quot;aa&quot;).usernameParameter (&quot;bb&quot;)ï¼Œé‚£ä¹ˆè¾“å…¥ä»»ä½•ç”¨æˆ·åéƒ½èƒ½æˆåŠŸè·³è½¬ï¼Ÿï¼Ÿï¼Ÿ</p>\n</blockquote>\n<p>ç›¸åº”çš„ç™»å½•é¡µé¢çš„è¡¨å•çš„å­—æ®µä¹Ÿéœ€è¦ä¿®æ”¹</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Insert title here<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/login<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>ç”¨æˆ·å <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>aa<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>å¯†ç  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>bb<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;_csrf.parameterName&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;_csrf.token&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ç™»å½•<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"ç™»å½•æˆåŠŸè·³è½¬æŒ‡å®šé¡µé¢\"><a class=\"anchor\" href=\"#ç™»å½•æˆåŠŸè·³è½¬æŒ‡å®šé¡µé¢\">#</a> ç™»å½•æˆåŠŸè·³è½¬æŒ‡å®šé¡µé¢</h3>\n<p>åªéœ€åœ¨æ ¸å¿ƒç±»æ”¹ä¸€ä¸ªç®€å•çš„é…ç½®å³å¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æŒ‡å®šé¡µé¢</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/ok\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>ok.html</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Insert title here<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>ç™»å½•æˆåŠŸ</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/ok\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"ok\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®æµ‹è¯•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210127134258335.png\" alt=\"image-20210127134258335\" /></p>\n<p>ç™»å½•å°±ä¼šè·³è½¬åˆ°è¯¥é¡µé¢ï¼Œä¸ç™»é™†çš„è¯æ— æ³•è®¿é—®è¯¥é¡µé¢</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210127134236923.png\" alt=\"image-20210127134236923\" /></p>\n<h3 id=\"ç™»å½•æˆåŠŸå¤„ç†\"><a class=\"anchor\" href=\"#ç™»å½•æˆåŠŸå¤„ç†\">#</a> ç™»å½•æˆåŠŸå¤„ç†</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// è®°ä½æˆ‘</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//\t\t\t\t.and().rememberMe().and()</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// é…ç½®ç™»å½•é¡µé¢çš„ç”¨æˆ·æ°‘ä»¥åŠå¯†ç å­—æ®µï¼Œé»˜è®¤ä¸º usernameã€password</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">usernameParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">passwordParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸåè¢«è°ƒèµ·ã€‚ç”¨æ¥é”å®šèµ„æºï¼Œåˆå§‹åŒ–èµ„æºç­‰</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">successHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t\t\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t\t\t\t<span class=\"token class-name\">Object</span> principal <span class=\"token operator\">=</span> authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>principal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                        <span class=\"token comment\">// æ ¹æ®æƒé™ä¸åŒï¼Œè·³è½¬åˆ°ä¸åŒé¡µé¢</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t\t\trequest<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t\t\trequest<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestDispatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æ ¹ç›®å½•</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æŒ‡å®šé¡µé¢</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/ok\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"é€€å‡ºç™»å½•å¤„ç†\"><a class=\"anchor\" href=\"#é€€å‡ºç™»å½•å¤„ç†\">#</a> é€€å‡ºç™»å½•å¤„ç†</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// é€€å‡ºå¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">addLogoutHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LogoutHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t\t\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\":é€€å‡ºç™»å½•\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"ç™»å½•å¤±è´¥å¤„ç†\"><a class=\"anchor\" href=\"#ç™»å½•å¤±è´¥å¤„ç†\">#</a> ç™»å½•å¤±è´¥å¤„ç†</h3>\n<p>Spring Security æœ‰ä¸€ä¸ªç™»å½•å¤±è´¥çš„å¤„ç†å™¨æ¥å£ AuthenticationFailureHandlerï¼Œè¯¥æ¥å£æœ‰å¾ˆå¤šç™»å½•å¤±è´¥çš„å¼‚å¸¸å¤„ç†ç±»ï¼Œæ¯”å¦‚è´¦å·å¯†ç é”™è¯¯ï¼Œè´¦å·è¿‡æœŸç­‰å¤„ç†ç±»</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210127140615559.png\" alt=\"image-20210127140615559\" /></p>\n<p>å¯ä»¥é€šè¿‡å¯¹ AuthenticationFailureHandler æ¥å£çš„å›è°ƒæ‹¿åˆ°ç™»å½•å¤±è´¥å¼‚å¸¸å±äºä»¥ä¸Šå“ªä¸€ä¸ªå…·ä½“ç±»æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä»è€Œç»™ç”¨æˆ·æç¤ºä¸åŒçš„ä¿¡æ¯æˆ–è·³è½¬åˆ°ç›¸åº”çš„é¡µé¢</p>\n<p>æ ¸å¿ƒé…ç½®ç±»ä¸­</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ç™»å½•å¤±è´¥è·³è½¬çš„é¡µé¢</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureForwardUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html?error\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥çš„å¤„ç†</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationFailureHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t\t\t\texception<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// åˆ¤æ–­å¼‚å¸¸ä¿¡æ¯è·³è½¬ä¸åŒé¡µé¢</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exception <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BadCredentialsException</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                            \t\t\t    <span class=\"token comment\">// è·³è½¬åˆ°å½“å‰è¯·æ±‚çš„ç•Œé¢ï¼Œå³ç™»å½•ç•Œé¢</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\t\t\t\trequest<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestDispatcher</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// è®°å½•ç™»å½•å¤±è´¥ï¼Œé”å®šå°±ç™»å½•</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®ï¼Œè¾“å…¥é”™è¯¯è´¦å·æˆ–å¯†ç </p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210127144559931.png\" alt=\"image-20210127144559931\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210127144623024.png\" alt=\"image-20210127144623024\" /></p>\n<h3 id=\"æ³¨é”€ç™»å½•\"><a class=\"anchor\" href=\"#æ³¨é”€ç™»å½•\">#</a> æ³¨é”€ç™»å½•</h3>\n<p>é»˜è®¤æ–¹å¼ get /logoutã€‚å¼€å¯ CSRF ä¹‹å éœ€è¦ä½¿ç”¨ post è¯·æ±‚é€€å‡ºæ¥å£</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token comment\">// è‡ªå®šä¹‰æ³¨é”€ URL</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>         <span class=\"token punctuation\">.</span><span class=\"token function\">logoutUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/out\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/logout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>GET logout<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/logout<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;_csrf.parameterName&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;_csrf.token&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST Logout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"åŸºäºå†…å­˜çš„ç”¨æˆ·åå¯†ç \"><a class=\"anchor\" href=\"#åŸºäºå†…å­˜çš„ç”¨æˆ·åå¯†ç \">#</a> åŸºäºå†…å­˜çš„ç”¨æˆ·åå¯†ç </h3>\n<p><strong>æ–¹å¼ä¸€ï¼š</strong></p>\n<p>éœ€è¦é‡å†™ configure (AuthenticationManagerBuilder auth) æ–¹æ³•ï¼Œæ­¤æ—¶ applicaiton.properties é…ç½®ä¸­çš„ç”¨æˆ·åå¯†ç å°†å¤±æ•ˆ</p>\n<p>æ ¸å¿ƒé…ç½®ç±»ä¸­</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æƒé™ç›¸å…³é…ç½®é¡¹ï¼Œä¸€æ—¦é‡å†™è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆé…ç½®æ–‡ä»¶ä¸­çš„ç”¨æˆ·åå¯†ç å°†å¤±æ•ˆ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthenticationManagerBuilder</span> auth<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\tauth<span class=\"token punctuation\">.</span><span class=\"token function\">inMemoryAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç”¨æˆ·å å¯†ç  è§’è‰²ï¼Œæ­¤æ—¶éœ€è¦åŠ å¯†å¯†ç ï¼Œå¦åˆ™æŠ¥é”™</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">withUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"123\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token function\">bcryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"123\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å¯ä»¥è®¾ç½®å¤šä¸ªç”¨æˆ·</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">withUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"321\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"321\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">BCryptPasswordEncoder</span> <span class=\"token function\">bcryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ PasswordEncoder æ¥å£ä¸­æä¾›äº†å¾ˆå¤šåŠ å¯†æ–¹å¼ï¼Œè¿™äº›åŠ å¯†æ–¹å¼å±äºæ‘˜è¦ç®—æ³•ï¼ŒåŠ å¯†é€Ÿåº¦å¿«ï¼ŒåŠ å¯†åæ— æ³•è§£å¯†ï¼Œç›¸åŒçš„å­—ç¬¦åŠ å¯†ç»“æœä¸€æ ·ï¼ŒMD5 ä¹Ÿæ˜¯é€šè¿‡æ‘˜è¦ç®—æ³•å¾—å‡ºç»“æœã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210127155235477.png\" alt=\"image-20210127155235477\" /></p>\n<p><strong>æ–¹å¼äºŒï¼š</strong></p>\n<p>ç›´æ¥é…ç½®ä¸€ä¸ª UserDetailsService çš„æ–¹æ³•å³å¯</p>\n<p>æ ¸å¿ƒç±»ä¸­</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// é…ç½®åŸºäºå†…å­˜çš„ç”¨æˆ·åå¯†ç </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token class-name\">UserDetailsService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token class-name\">InMemoryUserDetailsManager</span> manager <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InMemoryUserDetailsManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">singletonList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\tmanager<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\tmanager<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">withUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> manager<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®æµ‹è¯•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210128131954209.png\" alt=\"image-20210128131954209\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210128132338233.png\" alt=\"image-20210128132338233\" /></p>\n<p>UserDetailsManager æ¥å£æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼šInMemoryUserDetailsManager å’Œ JdbcUserDetailsManagerï¼Œè¿™ä¸¤ä¸ªç±»åˆ†åˆ«æ˜¯åŸºäºå†…å­˜å’ŒåŸºäºæ•°æ®åº“æ¥å®ç°ç”¨æˆ·åå¯†ç çš„å­˜å‚¨ã€‚UserDetailsManager æ¥å£ç»§æ‰¿äº† UserDetailsService æ¥å£ï¼ŒUserDetailsService æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³• loadUserByUsername (String username)ï¼Œæ­£æ˜¯é€šè¿‡è¯¥æ–¹æ³•æ ¹æ®ç”¨æˆ·ä¼ è¿›æ¥çš„ç”¨æˆ·åå»æ•°æ®åº“åŒ¹é…ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œå…¶æ¬¡ï¼Œè¯¥æ–¹æ³•è¿”å›çš„ç±»å‹æ˜¯ UserDetailsï¼Œè¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰ä¸€ä¸ªå…·ä½“çš„å®ç°ç±» Userã€‚è€Œåœ¨æ—¥å¸¸å¼€å‘ä¸­çš„åšæ³•æ˜¯ï¼šæœ‰å…³ç”¨æˆ·çš„å®ä½“ç±»å»å®ç° UserDetails æ¥å£å¹¶é‡å†™å…¶ä¸­çš„æ–¹æ³•ï¼Œæœ‰å…³ç”¨æˆ·çš„ service ç±»å»å®ç° UserDetailsService æ¥å£å¹¶é‡å†™ loadUserByUsername () æ–¹æ³•ã€‚</p>\n<h3 id=\"åŸºäºjdbcçš„ç”¨æˆ·åå¯†ç \"><a class=\"anchor\" href=\"#åŸºäºjdbcçš„ç”¨æˆ·åå¯†ç \">#</a> åŸºäº JDBC çš„ç”¨æˆ·åå¯†ç </h3>\n<p><strong>æ–¹å¼ä¸€ï¼š</strong></p>\n<p>é¦–å…ˆåŠ å…¥ jdbc å’Œ mysql çš„ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-jdbc<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>mysql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mysql-connector-java<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>æ–°å»ºæ•°æ®åº“è¡¨ï¼Œå¯ä»¥åœ¨åŒ… org.springframework.security.core.userdetails.jdbc ä¸‹æ‰¾åˆ°å®˜æ–¹æä¾›çš„ sql è¯­å¥ï¼Œä½¿ç”¨ mysql æ‰§è¡Œæ—¶ï¼Œå°† varchar_ignorecase æ›¿æ¢ä¸º varchar å³å¯ï¼Œè¿™é‡Œä¸ºäº†åé¢æ­¥éª¤å¥½æ“ä½œï¼Œæˆ‘ç»™ authorities è¡¨åŠ äº†ä¸€ä¸ªä¸»é”® idã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210128135207137.png\" alt=\"image-20210128135207137\" /></p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>users<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">`</span>password<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">`</span>enabled<span class=\"token punctuation\">`</span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>latin1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>authorities<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">`</span>authority<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>ix_auth_username<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>authority<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token keyword\">CONSTRAINT</span> <span class=\"token punctuation\">`</span>fk_authorities_users<span class=\"token punctuation\">`</span> <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> <span class=\"token punctuation\">`</span>users<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token operator\">=</span><span class=\"token number\">6</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>latin1<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>application.properties é…ç½®æ–‡ä»¶</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">spring.datasource.username</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">root</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">spring.datasource.password</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">123456</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">spring.datasource.url</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">jdbc:mysql:///test?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC</span></pre></td></tr></table></figure><p>æ ¸å¿ƒé…ç½®ç±»ä¸­</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// åŸºäº JDBC çš„ç”¨æˆ·åå¯†ç å­˜å‚¨</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token class-name\">DataSource</span> datasource<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token function\">userDetailsService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token class-name\">JdbcUserDetailsManager</span> jdbcUserDetailsManager <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JdbcUserDetailsManager</span><span class=\"token punctuation\">(</span>datasource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token comment\">// å¯†ç åŠ å¯†</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\tjdbcUserDetailsManager<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">withUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token comment\">// å¯†ç ä¸åŠ å¯†</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\tjdbcUserDetailsManager<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">withUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> jdbcUserDetailsManager<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®åæŸ¥çœ‹æ•°æ®åº“ä¸­ users è¡¨ã€authorities è¡¨ã€‚æ³¨æ„ authorities è§’è‰²è¡¨ä¸­è§’è‰²åœ¨æ’å…¥è¿‡ç¨‹ä¸­è‡ªåŠ¨æ·»åŠ äº† ROLE å‰ç¼€ï¼Œè€Œåœ¨æ—¥å¸¸å¼€å‘ä¸­æ•°æ®åº“ä¸­å­˜å‚¨çš„è§’è‰²ä¹Ÿå¿…é¡»æ˜¯ ROLE_å¼€å¤´ï¼Œè¿™æ˜¯ Sping Security æ¡†æ¶åœ¨è§£æè§’è‰²æ—¶çš„å›ºå®šæ ¼å¼ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210128150651789.png\" alt=\"image-20210128150651789\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210128150721563.png\" alt=\"image-20210128150721563\" /></p>\n<p>å¯ä»¥çœ‹åˆ°åªéœ€è¦ç®€å•çš„è°ƒç”¨å°±èƒ½é€šè¿‡ jdbc å°†ç”¨æˆ·åä»¥åŠå¯†ç å†™å…¥åˆ°æ•°æ®åº“ä¸­ã€‚</p>\n<p>å¯åŠ¨é¡¹ç›®æµ‹è¯•</p>\n<p>é¦–å…ˆä½¿ç”¨ test ç”¨æˆ·ç™»å½•ï¼Œåå°æŠ¥é”™ï¼Œå› ä¸º test ç”¨æˆ·çš„å¯†ç æ²¡åŠ å¯†ï¼Œå¯†ç æ ¼å¼ä¸å¯¹</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210128151807181.png\" alt=\"image-20210128151807181\" /></p>\n<p>ç„¶åä½¿ç”¨ admin ç”¨æˆ·ç™»å½•ï¼Œé¡µé¢æˆåŠŸè·³è½¬</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210128151728184.png\" alt=\"image-20210128151728184\" /></p>\n<p><strong>æ–¹å¼äºŒï¼š</strong></p>\n<p>å¯ä»¥é‡å†™ configure (AuthenticationManagerBuilder auth) æ–¹æ³•ï¼Œå¹¶åœ¨è¯¥æ–¹æ³•ä¸­å®ç°</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æƒé™ç›¸å…³é…ç½®é¡¹ï¼Œä¸€æ—¦é‡å†™è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆé…ç½®æ–‡ä»¶ä¸­çš„ç”¨æˆ·åå¯†ç å°†å¤±æ•ˆ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span> <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthenticationManagerBuilder</span> auth<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token comment\">// åŸºäº JDBC çš„ç”¨æˆ·åå¯†ç åˆ›å»ºä¸å­˜å‚¨ æ–¹å¼ä¸€</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token class-name\">JdbcUserDetailsManager</span> jdbcUserDetailsManager <span class=\"token operator\">=</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">jdbcAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">dataSource</span><span class=\"token punctuation\">(</span>datasource<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">getUserDetailsService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token comment\">// å¯ä»¥ç”¨åšç”¨æˆ·æ³¨å†Œæ—¶ åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>jdbcUserDetailsManager<span class=\"token punctuation\">.</span><span class=\"token function\">userExists</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"666\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\tjdbcUserDetailsManager<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">withUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"666\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"666\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">roles</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®åæŸ¥çœ‹æ•°æ®åº“ä¸­ users è¡¨</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210128154311370.png\" alt=\"image-20210128154311370\" /></p>\n<p>æµ‹è¯•ç™»å½•å¯ä»¥æ­£å¸¸ç™»å½•è·³è½¬</p>\n<h3 id=\"åŸºäºæ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·åå¯†ç \"><a class=\"anchor\" href=\"#åŸºäºæ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·åå¯†ç \">#</a> åŸºäºæ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·åå¯†ç </h3>\n<p>æ—¥å¸¸å¼€å‘ä¸­è‚¯å®šä¼šä»é¡µé¢è¡¨å•æäº¤çš„ç”¨æˆ·åå¯†ç å»è·Ÿæ•°æ®åº“åšæ¯”å¯¹ï¼Œæ‰€ä»¥è¿™é‡Œå°†å®ç°è¯¥åŠŸèƒ½ã€‚</p>\n<p>é¦–å…ˆï¼Œå¯¼å…¥ JPA ä¾èµ–ï¼Œå› ä¸º JPA ç›¸å¯¹ç®€å•ï¼Œè¿™é‡Œç”¨ JPA å»æŸ¥è¯¢æ•°æ®åº“</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-jpa<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>æ•°æ®è¡¨è¿˜æ˜¯ä»¥ä¸Šçš„ usersã€ã€authorities è¡¨ï¼Œåˆ›å»ºè¿™ä¸¤å¼ è¡¨å¯¹åº”çš„å®ä½“ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>entity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Entity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Id</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Table</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>* @Description: TODO    </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>* @Title:  MyUser.java </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>* @Package com.fan.entity </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>* @author  baifan</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>* @date 2021 å¹´ 2 æœˆ 1 æ—¥ ä¸Šåˆ 10:29:30 </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>* @version V1.0   </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@Entity</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"users\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyUser</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Id</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">char</span> enabled<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> username<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>username <span class=\"token operator\">=</span> username<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password <span class=\"token operator\">=</span> password<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">char</span> <span class=\"token function\">getEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> enabled<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setEnabled</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span> enabled<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>enabled <span class=\"token operator\">=</span> enabled<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"MyUser [username=\"</span> <span class=\"token operator\">+</span> username <span class=\"token operator\">+</span> <span class=\"token string\">\", password=\"</span> <span class=\"token operator\">+</span> password <span class=\"token operator\">+</span> <span class=\"token string\">\", enabled=\"</span> <span class=\"token operator\">+</span> enabled <span class=\"token operator\">+</span> <span class=\"token string\">\"]\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>entity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Entity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Id</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JoinColumn</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Table</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>* @Description: TODO    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>* @Title:  MyAuthoritys.java </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>* @Package com.fan.entity </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>* @author  baifan</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>* @date 2021 å¹´ 2 æœˆ 1 æ—¥ ä¸Šåˆ 10:48:58 </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>* @version V1.0   </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token annotation punctuation\">@Entity</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"authorities\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyAuthorities</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token annotation punctuation\">@Id</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token annotation punctuation\">@JoinColumn</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//\t@ManyToOne</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> authority<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"MyAuthorities [id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span> <span class=\"token string\">\", username=\"</span> <span class=\"token operator\">+</span> username <span class=\"token operator\">+</span> <span class=\"token string\">\", authority=\"</span> <span class=\"token operator\">+</span> authority <span class=\"token operator\">+</span> <span class=\"token string\">\"]\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Long</span> <span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setId</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> username<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>username <span class=\"token operator\">=</span> username<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getAuthority</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> authority<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setAuthority</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> authority<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authority <span class=\"token operator\">=</span> authority<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åˆ›å»º DAO å±‚æ¥å£ï¼Œéœ€è¦ç»§æ‰¿ JpaRepository æ¥å£ï¼Œè¯¥æ¥å£å°è£…äº†ä¸€äº›æŸ¥ç”¨çš„æ•°æ®åº“æ“ä½œæ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼Œæ— éœ€å†™ sql è¯­å¥ï¼Œéå¸¸æ–¹ä¾¿</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>mapper</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>jpa<span class=\"token punctuation\">.</span>repository<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JpaRepository</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>jpa<span class=\"token punctuation\">.</span>repository<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Query</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>entity<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>* @Description: TODO    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>* @Title:  MyUserDao.java </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>* @Package com.fan.mapper </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>* @author  baifan</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>* @date 2021 å¹´ 2 æœˆ 1 æ—¥ ä¸Šåˆ 10:53:31 </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>* @version V1.0   </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MyUserDao</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select u from MyUser u where u.username = ?1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token class-name\">MyUser</span> <span class=\"token function\">selectUserByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>mapper</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>jpa<span class=\"token punctuation\">.</span>repository<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JpaRepository</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>jpa<span class=\"token punctuation\">.</span>repository<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Query</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>entity<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyAuthorities</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>* @Description: TODO    </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>* @Title:  MyAuthoritiesDao.java </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>* @Package com.fan.mapper </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>* @author  baifan</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>* @date 2021 å¹´ 2 æœˆ 1 æ—¥ ä¸Šåˆ 11:06:20 </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>* @version V1.0   </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MyAuthoritiesDao</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyAuthorities</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\">// æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢è§’è‰²</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select au from MyAuthorities au where au.username = ?1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyAuthorities</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">selectAuthoritiesByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>service å±‚éœ€è¦å®ç° UserDetailsService æ¥å£ï¼Œè¯¥æ¥å£ä¸­çš„ loadUserByUsername æ˜¯å…³é”®ï¼Œè¡¨å•æäº¤æ—¶çš„ç”¨æˆ·åå°†ä¼ ç»™è¯¥æ–¹æ³•ï¼Œç„¶ååœ¨è¯¥æ–¹æ³•ä¸­å†è¿›ä¸€æ­¥è°ƒç”¨ DAO å±‚æ–¹æ³•æ ¹æ®ç”¨æˆ·åå»æ•°æ®åº“æŸ¥è¯¢åŒ¹é…</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>service</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ArrayList</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>authority<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>userdetails<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">User</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>userdetails<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UserDetails</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>userdetails<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UserDetailsService</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>userdetails<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UsernameNotFoundException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Service</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>entity<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyAuthorities</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>entity<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyAuthoritiesDao</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyUserDao</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>* @Description: TODO    </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>* @Title:  MyUserService.java </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>* @Package com.fan.service </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>* @author  baifan</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>* @date 2021 å¹´ 2 æœˆ 1 æ—¥ ä¸Šåˆ 11:00:30 </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>* @version V1.0   </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyUserService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">MyUserDao</span> myUserDao<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">MyAuthoritiesDao</span> myAuthoritiesDao<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">MyUserService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MyUserDao</span> myUserDao<span class=\"token punctuation\">,</span> <span class=\"token class-name\">MyAuthoritiesDao</span> myAuthoritiesDao<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myUserDao <span class=\"token operator\">=</span> myUserDao<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>myAuthoritiesDao <span class=\"token operator\">=</span> myAuthoritiesDao<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UsernameNotFoundException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t<span class=\"token class-name\">MyUser</span> user <span class=\"token operator\">=</span> myUserDao<span class=\"token punctuation\">.</span><span class=\"token function\">selectUserByName</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">//\t\tSystem.err.println(username);</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\">//\t\tSystem.err.println(user);</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MyAuthorities</span><span class=\"token punctuation\">></span></span> authorities <span class=\"token operator\">=</span> myAuthoritiesDao<span class=\"token punctuation\">.</span><span class=\"token function\">selectAuthoritiesByName</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">//\t\tSystem.err.println(authorities);</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">></span></span> simpleGrantedAuthorities <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MyAuthorities</span> myAuthorities <span class=\"token operator\">:</span> authorities<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t\tsimpleGrantedAuthorities<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">(</span>myAuthorities<span class=\"token punctuation\">.</span><span class=\"token function\">getAuthority</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token class-name\">UserDetails</span> userDetails <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> simpleGrantedAuthorities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> userDetails<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ ¸å¿ƒé…ç½®ä¸­ç›¸å¯¹ç®€å•ï¼Œå°† service å¯¹è±¡å¼•å…¥å³å¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataSource</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BadCredentialsException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthenticationManagerBuilder</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>builders<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpSecurity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">EnableWebSecurity</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebSecurityConfigurerAdapter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthenticationException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>crypto<span class=\"token punctuation\">.</span>bcrypt<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AuthenticationFailureHandler</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>csrf<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpSessionCsrfTokenRepository</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyUserService</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"26\"></td><td><pre> * @Description: TODO</pre></td></tr><tr><td data-num=\"27\"></td><td><pre> * @Title: MyConfig.java</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> * @Package com.fan</pre></td></tr><tr><td data-num=\"29\"></td><td><pre> * @author baifan</pre></td></tr><tr><td data-num=\"30\"></td><td><pre> * @date 2021 å¹´ 1 æœˆ 26 æ—¥ ä¸‹åˆ 1:34:37</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> * @version V1.0</pre></td></tr><tr><td data-num=\"32\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token annotation punctuation\">@EnableWebSecurity</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token class-name\">DataSource</span> datasource<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t<span class=\"token class-name\">MyUserService</span> myUserService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t<span class=\"token comment\">// ç™»å½•è®¤è¯ç›¸å…³é…ç½®é¡¹</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\thttp</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å“ªäº›è¯·æ±‚éœ€è¦ç™»å½•è®¤è¯ï¼ŒanyRequest () ä»£è¡¨æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦ç™»å½•è®¤è¯</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•çš„ç”¨æˆ·å¯ä»¥è®¿é—®è¯¥é¡µé¢ï¼Œä¸éœ€è¦è®¤è¯ï¼Œä¸ºæ­¤éœ€è¦é…ç½® permitAll ()</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t\t\t<span class=\"token comment\">//loginProcessingUrl () ä»£è¡¨ç™»å½•çš„ç”¨æˆ·åå¯†ç æ ¡éªŒçš„åœ°å€</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// é…ç½®ç™»å½•é¡µé¢çš„ç”¨æˆ·æ°‘ä»¥åŠå¯†ç å­—æ®µï¼Œé»˜è®¤ä¸º usernameã€password</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">usernameParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">passwordParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æ ¹ç›®å½•</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">//\t\t\t\t.defaultSuccessUrl(\"/\")</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æŒ‡å®šé¡µé¢</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/ok\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥è·³è½¬çš„é¡µé¢</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureForwardUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html?error\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥çš„å¤„ç†</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationFailureHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t\t\t\t\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t\t\t\t\t\texception<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// åˆ¤æ–­å¼‚å¸¸ä¿¡æ¯è·³è½¬ä¸åŒé¡µé¢</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exception <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BadCredentialsException</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>\t\t\t\t\t\t\trequest<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestDispatcher</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>\t\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// è®°å½•ç™»å½•å¤±è´¥ï¼Œé”å®šå°±ç™»å½•</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å¼€å¯ csrf å°†é»˜è®¤æ‹¦æˆªæ‰€æœ‰ post è¯·æ±‚ï¼Œå¦‚æœé‡å†™äº† configure () æ–¹æ³•ï¼Œé‚£ä¹ˆå¿…é¡»æ‰‹åŠ¨å¼€å¯ csrf æˆ–è€…æ‰‹åŠ¨å…³é—­ csrfï¼ˆä½¿ç”¨ csrf ().disable (), å…³é—­åæ— æ³•è·å–_csrf.token ç­‰å€¼ï¼‰ï¼Œå¦åˆ™ç™»å½•ä¸æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">csrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpSessionCsrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>\t<span class=\"token comment\">// æƒé™ç›¸å…³é…ç½®é¡¹ï¼Œä¸€æ—¦é‡å†™è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆé…ç½®æ–‡ä»¶ä¸­çš„ç”¨æˆ·åå¯†ç å°†å¤±æ•ˆ</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span> <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthenticationManagerBuilder</span> auth<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>\t<span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>\t\tauth<span class=\"token punctuation\">.</span><span class=\"token function\">userDetailsService</span><span class=\"token punctuation\">(</span>myUserService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">passwordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®æµ‹è¯•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210201144043992.png\" alt=\"image-20210201144043992\" /></p>\n<h3 id=\"å¿½ç•¥é™æ€è¯·æ±‚\"><a class=\"anchor\" href=\"#å¿½ç•¥é™æ€è¯·æ±‚\">#</a> å¿½ç•¥é™æ€è¯·æ±‚</h3>\n<p><strong>æ–¹å¼ä¸€ï¼š</strong></p>\n<p>æ ¸å¿ƒé…ç½®ç±»ä¸­ï¼Œé€šè¿‡é…ç½® antMatchers ()</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ç™»å½•è®¤è¯ç›¸å…³é…ç½®é¡¹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\thttp</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å“ªäº›è¯·æ±‚éœ€è¦ç™»å½•è®¤è¯ï¼ŒanyRequest () ä»£è¡¨æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦ç™»å½•è®¤è¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/img/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•çš„ç”¨æˆ·å¯ä»¥è®¿é—®è¯¥é¡µé¢ï¼Œä¸éœ€è¦è®¤è¯ï¼Œä¸ºæ­¤éœ€è¦é…ç½® permitAll ()</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\t<span class=\"token comment\">//loginProcessingUrl () ä»£è¡¨ç™»å½•çš„ç”¨æˆ·åå¯†ç æ ¡éªŒçš„åœ°å€</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// é…ç½®ç™»å½•é¡µé¢çš„ç”¨æˆ·æ°‘ä»¥åŠå¯†ç å­—æ®µï¼Œé»˜è®¤ä¸º usernameã€password</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">usernameParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">passwordParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æ ¹ç›®å½•</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">//\t\t\t\t.defaultSuccessUrl(\"/\")</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æŒ‡å®šé¡µé¢</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/ok\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥è·³è½¬çš„é¡µé¢</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureForwardUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html?error\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥çš„å¤„ç†</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationFailureHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t\t\texception<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// åˆ¤æ–­å¼‚å¸¸ä¿¡æ¯è·³è½¬ä¸åŒé¡µé¢</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exception <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BadCredentialsException</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t\t\t\t\trequest<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestDispatcher</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// è®°å½•ç™»å½•å¤±è´¥ï¼Œé”å®šå°±ç™»å½•</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å¼€å¯ csrf å°†é»˜è®¤æ‹¦æˆªæ‰€æœ‰ post è¯·æ±‚ï¼Œå¦‚æœé‡å†™äº† configure () æ–¹æ³•ï¼Œé‚£ä¹ˆå¿…é¡»æ‰‹åŠ¨å¼€å¯ csrf æˆ–è€…æ‰‹åŠ¨å…³é—­ csrfï¼ˆä½¿ç”¨ csrf ().disable (), å…³é—­åæ— æ³•è·å–_csrf.token ç­‰å€¼ï¼‰ï¼Œå¦åˆ™ç™»å½•ä¸æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">csrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpSessionCsrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>æ–¹å¼äºŒï¼š</strong></p>\n<p>æ ¸å¿ƒé…ç½®ç±»ä¸­ï¼Œé‡å†™ onfigure (WebSecurity web) æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦ç»è¿‡æƒé™è®¤è¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// é™æ€èµ„æºè¯·æ±‚å¿½ç•¥è®¤è¯ï¼Œä¸éœ€è¦ç™»å½•å°±èƒ½è®¿é—®èµ„æº</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSecurity</span> web<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\tweb<span class=\"token punctuation\">.</span><span class=\"token function\">ignoring</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/img/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210201151224918.png\" alt=\"image-20210201151224918\" /></p>\n<h3 id=\"æœ€å¤§ç™»å½•ç”¨æˆ·æ•°\"><a class=\"anchor\" href=\"#æœ€å¤§ç™»å½•ç”¨æˆ·æ•°\">#</a> æœ€å¤§ç™»å½•ç”¨æˆ·æ•°</h3>\n<p>æ ¸å¿ƒé…ç½®ç±»ä¸­é…ç½®æœ€å¤§ session æ•°å³å¯</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ç™»å½•è®¤è¯ç›¸å…³é…ç½®é¡¹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\thttp</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å“ªäº›è¯·æ±‚éœ€è¦ç™»å½•è®¤è¯ï¼ŒanyRequest () ä»£è¡¨æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦ç™»å½•è®¤è¯</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å¿½ç•¥é™æ€èµ„æºè¯·æ±‚éœ€è¦è®¤è¯</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//\t\t\t\t.antMatchers(\"/img/**\").permitAll()</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            \t  <span class=\"token comment\">// ä¸éœ€è¦ç™»å½•å°±èƒ½è®¿é—®çš„ ip</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//\t\t\t\t.antMatchers(\"url\").hasIpAddress(\"127.0.0.1\")</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            \t <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•çš„ç”¨æˆ·å¯ä»¥è®¿é—®è¯¥é¡µé¢ï¼Œä¸éœ€è¦è®¤è¯ï¼Œä¸ºæ­¤éœ€è¦é…ç½® permitAll ()</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t<span class=\"token comment\">//loginProcessingUrl () ä»£è¡¨ç™»å½•çš„ç”¨æˆ·åå¯†ç æ ¡éªŒçš„åœ°å€</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// è®°ä½æˆ‘</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//\t\t\t\t.and().rememberMe().and()</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// é…ç½®ç™»å½•é¡µé¢çš„ç”¨æˆ·æ°‘ä»¥åŠå¯†ç å­—æ®µï¼Œé»˜è®¤ä¸º usernameã€password</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">usernameParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">passwordParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æ ¹ç›®å½•</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æŒ‡å®šé¡µé¢</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/ok\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥è·³è½¬çš„é¡µé¢</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureForwardUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html?error\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥çš„å¤„ç†</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationFailureHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t\t\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t\t\texception<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// åˆ¤æ–­å¼‚å¸¸ä¿¡æ¯è·³è½¬ä¸åŒé¡µé¢</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exception <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BadCredentialsException</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t\t\t\t\trequest<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestDispatcher</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// é…ç½®æœ€å¤§ç™»å½•ç”¨æˆ·æ•°</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">maximumSessions</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å¼€å¯ csrf å°†é»˜è®¤æ‹¦æˆªæ‰€æœ‰ post è¯·æ±‚ï¼Œå¦‚æœé‡å†™äº† configure () æ–¹æ³•ï¼Œé‚£ä¹ˆå¿…é¡»æ‰‹åŠ¨å¼€å¯ csrf æˆ–è€…æ‰‹åŠ¨å…³é—­ csrfï¼ˆä½¿ç”¨ csrf ().disable (), å…³é—­åæ— æ³•è·å–_csrf.token ç­‰å€¼ï¼‰ï¼Œå¦åˆ™ç™»å½•ä¸æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">csrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpSessionCsrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨ä¸¤ä¸ªæµè§ˆå™¨æµ‹è¯•ï¼Œå¦ä¸€ä¸ªæµè§ˆå™¨ç™»å½•åï¼Œä¼šæç¤ºå·²ç™»å½•çš„æµè§ˆå™¨ session è¿‡æœŸ</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210201163327780.png\" alt=\"image-20210201163327780\" /></p>\n<p>æ­¤å¤–ï¼ŒmaximumSessions (1) åé¢å¯ä»¥å†è¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚æœ‰ç”¨æˆ·ç™»é™†åï¼Œä¸å…è®¸ç›¸åŒç”¨æˆ·å†æ¬¡ç™»å½•</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ç™»å½•è®¤è¯ç›¸å…³é…ç½®é¡¹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\thttp</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å“ªäº›è¯·æ±‚éœ€è¦ç™»å½•è®¤è¯ï¼ŒanyRequest () ä»£è¡¨æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦ç™»å½•è®¤è¯</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å¿½ç•¥é™æ€èµ„æºè¯·æ±‚éœ€è¦è®¤è¯</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//\t\t\t\t.antMatchers(\"/img/**\").permitAll()</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•çš„ç”¨æˆ·å¯ä»¥è®¿é—®è¯¥é¡µé¢ï¼Œä¸éœ€è¦è®¤è¯ï¼Œä¸ºæ­¤éœ€è¦é…ç½® permitAll ()</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t\t<span class=\"token comment\">//loginProcessingUrl () ä»£è¡¨ç™»å½•çš„ç”¨æˆ·åå¯†ç æ ¡éªŒçš„åœ°å€</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// è®°ä½æˆ‘</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//\t\t\t\t.and().rememberMe().and()</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// é…ç½®ç™»å½•é¡µé¢çš„ç”¨æˆ·æ°‘ä»¥åŠå¯†ç å­—æ®µï¼Œé»˜è®¤ä¸º usernameã€password</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">usernameParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">passwordParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æ ¹ç›®å½•</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•æˆåŠŸè·³è½¬åˆ°æŒ‡å®šé¡µé¢</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/ok\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥è·³è½¬çš„é¡µé¢</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureForwardUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login.html?error\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// ç™»å½•å¤±è´¥çš„å¤„ç†</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationFailureHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t\t\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t\t\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t\t\t\texception<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t\t\t\t<span class=\"token comment\">// åˆ¤æ–­å¼‚å¸¸ä¿¡æ¯è·³è½¬ä¸åŒé¡µé¢</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exception <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BadCredentialsException</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t\t\t\t\trequest<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestDispatcher</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// é…ç½®æœ€å¤§ç™»å½•ç”¨æˆ·æ•°</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">maximumSessions</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            \t\t   <span class=\"token comment\">// å·²ç»æœ‰ç”¨æˆ·ç™»å½•çš„æƒ…å†µä¸‹ï¼Œä¸å…è®¸ç›¸åŒç”¨æˆ·å†æ¬¡ç™»å½•</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">maxSessionsPreventsLogin</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å¼€å¯ csrf å°†é»˜è®¤æ‹¦æˆªæ‰€æœ‰ post è¯·æ±‚ï¼Œå¦‚æœé‡å†™äº† configure () æ–¹æ³•ï¼Œé‚£ä¹ˆå¿…é¡»æ‰‹åŠ¨å¼€å¯ csrf æˆ–è€…æ‰‹åŠ¨å…³é—­ csrfï¼ˆä½¿ç”¨ csrf ().disable (), å…³é—­åæ— æ³•è·å–_csrf.token ç­‰å€¼ï¼‰ï¼Œå¦åˆ™ç™»å½•ä¸æˆåŠŸ</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">csrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpSessionCsrfTokenRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token comment\">// æ¸…ç†è¿‡æœŸ session</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token class-name\">HttpSessionEventPublisher</span> <span class=\"token function\">httpSessionEventPublisher</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpSessionEventPublisher</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210201170629041.png\" alt=\"image-20210201170629041\" /></p>\n<h3 id=\"æŒ‡å®šé¡µé¢æƒé™\"><a class=\"anchor\" href=\"#æŒ‡å®šé¡µé¢æƒé™\">#</a> æŒ‡å®šé¡µé¢æƒé™</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>http</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// å“ªäº›è¯·æ±‚éœ€è¦ç™»å½•è®¤è¯ï¼ŒanyRequest () ä»£è¡¨æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦ç™»å½•è®¤è¯</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// è®¿é—®æŒ‡å®šé¡µé¢æ‰€éœ€è¦çš„è§’è‰²æƒé™ï¼Œå¦‚æœç™»é™†çš„ç”¨æˆ·æ²¡æœ‰è¯¥è§’è‰²æƒé™ï¼Œé‚£ä¹ˆå°†æ— æ³•è®¿é—®</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>security åƒ shiro ä¸€æ ·ï¼Œæƒé™åŒ¹é…æœ‰é¡ºåºï¼Œæ¯”å¦‚ä¸èƒ½æŠŠ.anyRequest ().authenticated () å†™åœ¨å…¶ä»–è§„åˆ™å‰é¢</p>\n<p>æµ‹è¯•ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/hi\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hi1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"hi admin\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/hi\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hi2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"hi user\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"æƒé™é›†æˆ\"><a class=\"anchor\" href=\"#æƒé™é›†æˆ\">#</a> æƒé™é›†æˆ</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// æƒé™é›†æˆ</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">RoleHierarchy</span> <span class=\"token function\">roleHierarchy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token class-name\">RoleHierarchyImpl</span> impl <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RoleHierarchyImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token comment\">// å…·æœ‰ admin è§’è‰²çš„ç”¨æˆ·å¯ä»¥è®¿é—®å…·æœ‰ user è§’è‰²çš„ç”¨æˆ·çš„æƒé™</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\timpl<span class=\"token punctuation\">.</span><span class=\"token function\">setHierarchy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_admin > ROLE_user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> impl<span class=\"token punctuation\">;</span>\t</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"åŸºäºæ³¨è§£çš„æƒé™\"><a class=\"anchor\" href=\"#åŸºäºæ³¨è§£çš„æƒé™\">#</a> åŸºäºæ³¨è§£çš„æƒé™</h3>\n<p><strong>æ–¹å¼ä¸€ï¼š</strong></p>\n<p>å¯åŠ¨ç±»åŠ å…¥æ³¨è§£  @EnableGlobalMethodSecurity (securedEnabled = true)</p>\n<p>controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hi\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// å…·æœ‰ admin æˆ–è€… test è§’è‰²çš„ç”¨æˆ·å¯ä»¥è®¿é—®è¯¥è·¯å¾„</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Secured</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"ROLE_admin\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ROLE_test\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"hi\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>æ–¹å¼äºŒï¼š</strong></p>\n<p>å¯åŠ¨ç±»åŠ å…¥æ³¨è§£  @EnableGlobalMethodSecurity (securedEnabled = true, prePostEnabled = true)</p>\n<p>controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/hi\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// éœ€è¦æœ‰ admin è§’è‰²çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—®è¯¥è·¯å¾„</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasRole('ROLE_admin')\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hi1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"hi admin\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ–è€…</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/hi4\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// éœ€è¦åŒæ—¶å…·æœ‰ admin è§’è‰²ä»¥åŠ test è§’è‰²çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—®è¯¥è·¯å¾„</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasRole('ROLE_admin') AND hasRole('ROLE_test')\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hi4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"hi admin\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æˆ–è€…</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/hi3\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// éœ€è¦æœ‰ admin æˆ–è€… test è§’è‰²çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—®è¯¥è·¯å¾„</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasAnyRole('ROLE_admin', 'ROLE_test')\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hi3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"hi admin\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ–¹å¼ä¸‰ï¼š</p>\n<p>å¯åŠ¨ç±»åŠ å…¥æ³¨è§£  @EnableGlobalMethodSecurity (securedEnabled = true, prePostEnabled = true)</p>\n<p>æ ¹æ®æ–¹æ³•è¿”å›å€¼åˆ¤æ–­æ˜¯å¦æœ‰æƒé™</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/hi5\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// è¯¥æ³¨è§£æ”¯æŒ Spring EL è¡¨è¾¾å¼ã€‚è¡¨è¾¾å¼è¿”å›å€¼ä¸º true æ—¶ï¼Œåˆ™è¡¨ç¤ºæœ‰æƒé™ã€‚ä¸éœ€è¦ç™»å½•ï¼Œæ ¹æ®è¿”å›å€¼åˆ¤æ–­æœ‰æ— æƒé™</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token comment\">// é€‚åˆä¸éœ€è¦ session çš„åœºæ™¯</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token annotation punctuation\">@PostAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"returnObject==1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">hi5</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"ç”¨æˆ·ä¿¡æ¯ä¸Šä¸‹æ–‡\"><a class=\"anchor\" href=\"#ç”¨æˆ·ä¿¡æ¯ä¸Šä¸‹æ–‡\">#</a> ç”¨æˆ·ä¿¡æ¯ä¸Šä¸‹æ–‡</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/hi6\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// éœ€è¦åŒæ—¶å…·æœ‰ admin è§’è‰²ä»¥åŠ test è§’è‰²çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—®è¯¥è·¯å¾„</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasRole('ROLE_admin') AND hasRole('ROLE_test')\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">hi6</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getCredentials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"hi admin\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><pre><code class=\"language-cmd\">null\nWebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=6EFA5CC1B2F966A572569BB91135F035]\norg.springframework.security.core.userdetails.User [Username=admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, credentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_admin, ROLE_test]]\n[ROLE_admin, ROLE_test]\n</code></pre>\n<h3 id=\"å›¾å½¢éªŒè¯ç \"><a class=\"anchor\" href=\"#å›¾å½¢éªŒè¯ç \">#</a> å›¾å½¢éªŒè¯ç </h3>\n<p>ä½¿ç”¨ Goggle çš„ Kaptcha</p>\n<p>å±æ€§ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>Constant</th>\n<th>æè¿°</th>\n<th>é»˜è®¤å€¼</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>kaptcha.border</td>\n<td>å›¾ç‰‡è¾¹æ¡†ï¼Œåˆæ³•å€¼ï¼šyes , no</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>kaptcha.border.color</td>\n<td>è¾¹æ¡†é¢œè‰²ï¼Œåˆæ³•å€¼ï¼š r,g,b (and optional alpha) æˆ–è€… white,black,blue.</td>\n<td>black</td>\n</tr>\n<tr>\n<td>kaptcha.image.width</td>\n<td>å›¾ç‰‡å®½</td>\n<td>200</td>\n</tr>\n<tr>\n<td>kaptcha.image.height</td>\n<td>å›¾ç‰‡é«˜</td>\n<td>50</td>\n</tr>\n<tr>\n<td>kaptcha.producer.impl</td>\n<td>å›¾ç‰‡å®ç°ç±»</td>\n<td>com.google.code.kaptcha.impl.DefaultKaptcha</td>\n</tr>\n<tr>\n<td>kaptcha.textproducer.impl</td>\n<td>æ–‡æœ¬å®ç°ç±»</td>\n<td>com.google.code.kaptcha.text.impl.DefaultTextCreator</td>\n</tr>\n<tr>\n<td>kaptcha.textproducer.char.string</td>\n<td>æ–‡æœ¬é›†åˆï¼ŒéªŒè¯ç å€¼ä»æ­¤é›†åˆä¸­è·å–</td>\n<td>abcde2345678gfynmnpwx</td>\n</tr>\n<tr>\n<td>kaptcha.textproducer.char.length</td>\n<td>éªŒè¯ç é•¿åº¦</td>\n<td>5</td>\n</tr>\n<tr>\n<td>kaptcha.textproducer.font.names</td>\n<td>å­—ä½“</td>\n<td>Arial, Courier</td>\n</tr>\n<tr>\n<td>kaptcha.textproducer.font.size</td>\n<td>å­—ä½“å¤§å°</td>\n<td>40px.</td>\n</tr>\n<tr>\n<td>kaptcha.textproducer.font.color</td>\n<td>å­—ä½“é¢œè‰²ï¼Œåˆæ³•å€¼ï¼š r,g,b  æˆ–è€… white,black,blue.</td>\n<td>black</td>\n</tr>\n<tr>\n<td>kaptcha.textproducer.char.space</td>\n<td>æ–‡å­—é—´éš”</td>\n<td>2</td>\n</tr>\n<tr>\n<td>kaptcha.noise.impl</td>\n<td>å¹²æ‰°å®ç°ç±»</td>\n<td>com.google.code.kaptcha.impl.DefaultNoise</td>\n</tr>\n<tr>\n<td>kaptcha.noise.color</td>\n<td>å¹²æ‰° é¢œè‰²ï¼Œåˆæ³•å€¼ï¼š r,g,b æˆ–è€… white,black,blue.</td>\n<td>black</td>\n</tr>\n<tr>\n<td>kaptcha.obscurificator.impl</td>\n<td>å›¾ç‰‡æ ·å¼ï¼š&lt;br /&gt; æ°´çº¹ com.google.code.kaptcha.impl.WaterRipple &lt;br /&gt; é±¼çœ¼ com.google.code.kaptcha.impl.FishEyeGimpy &lt;br /&gt; é˜´å½± com.google.code.kaptcha.impl.ShadowGimpy</td>\n<td>com.google.code.kaptcha.impl.WaterRipple</td>\n</tr>\n<tr>\n<td>kaptcha.background.impl</td>\n<td>èƒŒæ™¯å®ç°ç±»</td>\n<td>com.google.code.kaptcha.impl.DefaultBackground</td>\n</tr>\n<tr>\n<td>kaptcha.background.clear.from</td>\n<td>èƒŒæ™¯é¢œè‰²æ¸å˜ï¼Œå¼€å§‹é¢œè‰²</td>\n<td>light grey</td>\n</tr>\n<tr>\n<td><span class=\"exturl\" data-url=\"aHR0cDovL2thcHRjaGEuYmFja2dyb3VuZC5jbGVhci50bw==\">kaptcha.background.clear.to</span></td>\n<td>èƒŒæ™¯é¢œè‰²æ¸å˜ï¼Œ ç»“æŸé¢œè‰²</td>\n<td>white</td>\n</tr>\n<tr>\n<td>kaptcha.word.impl</td>\n<td>æ–‡å­—æ¸²æŸ“å™¨</td>\n<td>com.google.code.kaptcha.text.impl.DefaultWordRenderer</td>\n</tr>\n<tr>\n<td>kaptcha.session.key</td>\n<td>session key</td>\n<td>KAPTCHA_SESSION_KEY</td>\n</tr>\n<tr>\n<td>kaptcha.session.date</td>\n<td>session date</td>\n<td>KAPTCHA_SESSION_DATE</td>\n</tr>\n</tbody>\n</table>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC9hMzUyNTk5MGNkODI=\">å‚è€ƒ</span></p>\n<p>ä½¿ç”¨æ–¹å¼ï¼š</p>\n<p>å¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/com.github.penggle/kaptcha --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.github.penggle<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>kaptcha<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.3.2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>é…ç½®ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯ xml é…ç½®</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>kaptcha</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Properties</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>code<span class=\"token punctuation\">.</span>kaptcha<span class=\"token punctuation\">.</span>impl<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultKaptcha</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>code<span class=\"token punctuation\">.</span>kaptcha<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Config</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>* @Description: TODO    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>* @Title:  Kaconfig.java </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>* @Package com.fan.kaptcha </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>* @author  baifan</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>* @date 2021 å¹´ 5 æœˆ 24 æ—¥ ä¸‹åˆ 5:43:17 </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>* @version V1.0   </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Kaconfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">DefaultKaptcha</span> <span class=\"token function\">getDefaultKaptcha</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token class-name\">DefaultKaptcha</span> captchaProducer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultKaptcha</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\tproperties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kaptcha.border\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"yes\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\tproperties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kaptcha.border.color\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"105,179,90\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\tproperties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kaptcha.textproducer.font.color\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\tproperties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kaptcha.image.width\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"310\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\tproperties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kaptcha.image.height\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"240\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\tproperties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kaptcha.textproducer.font.size\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"30\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\tproperties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kaptcha.session.key\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\tproperties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kaptcha.textproducer.char.length\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t<span class=\"token comment\">// properties.setProperty(\"kaptcha.textproducer.char.string\", \"678\");</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\tproperties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kaptcha.obscurificator.impl\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"com.google.code.kaptcha.impl.ShadowGimpy\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\tproperties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kaptcha.textproducer.font.names\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"å®‹ä½“,æ¥·ä½“,å¾®è½¯é›…é»‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t<span class=\"token class-name\">Config</span> config <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Config</span><span class=\"token punctuation\">(</span>properties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\tcaptchaProducer<span class=\"token punctuation\">.</span><span class=\"token function\">setConfig</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> captchaProducer<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>kaptcha</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>awt<span class=\"token punctuation\">.</span>image<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BufferedImage</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>imageio<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ImageIO</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletOutputStream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpSession</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Controller</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GetMapping</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>code<span class=\"token punctuation\">.</span>kaptcha<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Constants</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>code<span class=\"token punctuation\">.</span>kaptcha<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Producer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>* @Description: TODO    </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>* @Title:  TestKaptcha.java </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>* @Package com.fan </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>* @author  baifan</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>* @date 2021 å¹´ 5 æœˆ 24 æ—¥ ä¸‹åˆ 5:39:24 </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>* @version V1.0   </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token annotation punctuation\">@Controller</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestKaptcha</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Producer</span> captchaProducer<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/kaptcha\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">getKaptchaImage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t<span class=\"token class-name\">HttpSession</span> session <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\tresponse<span class=\"token punctuation\">.</span><span class=\"token function\">setDateHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Expires\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\tresponse<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cache-Control\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"no-store, no-cache, must-revalidate\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\tresponse<span class=\"token punctuation\">.</span><span class=\"token function\">addHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cache-Control\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"post-check=0, pre-check=0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\tresponse<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Pragma\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"no-cache\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\tresponse<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"image/jpeg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t<span class=\"token class-name\">String</span> capText <span class=\"token operator\">=</span> captchaProducer<span class=\"token punctuation\">.</span><span class=\"token function\">createText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t<span class=\"token comment\">// å°†ç”Ÿæˆçš„éªŒè¯ç æ”¾å…¥ sessionï¼Œç”¨äºåç»­ filter</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\tsession<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span>KAPTCHA_SESSION_KEY<span class=\"token punctuation\">,</span> capText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t<span class=\"token class-name\">BufferedImage</span> bi <span class=\"token operator\">=</span> captchaProducer<span class=\"token punctuation\">.</span><span class=\"token function\">createImage</span><span class=\"token punctuation\">(</span>capText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t<span class=\"token class-name\">ServletOutputStream</span> out <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t<span class=\"token class-name\">ImageIO</span><span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>bi<span class=\"token punctuation\">,</span> <span class=\"token string\">\"jpg\"</span><span class=\"token punctuation\">,</span> out<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\tout<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t\tout<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgwL2thcHRjaGE=\">http://localhost:8080/kaptcha</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210524182526813.png\" alt=\"image-20210524182526813\" /></p>\n<p>æ­¤å¤–ï¼Œå¯ä»¥åŠ ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œåœ¨ç”¨æˆ·åå¯†ç æ ¡éªŒä¹‹å‰å…ˆæ ¡éªŒéªŒè¯ç çš„æ­£ç¡®æ€§</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>kaptcha</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FilterChain</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletRequest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletResponse</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ObjectUtils</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>code<span class=\"token punctuation\">.</span>kaptcha<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Constants</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>* @Description: TODO    </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>* @Title:  CodeFilter.java </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>* @Package com.fan.kaptcha </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>* @author  baifan</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>* @date 2021 å¹´ 5 æœˆ 24 æ—¥ ä¸‹åˆ 6:33:11 </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>* @version V1.0   </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CodeFilter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\"><span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span></span>Filter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">FilterChain</span> chain<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t<span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t<span class=\"token class-name\">HttpServletRequest</span> req <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t<span class=\"token class-name\">HttpServletResponse</span> resp <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">)</span> response<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t<span class=\"token comment\">// å½“å‰ç”¨æˆ·è¯·æ±‚çš„ URL</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token class-name\">String</span> uri <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getServletPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>uri<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"post\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t<span class=\"token comment\">// æ‹¿å‡º session ä¸­çš„éªŒè¯ç </span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t<span class=\"token class-name\">String</span> sessionCode <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span>KAPTCHA_SESSION_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t<span class=\"token comment\">// è¡¨å•æäº¤æ—¶çš„éªŒè¯ç </span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t<span class=\"token class-name\">String</span> formCode <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ObjectUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>formCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"éªŒè¯ç ä¸èƒ½ä¸ºç©º\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sessionCode<span class=\"token punctuation\">.</span><span class=\"token function\">equalsIgnoreCase</span><span class=\"token punctuation\">(</span>formCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"éªŒè¯é€šè¿‡\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"éªŒè¯ç é”™è¯¯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\t\t<span class=\"token comment\">// throw new AuthenticationServiceException(\"xx\");</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\tchain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ç™»å½•è®¤è¯ç›¸å…³é…ç½®é¡¹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token comment\">// åœ¨æ ¡éªŒç”¨æˆ·åå¯†ç ä¹‹å‰å…ˆæ ¡éªŒéªŒè¯ç </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\thttp<span class=\"token punctuation\">.</span><span class=\"token function\">addFilterBefore</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">CodeFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UsernamePasswordAuthenticationFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Insert title here<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/login<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>ç”¨æˆ·å <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>å¯†ç  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>éªŒè¯ç  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>code<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://localhost:8080/kaptcha<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;_csrf.parameterName&#125;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">th:</span>value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$&#123;_csrf.token&#125;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ç™»å½•<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"å¯†ç å®‰å…¨æ€§\"><a class=\"anchor\" href=\"#å¯†ç å®‰å…¨æ€§\">#</a> å¯†ç å®‰å…¨æ€§</h3>\n<p>å¯¹äº MD5 ç®—æ³•æ¥è¯´ï¼Œç°åœ¨æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡å½©è™¹è¡¨åˆ†æ®µæ¥ç¢°æ’è§£å¯†ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ç»™å¯†ç åŠ ç›åå†é€šè¿‡ç®—æ³•å»ç”Ÿæˆå¯†ç ï¼Œå…³é”®å°±åœ¨äºç›çš„é€‰æ‹©ï¼Œå›ºå®šç›è‚¯å®šæ˜¯ä¸å®‰å…¨çš„ï¼Œå¯ä»¥ç”¨éšæœºæ•°ä½œä¸ºç›ï¼Œå³ hash (æ˜æ–‡ + éšæœºæ•°)ï¼Œä½†è¿™æ ·åšçš„é—®é¢˜æ˜¯æ¯æ¬¡ç›¸åŒçš„æ˜æ–‡ç”±äºéšæœºæ•°çš„ä¸åŒå¯¼è‡´åŠ å¯†ç»“æœä¸åŒï¼Œæ‰€ä»¥é€ æˆäº†æ— æ³•åŒ¹é…çš„é—®é¢˜ã€‚è§£å†³åŠæ³•æ˜¯å°†æ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°è®°å½•ä¸‹æ¥åŠ åœ¨åŠ å¯†ç»“æœçš„åè¾¹æˆ–å‰é¢æˆ–ä¸­é—´åå­˜å…¥æ•°æ®åº“ï¼Œå°†æ¯æ¬¡è¯·æ±‚çš„æ˜æ–‡å¯†ç åŠ ä¸Šæ•°æ®åº“ä¸­å·²æœ‰å¯†ç åé¢çš„éšæœºæ•°å†æ¬¡æ‰§è¡Œç›¸åŒçš„ç®—æ³• hash (æ˜æ–‡ + éšæœºæ•°) åçš„åˆ°ç»“æœå»åŒ¹é…æ•°æ®åº“ä¸­çš„ç»“æœã€‚åœ¨æ­¤ç»“æœä¸Šè¿˜å¯ä»¥è¿›è¡Œå¤šæ¬¡åŠ å¯†ï¼Œå³ hash (hash (æ˜æ–‡ + éšæœºç›) + éšæœºç›)ï¼Œå¦‚ SHA-1ã€SHA-256 ç­‰ï¼Œè¿™æ ·çš„åŠ å¯†æ–¹å¼æ˜¯éå¸¸å®‰å…¨çš„ï¼Œä»¥ç›®å‰çš„è®¡ç®—æœºç®—åŠ›æƒ³è¦è§£å¯†æ˜¯ä¸å¯èƒ½çš„ï¼Œé™¤éé‡å­è®¡ç®—æœºã€‚</p>\n<h2 id=\"spring-securityé˜²ç«å¢™\"><a class=\"anchor\" href=\"#spring-securityé˜²ç«å¢™\">#</a> Spring Security é˜²ç«å¢™</h2>\n<h3 id=\"ipç™½åå•\"><a class=\"anchor\" href=\"#ipç™½åå•\">#</a> ip ç™½åå•</h3>\n<h4 id=\"æŒ‡å®šipå¯ä»¥ä¸ç™»å½•\"><a class=\"anchor\" href=\"#æŒ‡å®šipå¯ä»¥ä¸ç™»å½•\">#</a> æŒ‡å®š ip å¯ä»¥ä¸ç™»å½•</h4>\n<pre><code>\t\thttp.\n\t\t// å“ªäº› åœ°å€éœ€è¦ç™»å½•\n\t\tauthorizeRequests()\n\t\t//æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦éªŒè¯\n\t\t.anyRequest().authenticated()\n\t\t\n\t\t.antMatchers(&quot;/ip1&quot;).hasIpAddress(&quot;127.0.0.1&quot;)\n</code></pre>\n<h4 id=\"ç¦æ­¢ipè®¿é—®\"><a class=\"anchor\" href=\"#ç¦æ­¢ipè®¿é—®\">#</a> ç¦æ­¢ ip è®¿é—®</h4>\n<p>ç”¨ Filter å®ç°ã€æˆ–è€…ç”¨ HandlerInterceptor å®ç°</p>\n<h3 id=\"stricthttpfirewall\"><a class=\"anchor\" href=\"#stricthttpfirewall\">#</a> StrictHttpFirewall</h3>\n<p>spring security é»˜è®¤ä½¿ç”¨ StrictHttpFirewall é™åˆ¶ç”¨æˆ·è¯·æ±‚</p>\n<h4 id=\"method\"><a class=\"anchor\" href=\"#method\">#</a> method</h4>\n<p>ç¼ºçœè¢«å…è®¸çš„ <code>HTTP method</code>  æœ‰ [ <code>DELETE</code> ,  <code>GET</code> ,  <code>HEAD</code> ,  <code>OPTIONS</code> ,  <code>PATCH</code> ,  <code>POST</code> ,  <code>PUT</code> ]</p>\n<h4 id=\"uri\"><a class=\"anchor\" href=\"#uri\">#</a> URI</h4>\n<p><strong>åœ¨å…¶ <code>requestURI</code> / <code>contextPath</code> / <code>servletPath</code> / <code>pathInfo</code>  ä¸­ï¼Œå¿…é¡»ä¸èƒ½åŒ…å«ä»¥ä¸‹å­—ç¬¦ä¸²åºåˆ—ä¹‹ä¸€ :</strong></p>\n<pre><code>[&quot;//&quot;,&quot;./&quot;,&quot;/â€¦/&quot;,&quot;/.&quot;]\n</code></pre>\n<h4 id=\"åˆ†å·\"><a class=\"anchor\" href=\"#åˆ†å·\">#</a> åˆ†å·</h4>\n<pre><code>;æˆ–è€…%3bæˆ–è€…%3B\n// ç¦ç”¨è§„åˆ™\nsetAllowSemicolon(boolean)\n</code></pre>\n<h4 id=\"æ–œæ \"><a class=\"anchor\" href=\"#æ–œæ \">#</a> æ–œæ </h4>\n<pre><code>%2f`æˆ–è€…`%2F\n// ç¦ç”¨è§„åˆ™\nsetAllowUrlEncodedSlash(boolean)\n</code></pre>\n<h4 id=\"åæ–œæ \"><a class=\"anchor\" href=\"#åæ–œæ \">#</a> åæ–œæ </h4>\n<pre><code>\\æˆ–è€…%5cæˆ–è€…%5B\n// ç¦ç”¨è§„åˆ™\nsetAllowBackSlash(boolean)\n</code></pre>\n<h4 id=\"è‹±æ–‡å¥å·\"><a class=\"anchor\" href=\"#è‹±æ–‡å¥å·\">#</a> è‹±æ–‡å¥å·</h4>\n<pre><code>%2eæˆ–è€…%2E\n// ç¦ç”¨è§„åˆ™\nsetAllowUrlEncodedPeriod(boolean)\n</code></pre>\n<h4 id=\"ç™¾åˆ†å·\"><a class=\"anchor\" href=\"#ç™¾åˆ†å·\">#</a> ç™¾åˆ†å·</h4>\n<pre><code>%25\n// ç¦ç”¨è§„åˆ™\nsetAllowUrlEncodedPercent(boolean)\n</code></pre>\n<h4 id=\"é˜²ç«å¢™ä¸sqlæ³¨å…¥\"><a class=\"anchor\" href=\"#é˜²ç«å¢™ä¸sqlæ³¨å…¥\">#</a> é˜²ç«å¢™ä¸ sql æ³¨å…¥</h4>\n<p>' ; -- % å¤šæ•°éæ³•å­—ç¬¦å·²ç»åœ¨è¯·æ±‚çš„å‚æ•°ä¸Šè¢«ç¦ç”¨</p>\n<p>ä¸ºå•¥ç”¨æˆ·åä¸èƒ½æœ‰ç‰¹æ®Šå­—ç¬¦</p>\n<p>preparestatement</p>\n<p>awf å‰ç«¯æ‹¦æˆª</p>\n",
            "tags": [
                "Java",
                "Java",
                "è·¨åŸŸ",
                "SpringSecurity"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/SpringCloud/Apollo/",
            "url": "https://baiyezi.vip/java/SpringCloud/Apollo/",
            "title": "Apollo",
            "date_published": "2021-07-27T12:45:12.000Z",
            "content_html": "<p>Apolloï¼ˆé˜¿æ³¢ç½—ï¼‰æ˜¯æºç¨‹æ¡†æ¶éƒ¨é—¨ç ”å‘çš„åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œèƒ½å¤Ÿé›†ä¸­åŒ–ç®¡ç†åº”ç”¨ä¸åŒç¯å¢ƒã€ä¸åŒé›†ç¾¤çš„é…ç½®ï¼Œé…ç½®ä¿®æ”¹åèƒ½å¤Ÿå®æ—¶æ¨é€åˆ°åº”ç”¨ç«¯ï¼Œå¹¶ä¸”å…·å¤‡è§„èŒƒçš„æƒé™ã€æµç¨‹æ²»ç†ç­‰ç‰¹æ€§ï¼Œé€‚ç”¨äºå¾®æœåŠ¡é…ç½®ç®¡ç†åœºæ™¯ã€‚æœåŠ¡ç«¯åŸºäº Spring Boot å’Œ Spring Cloud å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–å®‰è£… Tomcat ç­‰åº”ç”¨å®¹å™¨ã€‚Java å®¢æˆ·ç«¯ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Spring/Spring Boot ç¯å¢ƒä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚.Net å®¢æˆ·ç«¯ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰.Net è¿è¡Œæ—¶ç¯å¢ƒã€‚</p>\n<p>GitHub <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N0cmlwY29ycC9hcG9sbG8=\">https://github.com/ctripcorp/apollo</span></p>\n<p>Gitee <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vbm9ib2R5aWFtL2Fwb2xsbw==\">https://gitee.com/nobodyiam/apollo</span></p>\n<h2 id=\"å®‰è£…éƒ¨ç½²\"><a class=\"anchor\" href=\"#å®‰è£…éƒ¨ç½²\">#</a> å®‰è£…éƒ¨ç½²</h2>\n<h3 id=\"ä¸‹è½½\"><a class=\"anchor\" href=\"#ä¸‹è½½\">#</a> ä¸‹è½½</h3>\n<p>ä¸‹è½½æ‰€éœ€å®‰è£…åŒ… <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N0cmlwY29ycC9hcG9sbG8vcmVsZWFzZXMvdGFnL3YxLjguMg==\">https://github.com/ctripcorp/apollo/releases/tag/v1.8.2</span></p>\n<p>æˆ‘è¿™é‡Œä¹‹å‰ä¸‹è½½è¿‡ï¼Œä½¿ç”¨ 1.7.1 ç‰ˆæœ¬</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725104113.png\" alt=\"image-20210725104112175\" /></p>\n<p>å°†ä»¥ä¸Šä¸‰ä¸ªå®‰è£…åŒ…ä¼ è¾“åˆ° linux ç›®å½•ä¸‹ï¼Œè¿™ä¸‰ä¸ªå®‰è£…åŒ…æ˜¯ä¸‰ä¸ª SpringBoot é¡¹ç›®ï¼Œåˆ†åˆ«ä»£è¡¨ Apollo çš„å‰ç«¯ç³»ç»Ÿã€åç«¯ç³»ç»Ÿã€é…ç½®ä¸­å¿ƒï¼ˆåŸºäº Eurekaï¼‰</p>\n<h3 id=\"åˆ›å»ºæ•°æ®åº“\"><a class=\"anchor\" href=\"#åˆ›å»ºæ•°æ®åº“\">#</a> åˆ›å»ºæ•°æ®åº“</h3>\n<p>æ‰§è¡Œä»¥ä¸‹ sqlï¼Œåˆ›å»ºæ•°æ®åº“ï¼ŒåŒ…å«ä¸¤ä¸ªæ•°æ®åº“ï¼Œä¸€ä¸ªæ˜¯é…ç½®ç›¸å…³ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·ç³»ç»Ÿç›¸å…³</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/*!40101 SET NAMES utf8 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># Create Database</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> ApolloConfigDB <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">Use</span> ApolloConfigDB<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># Dump of table app</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åº”ç”¨å'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">`</span>OrgId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'éƒ¨é—¨Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token punctuation\">`</span>OrgName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'éƒ¨é—¨åå­—'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token punctuation\">`</span>OwnerName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">`</span>OwnerEmail<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerEmail'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_Name<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'åº”ç”¨è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\"># Dump of table appnamespace</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceåå­—ï¼Œæ³¨æ„ï¼Œéœ€è¦å…¨å±€å”¯ä¸€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'app id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token punctuation\">`</span>Format<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'properties'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceçš„formatç±»å‹'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsPublic<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceæ˜¯å¦ä¸ºå…¬å…±'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ³¨é‡Š'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_AppId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>Name_AppId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'åº”ç”¨namespaceå®šä¹‰'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token comment\"># Dump of table audit</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Audit<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Audit<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>  <span class=\"token punctuation\">`</span>EntityName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è¡¨å'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token punctuation\">`</span>EntityId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è®°å½•ID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token punctuation\">`</span>OpName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ“ä½œç±»å‹'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å¤‡æ³¨'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'æ—¥å¿—å®¡è®¡è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token comment\"># Dump of table cluster</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre></pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>  <span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é›†ç¾¤åå­—'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'App id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>  <span class=\"token punctuation\">`</span>ParentClusterId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'çˆ¶cluster'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_AppId_Name<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_ParentClusterId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>ParentClusterId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'é›†ç¾¤'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre></pre></td></tr><tr><td data-num=\"109\"></td><td><pre></pre></td></tr><tr><td data-num=\"110\"></td><td><pre></pre></td></tr><tr><td data-num=\"111\"></td><td><pre><span class=\"token comment\"># Dump of table commit</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre></pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Commit</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Commit</span><span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>  <span class=\"token punctuation\">`</span>ChangeSets<span class=\"token punctuation\">`</span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¿®æ”¹å˜æ›´é›†'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>  <span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ClusterName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>  <span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å¤‡æ³¨'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'commit å†å²è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre></pre></td></tr><tr><td data-num=\"135\"></td><td><pre><span class=\"token comment\"># Dump of table grayreleaserule</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre></pre></td></tr><tr><td data-num=\"138\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>GrayReleaseRule<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre></pre></td></tr><tr><td data-num=\"140\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>GrayReleaseRule<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>  <span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Cluster Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>  <span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Namespace Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>  <span class=\"token punctuation\">`</span>BranchName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'branch name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>  <span class=\"token punctuation\">`</span>Rules<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">16000</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'[]'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç°åº¦è§„åˆ™'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>  <span class=\"token punctuation\">`</span>ReleaseId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç°åº¦å¯¹åº”çš„release'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>  <span class=\"token punctuation\">`</span>BranchStatus<span class=\"token punctuation\">`</span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'1'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç°åº¦åˆ†æ”¯çŠ¶æ€: 0:åˆ é™¤åˆ†æ”¯,1:æ­£åœ¨ä½¿ç”¨çš„è§„åˆ™ 2ï¼šå…¨é‡å‘å¸ƒ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_Namespace<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'ç°åº¦è§„åˆ™è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre></pre></td></tr><tr><td data-num=\"159\"></td><td><pre></pre></td></tr><tr><td data-num=\"160\"></td><td><pre><span class=\"token comment\"># Dump of table instance</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre></pre></td></tr><tr><td data-num=\"163\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Instance<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre></pre></td></tr><tr><td data-num=\"165\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Instance<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>  <span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ClusterName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataCenter<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Data Center Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>  <span class=\"token punctuation\">`</span>Ip<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'instance ip'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_UNIQUE_KEY<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>Ip<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>DataCenter<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_IP<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Ip<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'ä½¿ç”¨é…ç½®çš„åº”ç”¨å®ä¾‹'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre></pre></td></tr><tr><td data-num=\"179\"></td><td><pre></pre></td></tr><tr><td data-num=\"180\"></td><td><pre></pre></td></tr><tr><td data-num=\"181\"></td><td><pre><span class=\"token comment\"># Dump of table instanceconfig</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre></pre></td></tr><tr><td data-num=\"184\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>InstanceConfig<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre></pre></td></tr><tr><td data-num=\"186\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>InstanceConfig<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>  <span class=\"token punctuation\">`</span>InstanceId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Instance Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>  <span class=\"token punctuation\">`</span>ConfigAppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Config App Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>  <span class=\"token punctuation\">`</span>ConfigClusterName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Config Cluster Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>  <span class=\"token punctuation\">`</span>ConfigNamespaceName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Config Namespace Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>  <span class=\"token punctuation\">`</span>ReleaseKey<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å‘å¸ƒçš„Key'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>  <span class=\"token punctuation\">`</span>ReleaseDeliveryTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…ç½®è·å–æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_UNIQUE_KEY<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>InstanceId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>ConfigAppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>ConfigNamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_ReleaseKey<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>ReleaseKey<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"199\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_Valid_Namespace<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>ConfigAppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>ConfigClusterName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>ConfigNamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'åº”ç”¨å®ä¾‹çš„é…ç½®ä¿¡æ¯'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre></pre></td></tr><tr><td data-num=\"203\"></td><td><pre></pre></td></tr><tr><td data-num=\"204\"></td><td><pre></pre></td></tr><tr><td data-num=\"205\"></td><td><pre><span class=\"token comment\"># Dump of table item</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre></pre></td></tr><tr><td data-num=\"208\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Item<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre></pre></td></tr><tr><td data-num=\"210\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Item<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre>  <span class=\"token punctuation\">`</span>NamespaceId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é›†ç¾¤NamespaceId'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"213\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Key</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…ç½®é¡¹Key'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"214\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Value</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…ç½®é¡¹å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"215\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ³¨é‡Š'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"216\"></td><td><pre>  <span class=\"token punctuation\">`</span>LineNum<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è¡Œå·'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"219\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"221\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_GroupId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>NamespaceId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"224\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'é…ç½®é¡¹ç›®'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre></pre></td></tr><tr><td data-num=\"227\"></td><td><pre></pre></td></tr><tr><td data-num=\"228\"></td><td><pre></pre></td></tr><tr><td data-num=\"229\"></td><td><pre><span class=\"token comment\"># Dump of table namespace</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"231\"></td><td><pre></pre></td></tr><tr><td data-num=\"232\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Namespace<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"233\"></td><td><pre></pre></td></tr><tr><td data-num=\"234\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Namespace<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"235\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"236\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"237\"></td><td><pre>  <span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Cluster Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre>  <span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Namespace Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"239\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"240\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"241\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"242\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"245\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>AppId_ClusterName_NamespaceName<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"246\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"247\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_NamespaceName<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"248\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'å‘½åç©ºé—´'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"249\"></td><td><pre></pre></td></tr><tr><td data-num=\"250\"></td><td><pre></pre></td></tr><tr><td data-num=\"251\"></td><td><pre></pre></td></tr><tr><td data-num=\"252\"></td><td><pre><span class=\"token comment\"># Dump of table namespacelock</span></pre></td></tr><tr><td data-num=\"253\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"254\"></td><td><pre></pre></td></tr><tr><td data-num=\"255\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>NamespaceLock<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"256\"></td><td><pre></pre></td></tr><tr><td data-num=\"257\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>NamespaceLock<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"258\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"259\"></td><td><pre>  <span class=\"token punctuation\">`</span>NamespaceId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é›†ç¾¤NamespaceId'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"260\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"261\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"262\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"263\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"264\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è½¯åˆ é™¤'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"265\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"266\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_NamespaceId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>NamespaceId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"267\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"268\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'namespaceçš„ç¼–è¾‘é”'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"269\"></td><td><pre></pre></td></tr><tr><td data-num=\"270\"></td><td><pre></pre></td></tr><tr><td data-num=\"271\"></td><td><pre></pre></td></tr><tr><td data-num=\"272\"></td><td><pre><span class=\"token comment\"># Dump of table release</span></pre></td></tr><tr><td data-num=\"273\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"274\"></td><td><pre></pre></td></tr><tr><td data-num=\"275\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Release</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"276\"></td><td><pre></pre></td></tr><tr><td data-num=\"277\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Release</span><span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"278\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"279\"></td><td><pre>  <span class=\"token punctuation\">`</span>ReleaseKey<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å‘å¸ƒçš„Key'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"280\"></td><td><pre>  <span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å‘å¸ƒåå­—'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"281\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å‘å¸ƒè¯´æ˜'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"282\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"283\"></td><td><pre>  <span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ClusterName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"284\"></td><td><pre>  <span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"285\"></td><td><pre>  <span class=\"token punctuation\">`</span>Configurations<span class=\"token punctuation\">`</span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å‘å¸ƒé…ç½®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"286\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsAbandoned<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ˜¯å¦åºŸå¼ƒ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"287\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"288\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"289\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"290\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"291\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"292\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"293\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>AppId_ClusterName_GroupName<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"294\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"295\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_ReleaseKey<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>ReleaseKey<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"296\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'å‘å¸ƒ'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"297\"></td><td><pre></pre></td></tr><tr><td data-num=\"298\"></td><td><pre></pre></td></tr><tr><td data-num=\"299\"></td><td><pre><span class=\"token comment\"># Dump of table releasehistory</span></pre></td></tr><tr><td data-num=\"300\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"301\"></td><td><pre></pre></td></tr><tr><td data-num=\"302\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>ReleaseHistory<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"303\"></td><td><pre></pre></td></tr><tr><td data-num=\"304\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>ReleaseHistory<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"305\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"306\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"307\"></td><td><pre>  <span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ClusterName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"308\"></td><td><pre>  <span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"309\"></td><td><pre>  <span class=\"token punctuation\">`</span>BranchName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å‘å¸ƒåˆ†æ”¯å'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"310\"></td><td><pre>  <span class=\"token punctuation\">`</span>ReleaseId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å…³è”çš„Release Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"311\"></td><td><pre>  <span class=\"token punctuation\">`</span>PreviousReleaseId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å‰ä¸€æ¬¡å‘å¸ƒçš„ReleaseId'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"312\"></td><td><pre>  <span class=\"token punctuation\">`</span>Operation<span class=\"token punctuation\">`</span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å‘å¸ƒç±»å‹ï¼Œ0: æ™®é€šå‘å¸ƒï¼Œ1: å›æ»šï¼Œ2: ç°åº¦å‘å¸ƒï¼Œ3: ç°åº¦è§„åˆ™æ›´æ–°ï¼Œ4: ç°åº¦åˆå¹¶å›ä¸»åˆ†æ”¯å‘å¸ƒï¼Œ5: ä¸»åˆ†æ”¯å‘å¸ƒç°åº¦è‡ªåŠ¨å‘å¸ƒï¼Œ6: ä¸»åˆ†æ”¯å›æ»šç°åº¦è‡ªåŠ¨å‘å¸ƒï¼Œ7: æ”¾å¼ƒç°åº¦'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"313\"></td><td><pre>  <span class=\"token punctuation\">`</span>OperationContext<span class=\"token punctuation\">`</span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å‘å¸ƒä¸Šä¸‹æ–‡ä¿¡æ¯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"314\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"315\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"316\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"317\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"318\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"319\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"320\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_Namespace<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>BranchName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"321\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_ReleaseId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>ReleaseId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"322\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"323\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'å‘å¸ƒå†å²'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"324\"></td><td><pre></pre></td></tr><tr><td data-num=\"325\"></td><td><pre></pre></td></tr><tr><td data-num=\"326\"></td><td><pre><span class=\"token comment\"># Dump of table releasemessage</span></pre></td></tr><tr><td data-num=\"327\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"328\"></td><td><pre></pre></td></tr><tr><td data-num=\"329\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>ReleaseMessage<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"330\"></td><td><pre></pre></td></tr><tr><td data-num=\"331\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>ReleaseMessage<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"332\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"333\"></td><td><pre>  <span class=\"token punctuation\">`</span>Message<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å‘å¸ƒçš„æ¶ˆæ¯å†…å®¹'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"334\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"335\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"336\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"337\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_Message<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Message<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"338\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'å‘å¸ƒæ¶ˆæ¯'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"339\"></td><td><pre></pre></td></tr><tr><td data-num=\"340\"></td><td><pre></pre></td></tr><tr><td data-num=\"341\"></td><td><pre></pre></td></tr><tr><td data-num=\"342\"></td><td><pre><span class=\"token comment\"># Dump of table serverconfig</span></pre></td></tr><tr><td data-num=\"343\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"344\"></td><td><pre></pre></td></tr><tr><td data-num=\"345\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"346\"></td><td><pre></pre></td></tr><tr><td data-num=\"347\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"348\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"349\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Key</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…ç½®é¡¹Key'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"350\"></td><td><pre>  <span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…ç½®å¯¹åº”çš„é›†ç¾¤ï¼Œdefaultä¸ºä¸é’ˆå¯¹ç‰¹å®šçš„é›†ç¾¤'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"351\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Value</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">2048</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…ç½®é¡¹å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"352\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ³¨é‡Š'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"353\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"354\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"355\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"356\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"357\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"358\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"359\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_Key<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span><span class=\"token keyword\">Key</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"360\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"361\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'é…ç½®æœåŠ¡è‡ªèº«é…ç½®'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"362\"></td><td><pre></pre></td></tr><tr><td data-num=\"363\"></td><td><pre><span class=\"token comment\"># Dump of table accesskey</span></pre></td></tr><tr><td data-num=\"364\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"365\"></td><td><pre></pre></td></tr><tr><td data-num=\"366\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>AccessKey<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"367\"></td><td><pre></pre></td></tr><tr><td data-num=\"368\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>AccessKey<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"369\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"370\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"371\"></td><td><pre>  <span class=\"token punctuation\">`</span>Secret<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Secret'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"372\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsEnabled<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: enabled, 0: disabled'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"373\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"374\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"375\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"376\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"377\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"378\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"379\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"380\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"381\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'è®¿é—®å¯†é’¥'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"382\"></td><td><pre></pre></td></tr><tr><td data-num=\"383\"></td><td><pre><span class=\"token comment\"># Config</span></pre></td></tr><tr><td data-num=\"384\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"385\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span><span class=\"token keyword\">Key</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Value</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"386\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"387\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'eureka.service.url'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http://localhost:8080/eureka/'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'EurekaæœåŠ¡Urlï¼Œå¤šä¸ªserviceä»¥è‹±æ–‡é€—å·åˆ†éš”'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"388\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'namespace.lock.switch'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'false'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ä¸€æ¬¡å‘å¸ƒåªèƒ½æœ‰ä¸€ä¸ªäººä¿®æ”¹å¼€å…³'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"389\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'item.value.length.limit'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'20000'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'item valueæœ€å¤§é•¿åº¦é™åˆ¶'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"390\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'config-service.cache.enabled'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'false'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ConfigServiceæ˜¯å¦å¼€å¯ç¼“å­˜ï¼Œå¼€å¯åèƒ½æé«˜æ€§èƒ½ï¼Œä½†æ˜¯ä¼šå¢å¤§å†…å­˜æ¶ˆè€—ï¼'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"391\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'item.key.length.limit'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'128'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'item key æœ€å¤§é•¿åº¦é™åˆ¶'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"392\"></td><td><pre></pre></td></tr><tr><td data-num=\"393\"></td><td><pre><span class=\"token comment\"># Sample Data</span></pre></td></tr><tr><td data-num=\"394\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"395\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>OrgId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>OrgName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>OwnerName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>OwnerEmail<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"396\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"397\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Sample App'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'TEST1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ ·ä¾‹éƒ¨é—¨1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo@acme.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"398\"></td><td><pre></pre></td></tr><tr><td data-num=\"399\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Format<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>IsPublic<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"400\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"401\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token string\">'application'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'properties'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default app namespace'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"402\"></td><td><pre></pre></td></tr><tr><td data-num=\"403\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"404\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"405\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"406\"></td><td><pre></pre></td></tr><tr><td data-num=\"407\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>Namespace<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"408\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"409\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"410\"></td><td><pre></pre></td></tr><tr><td data-num=\"411\"></td><td><pre></pre></td></tr><tr><td data-num=\"412\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>Item<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>NamespaceId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Key</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Value</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>LineNum<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"413\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"414\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'timeout'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'100'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sample timeouté…ç½®'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"415\"></td><td><pre></pre></td></tr><tr><td data-num=\"416\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Release</span><span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>ReleaseKey<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Configurations<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"417\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"418\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token string\">'20161009155425-d3a0749c6e20bc15'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'20161009155424-release'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Sampleå‘å¸ƒ'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'application'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&#123;\\\"timeout\\\":\\\"100\\\"&#125;'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"419\"></td><td><pre></pre></td></tr><tr><td data-num=\"420\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>ReleaseHistory<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>BranchName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>ReleaseId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>PreviousReleaseId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Operation<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>OperationContext<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"421\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"422\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'application'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&#123;&#125;'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"423\"></td><td><pre></pre></td></tr><tr><td data-num=\"424\"></td><td><pre></pre></td></tr><tr><td data-num=\"425\"></td><td><pre><span class=\"token comment\">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"426\"></td><td><pre><span class=\"token comment\">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"427\"></td><td><pre><span class=\"token comment\">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"428\"></td><td><pre><span class=\"token comment\">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"429\"></td><td><pre><span class=\"token comment\">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"430\"></td><td><pre><span class=\"token comment\">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/*!40101 SET NAMES utf8 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># Create Database</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> ApolloPortalDB <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">Use</span> ApolloPortalDB<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># Dump of table app</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åº”ç”¨å'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">`</span>OrgId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'éƒ¨é—¨Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token punctuation\">`</span>OrgName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'éƒ¨é—¨åå­—'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token punctuation\">`</span>OwnerName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">`</span>OwnerEmail<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerEmail'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_Name<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'åº”ç”¨è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\"># Dump of table appnamespace</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceåå­—ï¼Œæ³¨æ„ï¼Œéœ€è¦å…¨å±€å”¯ä¸€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'app id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token punctuation\">`</span>Format<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'properties'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceçš„formatç±»å‹'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsPublic<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceæ˜¯å¦ä¸ºå…¬å…±'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ³¨é‡Š'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_AppId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>Name_AppId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'åº”ç”¨namespaceå®šä¹‰'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token comment\"># Dump of table consumer</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Consumer<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Consumer<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åº”ç”¨å'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token punctuation\">`</span>OrgId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'éƒ¨é—¨Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token punctuation\">`</span>OrgName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'éƒ¨é—¨åå­—'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  <span class=\"token punctuation\">`</span>OwnerName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>  <span class=\"token punctuation\">`</span>OwnerEmail<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerEmail'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'å¼€æ”¾APIæ¶ˆè´¹è€…'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre></pre></td></tr><tr><td data-num=\"89\"></td><td><pre></pre></td></tr><tr><td data-num=\"90\"></td><td><pre></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token comment\"># Dump of table consumeraudit</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre></pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>ConsumerAudit<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre></pre></td></tr><tr><td data-num=\"96\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>ConsumerAudit<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>  <span class=\"token punctuation\">`</span>ConsumerId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Consumer Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>  <span class=\"token punctuation\">`</span>Uri<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è®¿é—®çš„Uri'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>  <span class=\"token punctuation\">`</span>Method<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è®¿é—®çš„Method'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_ConsumerId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>ConsumerId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'consumerå®¡è®¡è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre></pre></td></tr><tr><td data-num=\"108\"></td><td><pre></pre></td></tr><tr><td data-num=\"109\"></td><td><pre></pre></td></tr><tr><td data-num=\"110\"></td><td><pre><span class=\"token comment\"># Dump of table consumerrole</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre></pre></td></tr><tr><td data-num=\"113\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>ConsumerRole<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>ConsumerRole<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>  <span class=\"token punctuation\">`</span>ConsumerId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Consumer Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>  <span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Role Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_RoleId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_ConsumerId_RoleId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>ConsumerId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'consumerå’Œroleçš„ç»‘å®šè¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre></pre></td></tr><tr><td data-num=\"130\"></td><td><pre></pre></td></tr><tr><td data-num=\"131\"></td><td><pre></pre></td></tr><tr><td data-num=\"132\"></td><td><pre><span class=\"token comment\"># Dump of table consumertoken</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre></pre></td></tr><tr><td data-num=\"135\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>ConsumerToken<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre></pre></td></tr><tr><td data-num=\"137\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>ConsumerToken<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>  <span class=\"token punctuation\">`</span>ConsumerId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ConsumerId'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>  <span class=\"token punctuation\">`</span>Token<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'token'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>  <span class=\"token punctuation\">`</span>Expires<span class=\"token punctuation\">`</span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'2099-01-01 00:00:00'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'tokenå¤±æ•ˆæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_Token<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Token<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'consumer tokenè¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre></pre></td></tr><tr><td data-num=\"152\"></td><td><pre><span class=\"token comment\"># Dump of table favorite</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre></pre></td></tr><tr><td data-num=\"155\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Favorite<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre></pre></td></tr><tr><td data-num=\"157\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Favorite<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ä¸»é”®'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>  <span class=\"token punctuation\">`</span>UserId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ”¶è—çš„ç”¨æˆ·'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre>  <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>  <span class=\"token punctuation\">`</span>Position<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'10000'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ”¶è—é¡ºåº'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_UserId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>UserId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token operator\">=</span><span class=\"token number\">23</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'åº”ç”¨æ”¶è—è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre></pre></td></tr><tr><td data-num=\"173\"></td><td><pre><span class=\"token comment\"># Dump of table permission</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre></pre></td></tr><tr><td data-num=\"176\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Permission<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre></pre></td></tr><tr><td data-num=\"178\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Permission<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre>  <span class=\"token punctuation\">`</span>PermissionType<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æƒé™ç±»å‹'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre>  <span class=\"token punctuation\">`</span>TargetId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æƒé™å¯¹è±¡ç±»å‹'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_TargetId_PermissionType<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>TargetId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>PermissionType<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'permissionè¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre></pre></td></tr><tr><td data-num=\"192\"></td><td><pre></pre></td></tr><tr><td data-num=\"193\"></td><td><pre></pre></td></tr><tr><td data-num=\"194\"></td><td><pre><span class=\"token comment\"># Dump of table role</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre></pre></td></tr><tr><td data-num=\"197\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Role<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre></pre></td></tr><tr><td data-num=\"199\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Role<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre>  <span class=\"token punctuation\">`</span>RoleName<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Role name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_RoleName<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>RoleName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'è§’è‰²è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre></pre></td></tr><tr><td data-num=\"212\"></td><td><pre></pre></td></tr><tr><td data-num=\"213\"></td><td><pre></pre></td></tr><tr><td data-num=\"214\"></td><td><pre><span class=\"token comment\"># Dump of table rolepermission</span></pre></td></tr><tr><td data-num=\"215\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"216\"></td><td><pre></pre></td></tr><tr><td data-num=\"217\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>RolePermission<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre></pre></td></tr><tr><td data-num=\"219\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>RolePermission<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"221\"></td><td><pre>  <span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Role Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre>  <span class=\"token punctuation\">`</span>PermissionId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Permission Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"224\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"227\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"228\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"229\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_RoleId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"231\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_PermissionId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>PermissionId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"232\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'è§’è‰²å’Œæƒé™çš„ç»‘å®šè¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"233\"></td><td><pre></pre></td></tr><tr><td data-num=\"234\"></td><td><pre></pre></td></tr><tr><td data-num=\"235\"></td><td><pre></pre></td></tr><tr><td data-num=\"236\"></td><td><pre><span class=\"token comment\"># Dump of table serverconfig</span></pre></td></tr><tr><td data-num=\"237\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre></pre></td></tr><tr><td data-num=\"239\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"240\"></td><td><pre></pre></td></tr><tr><td data-num=\"241\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"242\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Key</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…ç½®é¡¹Key'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Value</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">2048</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é…ç½®é¡¹å€¼'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"245\"></td><td><pre>  <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ³¨é‡Š'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"246\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"247\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"248\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"249\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"250\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"251\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"252\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_Key<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span><span class=\"token keyword\">Key</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"253\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"254\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'é…ç½®æœåŠ¡è‡ªèº«é…ç½®'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"255\"></td><td><pre></pre></td></tr><tr><td data-num=\"256\"></td><td><pre></pre></td></tr><tr><td data-num=\"257\"></td><td><pre></pre></td></tr><tr><td data-num=\"258\"></td><td><pre><span class=\"token comment\"># Dump of table userrole</span></pre></td></tr><tr><td data-num=\"259\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"260\"></td><td><pre></pre></td></tr><tr><td data-num=\"261\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>UserRole<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"262\"></td><td><pre></pre></td></tr><tr><td data-num=\"263\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>UserRole<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"264\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"265\"></td><td><pre>  <span class=\"token punctuation\">`</span>UserId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç”¨æˆ·èº«ä»½æ ‡è¯†'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"266\"></td><td><pre>  <span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Role Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"267\"></td><td><pre>  <span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"268\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºäººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"269\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'åˆ›å»ºæ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"270\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹äººé‚®ç®±å‰ç¼€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"271\"></td><td><pre>  <span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æœ€åä¿®æ”¹æ—¶é—´'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"272\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"273\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"274\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_RoleId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"275\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">`</span>IX_UserId_RoleId<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>UserId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"276\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'ç”¨æˆ·å’Œroleçš„ç»‘å®šè¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"277\"></td><td><pre></pre></td></tr><tr><td data-num=\"278\"></td><td><pre><span class=\"token comment\"># Dump of table Users</span></pre></td></tr><tr><td data-num=\"279\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"280\"></td><td><pre></pre></td></tr><tr><td data-num=\"281\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Users<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"282\"></td><td><pre></pre></td></tr><tr><td data-num=\"283\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Users<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"284\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"285\"></td><td><pre>  <span class=\"token punctuation\">`</span>Username<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç”¨æˆ·å'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"286\"></td><td><pre>  <span class=\"token punctuation\">`</span>Password<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'å¯†ç '</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"287\"></td><td><pre>  <span class=\"token punctuation\">`</span>Email<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'é‚®ç®±åœ°å€'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"288\"></td><td><pre>  <span class=\"token punctuation\">`</span>Enabled<span class=\"token punctuation\">`</span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'æ˜¯å¦æœ‰æ•ˆ'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"289\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"290\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'ç”¨æˆ·è¡¨'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"291\"></td><td><pre></pre></td></tr><tr><td data-num=\"292\"></td><td><pre></pre></td></tr><tr><td data-num=\"293\"></td><td><pre><span class=\"token comment\"># Dump of table Authorities</span></pre></td></tr><tr><td data-num=\"294\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"295\"></td><td><pre></pre></td></tr><tr><td data-num=\"296\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token punctuation\">`</span>Authorities<span class=\"token punctuation\">`</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"297\"></td><td><pre></pre></td></tr><tr><td data-num=\"298\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>Authorities<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"299\"></td><td><pre>  <span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'è‡ªå¢Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"300\"></td><td><pre>  <span class=\"token punctuation\">`</span>Username<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"301\"></td><td><pre>  <span class=\"token punctuation\">`</span>Authority<span class=\"token punctuation\">`</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"302\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"303\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"304\"></td><td><pre></pre></td></tr><tr><td data-num=\"305\"></td><td><pre></pre></td></tr><tr><td data-num=\"306\"></td><td><pre><span class=\"token comment\"># Config</span></pre></td></tr><tr><td data-num=\"307\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"308\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span><span class=\"token keyword\">Key</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Value</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"309\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"310\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'apollo.portal.envs'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'dev'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'å¯æ”¯æŒçš„ç¯å¢ƒåˆ—è¡¨'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"311\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'organizations'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'[&#123;\\\"orgId\\\":\\\"TEST1\\\",\\\"orgName\\\":\\\"æ ·ä¾‹éƒ¨é—¨1\\\"&#125;,&#123;\\\"orgId\\\":\\\"TEST2\\\",\\\"orgName\\\":\\\"æ ·ä¾‹éƒ¨é—¨2\\\"&#125;]'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'éƒ¨é—¨åˆ—è¡¨'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"312\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'superAdmin'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Portalè¶…çº§ç®¡ç†å‘˜'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"313\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'api.readTimeout'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'10000'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'httpæ¥å£read timeout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"314\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'consumer.token.salt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'someSalt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'consumer token salt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"315\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'admin.createPrivateNamespace.switch'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ˜¯å¦å…è®¸é¡¹ç›®ç®¡ç†å‘˜åˆ›å»ºç§æœ‰namespace'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"316\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'configView.memberOnly.envs'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'dev'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'åªå¯¹é¡¹ç›®æˆå‘˜æ˜¾ç¤ºé…ç½®ä¿¡æ¯çš„ç¯å¢ƒåˆ—è¡¨ï¼Œå¤šä¸ªenvä»¥è‹±æ–‡é€—å·åˆ†éš”'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"317\"></td><td><pre></pre></td></tr><tr><td data-num=\"318\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>Users<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Username<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Password<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Email<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Enabled<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"319\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"320\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$2a$10$7r20uS.BQ9uBpf3Baj3uQOZvMVvB1RN3PYoKE94gtz2.WAOuiiwXS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo@acme.com'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"321\"></td><td><pre></pre></td></tr><tr><td data-num=\"322\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>Authorities<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Username<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Authority<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ROLE_user'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"323\"></td><td><pre></pre></td></tr><tr><td data-num=\"324\"></td><td><pre><span class=\"token comment\"># Sample Data</span></pre></td></tr><tr><td data-num=\"325\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"326\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>OrgId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>OrgName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>OwnerName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>OwnerEmail<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"327\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"328\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Sample App'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'TEST1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'æ ·ä¾‹éƒ¨é—¨1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo@acme.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"329\"></td><td><pre></pre></td></tr><tr><td data-num=\"330\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>Format<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>IsPublic<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span><span class=\"token keyword\">Comment</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"331\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"332\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token string\">'application'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'properties'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default app namespace'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"333\"></td><td><pre></pre></td></tr><tr><td data-num=\"334\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>Permission<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>PermissionType<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>TargetId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"335\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"336\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CreateCluster'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"337\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CreateNamespace'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"338\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'AssignRole'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"339\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ModifyNamespace'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp+application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"340\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ReleaseNamespace'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp+application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"341\"></td><td><pre></pre></td></tr><tr><td data-num=\"342\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>Role<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>RoleName<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"343\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"344\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Master+SampleApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"345\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ModifyNamespace+SampleApp+application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"346\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ReleaseNamespace+SampleApp+application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"347\"></td><td><pre></pre></td></tr><tr><td data-num=\"348\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>RolePermission<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>PermissionId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"349\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"350\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"351\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"352\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"353\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"354\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"355\"></td><td><pre></pre></td></tr><tr><td data-num=\"356\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>UserRole<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>UserId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"357\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"358\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"359\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"360\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"361\"></td><td><pre></pre></td></tr><tr><td data-num=\"362\"></td><td><pre><span class=\"token comment\">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"363\"></td><td><pre><span class=\"token comment\">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"364\"></td><td><pre><span class=\"token comment\">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"365\"></td><td><pre><span class=\"token comment\">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"366\"></td><td><pre><span class=\"token comment\">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"367\"></td><td><pre><span class=\"token comment\">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"ä¿®æ”¹å®‰è£…åŒ…ä¸­é…ç½®\"><a class=\"anchor\" href=\"#ä¿®æ”¹å®‰è£…åŒ…ä¸­é…ç½®\">#</a> ä¿®æ”¹å®‰è£…åŒ…ä¸­é…ç½®</h3>\n<p>apollo-configservice-1.7.1-github/config/application-github.propertiesï¼Œä¿®æ”¹ä¸ºè‡ªå·±çš„æ•°æ®åº“åœ°å€</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># DataSource</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">spring.datasource.url</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">jdbc:mysql://192.168.137.128:3306/ApolloConfigDB?characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">spring.datasource.username</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">root</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token attr-name\">spring.datasource.password</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">123456</span></pre></td></tr></table></figure><p>apollo-adminservice-1.7.1-github/config/application-github.properties</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># DataSource</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">spring.datasource.url</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">jdbc:mysql://192.168.137.128:3306/ApolloConfigDB?characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">spring.datasource.username</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">root</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token attr-name\">spring.datasource.password</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">123456</span></pre></td></tr></table></figure><p>apollo-portal-1.7.1-github/config/application-github.properties</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># DataSource</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">spring.datasource.url</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">jdbc:mysql://192.168.137.128:3306/ApolloPortalDB?characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">spring.datasource.username</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">root</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token attr-name\">spring.datasource.password</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">123456</span></pre></td></tr></table></figure><p>apollo-portal-1.7.1-github/config/apollo-env.properties</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">local.meta</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">http://localhost:8080</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">dev.meta</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">http://localhost:8080</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#fat.meta=http://fill-in-fat-meta-server:8080</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#uat.meta=http://fill-in-uat-meta-server:8080</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#lpt.meta=$&#123;lpt_meta&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#pro.meta=http://fill-in-pro-meta-server:8080</span></pre></td></tr></table></figure><h3 id=\"å¯åŠ¨é¡¹ç›®\"><a class=\"anchor\" href=\"#å¯åŠ¨é¡¹ç›®\">#</a> å¯åŠ¨é¡¹ç›®</h3>\n<p>åˆ†åˆ«æŒ‰ç…§é¡ºå¯»å¯åŠ¨ configserviceã€adminserviceã€portal é¡¹ç›®ï¼ˆåœ¨å¯¹åº”ç›®å½•ä¸‹æœ‰ jarï¼‰</p>\n<p>å¯åŠ¨é¡¹ç›®æŠ¥é”™ï¼š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>at com.mysql.cj.protocol.a.NativeAuthenticationProvider.proceedHandshakeWithPluggableAuthentication<span class=\"token punctuation\">(</span>NativeAuthenticationProvider.java:486<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tat com.mysql.cj.protocol.a.NativeAuthenticationProvider.connect<span class=\"token punctuation\">(</span>NativeAuthenticationProvider.java:202<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tat com.mysql.cj.protocol.a.NativeProtocol.connect<span class=\"token punctuation\">(</span>NativeProtocol.java:1452<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tat com.mysql.cj.NativeSession.connect<span class=\"token punctuation\">(</span>NativeSession.java:165<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tat com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly<span class=\"token punctuation\">(</span>ConnectionImpl.java:955<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tat com.mysql.cj.jdbc.ConnectionImpl.createNewIO<span class=\"token punctuation\">(</span>ConnectionImpl.java:825<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token punctuation\">..</span>. <span class=\"token number\">158</span> common frames omitted</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Caused by: javax.net.ssl.SSLHandshakeException: No appropriate protocol <span class=\"token punctuation\">(</span>protocol is disabled or cipher suites are inappropriate<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tat sun.security.ssl.HandshakeContext.<span class=\"token operator\">&lt;</span>init<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>HandshakeContext.java:171<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tat sun.security.ssl.ClientHandshakeContext.<span class=\"token operator\">&lt;</span>init<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>ClientHandshakeContext.java:98<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tat sun.security.ssl.TransportContext.kickstart<span class=\"token punctuation\">(</span>TransportContext.java:220<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tat sun.security.ssl.SSLSocketImpl.startHandshake<span class=\"token punctuation\">(</span>SSLSocketImpl.java:387<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tat com.mysql.cj.protocol.ExportControlled.performTlsHandshake<span class=\"token punctuation\">(</span>ExportControlled.java:316<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tat com.mysql.cj.protocol.StandardSocketFactory.performTlsHandshake<span class=\"token punctuation\">(</span>StandardSocketFactory.java:188<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tat com.mysql.cj.protocol.a.NativeSocketConnection.performTlsHandshake<span class=\"token punctuation\">(</span>NativeSocketConnection.java:99<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tat com.mysql.cj.protocol.a.NativeProtocol.negotiateSSLConnection<span class=\"token punctuation\">(</span>NativeProtocol.java:352<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token punctuation\">..</span>. <span class=\"token number\">165</span> common frames omitted</pre></td></tr></table></figure><p>åœ¨ mysql è¿æ¥åé¢åŠ ä¸Š useSSL=false</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">spring.datasource.url</span> <span class=\"token punctuation\">=</span> <span class=\"token attr-value\">jdbc:mysql://192.168.137.128:3306/ApolloConfigDB?characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai&amp;useSSL=false</span></pre></td></tr></table></figure><p>ä¸‰ä¸ªé¡¹ç›®å¯åŠ¨åï¼Œè®¿é—®</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725184147.png\" alt=\"image-20210725184144586\" /></p>\n<p>ç”¨æˆ·åï¼šapolloï¼Œå¯†ç ï¼šadmin</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725184330.png\" alt=\"image-20210725184328198\" /></p>\n<h2 id=\"apolloçš„ä½¿ç”¨\"><a class=\"anchor\" href=\"#apolloçš„ä½¿ç”¨\">#</a> Apollo çš„ä½¿ç”¨</h2>\n<h3 id=\"æ–°å»ºé¡¹ç›®\"><a class=\"anchor\" href=\"#æ–°å»ºé¡¹ç›®\">#</a> æ–°å»ºé¡¹ç›®</h3>\n<p>æ–°å»º SpringBoot é¡¹ç›®ï¼Œå¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.ctrip.framework.apollo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>apollo-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.7.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># å¦‚æœæ˜¯åœ¨ yml ä¸­ï¼Œåˆ™å¯åŠ¨é¡¹ç›®æ—¶ 001 ä¼šè¢«è¯†åˆ«ä¸º 1ï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦ä»¥ 0 å¼€å¤´</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">app.id</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">001</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">spring.application.name</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">provider</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#configservice åœ°å€</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token attr-name\">apollo.meta</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">http://192.168.137.128:8080</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token attr-name\">apollo.bootstrap.enabled</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#é…ç½®åˆ†ç»„</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token attr-name\">apollo.bootstrap.namespaces</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">application</span></pre></td></tr></table></figure><p>åœ¨å®¢æˆ·ç«¯åˆ›å»ºé¡¹ç›®é…ç½®</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725190816.png\" alt=\"image-20210725190538073\" /></p>\n<p>æ³¨æ„ï¼šappId éœ€è¦å’Œé…ç½®æ–‡ä»¶ä¸­ä¿æŒä¸€è‡´</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725191255.png\" alt=\"image-20210725190741116\" /></p>\n<p>æ–°å¢é…ç½®å¹¶å‘å¸ƒ</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725191513.png\" alt=\"image-20210725191512035\" /></p>\n<p>å¯åŠ¨åˆšæ‰æ–°å»ºçš„é¡¹ç›®ï¼Œéœ€è¦åŠ å¯åŠ¨å‚æ•° -Denv=ENV</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725191736.png\" alt=\"image-20210725191734964\" /></p>\n<p>è®¿é—® <span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgwLyVFRiVCQyU4QyVFNSU4RiVBRiVFNCVCQiVBNSVFNyU5QyU4QiVFNSU4OCVCMCVFNiU4OCU5MCVFNSU4QSU5RiVFOCVBRiVCQiVFNSU4OCVCMCVFNCVCQSU4NiVFNSU4OCU5QSVFNiU4OSU4RCVFNSU4RiU5MSVFNSVCOCU4MyVFNyU5QSU4NCVFOSU4NSU4RCVFNyVCRCVBRSVFMyU4MCU4MiVFNSVCOSVCNiVFNCVCOCU5NCVFNiU5QiVCNCVFNiU5NCVCOSVFOSU4NSU4RCVFNyVCRCVBRSVFNSU5MCU4RSVFNSU4RiVBRiVFNCVCQiVBNSVFNSVBRSU5RSVFNiU5NyVCNiVFOCVBRiVCQiVFNSU4RiU5NiVFNSU4OCVCMCVFMyU4MCU4Mg==\">http://localhost:8080/ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸè¯»åˆ°äº†åˆšæ‰å‘å¸ƒçš„é…ç½®ã€‚å¹¶ä¸”æ›´æ”¹é…ç½®åå¯ä»¥å®æ—¶è¯»å–åˆ°ã€‚</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725191825.png\" alt=\"image-20210725191822959\" /></p>\n<h3 id=\"é…ç½®äº‹ä»¶ç›‘å¬\"><a class=\"anchor\" href=\"#é…ç½®äº‹ä»¶ç›‘å¬\">#</a> é…ç½®äº‹ä»¶ç›‘å¬</h3>\n<p>é•¿è½®è¯¢ç›‘å¬é…ç½®çš„æ›´æ”¹ï¼Œé»˜è®¤ 60 ç§’ï¼Œæ¯éš” 60 ç§’è¿”å› 304ï¼Œä¹‹åé‡æ–°è½®è¯¢</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>config</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>ctrip<span class=\"token punctuation\">.</span>framework<span class=\"token punctuation\">.</span>apollo<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Config</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>ctrip<span class=\"token punctuation\">.</span>framework<span class=\"token punctuation\">.</span>apollo<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConfigService</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>ctrip<span class=\"token punctuation\">.</span>framework<span class=\"token punctuation\">.</span>apollo<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConfigChange</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * apollo é…ç½®äº‹ä»¶ç›‘å¬</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Description:</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Author: Fan</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @Date: 2021/7/25 19:28</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token annotation punctuation\">@Configuration</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApolloConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">Config</span> appConfig <span class=\"token operator\">=</span> <span class=\"token class-name\">ConfigService</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAppConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        appConfig<span class=\"token punctuation\">.</span><span class=\"token function\">addChangeListener</span><span class=\"token punctuation\">(</span>configChangeEvent <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Changes for namespace \"</span> <span class=\"token operator\">+</span> configChangeEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getNamespace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> key <span class=\"token operator\">:</span> configChangeEvent<span class=\"token punctuation\">.</span><span class=\"token function\">changedKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token class-name\">ConfigChange</span> change <span class=\"token operator\">=</span> configChangeEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getChange</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Found change - key: %s, oldValue: %s, newValue: %s, changeType: %s\"</span><span class=\"token punctuation\">,</span> change<span class=\"token punctuation\">.</span><span class=\"token function\">getPropertyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> change<span class=\"token punctuation\">.</span><span class=\"token function\">getOldValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> change<span class=\"token punctuation\">.</span><span class=\"token function\">getNewValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> change<span class=\"token punctuation\">.</span><span class=\"token function\">getChangeType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æµ‹è¯•ä¿®æ”¹é…ç½®ï¼Œæ§åˆ¶å°æ‰“å°</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725193714.png\" alt=\"image-20210725193713082\" /></p>\n<h2 id=\"ç¼“å­˜\"><a class=\"anchor\" href=\"#ç¼“å­˜\">#</a> ç¼“å­˜</h2>\n<p>é…ç½®ä¼šç¼“å­˜åœ¨æœ¬åœ°</p>\n<pre><code class=\"language-cmd\">Linuxä¸‹ï¼š\n/opt/data/&#123;appId&#125;/config-cache \nWindowsä¸‹ï¼š\nC:\\opt\\data&#123;appId&#125;\\config-cache\n</code></pre>\n<h2 id=\"å¯†é’¥é…ç½®\"><a class=\"anchor\" href=\"#å¯†é’¥é…ç½®\">#</a> å¯†é’¥é…ç½®</h2>\n<p>åŸºäº SpringSecurity</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#å¯†é’¥é…ç½®</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">apollo.accesskey.secret</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">4ae81e9a8b7c4bdc9ca8aaa47e34009c</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725194459.png\" alt=\"image-20210725194457864\" /></p>\n<h2 id=\"ç°åº¦å‘å¸ƒ\"><a class=\"anchor\" href=\"#ç°åº¦å‘å¸ƒ\">#</a> ç°åº¦å‘å¸ƒ</h2>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725200125.png\" alt=\"image-20210725200123848\" /></p>\n<p>ç°åº¦è§„åˆ™ï¼Œå¯ä»¥åŸºäº IPï¼Œå¯¹æŒ‡å®š IP çš„æœåŠ¡è¿›è¡Œç°åº¦å‘å¸ƒ</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725200213.png\" alt=\"image-20210725200212243\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725200428.png\" alt=\"image-20210725200427138\" /></p>\n<h2 id=\"namespace\"><a class=\"anchor\" href=\"#namespace\">#</a> Namespace</h2>\n<p>å½“é¡¹ç›®æ¯”è¾ƒå¤§æ—¶ï¼Œå¯ä»¥å¯¹é…ç½®è¿›è¡Œåˆ†ç»„</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725200839.png\" alt=\"image-20210725200836727\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210725200903.png\" alt=\"image-20210725200902488\" /></p>\n",
            "tags": [
                "Java",
                "å¾®æœåŠ¡",
                "Java",
                "é…ç½®ä¸­å¿ƒ",
                "SpringCloud",
                "å¾®æœåŠ¡",
                "Apollo"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/SpringCloud/SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB/",
            "url": "https://baiyezi.vip/java/SpringCloud/SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB/",
            "title": "SpringCloud-SpringCloudä½“ç³»",
            "date_published": "2021-07-25T10:12:25.000Z",
            "content_html": "<h2 id=\"springcloud-admin\"><a class=\"anchor\" href=\"#springcloud-admin\">#</a> SpringCloud Admin</h2>\n<h3 id=\"adminæœåŠ¡ç«¯\"><a class=\"anchor\" href=\"#adminæœåŠ¡ç«¯\">#</a> Admin æœåŠ¡ç«¯</h3>\n<p>æ–°å»ºä¸€ä¸ª SpringBoo é¡¹ç›®å¹¶å¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- Admin æœåŠ¡ --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>de.codecentric<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-admin-starter-server<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.4.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">&lt;!-- Admin ç•Œé¢ --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>de.codecentric<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-admin-server-ui<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.4.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>åœ¨å¯åŠ¨ç±»åŠ ä¸Šæ³¨è§£ï¼š@EnableAdminServer</p>\n<p>å¯åŠ¨é¡¹ç›®è®¿é—®åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgwLw==\">http://localhost:8080/</span></p>\n<p><img data-src=\"SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB.assets/20210517213028.png\" alt=\"image-20210517213026493\" /></p>\n<h3 id=\"adminå¾®æœåŠ¡ç«¯\"><a class=\"anchor\" href=\"#adminå¾®æœåŠ¡ç«¯\">#</a> Admin å¾®æœåŠ¡ç«¯</h3>\n<p>åŠ å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- Admin æœåŠ¡ --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      \t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>de.codecentric<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-admin-starter-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.4.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      \t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-actuator<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>åŠ å…¥é…ç½®</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">management.endpoints.web.exposure.include</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">*</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">management.endpoint.health.show-details</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">always</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">spring.boot.admin.client.url</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">http://localhost:8080</span></pre></td></tr></table></figure><p>å¯åŠ¨å¾®æœåŠ¡é¡¹ç›®ï¼Œ<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgwLw==\">http://localhost:8080/</span> ç•Œé¢è‡ªåŠ¨åˆ·æ–°ï¼Œæ˜¾ç¤ºå·²ç»æ¥å…¥çš„æœåŠ¡ä¿¡æ¯</p>\n<p><img data-src=\"SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB.assets/20210517220300.png\" alt=\"image-20210517220205334\" /></p>\n<h3 id=\"é‚®ä»¶é€šçŸ¥\"><a class=\"anchor\" href=\"#é‚®ä»¶é€šçŸ¥\">#</a> é‚®ä»¶é€šçŸ¥</h3>\n<p>åœ¨ Admin æœåŠ¡ç«¯åŠ å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- é‚®ä»¶é€šçŸ¥ --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-mail<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>åŠ å…¥é…ç½®</p>\n<pre><code class=\"language-pro\">#é‚®ä»¶è®¾ç½®\nspring.mail.host=smtp.qq.com\nspring.mail.username=1966659927\nspring.mail.password=fdxatuzmzbeqceba\nspring.mail.properties.mail.smpt.auth=true\nspring.mail.properties.mail.smpt.starttls.enable=true\nspring.mail.properties.mail.smpt.starttls.required=true\n\n#æ”¶ä»¶é‚®ç®±\nspring.boot.admin.notify.mail.to=yuan199696@qq.com\n# å‘ä»¶é‚®ç®±éœ€è¦å’Œä»¥ä¸Šé…ç½®é¡¹spring.mail.usernameçš„å€¼ç›¸åŒ\nspring.boot.admin.notify.mail.from=yuan199696@qq.com\n</code></pre>\n<p>åœ¨ qq é‚®ç®±è®¾ç½® - è´¦æˆ·ä¸­å¼€å¯ POP3/SMTP æœåŠ¡å¹¶è·å–åˆ°æˆæƒç ï¼Œå¡«å…¥é…ç½®é¡¹ spring.mail.password ä¸­</p>\n<p>é‡æ–°å¯åŠ¨æœåŠ¡ç«¯é¡¹ç›®ï¼Œæ­¤æ—¶å°†ä¸€ä¸ªå·²ç»æ³¨å†Œåœ¨ Admin çš„å¾®æœåŠ¡å…³æ‰ï¼ŒæŸ¥çœ‹é‚®ä»¶</p>\n<p><img data-src=\"SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB.assets/20210517225407.png\" alt=\"image-20210517225402475\" /></p>\n<h3 id=\"é’‰é’‰ç¾¤é€šçŸ¥\"><a class=\"anchor\" href=\"#é’‰é’‰ç¾¤é€šçŸ¥\">#</a> é’‰é’‰ç¾¤é€šçŸ¥</h3>\n<p>ä»¥ä¸‹æ“ä½œå‡åœ¨ Admin æœåŠ¡ç«¯</p>\n<p>åˆ›å»ºé€šçŸ¥ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>dingding</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>fastjson<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JSONObject</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">de<span class=\"token punctuation\">.</span>codecentric<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>admin<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>entities<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Instance</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">de<span class=\"token punctuation\">.</span>codecentric<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>admin<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>entities<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InstanceRepository</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">de<span class=\"token punctuation\">.</span>codecentric<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>admin<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>events<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InstanceEvent</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">de<span class=\"token punctuation\">.</span>codecentric<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>admin<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>notify<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AbstractStatusChangeNotifier</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">reactor<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>publisher<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Mono</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Map</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Description: é€šçŸ¥ç±»</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @Author: Fan</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @Date: 2021/5/17 23:01</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DingDingNotifier</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractStatusChangeNotifier</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DingDingNotifier</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InstanceRepository</span> repository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>repository<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Mono</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">doNotify</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InstanceEvent</span> event<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Instance</span> instance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">String</span> serviceName <span class=\"token operator\">=</span> instance<span class=\"token punctuation\">.</span><span class=\"token function\">getRegistration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">String</span> serviceUrl <span class=\"token operator\">=</span> instance<span class=\"token punctuation\">.</span><span class=\"token function\">getRegistration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getServiceUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">String</span> status <span class=\"token operator\">=</span> instance<span class=\"token punctuation\">.</span><span class=\"token function\">getStatusInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> details <span class=\"token operator\">=</span> instance<span class=\"token punctuation\">.</span><span class=\"token function\">getStatusInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token class-name\">StringBuilder</span> str <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        str<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æœåŠ¡é¢„è­¦ : ã€\"</span> <span class=\"token operator\">+</span> serviceName <span class=\"token operator\">+</span> <span class=\"token string\">\"ã€‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// ä¸é’‰é’‰æœºå™¨äººçš„å…³é”®è¯è¦å¯¹åº”</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        str<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ã€æœåŠ¡åœ°å€ã€‘\"</span> <span class=\"token operator\">+</span> serviceUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        str<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ã€çŠ¶æ€ã€‘\"</span> <span class=\"token operator\">+</span> status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        str<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ã€è¯¦æƒ…ã€‘\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">JSONObject</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span>details<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Mono</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromRunnable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token class-name\">DingDingMessageUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">sendTextMessage</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å‘é€å·¥å…·ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>dingding</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>fastjson<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JSONObject</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InputStream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">OutputStream</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpURLConnection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span>URL<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @Description: å‘é€å·¥å…·ç±»</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Author: Fan</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Date: 2021/5/17 23:05</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DingDingMessageUtil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// é’‰é’‰ç¾¤æœºå™¨äººçš„ token</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> access_token <span class=\"token operator\">=</span> <span class=\"token string\">\"Token\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendTextMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token class-name\">Message</span> message <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            message<span class=\"token punctuation\">.</span><span class=\"token function\">setMsgtype</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            message<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageInfo</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token class-name\">URL</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token function\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://oapi.dingtalk.com/robot/send?access_token=\"</span> <span class=\"token operator\">+</span> access_token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token comment\">// å»ºç«‹ http è¿æ¥</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token class-name\">HttpURLConnection</span> conn <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpURLConnection</span><span class=\"token punctuation\">)</span> url<span class=\"token punctuation\">.</span><span class=\"token function\">openConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            conn<span class=\"token punctuation\">.</span><span class=\"token function\">setDoOutput</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            conn<span class=\"token punctuation\">.</span><span class=\"token function\">setDoInput</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            conn<span class=\"token punctuation\">.</span><span class=\"token function\">setUseCaches</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            conn<span class=\"token punctuation\">.</span><span class=\"token function\">setRequestMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            conn<span class=\"token punctuation\">.</span><span class=\"token function\">setRequestProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Charset\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            conn<span class=\"token punctuation\">.</span><span class=\"token function\">setRequestProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"application/Json; charset=UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            conn<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token class-name\">OutputStream</span> out <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token class-name\">String</span> textMessage <span class=\"token operator\">=</span> <span class=\"token class-name\">JSONObject</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> data <span class=\"token operator\">=</span> textMessage<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            out<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            out<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            out<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token class-name\">InputStream</span> in <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> data1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span>in<span class=\"token punctuation\">.</span><span class=\"token function\">available</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            in<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>data1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>data1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ¶ˆæ¯ç±»</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>dingding</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Description: æ¶ˆæ¯ç±»</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Author: Fan</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Date: 2021/5/17 23:06</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Message</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> msgtype<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">MessageInfo</span> text<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getMsgtype</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> msgtype<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setMsgtype</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> msgtype<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>msgtype <span class=\"token operator\">=</span> msgtype<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MessageInfo</span> <span class=\"token function\">getText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">return</span> text<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setText</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageInfo</span> text<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> text<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>dingding</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Description:</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @Author: Fan</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * @Date: 2021/5/17 23:07</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MessageInfo</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MessageInfo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> content<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>content <span class=\"token operator\">=</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> content<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>content <span class=\"token operator\">=</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨ç±»ä¸­åŠ å…¥</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">DingDingNotifier</span> <span class=\"token function\">dingDingNotifier</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InstanceRepository</span> repository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DingDingNotifier</span><span class=\"token punctuation\">(</span>repository<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨ Admin æœåŠ¡ç«¯é¡¹ç›®ï¼Œå…³æ‰ä¸€ä¸ªå·²ç»åœ¨ Admin ä¸­æ³¨å†Œçš„å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹é’‰é’‰ç¾¤çš„é€šçŸ¥</p>\n<h2 id=\"é…ç½®ä¸­å¿ƒ\"><a class=\"anchor\" href=\"#é…ç½®ä¸­å¿ƒ\">#</a> é…ç½®ä¸­å¿ƒ</h2>\n<h3 id=\"æœåŠ¡ç«¯\"><a class=\"anchor\" href=\"#æœåŠ¡ç«¯\">#</a> æœåŠ¡ç«¯</h3>\n<p>æ–°å»ºä¸€ä¸ªå…¬æœ‰çš„ git ä»“åº“å¹¶ä¸Šä¼ ä¸€ä¸ª properties (æˆ– yamlã€json æ–‡ä»¶) é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶å‘½åè§„åˆ™</p>\n<pre><code class=\"language-cmd\">è·å–é…ç½®è§„åˆ™ï¼šæ ¹æ®å‰ç¼€åŒ¹é…\n/&#123;name&#125;-&#123;profiles&#125;.properties\n/&#123;name&#125;-&#123;profiles&#125;.yml\n/&#123;name&#125;-&#123;profiles&#125;.json\n/&#123;label&#125;/&#123;name&#125;-&#123;profiles&#125;.yml\n\nname æœåŠ¡åç§°\nprofile ç¯å¢ƒåç§°ï¼Œå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼šdev test prd\nlable ä»“åº“åˆ†æ”¯ã€é»˜è®¤masteråˆ†æ”¯\n</code></pre>\n<p><img data-src=\"SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB.assets/image-20210518182553027.png\" alt=\"image-20210518182553027\" /></p>\n<p>provider-dev.properties</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">eureka.client.service-url.defaultZone</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">http://euk1.com:7001/eureka/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">86</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#server.port=87</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token attr-name\">spring.application.name</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">user-provider</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#zipkin çš„ UI åœ°å€</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token attr-name\">spring.zipkin.base-url</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">http://localhost:9411</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#é‡‡æ ·æ¯”ä¾‹</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token attr-name\">spring.sleuth.sampler.rate</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">1</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#admin å¥åº·ä¸ŠæŠ¥</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token attr-name\">management.endpoints.web.exposure.include</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">*</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token attr-name\">management.endpoint.health.show-details</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">always</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token attr-name\">spring.boot.admin.client.url</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">http://localhost:8080</span></pre></td></tr></table></figure><p>æ–°å»ºä¸€ä¸ª SpringBoot é¡¹ç›®ï¼Œå¼•å…¥ä¾èµ– config-serverã€eureka-clientã€actuator</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-config-server<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-netflix-eureka-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-actuator<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å¯åŠ¨ç±»åŠ æ³¨è§£ @EnableConfigServer</p>\n<p>åŠ å…¥é…ç½®æ–‡ä»¶</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">76</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#git ä»“åº“åœ°å€</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">spring.cloud.config.server.git.uri</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">https://gitee.com/bfanfanfan/config-center.git</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#å­˜æ”¾é…ç½®æ–‡ä»¶çš„åˆ†æ”¯</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token attr-name\">spring.cloud.config.label</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">master</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token attr-name\">eureka.client.service-url.defaultZone</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">http://euk1.com:7001/eureka/</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token attr-name\">spring.application.name</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">config-center</span></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®ï¼Œè¿›è¡Œæµ‹è¯•ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo3Ni9tYXN0ZXIvcHJvdmlkZXItZGV2LnByb3BlcnRpZXM=\">http://localhost:76/master/provider-dev.properties</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210518113558469.png\" alt=\"image-20210518113558469\" /></p>\n<h3 id=\"å®¢æˆ·ç«¯\"><a class=\"anchor\" href=\"#å®¢æˆ·ç«¯\">#</a> å®¢æˆ·ç«¯</h3>\n<p>æ–°å»ºä¸€ä¸ª SpringBoot é¡¹ç›®ï¼Œå¼•å…¥ä¾èµ– config-clientã€eurekaã€client</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-config<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-netflix-eureka-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>åœ¨ git ä»“åº“æ–°å»ºä¸€ä¸ªåˆ†æ”¯ testï¼Œå¹¶åˆ›å»ºé…ç½®æ–‡ä»¶ config-client-dev.propertiesï¼Œå†…å®¹ä¸º</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">name</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">hello</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210518210934.png\" alt=\"image-20210518210933017\" /></p>\n<p>é…ç½®æ–‡ä»¶ï¼šbootstrap.properties ï¼ˆæ³¨æ„å‘½åä¸€å®šè¦æ˜¯ bootstrapï¼Œè¿™æ˜¯çº¦å®šï¼‰</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">9999</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">spring.application.name</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">config-client</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">eureka.client.service-url.defaultZone</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">http://euk1.com:7001/eureka/</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#ç›´æ¥ URL æ–¹å¼æŸ¥æ‰¾é…ç½®ä¸­å¿ƒ</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token attr-name\">spring.cloud.config.uri</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">http://localhost:76/</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#é€šè¿‡æ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#spring.cloud.config.discovery.enabled=true</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#spring.cloud.config.discovery.service-id=config-center</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#å¯¹åº” git ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶å‘½å config-client-dev.propertiesï¼Œå³ &#123;æœåŠ¡å&#125;-&#123;profile&#125;.properties, æœåŠ¡åå°±æ˜¯ spring.application.name çš„å€¼ï¼Œprofile å¯ä»¥æ˜¯ devã€testã€prod ç­‰</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token attr-name\">spring.cloud.config.profile</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">dev</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#ä»“åº“åˆ†æ”¯</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token attr-name\">spring.cloud.config.label</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">test</span></pre></td></tr></table></figure><p>controller</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>controller</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Value</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GetMapping</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RestController</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @DateTime: 2021-05-18 14:06</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;name&#125;\"</span><span class=\"token punctuation\">)</span><span class=\"token comment\">// è¦è®¿é—®çš„ git ä»“åº“ä¸­é…ç½®æ–‡ä»¶ä¸­çš„ name å±æ€§çš„å€¼ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰è¯¥å±æ€§ï¼Œé‚£ä¹ˆå°†æŠ¥é”™</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">return</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®æŠ¥é”™ï¼š</p>\n<pre><code class=\"language-cmd\">15:27:05.390 [main] DEBUG org.springframework.boot.diagnostics.LoggingFailureAnalysisReporter - Application failed to start due to an exception\norg.springframework.cloud.config.client.ConfigServerConfigDataMissingEnvironmentPostProcessor$ImportException: No spring.config.import set\n\tat org.springframework.cloud.config.client.ConfigServerConfigDataMissingEnvironmentPostProcessor.postProcessEnvironment(ConfigServerConfigDataMissingEnvironmentPostProcessor.java:60)\n\tat org.springframework.boot.env.EnvironmentPostProcessorApplicationListener.onApplicationEnvironmentPreparedEvent(EnvironmentPostProcessorApplicationListener.java:100)\n\tat org.springframework.boot.env.EnvironmentPostProcessorApplicationListener.onApplicationEvent(EnvironmentPostProcessorApplicationListener.java:86)\n\tat org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener(SimpleApplicationEventMulticaster.java:176)\n\tat org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener(SimpleApplicationEventMulticaster.java:169)\n\tat org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:143)\n\tat org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:131)\n\tat org.springframework.boot.context.event.EventPublishingRunListener.environmentPrepared(EventPublishingRunListener.java:82)\n\tat org.springframework.boot.SpringApplicationRunListeners.lambda$environmentPrepared$2(SpringApplicationRunListeners.java:63)\n\tat java.util.ArrayList.forEach(ArrayList.java:1257)\n\tat org.springframework.boot.SpringApplicationRunListeners.doWithListeners(SpringApplicationRunListeners.java:117)\n\tat org.springframework.boot.SpringApplicationRunListeners.doWithListeners(SpringApplicationRunListeners.java:111)\n\tat org.springframework.boot.SpringApplicationRunListeners.environmentPrepared(SpringApplicationRunListeners.java:62)\n\tat org.springframework.boot.SpringApplication.prepareEnvironment(SpringApplication.java:375)\n\tat org.springframework.boot.SpringApplication.run(SpringApplication.java:333)\n\tat org.springframework.boot.SpringApplication.run(SpringApplication.java:1340)\n\tat org.springframework.boot.SpringApplication.run(SpringApplication.java:1329)\n\tat com.fan.ConfigCenterClientApplication.main(ConfigCenterClientApplication.java:10)\n15:27:05.396 [main] ERROR org.springframework.boot.diagnostics.LoggingFailureAnalysisReporter - \n\n***************************\nAPPLICATION FAILED TO START\n***************************\n\nDescription:\n\nNo spring.config.import property has been defined\n\nAction:\n\nAdd a spring.config.import=configserver: property to your configuration.\n\tIf configuration is not required add spring.config.import=optional:configserver: instead.\n\tTo disable this check, set spring.cloud.config.enabled=false or \n\tspring.cloud.config.import-check.enabled=false.\n\n</code></pre>\n<p>åŸå› ï¼šspringcloud2020 ç‰ˆæœ¬ æŠŠ Bootstrap è¢«é»˜è®¤ç¦ç”¨ï¼ŒåŒæ—¶ spring.config.import åŠ å…¥äº†å¯¹è§£å¯†çš„æ”¯æŒã€‚å¯¹äº Config Clientã€Consulã€Vault å’Œ Zookeeper çš„é…ç½®å¯¼å…¥ï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨åŸæ¥çš„é…ç½®å¼•å¯¼åŠŸèƒ½ï¼Œé‚£ä¹ˆéœ€è¦å°† org.springframework.cloud:spring-cloud-starter-bootstrap ä¾èµ–å¼•å…¥åˆ°å·¥ç¨‹ä¸­</p>\n<p>è§£å†³ï¼šåŠ å…¥ä¾èµ–ã€‚è¿™ä¸ªé—®é¢˜æ˜¯ç”±äºæ”¹åä¸º bootstrap.properties é€ æˆçš„</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-bootstrap<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å†æ¬¡å¯åŠ¨é¡¹ç›®åæ²¡æŠ¥é”™ï¼Œä½†æ˜¯æ— æ³•å¯åŠ¨ï¼š</p>\n<pre><code class=\"language-cmd\">2021-05-18 18:21:20.980  INFO 20612 --- [extShutdownHook] com.netflix.discovery.DiscoveryClient    : Shutting down DiscoveryClient ...\n2021-05-18 18:21:21.091  INFO 20612 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_CONFIG-CLIENT/localhost:config-client:77 - registration status: 204\n2021-05-18 18:21:21.091  INFO 20612 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_CONFIG-CLIENT/localhost:config-client:77: registering service...\n2021-05-18 18:21:21.113  INFO 20612 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_CONFIG-CLIENT/localhost:config-client:77 - registration status: 204\n2021-05-18 18:21:21.116  INFO 20612 --- [extShutdownHook] com.netflix.discovery.DiscoveryClient    : Unregistering ...\n2021-05-18 18:21:21.121  INFO 20612 --- [extShutdownHook] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_CONFIG-CLIENT/localhost:config-client:77 - deregister  status: 200\n2021-05-18 18:21:21.128  INFO 20612 --- [extShutdownHook] com.netflix.discovery.DiscoveryClient    : Completed shut down of DiscoveryClient\n\n</code></pre>\n<p>è§£å†³ï¼šåŠ å…¥ springboot-web ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å†æ¬¡å¯åŠ¨é¡¹ç›®è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo5OTk5Lw==\">http://localhost:9999/</span></p>\n<p><img data-src=\"SpringCloud-SpringCloud%E4%BD%93%E7%B3%BB.assets/image-20210518211033308.png\" alt=\"image-20210518211033308\" /></p>\n<p>æ€»ç»“ï¼šé…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯éœ€è¦å¼•å…¥çš„ä¾èµ–æœ‰</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-config<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-netflix-eureka-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-bootstrap<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h3 id=\"æ‰‹åŠ¨åˆ·æ–°é…ç½®\"><a class=\"anchor\" href=\"#æ‰‹åŠ¨åˆ·æ–°é…ç½®\">#</a> æ‰‹åŠ¨åˆ·æ–°é…ç½®</h3>\n<p>å½“ git ä»“åº“ä¸­é…ç½®æ–‡ä»¶æ›´æ”¹åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸é‡å¯å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹è·å–åˆ°æœ€æ–°çš„é…ç½®</p>\n<ol>\n<li>\n<p>æ·»åŠ ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-actuator<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>controller ä¸ŠåŠ ä¸Šæ³¨è§£ @RefreshScope</p>\n</li>\n<li>\n<p>æ·»åŠ é…ç½®</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#å¼€æ”¾ actuator æ‰€æœ‰è·¯å¾„</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">management.endpoints.web.exposure.include</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">*</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#å¯ä»¥ç»™ actuator é‡æ–°å¼€ä¸€ä¸ªç«¯å£</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#management.server.port=8081</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#management.endpoints.jmx.exposure.include=*</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#management.endpoint.health.show-details=always</span></pre></td></tr></table></figure></li>\n<li>\n<p>å‘å®¢æˆ·ç«¯ url <span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo5OTk5L2FjdHVhdG9yL3JlZnJlc2g=\">http://localhost:9999/actuator/refresh</span> å‘é€ post è¯·æ±‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210518221832.png\" alt=\"image-20210518221830833\" /></p>\n</li>\n<li>\n<p>ä¹‹åæ›´æ”¹ git ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ä¸é‡å¯å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹è®¿é—® <span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo5OTk5\">http://localhost:9999</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210518221925.png\" alt=\"image-20210518221924222\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210518221848.png\" alt=\"image-20210518221847189\" /></p>\n</li>\n</ol>\n<h3 id=\"è‡ªåŠ¨åˆ·æ–°é…ç½®\"><a class=\"anchor\" href=\"#è‡ªåŠ¨åˆ·æ–°é…ç½®\">#</a> è‡ªåŠ¨åˆ·æ–°é…ç½®</h3>\n<ol>\n<li>\n<p>å®‰è£… erlangï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5lcmxhbmcub3JnL2Rvd25sb2Fkcw==\">http://www.erlang.org/downloads</span></p>\n<p>å®‰è£…å®Œæˆä¹‹åå°† erlang é…ç½®åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œç„¶ååœ¨ cmd ä¸­è¾“å…¥ <code>erl</code>  éªŒè¯</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210520214603.png\" alt=\"image-20210520214600658\" /></p>\n</li>\n<li>\n<p>å®‰è£… RabbitMQï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5yYWJiaXRtcS5jb20vaW5zdGFsbC13aW5kb3dzLmh0bWw=\">http://www.rabbitmq.com/install-windows.html</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210520215020.png\" alt=\"image-20210520215018525\" /></p>\n<p>å®‰è£…å®Œæˆä¹‹ååœ¨ cmd ä¸­è¿›å…¥åˆ°å®‰è£…ç›®å½•çš„ sbin ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹ä¸¤æ¡å‘½ä»¤</p>\n<pre><code class=\"language-cmd\"># å¼€å¯RabbitMQèŠ‚ç‚¹\nrabbitmqctl start_app\n# å¼€å¯RabbitMQç®¡ç†æ¨¡å—çš„æ’ä»¶ï¼Œå¹¶é…ç½®åˆ°RabbitMQèŠ‚ç‚¹ä¸Š\nrabbitmq-plugins enable rabbitmq_management\n</code></pre>\n<pre><code class=\"language-cmd\">D:\\soft\\rabbitmq_server-3.8.16\\sbin&gt;rabbitmq-plugins enable rabbitmq_management\nEnabling plugins on node rabbit@LAPTOP-2IM3RNAC:\nrabbitmq_management\nThe following plugins have been configured:\n  rabbitmq_management\n  rabbitmq_management_agent\n  rabbitmq_web_dispatch\nApplying plugin configuration to rabbit@LAPTOP-2IM3RNAC...\nThe following plugins have been enabled:\n  rabbitmq_management\n  rabbitmq_management_agent\n  rabbitmq_web_dispatch\n\nstarted 3 plugins.\n</code></pre>\n<p>è®¿é—®å…¶ç®¡ç†ç•Œé¢ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDoxNTY3Mg==\">http://localhost:15672</span>ï¼Œç”¨æˆ·åã€å¯†ç å‡ä¸º guest</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210521205128.png\" alt=\"image-20210521205121900\" /></p>\n</li>\n<li>\n<p>åœ¨éœ€è¦æ¥å…¥è‡ªåŠ¨åˆ·æ–°é…ç½®çš„æœåŠ¡ä¸­åŠ å…¥ä¾èµ–ä»¥åŠé…ç½®</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-bus-amqp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">spring.rabbitmq.host</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">localhost</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token attr-name\">spring.rabbitmq.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">5672</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">spring.rabbitmq.username</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">guest</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token attr-name\">spring.rabbitmq.password</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">guest</span></pre></td></tr></table></figure><p>æ­¤æ—¶å¯åŠ¨åŠ å…¥è¯¥ä¾èµ–ä»¥åŠé…ç½®çš„æœåŠ¡ï¼Œè®¿é—®å…¶ actuator èŠ‚ç‚¹ï¼š<img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210520222659.png\" alt=\"image-20210520222656780\" /></p>\n<p>å¯ä»¥å‘ç°ï¼Œç›¸æ¯”æœåŠ¡åŸæ¥çš„ actuator èŠ‚ç‚¹å¤šäº†å¸¦æœ‰ bus çš„èŠ‚ç‚¹ï¼Œè®°ä¸‹è¯¥èŠ‚ç‚¹ï¼Œä¸€ä¼šéœ€è¦å¯¹è¯¥èŠ‚ç‚¹å‘é€è¯·æ±‚</p>\n</li>\n<li>\n<p>æµ‹è¯•</p>\n<p>å¯åŠ¨ä¸¤ä¸ªå¾®æœåŠ¡ï¼ˆéœ€è¦åŠ å…¥ç¬¬ä¸‰æ­¥çš„ä¾èµ–ä»¥åŠé…ç½®ï¼‰ï¼Œæ›´æ”¹ git ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œç°åœ¨åœ¨ä¸é‡å¯ä¸¤ä¸ªå¾®æœåŠ¡çš„æƒ…å†µä¸‹è·å– git ä»“åº“ä¸­çš„æ›´æ”¹åçš„é…ç½®æ–‡ä»¶ï¼Œå…·ä½“åšæ³•å¦‚ä¸‹ï¼š</p>\n<p>git ä»“åº“é…ç½®æ–‡ä»¶æ›´æ”¹å‰ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210521205600.png\" alt=\"image-20210521205558506\" /></p>\n<p>æ›´æ”¹ git ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210521205445.png\" alt=\"image-20210521205444314\" /></p>\n<p>æ­¤æ—¶é€šè¿‡å¾®æœåŠ¡è®¿é—®é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°è®¿é—®çš„è¿˜æ˜¯ git ä»“åº“ä¸­æ—§çš„é…ç½®æ–‡ä»¶ä¿¡æ¯</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210521205742.png\" alt=\"image-20210521205741414\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210521205801.png\" alt=\"image-20210521205800297\" /></p>\n<p>æ¥ä¸‹æ¥ä»¥ post æ–¹å¼è®¿é—®å…¶ä¸­ä¸€ä¸ªå¾®æœåŠ¡çš„ actuator èŠ‚ç‚¹ä¸­çš„ busrefresh èŠ‚ç‚¹ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo5OTk5L2FjdHVhdG9yL2J1c3JlZnJlc2glRUYlQkMlOEMlRTYlODglOTElRTglQkYlOTklRTklODclOEMlRTQlQkQlQkYlRTclOTQlQThJREVBJUU4JTg3JUFBJUU1JUI4JUE2JUU3JTlBJTg0SHR0cA==\">http://localhost:9999/actuator/busrefreshï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ IDEA è‡ªå¸¦çš„ Http</span> Client å·¥å…·æ¥å‘é€</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210521210210.png\" alt=\"image-20210521210208136\" /></p>\n<p>ä¹‹åæŸ¥çœ‹ä¸¤ä¸ªå¾®æœåŠ¡è·å–åˆ°çš„ git ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶æ˜¯å¦ä¸ºæœ€æ–°çš„é…ç½®æ–‡ä»¶ï¼š</p>\n</li>\n</ol>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210521210233.png\" alt=\"image-20210521210232292\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210521210256.png\" alt=\"image-20210521210253581\" /></p>\n<p>å½“ç„¶ä¹Ÿå¯ä»¥å°† RibbitMQ é…ç½®åœ¨é…ç½®ä¸­å¿ƒä¸­ï¼ŒåŒæ ·æ˜¯åŠ å…¥ç¬¬ä¸‰æ­¥çš„ä¾èµ–ä»¥åŠé…ç½®ï¼Œæ³¨æ„åŒæ—¶ä¸è¦å¿˜è®°æ‰“å¼€æ‰€æœ‰ actuator èŠ‚ç‚¹ ï¼Œä¸ºæ­¤éœ€è¦åŠ å…¥é…ç½®</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">management.endpoints.web.exposure.include</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">*</span></pre></td></tr></table></figure><p>ç„¶åä»¥ post æ–¹å¼è®¿é—®é…ç½®ä¸­å¿ƒçš„ actuator èŠ‚ç‚¹ä¸­çš„ busrefresh èŠ‚ç‚¹ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo3Ni9hY3R1YXRvci9idXNyZWZyZXNoJUVGJUJDJThDJUU0JUI5JThCJUU1JTkwJThFJUU0JUJFJUJGJUU1JThGJUFGJUU0JUJCJUE1JUU3JTlDJThCJUU1JTg4JUIwJUU2JTg5JTgwJUU2JTlDJTg5JUU1JUI3JUIyJUU3JUJCJThGJUU2JUIzJUE4JUU1JTg2JThDJUU1JTlDJUE4JUU5JTg1JThEJUU3JUJEJUFFJUU0JUI4JUFEJUU1JUJGJTgzJUU3JTlBJTg0JUU1JUJFJUFFJUU2JTlDJThEJUU1JThBJUExJUU3JTlBJTg0JUU5JTg1JThEJUU3JUJEJUFFJUU2JTk2JTg3JUU0JUJCJUI2JUU5JTgzJUJEJUU1JThGJUFGJUU0JUJCJUE1JUU0JUI4JThFJUU4JUJGJTlDJUU3JUE4JThCZ2l0JUU0JUJCJTkzJUU1JUJBJTkzJUU0JUI4JUFEJUU3JTlBJTg0JUU5JTg1JThEJUU3JUJEJUFFJUU2JTk2JTg3JUU0JUJCJUI2JUU1JTkwJThDJUU2JUFEJUE1JUU2JTlCJUI0JUU2JTk2JUIwJUUzJTgwJTgy\">http://localhost:76/actuator/busrefreshï¼Œä¹‹åä¾¿å¯ä»¥çœ‹åˆ°æ‰€æœ‰å·²ç»æ³¨å†Œåœ¨é…ç½®ä¸­å¿ƒçš„å¾®æœåŠ¡çš„é…ç½®æ–‡ä»¶éƒ½å¯ä»¥ä¸è¿œç¨‹ git ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶åŒæ­¥æ›´æ–°ã€‚</span></p>\n<h2 id=\"springcloud-gateway\"><a class=\"anchor\" href=\"#springcloud-gateway\">#</a> SpringCloud Gateway</h2>\n<p>ç›®å‰ä¸»æµç½‘å…³æœ‰ï¼šZuul1.xï¼ˆåŸºäº Servletï¼‰ã€Zuul2.xï¼ˆåŸºäº Servletã€Nettyï¼‰ã€SpringCloud Gatewayï¼ˆåŸºäº Nettyï¼‰ã€Nginx+luaï¼ˆOpenrestyã€Kongï¼‰ã€‚</p>\n<p>ç½‘å…³æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œæ˜¯è®¿é—®å†…éƒ¨ç³»ç»Ÿçš„å”¯ä¸€å…¥å£ï¼Œæä¾›å†…éƒ¨æœåŠ¡çš„è·¯ç”±ä¸­è½¬ï¼Œé¢å¤–è¿˜å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæä¾›å¦‚é‰´æƒã€ç›‘æ§ã€è´Ÿè½½å‡è¡¡ã€é™æµã€é™çº§ä¸åº”ç”¨æ£€æµ‹ç­‰åŠŸèƒ½ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/micro-service-arc.jpg\" alt=\"\" /></p>\n<h3 id=\"spring-cloud-gateway-ä¸-zuul-å¯¹æ¯”\"><a class=\"anchor\" href=\"#spring-cloud-gateway-ä¸-zuul-å¯¹æ¯”\">#</a> Spring Cloud Gateway ä¸ Zuul å¯¹æ¯”</h3>\n<h4 id=\"zuul1xä¸zuul2x\"><a class=\"anchor\" href=\"#zuul1xä¸zuul2x\">#</a> zuul1.x ä¸ zuul2.x</h4>\n<p>Zuul 1.x åŸºäºåŒæ­¥ IO</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20200911151036538.png\" alt=\"image-20200911151036538\" /></p>\n<p>zuul2.x</p>\n<p>åŸºäºå¼‚æ­¥ io</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/v2-0c6981a1060decadf5d0537f0d5aedcb_r.jpg\" alt=\"image-20200911153215567\" /></p>\n<p>zuul1.x å¯¹æ¯” zuul2.x æ€§èƒ½æå‡</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/16c50806geslim.jpg\" alt=\"img\" /></p>\n<h4 id=\"zuul-ä¸gatewayå¯¹æ¯”\"><a class=\"anchor\" href=\"#zuul-ä¸gatewayå¯¹æ¯”\">#</a> zuul ä¸ Gateway å¯¹æ¯”</h4>\n<h3 id=\"æ–­è¨€-predicates\"><a class=\"anchor\" href=\"#æ–­è¨€-predicates\">#</a> æ–­è¨€ predicates</h3>\n<p>å¤šä¸ªæ–­è¨€å¯ä»¥é…åˆä½¿ç”¨</p>\n<h4 id=\"pathæ–­è¨€\"><a class=\"anchor\" href=\"#pathæ–­è¨€\">#</a> path æ–­è¨€</h4>\n<pre><code>        predicates:\n        - Path=/mg/**\n</code></pre>\n<h4 id=\"queryæ–­è¨€\"><a class=\"anchor\" href=\"#queryæ–­è¨€\">#</a> Query æ–­è¨€</h4>\n<p>å‚æ•°å€¼å¯ä»¥å†™æ­£åˆ™ï¼Œä¹Ÿå¯ä»¥åªå†™å‚æ•°å</p>\n<pre><code>        predicates:\n        - Query=foo,ba.\n</code></pre>\n<h4 id=\"methodæ–­è¨€\"><a class=\"anchor\" href=\"#methodæ–­è¨€\">#</a> Method æ–­è¨€</h4>\n<pre><code>        predicates:\n        - Method=get\n</code></pre>\n<h4 id=\"hostæ–­è¨€\"><a class=\"anchor\" href=\"#hostæ–­è¨€\">#</a> Host æ–­è¨€</h4>\n<pre><code>  predicates:\n        - Host=mashibing.com\n</code></pre>\n<h4 id=\"cookieæ–­è¨€\"><a class=\"anchor\" href=\"#cookieæ–­è¨€\">#</a> Cookie æ–­è¨€</h4>\n<pre><code>        predicates:\n        - Cookie=name,yiming\n</code></pre>\n<h3 id=\"åŸºæœ¬è·¯ç”±\"><a class=\"anchor\" href=\"#åŸºæœ¬è·¯ç”±\">#</a> åŸºæœ¬è·¯ç”±</h3>\n<h4 id=\"ä¾èµ–\"><a class=\"anchor\" href=\"#ä¾èµ–\">#</a> ä¾èµ–</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-gateway<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h4 id=\"é…ç½®æ–‡ä»¶\"><a class=\"anchor\" href=\"#é…ç½®æ–‡ä»¶\">#</a> é…ç½®æ–‡ä»¶</h4>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> xxooroute</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#          è¯·æ±‚ä¸­è½¬åˆ°è¯¥ uri</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#          ä»¥ä¸Š uri è·¯å¾„åé¢éœ€è¦åŠ ä¸Šä»¥ä¸‹æ–­è¨€è·¯å¾„</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/api/gateway/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#            å‚æ•°ï¼Œå‚æ•°é•¿åº¦ï¼ˆå¯ä»¥ä½¿ç”¨æ­£åˆ™ï¼‰</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">-</span> Query=id<span class=\"token punctuation\">,</span>.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#          è¯·æ±‚è½¬å‘æ—¶å»é™¤ä¸Šé¢çš„æ–­è¨€çº§æ•°</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">-</span> StripPrefix=2</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> test1</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#            è½¬å‘åˆ°å…·ä½“çš„ä¸»æœº</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#            - Host:fan.com</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#            è¯·æ±‚æ–¹å¼</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token punctuation\">-</span> Method=get</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#            cookieï¼šnameï¼Œvalue</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Cookie</span><span class=\"token punctuation\">:</span> name<span class=\"token punctuation\">,</span>fan</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token punctuation\">-</span> StripPrefix=2</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr></table></figure><h3 id=\"æ•´åˆeureka\"><a class=\"anchor\" href=\"#æ•´åˆeureka\">#</a> æ•´åˆ Eureka</h3>\n<p>åœ¨ç½‘å…³çš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ eureka é…ç½®ï¼Œå¹¶å¼•å…¥ eureka å®¢æˆ·ç«¯çš„ä¾èµ–</p>\n<h4 id=\"ä¾èµ–-2\"><a class=\"anchor\" href=\"#ä¾èµ–-2\">#</a> ä¾èµ–</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-gateway<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">&lt;!-- æ•´åˆ eureka--></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-netflix-eureka-client<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h4 id=\"é…ç½®\"><a class=\"anchor\" href=\"#é…ç½®\">#</a> é…ç½®</h4>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#      å°†æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡å…¨éƒ¨æ¥å›æ¥å¹¶æ˜ å°„åˆ°ä»¥ä¸‹ routes è§„åˆ™ä¸­</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">locator</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token comment\">#      routes:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#        - id: xxooroute</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">##          è¯·æ±‚ä¸­è½¬åˆ°è¯¥ uri</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#          uri: http://localhost:8080</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">##          ä»¥ä¸Š uri è·¯å¾„åé¢éœ€è¦åŠ ä¸Šä»¥ä¸‹æ–­è¨€è·¯å¾„</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#          predicates:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#            - Path=/api/gateway/**</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">##            å‚æ•°ï¼Œå‚æ•°é•¿åº¦ï¼ˆå¯ä»¥ä½¿ç”¨æ­£åˆ™ï¼‰</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#            - Query=id,.</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">##          è¯·æ±‚è½¬å‘æ—¶å»é™¤ä¸Šé¢çš„æ–­è¨€çº§æ•°</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#          filters:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#            - StripPrefix=2</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#        - id: test1</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#          uri: http://localhost:8080</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#          predicates:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">##            è½¬å‘åˆ°å…·ä½“çš„ä¸»æœº</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">##            - Host:fan.com</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">##            è¯·æ±‚æ–¹å¼</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#            - Method=get</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">##            cookieï¼šnameï¼Œvalue</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#            - Cookie: name,fan</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#          filters:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#            - StripPrefix=2</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> gateway</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\"># æ•´åˆ eureka</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//euk1.com<span class=\"token punctuation\">:</span>7002/eureka/</pre></td></tr></table></figure><p>è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC8lRTYlOUMlOEQlRTUlOEElQTElRTUlOTAlOEQvJUU0JUI4JTlBJUU1JThBJUEx\">http://localhost/ æœåŠ¡å / ä¸šåŠ¡</span></p>\n<h4 id=\"è´Ÿè½½å‡è¡¡\"><a class=\"anchor\" href=\"#è´Ÿè½½å‡è¡¡\">#</a> è´Ÿè½½å‡è¡¡</h4>\n<p>gateway é»˜è®¤è‡ªåŠ¨è¿›è¡Œè´Ÿè½½å‡è¡¡</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#      å°†æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡å…¨éƒ¨æ¥å›æ¥å¹¶æ˜ å°„åˆ°ä»¥ä¸‹ routes è§„åˆ™ä¸­</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">locator</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> mdb</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/mangodb/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#            æ³¨æ„æ­¤æ—¶åè®®æ˜¯ lb,MDB ä»£è¡¨æœåŠ¡å</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//MDB</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>              <span class=\"token punctuation\">-</span> StripPrefix=1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token comment\">#      routes:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#        - id: xxooroute</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">##          è¯·æ±‚ä¸­è½¬åˆ°è¯¥ uri</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#          uri: http://localhost:8080</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">##          ä»¥ä¸Š uri è·¯å¾„åé¢éœ€è¦åŠ ä¸Šä»¥ä¸‹æ–­è¨€è·¯å¾„</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#          predicates:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#            - Path=/api/gateway/**</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">##            å‚æ•°ï¼Œå‚æ•°é•¿åº¦ï¼ˆå¯ä»¥ä½¿ç”¨æ­£åˆ™ï¼‰</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#            - Query=id,.</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">##          è¯·æ±‚è½¬å‘æ—¶å»é™¤ä¸Šé¢çš„æ–­è¨€çº§æ•°</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#          filters:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#            - StripPrefix=2</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#        - id: test1</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#          uri: http://localhost:8080</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#          predicates:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">##            è½¬å‘åˆ°å…·ä½“çš„ä¸»æœº</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">##            - Host:fan.com</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">##            è¯·æ±‚æ–¹å¼</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">#            - Method=get</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">##            cookieï¼šnameï¼Œvalue</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#            - Cookie: name,fan</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#          filters:</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#            - StripPrefix=2</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> gateway</pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token key atrule\">eureka</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token key atrule\">client</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token key atrule\">service-url</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token key atrule\">defaultZone</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//euk1.com<span class=\"token punctuation\">:</span>7002/eureka/</pre></td></tr></table></figure><h4 id=\"è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡\">#</a> è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡</h4>\n<h5 id=\"é…ç½®-2\"><a class=\"anchor\" href=\"#é…ç½®-2\">#</a> é…ç½®</h5>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">MDB</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">ribbon</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">NFLoadBalancerRuleClassName</span><span class=\"token punctuation\">:</span> com.fan.admin.MyRule</pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>rule</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>netflix<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IClientConfig</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>netflix<span class=\"token punctuation\">.</span>loadbalancer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AbstractLoadBalancerRule</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>netflix<span class=\"token punctuation\">.</span>loadbalancer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Server</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyRule</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractLoadBalancerRule</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Server</span> <span class=\"token function\">choose</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token comment\">// TODO Auto-generated method stub</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Server</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLoadBalancer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getReachableServers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token comment\">// å„ç§é€»è¾‘ï½ï½ï½ï½</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xxoo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initWithNiwsConfig</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IClientConfig</span> clientConfig<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token comment\">// TODO Auto-generated method stub</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"è‡ªå®šä¹‰è·¯ç”±\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰è·¯ç”±\">#</a> è‡ªå®šä¹‰è·¯ç”±</h3>\n<p>ä¼˜å…ˆçº§é«˜äº yml é…ç½®ä¸­çš„è·¯ç”±è§„åˆ™ï¼Œå¦‚æœç›¸åŒåˆ™è¦†ç›–</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">RouteLocator</span> routeLocator <span class=\"token punctuation\">(</span><span class=\"token class-name\">RouteLocatorBuilder</span> locatorBuilder<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> locatorBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">routes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">route</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">-></span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t\t\tp<span class=\"token punctuation\">.</span><span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/xxoo\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">filters</span><span class=\"token punctuation\">(</span>f <span class=\"token operator\">-></span> f<span class=\"token punctuation\">.</span><span class=\"token function\">stripPrefix</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                       <span class=\"token comment\">// è·¯ç”±åˆ°åç«¯çš„åœ°å€ï¼ˆä¸­è½¬åœ°å€ï¼‰</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">uri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://fan.com\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t\t\t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">route</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">-></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t\tp<span class=\"token punctuation\">.</span><span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/go\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">filters</span><span class=\"token punctuation\">(</span>f <span class=\"token operator\">-></span> f<span class=\"token punctuation\">.</span><span class=\"token function\">stripPrefix</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                     <span class=\"token comment\">// å†…éƒ¨æœåŠ¡</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">uri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lb://MDB\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t\t\t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"è‡ªå®šä¹‰è¿‡æ»¤å™¨\"><a class=\"anchor\" href=\"#è‡ªå®šä¹‰è¿‡æ»¤å™¨\">#</a> è‡ªå®šä¹‰è¿‡æ»¤å™¨</h3>\n<p>Gateway ä¸­æœ‰ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨ï¼Œå¯ä»¥å®ç°å®šå‘æµé‡åˆ†å‘ã€é™æµã€é‰´æƒã€ç¼“å­˜ç­‰</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>filter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>gateway<span class=\"token punctuation\">.</span>filter<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GatewayFilterChain</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>gateway<span class=\"token punctuation\">.</span>filter<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GlobalFilter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Ordered</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataBuffer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>reactive<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerHttpRequest</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Component</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MultiValueMap</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerWebExchange</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">reactor<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>publisher<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Mono</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyFilter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Ordered</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">GlobalFilter</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Mono</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerWebExchange</span> exchange<span class=\"token punctuation\">,</span> <span class=\"token class-name\">GatewayFilterChain</span> chain<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t<span class=\"token class-name\">ServerHttpRequest</span> request <span class=\"token operator\">=</span> exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token class-name\">MultiValueMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> queryParams <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getQueryParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> queryParams<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token operator\">==</span> list <span class=\"token operator\">||</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token comment\">// éæ³•è¯·æ±‚</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯·æ±‚ä¸é€šè¿‡ï¼\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t</pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">//\t\t\texchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">//\t\t\treturn exchange.getResponse().setComplete();</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t<span class=\"token class-name\">DataBuffer</span> dataBuffer <span class=\"token operator\">=</span> exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">bufferFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è¯·æ±‚ä¸é€šè¿‡!\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\texchange<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span>UNAUTHORIZED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token comment\">// Mono ä¸å®šé•¿åºåˆ—</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t<span class=\"token keyword\">return</span> exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">writeWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Mono</span><span class=\"token punctuation\">.</span><span class=\"token function\">just</span><span class=\"token punctuation\">(</span>dataBuffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t<span class=\"token comment\">// å°†è¿”å›ç»“æœä¼ é€’åˆ°ä¸‹ä¸€ä¸ª filter</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> chain<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token comment\">// è¿‡æ»¤å™¨ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šå¤§</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t<span class=\"token comment\">// TODO Auto-generated method stub</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"é‰´æƒ\"><a class=\"anchor\" href=\"#é‰´æƒ\">#</a> é‰´æƒ</h3>\n<p>åœ¨ filter ä¸­æ•´åˆ SpringSecurity å®ç°</p>\n<h3 id=\"è·¯ç”±\"><a class=\"anchor\" href=\"#è·¯ç”±\">#</a> è·¯ç”±</h3>\n<h4 id=\"åŸºäºwebfluxçš„è·¯ç”±\"><a class=\"anchor\" href=\"#åŸºäºwebfluxçš„è·¯ç”±\">#</a> åŸºäº Webflux çš„è·¯ç”±</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     * åŸºäº webflux çš„è·¯ç”±</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RouterFunction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ServerResponse</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">routerFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">RouterFunction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ServerResponse</span><span class=\"token punctuation\">></span></span> route <span class=\"token operator\">=</span> <span class=\"token class-name\">RouterFunctions</span><span class=\"token punctuation\">.</span><span class=\"token function\">route</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token class-name\">RequestPredicates</span><span class=\"token punctuation\">.</span><span class=\"token function\">path</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/003\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                req <span class=\"token operator\">-></span> <span class=\"token class-name\">ServerResponse</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BodyInserters</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"webflux\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span>  route<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"æƒé‡ä¸ç°åº¦å‘å¸ƒ\"><a class=\"anchor\" href=\"#æƒé‡ä¸ç°åº¦å‘å¸ƒ\">#</a> æƒé‡ä¸ç°åº¦å‘å¸ƒ</h4>\n<p><img data-src=\"../../../../../../Do/InternetArchitect-master/InternetArchitect-master/20%20SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/SpringCloud%20Gateway/img/5?lastModify=1626763270\" alt=\"img\" /></p>\n<p>éšæœºç®—æ³•</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> w1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token punctuation\">-</span> Path=/w/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">-</span> Weight=service<span class=\"token punctuation\">,</span><span class=\"token number\">95</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//MDB</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">-</span> StripPrefix=1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> w2</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">-</span> Path=/w/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">-</span> Weight=service<span class=\"token punctuation\">,</span><span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//MDB2</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">-</span> StripPrefix=1</pre></td></tr></table></figure><h3 id=\"é™æµ\"><a class=\"anchor\" href=\"#é™æµ\">#</a> é™æµ</h3>\n<h4 id=\"å†…ç½®ä»¤ç‰Œæ¡¶-redis\"><a class=\"anchor\" href=\"#å†…ç½®ä»¤ç‰Œæ¡¶-redis\">#</a> å†…ç½®ä»¤ç‰Œæ¡¶ + Redis</h4>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-redis-reactive<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> w1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token punctuation\">-</span> Path=/w/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//MDB2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">-</span> StripPrefix=1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> RequestRateLimiter</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>          <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token key atrule\">key-resolver</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'#&#123;@userKeyResolver&#125;'</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token key atrule\">redis-rate-limiter.replenishRate</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token key atrule\">redis-rate-limiter.burstCapacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RateLimitConfig</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token annotation punctuation\">@Bean</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token class-name\">KeyResolver</span> <span class=\"token function\">userKeyResolver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> exchange <span class=\"token operator\">-></span> <span class=\"token class-name\">Mono</span><span class=\"token punctuation\">.</span><span class=\"token function\">just</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getQueryParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getFirst</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¼€å¯ redis</p>\n<h4 id=\"æ•´åˆgoogleguava\"><a class=\"anchor\" href=\"#æ•´åˆgoogleguava\">#</a> æ•´åˆ GoogleGuava</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HashMap</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Objects</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>validation<span class=\"token punctuation\">.</span>constraints<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DecimalMin</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>gateway<span class=\"token punctuation\">.</span>filter<span class=\"token punctuation\">.</span>ratelimit<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AbstractRateLimiter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>gateway<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ConfigurationService</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Primary</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Component</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>validation<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Validated</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RateLimiter</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">reactor<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>publisher<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Mono</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token annotation punctuation\">@Component</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token annotation punctuation\">@Primary</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DefaultRateLimiter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractRateLimiter</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DefaultRateLimiter<span class=\"token punctuation\">.</span>Config</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DefaultRateLimiter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    \t</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Config</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"default-rate-limit\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConfigurationService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     * æ¯ç§’ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯ç§’å‘ä¸€ä¸ªä»¤ç‰Œ</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">RateLimiter</span> limiter <span class=\"token operator\">=</span> <span class=\"token class-name\">RateLimiter</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Mono</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Response</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">isAllowed</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> routeId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token class-name\">Config</span> config <span class=\"token operator\">=</span> <span class=\"token function\">getConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>routeId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        limiter<span class=\"token punctuation\">.</span><span class=\"token function\">setRate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNull</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">getPermitsPerSecond</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">1</span> <span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token function\">getPermitsPerSecond</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token keyword\">boolean</span> isAllow <span class=\"token operator\">=</span> limiter<span class=\"token punctuation\">.</span><span class=\"token function\">tryAcquire</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Mono</span><span class=\"token punctuation\">.</span><span class=\"token function\">just</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span>isAllow<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token annotation punctuation\">@Validated</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Config</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token annotation punctuation\">@DecimalMin</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0.1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">private</span> <span class=\"token class-name\">Double</span> permitsPerSecond<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token class-name\">Double</span> <span class=\"token function\">getPermitsPerSecond</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token keyword\">return</span> permitsPerSecond<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token class-name\">Config</span> <span class=\"token function\">setPermitsPerSecond</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Double</span> permitsPerSecond<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>permitsPerSecond <span class=\"token operator\">=</span> permitsPerSecond<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>\t\t</pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> w1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token punctuation\">-</span> Path=/w/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//MDB2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">-</span> StripPrefix=1</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> RequestRateLimiter</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>          <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token key atrule\">rate-limiter</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"#&#123;@defaultRateLimiter&#125;\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token key atrule\">key-resolver</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"#&#123;@userKeyResolver&#125;\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token key atrule\">default-rate-limit.permitsPerSecond</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.5</span></pre></td></tr></table></figure>",
            "tags": [
                "Java",
                "å¾®æœåŠ¡",
                "Java",
                "é…ç½®ä¸­å¿ƒ",
                "SpringCloud",
                "å¾®æœåŠ¡",
                "é™æµ",
                "Gateway",
                "Zuul"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/SpringCloud/SpringCloud-Alibaba%E4%BD%93%E7%B3%BB/",
            "url": "https://baiyezi.vip/java/SpringCloud/SpringCloud-Alibaba%E4%BD%93%E7%B3%BB/",
            "title": "SpringCloud-Alibabaä½“ç³»",
            "date_published": "2021-07-10T14:01:56.000Z",
            "content_html": "<p>æ¡†æ¶åè®®å¯¹æ¯”</p>\n<p><img data-src=\"SpringCloud-Alibaba%E4%BD%93%E7%B3%BB.assets/image-20210721094812975.png\" alt=\"image-20210721094812975\" /></p>\n<p>Spring ä¾ç…§ Netflix å¼€æºçš„äº§å“å®šä¹‰äº†ä¸€å¥—æ¥å£ç§°ä¹‹ä¸º SpringCloudï¼ŒAlibabaã€Netflix çš„å¼€æºäº§å“å°±æ˜¯è¿™å¥—å£çš„å…·ä½“å®ç°ã€‚</p>\n<h2 id=\"sentinel\"><a class=\"anchor\" href=\"#sentinel\">#</a> Sentinel</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcHJpbmcuaW8vcHJvamVjdHMvc3ByaW5nLWNsb3VkLWFsaWJhYmE=\">https://spring.io/projects/spring-cloud-alibaba</span></p>\n<p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>\n<p>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p>\n<ul>\n<li><strong>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</strong>ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</li>\n<li><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§</strong>ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</li>\n<li><strong>å¹¿æ³›çš„å¼€æºç”Ÿæ€</strong>ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶ / åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Dubboã€gRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚</li>\n<li><strong>å®Œå–„çš„ SPI æ‰©å±•ç‚¹</strong>ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</li>\n</ul>\n<p>Sentinel çš„ä¸»è¦ç‰¹æ€§ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/50505538-2c484880-0aaf-11e9-9ffc-cbaaef20be2b.png\" alt=\"Sentinel-features-overview\" /></p>\n<p>Sentinel çš„å¼€æºç”Ÿæ€ï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/84338449-a9497e00-abce-11ea-8c6a-473fe477b9a1.png\" alt=\"Sentinel-opensource-eco\" /></p>\n<p>Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:</p>\n<ul>\n<li>æ ¸å¿ƒåº“ï¼ˆJava å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶ / åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚</li>\n<li>æ§åˆ¶å°ï¼ˆDashboardï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ã€‚</li>\n</ul>\n<h3 id=\"sentinel-ä¸-hystrix-çš„å¯¹æ¯”\"><a class=\"anchor\" href=\"#sentinel-ä¸-hystrix-çš„å¯¹æ¯”\">#</a> Sentinel ä¸ Hystrix çš„å¯¹æ¯”</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\">Sentinel</th>\n<th style=\"text-align:left\">Hystrix</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">éš”ç¦»ç­–ç•¥</td>\n<td style=\"text-align:left\">ä¿¡å·é‡éš”ç¦»</td>\n<td style=\"text-align:left\">çº¿ç¨‹æ± éš”ç¦» / ä¿¡å·é‡éš”ç¦»</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ç†”æ–­é™çº§ç­–ç•¥</td>\n<td style=\"text-align:left\">åŸºäºå“åº”æ—¶é—´æˆ–å¤±è´¥æ¯”ç‡</td>\n<td style=\"text-align:left\">åŸºäºå¤±è´¥æ¯”ç‡</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">å®æ—¶æŒ‡æ ‡å®ç°</td>\n<td style=\"text-align:left\">æ»‘åŠ¨çª—å£</td>\n<td style=\"text-align:left\">æ»‘åŠ¨çª—å£ï¼ˆåŸºäº RxJavaï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">è§„åˆ™é…ç½®</td>\n<td style=\"text-align:left\">æ”¯æŒå¤šç§æ•°æ®æº</td>\n<td style=\"text-align:left\">æ”¯æŒå¤šç§æ•°æ®æº</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ‰©å±•æ€§</td>\n<td style=\"text-align:left\">å¤šä¸ª SPI æ‰©å±•ç‚¹</td>\n<td style=\"text-align:left\">æ’ä»¶çš„å½¢å¼</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">åŸºäºæ³¨è§£çš„æ”¯æŒ</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">é™æµ</td>\n<td style=\"text-align:left\">åŸºäº QPSï¼Œæ”¯æŒåŸºäºè°ƒç”¨å…³ç³»çš„é™æµ</td>\n<td style=\"text-align:left\">æœ‰é™çš„æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æµé‡æ•´å½¢</td>\n<td style=\"text-align:left\">æ”¯æŒæ…¢å¯åŠ¨ã€åŒ€é€Ÿå™¨æ¨¡å¼</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤</td>\n<td style=\"text-align:left\">æ”¯æŒ</td>\n<td style=\"text-align:left\">ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">æ§åˆ¶å°</td>\n<td style=\"text-align:left\">å¼€ç®±å³ç”¨ï¼Œå¯é…ç½®è§„åˆ™ã€æŸ¥çœ‹ç§’çº§ç›‘æ§ã€æœºå™¨å‘ç°ç­‰</td>\n<td style=\"text-align:left\">ä¸å®Œå–„</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">å¸¸è§æ¡†æ¶çš„é€‚é…</td>\n<td style=\"text-align:left\">Servletã€Spring Cloudã€Dubboã€gRPC ç­‰</td>\n<td style=\"text-align:left\">Servletã€Spring Cloud Netflix</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"spring-cloud-alibaba\"><a class=\"anchor\" href=\"#spring-cloud-alibaba\">#</a> Spring Cloud Alibaba</h3>\n<ul>\n<li><strong>Flow control and service degradation</strong>ï¼šflow control, circuit breaking and system adaptive protection with <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvU2VudGluZWwv\">Alibaba Sentinel</span></li>\n<li><strong>Service registration and discovery</strong>ï¼šinstances can be registered with <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3Mv\">Alibaba Nacos</span> and clients can discover the instances using Spring-managed beans. Supports Ribbon, the client side load-balancer via Spring Cloud Netflix</li>\n<li><strong>Distributed Configuration</strong>ï¼šusing <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3Mv\">Alibaba Nacos</span> as a data store</li>\n<li><strong>Event-driven</strong>ï¼šbuilding highly scalable event-driven microservices connected with Spring Cloud Stream <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yb2NrZXRtcS5hcGFjaGUub3JnLw==\">RocketMQ</span> Binder</li>\n<li><strong>Message Bus</strong>: link nodes of a distributed system with Spring Cloud Bus RocketMQ</li>\n<li><strong>Distributed Transaction</strong>ï¼šsupport for distributed transaction solution with high performance and ease of use with <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlYXRhL3NlYXRh\">Seata</span></li>\n<li><strong>Dubbo RPC</strong>ï¼šextend the communication protocols of Spring Cloud service-to-service calls by [Apache Dubbo RPC](</li>\n</ul>\n<h3 id=\"åŸºæœ¬ä½¿ç”¨\"><a class=\"anchor\" href=\"#åŸºæœ¬ä½¿ç”¨\">#</a> åŸºæœ¬ä½¿ç”¨</h3>\n<p>æ³¨æ„ï¼šSentinel æœ€é«˜æ”¯æŒçš„ Springboot ç‰ˆæœ¬æ˜¯ 2.4.x</p>\n<p>å¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-sentinel<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2021.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>å¯åŠ¨ç±»ä¸­åˆå§‹åŒ–æµé‡è§„åˆ™</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>csp<span class=\"token punctuation\">.</span>sentinel<span class=\"token punctuation\">.</span>slots<span class=\"token punctuation\">.</span>block<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RuleConstant</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>csp<span class=\"token punctuation\">.</span>sentinel<span class=\"token punctuation\">.</span>slots<span class=\"token punctuation\">.</span>block<span class=\"token punctuation\">.</span>flow<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FlowRule</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>csp<span class=\"token punctuation\">.</span>sentinel<span class=\"token punctuation\">.</span>slots<span class=\"token punctuation\">.</span>block<span class=\"token punctuation\">.</span>flow<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FlowRuleManager</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringBootApplication</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ArrayList</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringcloudAlibabaApplication</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// åˆå§‹åŒ–èµ„æº</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token function\">initFlowRules</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringcloudAlibabaApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     * æœåŠ¡ã€æ–¹æ³•çš„é™æµè§„åˆ™</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initFlowRules</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">FlowRule</span><span class=\"token punctuation\">></span></span> rules <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token class-name\">FlowRule</span> flowRule <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FlowRule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// æœåŠ¡èµ„æº</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        flowRule<span class=\"token punctuation\">.</span><span class=\"token function\">setResource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HelloWorld\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        flowRule<span class=\"token punctuation\">.</span><span class=\"token function\">setGrade</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RuleConstant</span><span class=\"token punctuation\">.</span>FLOW_GRADE_QPS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">// æ¯ç§’èƒ½é€šè¿‡è¯·æ±‚çš„æ•°é‡</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        flowRule<span class=\"token punctuation\">.</span><span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        rules<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>flowRule<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">FlowRuleManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">loadRules</span><span class=\"token punctuation\">(</span>rules<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>service</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>csp<span class=\"token punctuation\">.</span>sentinel<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SentinelResource</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>alibaba<span class=\"token punctuation\">.</span>csp<span class=\"token punctuation\">.</span>sentinel<span class=\"token punctuation\">.</span>slots<span class=\"token punctuation\">.</span>block<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BlockException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Service</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @Author yuan199696@qq.com</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @Date 2021-07-21 13:51</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Project springcloud-alibaba</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token annotation punctuation\">@Service</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PersonService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token annotation punctuation\">@SentinelResource</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"HelloWorld\"</span><span class=\"token punctuation\">,</span>blockHandler <span class=\"token operator\">=</span> <span class=\"token string\">\"back\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"get resource...\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     * å›è°ƒå¤„ç†</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     * @param e</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     * @return</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">back</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BlockException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"é™çº§äº†ã€‚ã€‚ã€‚\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>controller</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">PersonService</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Autowired</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GetMapping</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RestController</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @Author yuan199696@qq.com</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @Date 2021-07-21 13:35</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Project springcloud-alibaba</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainController</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token annotation punctuation\">@Autowired</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token class-name\">PersonService</span> personService<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/get\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> personService<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æµ‹è¯•åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgwL2dldA==\">http://localhost:8080/get</span></p>\n<h3 id=\"sentinel-dashboard\"><a class=\"anchor\" href=\"#sentinel-dashboard\">#</a> Sentinel Dashboard</h3>\n<p>Sentinel æä¾›ä¸€ä¸ªè½»é‡çº§çš„å¼€æºæ§åˆ¶å°ï¼Œå®ƒæä¾›æœºå™¨å‘ç°ä»¥åŠå¥åº·æƒ…å†µç®¡ç†ã€ç›‘æ§ï¼ˆå•æœºå’Œé›†ç¾¤ï¼‰ï¼Œè§„åˆ™ç®¡ç†å’Œæ¨é€çš„åŠŸèƒ½ã€‚å¦å¤–ï¼Œé‰´æƒåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¹Ÿå¿…ä¸å¯å°‘ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¼šè¯¦ç»†è®²è¿°å¦‚ä½•é€šè¿‡<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvU2VudGluZWwvd2lraS8lRTYlOEUlQTclRTUlODglQjYlRTUlOEYlQjAjMi0lRTUlOTAlQUYlRTUlOEElQTglRTYlOEUlQTclRTUlODglQjYlRTUlOEYlQjA=\">ç®€å•çš„æ­¥éª¤</span>å°±å¯ä»¥ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¼šé€ä¸€ä»‹ç»å¦‚ä½•æ•´åˆ Sentinel æ ¸å¿ƒåº“å’Œ Dashboardï¼Œè®©å®ƒå‘æŒ¥æœ€å¤§çš„ä½œç”¨ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨é˜¿é‡Œäº‘ä¸Šæä¾›ä¼ä¸šçº§çš„æ§åˆ¶å°ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvU2VudGluZWwvd2lraS9BSEFTLVNlbnRpbmVsLSVFNiU4RSVBNyVFNSU4OCVCNiVFNSU4RiVCMA==\">AHAS Sentinel æ§åˆ¶å°</span>ï¼Œæ‚¨åªéœ€è¦å‡ ä¸ªç®€å•çš„æ­¥éª¤ï¼Œå°±èƒ½æœ€ç›´è§‚åœ°çœ‹åˆ°æ§åˆ¶å°å¦‚ä½•å®ç°è¿™äº›åŠŸèƒ½ã€‚</p>\n<p>Sentinel æ§åˆ¶å°åŒ…å«å¦‚ä¸‹åŠŸèƒ½:</p>\n<ul>\n<li><a href=\"https://github.com/alibaba/Sentinel/wiki/%E6%8E%A7%E5%88%B6%E5%8F%B0#4-%E6%9F%A5%E7%9C%8B%E6%9C%BA%E5%99%A8%E5%88%97%E8%A1%A8%E4%BB%A5%E5%8F%8A%E5%81%A5%E5%BA%B7%E6%83%85%E5%86%B5\"><strong>æŸ¥çœ‹æœºå™¨åˆ—è¡¨ä»¥åŠå¥åº·æƒ…å†µ</strong></a>ï¼šæ”¶é›† Sentinel å®¢æˆ·ç«¯å‘é€çš„å¿ƒè·³åŒ…ï¼Œç”¨äºåˆ¤æ–­æœºå™¨æ˜¯å¦åœ¨çº¿ã€‚</li>\n<li><a href=\"https://github.com/alibaba/Sentinel/wiki/%E6%8E%A7%E5%88%B6%E5%8F%B0#5-%E7%9B%91%E6%8E%A7\"><strong>ç›‘æ§ (å•æœºå’Œé›†ç¾¤èšåˆ)</strong></a>ï¼šé€šè¿‡ Sentinel å®¢æˆ·ç«¯æš´éœ²çš„ç›‘æ§ APIï¼Œå®šæœŸæ‹‰å–å¹¶ä¸”èšåˆåº”ç”¨ç›‘æ§ä¿¡æ¯ï¼Œæœ€ç»ˆå¯ä»¥å®ç°ç§’çº§çš„å®æ—¶ç›‘æ§ã€‚</li>\n<li><a href=\"https://github.com/alibaba/Sentinel/wiki/%E6%8E%A7%E5%88%B6%E5%8F%B0#6-%E8%A7%84%E5%88%99%E7%AE%A1%E7%90%86%E5%8F%8A%E6%8E%A8%E9%80%81\"><strong>è§„åˆ™ç®¡ç†å’Œæ¨é€</strong></a>ï¼šç»Ÿä¸€ç®¡ç†æ¨é€è§„åˆ™ã€‚</li>\n<li><a href=\"https://github.com/alibaba/Sentinel/wiki/%E6%8E%A7%E5%88%B6%E5%8F%B0#%E9%89%B4%E6%9D%83\"><strong>é‰´æƒ</strong></a>ï¼šç”Ÿäº§ç¯å¢ƒä¸­é‰´æƒéå¸¸é‡è¦ã€‚è¿™é‡Œæ¯ä¸ªå¼€å‘è€…éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè¿›è¡Œå®šåˆ¶ã€‚</li>\n</ul>\n<blockquote>\n<p>æ³¨æ„ï¼š</p>\n<p>Sentinel æ§åˆ¶å°ç›®å‰ä»…æ”¯æŒå•æœºéƒ¨ç½²ã€‚</p>\n<p>å¯åŠ¨ Sentinel æ§åˆ¶å°éœ€è¦ JDK ç‰ˆæœ¬ä¸º 1.8 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚</p>\n<p>æµé‡è§„åˆ™åœ¨ dashboard ä¸­ä»¥åŠä»£ç ä¸­é…ç½®åï¼Œä»£ç ä¸­é…ç½®çš„æµé‡è§„åˆ™ä¸å†ç”Ÿæ•ˆã€‚</p>\n</blockquote>\n<p>ä¸‹è½½åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvU2VudGluZWwvcmVsZWFzZXM=\">https://github.com/alibaba/Sentinel/releases</span></p>\n<p>å¯åŠ¨å‘½ä»¤ï¼š</p>\n<pre><code>java -Dserver.port=8080 -Dcsp.sentinel.dashboard.server=localhost:8080 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.8.2.jar\n</code></pre>\n<p>å…¶ä¸­  <code>-Dserver.port=8080</code>  ç”¨äºæŒ‡å®š Sentinel æ§åˆ¶å°ç«¯å£ä¸º  <code>8080</code> ã€‚</p>\n<p>ä» Sentinel 1.6.0 èµ·ï¼ŒSentinel æ§åˆ¶å°å¼•å…¥åŸºæœ¬çš„<strong>ç™»å½•</strong>åŠŸèƒ½ï¼Œé»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯  <code>sentinel</code> ã€‚å¯ä»¥å‚è€ƒ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvU2VudGluZWwvd2lraS8lRTYlOEUlQTclRTUlODglQjYlRTUlOEYlQjAjJUU5JTg5JUI0JUU2JTlEJTgz\">é‰´æƒæ¨¡å—æ–‡æ¡£</span> é…ç½®ç”¨æˆ·åå’Œå¯†ç ã€‚</p>\n<h4 id=\"å°†æœåŠ¡åŠ å…¥dashboard\"><a class=\"anchor\" href=\"#å°†æœåŠ¡åŠ å…¥dashboard\">#</a> å°†æœåŠ¡åŠ å…¥ dashboard</h4>\n<p>åœ¨å¯åŠ¨ç±»ä¸­æ³¨é‡Šæ‰ä¹‹å‰çš„æµé‡è§„åˆ™é…ç½®</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>spring.cloud.sentinel.transport.dashboard=localhost<span class=\"token punctuation\">:</span><span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#æœåŠ¡å¯åŠ¨åç«‹å³æ³¨å†Œåˆ° dashboard</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>spring.cloud.sentinel.eager=true</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>spring.application.name=stn</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>server.port=80</pre></td></tr></table></figure><p>åœ¨ dashboard æ·»åŠ æµé‡æ§åˆ¶</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210721150911123.png\" alt=\"image-20210721150911123\" /></p>\n<h3 id=\"sentinelä¸­çš„æ»‘åŠ¨æ—¶é—´çª—å£è®¡æ•°\"><a class=\"anchor\" href=\"#sentinelä¸­çš„æ»‘åŠ¨æ—¶é—´çª—å£è®¡æ•°\">#</a> Sentinel ä¸­çš„æ»‘åŠ¨æ—¶é—´çª—å£è®¡æ•°</h3>\n<p>å°†ä¸€ç§’åˆ’åˆ†æˆä¸¤éƒ¨åˆ†ï¼ˆæ¯ä¸€éƒ¨åˆ†ç§°ä¸ºä¸€ä¸ª bucketï¼‰ï¼Œå„ 500msï¼Œè‹¥å¹²ä¸ª bucket ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œç›¸é‚»çš„ä¸¤éƒ¨åˆ†ç»„æˆä¸€ä¸ªçª—å£ï¼Œè¯·æ±‚è½åœ¨å½“å‰æ—¶é—´æˆ³ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼Œå»æ‰æ¯«ç§’ï¼‰å¯¹æ•°ç»„é•¿åº¦å–ä½™åçš„æ•°ç»„ä¸‹æ ‡å¯¹åº”çš„çª—å£å†…ï¼Œå¦‚æœåœ¨è¿™ä¸ªçª—å£å†…ï¼ˆå³æ¯ç§’ï¼‰ç´¯è®¡çš„è¯·æ±‚æ•°é‡å°äºç»™å®šçš„æ¯ç§’å…è®¸çš„è¯·æ±‚é‡ï¼Œé‚£ä¹ˆè¯·æ±‚å°±é€šè¿‡ï¼Œå¦åˆ™æ‹’ç»è¯·æ±‚ã€‚è¿™å°±æ˜¯ QPS é™æµã€‚</p>\n<p>å¯ä»¥ç›´æ¥åœ¨ dashboard ä¸­æ›´æ”¹é™æµè§„åˆ™</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210722095343865.png\" alt=\"image-20210722095343865\" /></p>\n<p>ç„¶åå¯ä»¥ä½¿ç”¨ JMeter æµ‹è¯•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210722100921724.png\" alt=\"image-20210722100921724\" /></p>\n<h3 id=\"qpsé™æµä¸çº¿ç¨‹é™æµ\"><a class=\"anchor\" href=\"#qpsé™æµä¸çº¿ç¨‹é™æµ\">#</a> QPS é™æµä¸çº¿ç¨‹é™æµ</h3>\n<h4 id=\"ç›´è¿é™æµ\"><a class=\"anchor\" href=\"#ç›´è¿é™æµ\">#</a> ç›´è¿é™æµ</h4>\n<p>qps é™æµï¼šæ¯ç§’ï¼ˆæ»‘åŠ¨æ—¶é—´çª—å£ï¼‰å¯ä»¥é€šè¿‡çš„è¯·æ±‚æ•°é‡</p>\n<p>tps çº¿ç¨‹é™æµï¼šæ¯ç§’å…è®¸çš„çº¿ç¨‹æ•°ï¼Œåº”è¯¥å°äºæˆ–ç­‰äºå®é™… Tomcat è®¾ç½®çš„çº¿ç¨‹æ•°</p>\n<p>ä¿¡å·é‡é™æµï¼šè®¡æ•°</p>\n<p>æœåŠ¡é™æµï¼šæœåŠ¡å…·ä½“æ–¹æ³•çš„é™æµ</p>\n<h4 id=\"å…³è”é™æµ\"><a class=\"anchor\" href=\"#å…³è”é™æµ\">#</a> å…³è”é™æµ</h4>\n<p>å…³è”å…³ç³»ï¼šé™æµå–å†³äºå…¶ä»–æœåŠ¡çŠ¶æ€ã€‚æ¯”å¦‚èµ„æº get4 å…³è”èµ„æº get3ã€‚å€¼å¯ä»¥æ˜¯èµ„æºåï¼Œä¹Ÿå¯ä»¥æ˜¯ URL</p>\n<p>Warm Upï¼šè¯·æ±‚ä¹‹å‰é¢„çƒ­ï¼Œå•ä½ç§’ã€‚åœ¨è¯¥æ—¶é—´å†…é€æ­¥è¾¾åˆ° QPS</p>\n<p>æ’é˜Ÿç­‰å¾…ï¼šå½“ QPS æ»¡äº†åï¼Œå†æœ‰è¯·æ±‚è¿›å…¥æ—¶ç­‰å¾…æŒ‡å®šæ—¶é—´åè¶…æ—¶ï¼Œå•ä½æ¯«ç§’</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210722103901288.png\" alt=\"image-20210722103901288\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/get3\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@SentinelResource</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"get3\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">get3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"get3\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/get4\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token annotation punctuation\">@SentinelResource</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"get4\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">get4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"get4\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"é“¾è·¯é™æµ\"><a class=\"anchor\" href=\"#é“¾è·¯é™æµ\">#</a> é“¾è·¯é™æµ</h4>\n<p>æœ‰ bugï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvc2VudGluZWwvaXNzdWVzLzEyMTM=\">https://github.com/alibaba/sentinel/issues/1213</span></p>\n<h3 id=\"ç†”æ–­è§„åˆ™\"><a class=\"anchor\" href=\"#ç†”æ–­è§„åˆ™\">#</a> ç†”æ–­è§„åˆ™</h3>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210722165604090.png\" alt=\"image-20210722165604090\" /></p>\n<h3 id=\"çƒ­ç‚¹è§„åˆ™\"><a class=\"anchor\" href=\"#çƒ­ç‚¹è§„åˆ™\">#</a> çƒ­ç‚¹è§„åˆ™</h3>\n<p>å¯ä»¥æ ¹æ®å‚æ•°å€¼è¿›è¡Œé™æµ</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/getPer\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@SentinelResource</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"getPer\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">return</span> name <span class=\"token operator\">+</span> <span class=\"token string\">\"-\"</span> <span class=\"token operator\">+</span> age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å½“ name=zs æ—¶ QPS ä¸º 1ï¼Œå½“ name=ww æ—¶ï¼ŒQPS=10</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210722183909950.png\" alt=\"image-20210722183909950\" /></p>\n<h3 id=\"ç³»ç»Ÿè§„åˆ™\"><a class=\"anchor\" href=\"#ç³»ç»Ÿè§„åˆ™\">#</a> ç³»ç»Ÿè§„åˆ™</h3>\n<p>ç³»ç»Ÿå¯ä»¥è‡ªé€‚åº”é™æµã€‚</p>\n<p>æ–‡æ¡£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvU2VudGluZWwvd2lraS8lRTclQjMlQkIlRTclQkIlOUYlRTglODclQUElRTklODAlODIlRTUlQkElOTQlRTklOTklOTAlRTYlQjUlODE=\">https://github.com/alibaba/Sentinel/wiki/ ç³»ç»Ÿè‡ªé€‚åº”é™æµ</span></p>\n<p>Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä»æ•´ä½“ç»´åº¦å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚</p>\n<ul>\n<li>\n<p><strong>Load è‡ªé€‚åº”</strong>ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šcpu å †ç§¯çš„çº¿ç¨‹ä¸ªæ•°ã€‚ç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„  <code>maxQps * minRt</code>  ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯  <code>CPU cores * 2.5</code> ã€‚ï¼ˆå»ºè®®è®¾ç½®ä¸º 2ï¼‰</p>\n</li>\n<li>\n<p><strong>CPU usage</strong>ï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•ã€‚</p>\n</li>\n<li>\n<p><strong>å¹³å‡ RT</strong>ï¼ˆResponse Timeï¼‰ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</p>\n</li>\n<li>\n<p><strong>å¹¶å‘çº¿ç¨‹æ•°</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</p>\n</li>\n<li>\n<p><strong>å…¥å£ QPS</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</p>\n</li>\n</ul>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210722163442445.png\" alt=\"image-2021072216344445\" /></p>\n<h3 id=\"é›†ç¾¤é™æµ\"><a class=\"anchor\" href=\"#é›†ç¾¤é™æµ\">#</a> é›†ç¾¤é™æµ</h3>\n<p>æ–‡æ¡£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvU2VudGluZWwvd2lraS8lRTklOUIlODYlRTclQkUlQTQlRTYlQjUlODElRTYlOEUlQTc=\">https://github.com/alibaba/Sentinel/wiki/ é›†ç¾¤æµæ§</span></p>\n<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é›†ç¾¤æµæ§å‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬å¸Œæœ›ç»™æŸä¸ªç”¨æˆ·é™åˆ¶è°ƒç”¨æŸä¸ª API çš„æ€» QPS ä¸º 50ï¼Œä½†æœºå™¨æ•°å¯èƒ½å¾ˆå¤šï¼ˆæ¯”å¦‚æœ‰ 100 å°ï¼‰ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¾ˆè‡ªç„¶åœ°å°±æƒ³åˆ°ï¼Œæ‰¾ä¸€ä¸ª server æ¥ä¸“é—¨æ¥ç»Ÿè®¡æ€»çš„è°ƒç”¨é‡ï¼Œå…¶å®ƒçš„å®ä¾‹éƒ½ä¸è¿™å° server é€šä¿¡æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥è°ƒç”¨ã€‚è¿™å°±æ˜¯æœ€åŸºç¡€çš„é›†ç¾¤æµæ§çš„æ–¹å¼ã€‚</p>\n<p>å¦å¤–é›†ç¾¤æµæ§è¿˜å¯ä»¥è§£å†³æµé‡ä¸å‡åŒ€å¯¼è‡´æ€»ä½“é™æµæ•ˆæœä¸ä½³çš„é—®é¢˜ã€‚å‡è®¾é›†ç¾¤ä¸­æœ‰ 10 å°æœºå™¨ï¼Œæˆ‘ä»¬ç»™æ¯å°æœºå™¨è®¾ç½®å•æœºé™æµé˜ˆå€¼ä¸º 10 QPSï¼Œç†æƒ³æƒ…å†µä¸‹æ•´ä¸ªé›†ç¾¤çš„é™æµé˜ˆå€¼å°±ä¸º 100 QPSã€‚ä¸è¿‡å®é™…æƒ…å†µä¸‹æµé‡åˆ°æ¯å°æœºå™¨å¯èƒ½ä¼šä¸å‡åŒ€ï¼Œä¼šå¯¼è‡´æ€»é‡æ²¡æœ‰åˆ°çš„æƒ…å†µä¸‹æŸäº›æœºå™¨å°±å¼€å§‹é™æµã€‚å› æ­¤ä»…é å•æœºç»´åº¦å»é™åˆ¶çš„è¯ä¼šæ— æ³•ç²¾ç¡®åœ°é™åˆ¶æ€»ä½“æµé‡ã€‚è€Œé›†ç¾¤æµæ§å¯ä»¥ç²¾ç¡®åœ°æ§åˆ¶æ•´ä¸ªé›†ç¾¤çš„è°ƒç”¨æ€»é‡ï¼Œç»“åˆå•æœºé™æµå…œåº•ï¼Œå¯ä»¥æ›´å¥½åœ°å‘æŒ¥æµé‡æ§åˆ¶çš„æ•ˆæœã€‚</p>\n<p>é›†ç¾¤æµæ§ä¸­å…±æœ‰ä¸¤ç§èº«ä»½ï¼š</p>\n<ul>\n<li>Token Clientï¼šé›†ç¾¤æµæ§å®¢æˆ·ç«¯ï¼Œç”¨äºå‘æ‰€å± Token Server é€šä¿¡è¯·æ±‚ tokenã€‚é›†ç¾¤é™æµæœåŠ¡ç«¯ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ç»“æœï¼Œå†³å®šæ˜¯å¦é™æµã€‚</li>\n<li>Token Serverï¼šå³é›†ç¾¤æµæ§æœåŠ¡ç«¯ï¼Œå¤„ç†æ¥è‡ª Token Client çš„è¯·æ±‚ï¼Œæ ¹æ®é…ç½®çš„é›†ç¾¤è§„åˆ™åˆ¤æ–­æ˜¯å¦åº”è¯¥å‘æ”¾ tokenï¼ˆæ˜¯å¦å…è®¸é€šè¿‡ï¼‰ã€‚</li>\n</ul>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210722132753853.png\" alt=\"image-20210722132753853\" /></p>\n<h2 id=\"sentinelæ•´åˆspringcloud-gateway\"><a class=\"anchor\" href=\"#sentinelæ•´åˆspringcloud-gateway\">#</a> Sentinel æ•´åˆ SpringCloud Gateway</h2>\n<p>å¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-parent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.4.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>relativePath</span><span class=\"token punctuation\">/></span></span> <span class=\"token comment\">&lt;!-- lookup parent from repository --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.fan<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>springcloud-alibaba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>0.0.1-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>springcloud-alibaba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>description</span><span class=\"token punctuation\">></span></span>Demo project for Spring Boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>description</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>java.version</span><span class=\"token punctuation\">></span></span>1.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>java.version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alibaba-sentinel --></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-sentinel<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2021.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.csp/sentinel-datasource-nacos --></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.csp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>sentinel-datasource-nacos<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.8.2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alibaba-nacos-discovery --></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2021.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugins</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-maven-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugins</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>Sentinel ä¸­é…ç½®</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token attr-name\">spring.cloud.sentinel.transport.dashboard</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">localhost:8080</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#æœåŠ¡å¯åŠ¨åç«‹å³æ³¨å†Œåˆ° dashboard</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">spring.cloud.sentinel.eager</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token attr-name\">spring.application.name</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">stn</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">80</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#æ•´åˆ nacos (ä½œä¸ºé…ç½®ä¸­å¿ƒ)ï¼Œä¸‹å‘é…ç½®åˆ° sentinel dashboard</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#nacos é»˜è®¤ ip ç«¯å£ï¼šlocalhost:8848ï¼Œå¯ä»¥åœ¨ conf ç›®å½•ä¸‹çš„ application.properties é…ç½®ä¸­æ›´æ”¹</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#spring.cloud.sentinel.datasource.ds.nacos.server-addr=localhost:8848</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#spring.cloud.sentinel.datasource.ds.nacos.dataId=stn123</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#spring.cloud.sentinel.datasource.ds.nacos.groupId=DEFAULT_GROUP</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#spring.cloud.sentinel.datasource.ds.nacos.ruleType=flow</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#æ•´åˆ nacos (ä½œä¸ºæ³¨å†Œä¸­å¿ƒ)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token attr-name\">spring.cloud.nacos.discovery.server-addr</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">192.168.137.1:8848</span></pre></td></tr></table></figure><p>æ–°å»º gateway é¡¹ç›®ï¼Œå¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>xsi</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2001/XMLSchema-instance<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>         <span class=\"token attr-name\"><span class=\"token namespace\">xsi:</span>schemaLocation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modelVersion</span><span class=\"token punctuation\">></span></span>4.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modelVersion</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-parent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.4.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>relativePath</span><span class=\"token punctuation\">/></span></span> <span class=\"token comment\">&lt;!-- lookup parent from repository --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.fan<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>sentinel-gateway<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>0.0.1-SNAPSHOT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>sentinel-gateway<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>description</span><span class=\"token punctuation\">></span></span>Demo project for Spring Boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>description</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>java.version</span><span class=\"token punctuation\">></span></span>1.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>java.version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>properties</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alibaba-sentinel --></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-sentinel<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2021.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.csp/sentinel-datasource-nacos --></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">&lt;!--&lt;dependency></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            &lt;groupId>com.alibaba.csp&lt;/groupId></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            &lt;artifactId>sentinel-datasource-nacos&lt;/artifactId></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            &lt;version>1.8.2&lt;/version></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        &lt;/dependency>--></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.cloud/spring-cloud-starter-alibaba-nacos-discovery --></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2021.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-gateway --></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-gateway<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>3.0.3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugins</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-maven-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugins</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>é…ç½®</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">locator</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>          <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> w1</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">-</span> Path=/w/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//stn</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">-</span> StripPrefix=1</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 172.20.10.3<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sentinel<span class=\"token punctuation\">-</span>gateway</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8082</span></pre></td></tr></table></figure><p>è®¿é—® nacosï¼Œå¯ä»¥çœ‹åˆ°æ³¨å†Œä¸­å¿ƒæœåŠ¡ä»¥åŠ gateway æœåŠ¡</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210723004243.png\" alt=\"image-20210723004240104\" /></p>\n<p>è®¿é—®æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgyL3cvZ2V0NA==\">http://localhost:8082/w/get4</span></p>\n<p>ä¹Ÿå¯ä»¥åŠ å…¥ Dashboard</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">sentinel</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token key atrule\">eager</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token key atrule\">transport</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">dashboard</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></pre></td></tr></table></figure><h2 id=\"sentinelæ•´åˆnacos\"><a class=\"anchor\" href=\"#sentinelæ•´åˆnacos\">#</a> Sentinel æ•´åˆ Nacos</h2>\n<p>nacos å¯ä»¥ä½œä¸ºé…ç½®ä¸­å¿ƒã€æ³¨å†Œä¸­å¿ƒ</p>\n<p>ä¸‹è½½åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvbmFjb3MvcmVsZWFzZXM=\">https://github.com/alibaba/nacos/releases</span></p>\n<p>å¼•å…¥ä¾èµ–</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.csp/sentinel-datasource-nacos --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.csp<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>sentinel-datasource-nacos<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.8.2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>é…ç½®</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>spring.cloud.sentinel.transport.dashboard=localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#æœåŠ¡å¯åŠ¨åç«‹å³æ³¨å†Œåˆ° dashboard</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>spring.cloud.sentinel.eager=true</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>spring.application.name=stn</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>server.port=80</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#æ•´åˆ nacosï¼Œä¸‹å‘é…ç½®åˆ° sentinel dashboard</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#nacos é»˜è®¤ ip ç«¯å£ï¼šlocalhost:8848ï¼Œå¯ä»¥åœ¨ conf ç›®å½•ä¸‹çš„ application.properties é…ç½®ä¸­æ›´æ”¹</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>spring.cloud.sentinel.datasource.ds.nacos.server<span class=\"token punctuation\">-</span>addr=localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>spring.cloud.sentinel.datasource.ds.nacos.dataId=stn123</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>spring.cloud.sentinel.datasource.ds.nacos.groupId=DEFAULT_GROUP</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>spring.cloud.sentinel.datasource.ds.nacos.ruleType=flow</pre></td></tr></table></figure><p>å¯åŠ¨ nacos æŠ¥é”™ï¼šå¯åŠ¨æŠ¥é”™ Caused by: org.springframework.boot.web.server.WebServerException: Unable to...</p>\n<p>è§£å†³ï¼šåœ¨ nacos å®‰è£…ç›®å½•ä¸‹çš„ bin ç›®å½•ä¸‹ä¿®æ”¹å¯åŠ¨è„šæœ¬ startup.cmdï¼Œå°† 26 çš„å¯åŠ¨æ¨¡å¼æ”¹ä¸ºå•æœºç‰ˆï¼ˆé»˜è®¤æ˜¯é›†ç¾¤æ¨¡å¼ï¼‰</p>\n<pre><code class=\"language-cmd\">set MODE=&quot;cluster&quot;\n</code></pre>\n<p>æ”¹ä¸º</p>\n<pre><code class=\"language-cmd\">set MODE=&quot;standalone&quot;\n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210721160933174.png\" alt=\"image-20210721160933174\" /></p>\n<p>ç™»å½•ç”¨æˆ·åä»¥åŠå¯†ç ï¼šnacosï¼Œé»˜è®¤é›†æˆäº† SpringSecurityï¼Œå¯ä»¥åœ¨ conf ç›®å½•ä¸‹çš„ application.properties é…ç½®ä¸­å–æ¶ˆ</p>\n<p>æ·»åŠ é…ç½®ï¼šéœ€è¦å’Œä»¥ä¸Š yaml ä¸­é…ç½®ä¿æŒä¸€è‡´</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// èµ„æºåç§°</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"HelloWorld\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"limitApp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">//qps/tps</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"grade\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// å…è®¸çš„è¯·æ±‚æ•°é‡ / æ¯ç§’</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"strategy\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"controlBehavior\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token property\">\"clusterMode\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210721161653354.png\" alt=\"image-20210721161653354\" /></p>\n<p>è¯¥é…ç½®å‘å¸ƒåä¼šå®æ—¶åŒæ­¥åˆ° Sentinel Dashboard ä¸­ï¼Œ</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210721161943054.png\" alt=\"image-20210721161943054\" /></p>\n<p>å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä¹Ÿæ˜¯é€šè¿‡ nacos ç»Ÿä¸€ä¸‹å‘é™æµè§„åˆ™åˆ°å„ä¸ªæœåŠ¡èµ„æºï¼Œè€Œä¸æ˜¯åœ¨ yaml ä¸­å•ä¸ªé…ç½®æˆ–è€…åœ¨ Dashboard ä¸­å•ä¸ªé…ç½®ã€‚</p>\n<h2 id=\"nacos\"><a class=\"anchor\" href=\"#nacos\">#</a> Nacos</h2>\n<p>å®˜æ–¹ç½‘ç«™ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uYWNvcy5pby96aC1jbi8=\">https://nacos.io/zh-cn/</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210723113803015.png\" alt=\"image-20210723113803015\" /></p>\n<ul>\n<li>ç‰¹æ€§å¤§å›¾ï¼šè¦ä»åŠŸèƒ½ç‰¹æ€§ï¼ŒéåŠŸèƒ½ç‰¹æ€§ï¼Œå…¨é¢ä»‹ç»æˆ‘ä»¬è¦è§£çš„é—®é¢˜åŸŸçš„ç‰¹æ€§è¯‰æ±‚</li>\n<li>æ¶æ„å¤§å›¾ï¼šé€šè¿‡æ¸…æ™°æ¶æ„ï¼Œè®©æ‚¨å¿«é€Ÿè¿›å…¥ Nacos ä¸–ç•Œ</li>\n<li>ä¸šåŠ¡å¤§å›¾ï¼šåˆ©ç”¨å½“å‰ç‰¹æ€§å¯ä»¥æ”¯æŒçš„ä¸šåŠ¡åœºæ™¯ï¼ŒåŠå…¶æœ€ä½³å®è·µ</li>\n<li>ç”Ÿæ€å¤§å›¾ï¼šç³»ç»Ÿæ¢³ç† Nacos å’Œä¸»æµæŠ€æœ¯ç”Ÿæ€çš„å…³ç³»</li>\n<li>ä¼˜åŠ¿å¤§å›¾ï¼šå±•ç¤º Nacos æ ¸å¿ƒç«äº‰åŠ›</li>\n<li>æˆ˜ç•¥å¤§å›¾ï¼šè¦ä»æˆ˜ç•¥åˆ°æˆ˜æœ¯å±‚é¢è®² Nacos çš„å®è§‚ä¼˜åŠ¿</li>\n</ul>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210723113657649.png\" alt=\"image-20210723113657649\" /></p>\n<p><strong>é…ç½®ä¸­å¿ƒä¸æ³¨å†Œä¸­å¿ƒå‹æµ‹æŠ¥å‘Š</strong></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9uYWNvcy5pby96aC1jbi9kb2NzL25hY29zLWNvbmZpZy1iZW5jaG1hcmsuaHRtbA==\">https://nacos.io/zh-cn/docs/nacos-config-benchmark.html</span></p>\n<h3 id=\"åŠ¨æ€é…ç½®æœåŠ¡\"><a class=\"anchor\" href=\"#åŠ¨æ€é…ç½®æœåŠ¡\">#</a> åŠ¨æ€é…ç½®æœåŠ¡</h3>\n<p>åŠ¨æ€é…ç½®æœåŠ¡è®©æ‚¨èƒ½å¤Ÿä»¥ä¸­å¿ƒåŒ–ã€å¤–éƒ¨åŒ–å’ŒåŠ¨æ€åŒ–çš„æ–¹å¼ç®¡ç†æ‰€æœ‰ç¯å¢ƒçš„é…ç½®ã€‚åŠ¨æ€é…ç½®æ¶ˆé™¤äº†é…ç½®å˜æ›´æ—¶é‡æ–°éƒ¨ç½²åº”ç”¨å’ŒæœåŠ¡çš„éœ€è¦ã€‚é…ç½®ä¸­å¿ƒåŒ–ç®¡ç†è®©å®ç°æ— çŠ¶æ€æœåŠ¡æ›´ç®€å•ï¼Œä¹Ÿè®©æŒ‰éœ€å¼¹æ€§æ‰©å±•æœåŠ¡æ›´å®¹æ˜“ã€‚</p>\n<h4 id=\"æœåŠ¡æä¾›æ–¹\"><a class=\"anchor\" href=\"#æœåŠ¡æä¾›æ–¹\">#</a> æœåŠ¡æä¾›æ–¹</h4>\n<ol>\n<li><code>bootstrap.yml</code>  ä¸­é…ç½® Nacos server çš„åœ°å€å’Œåº”ç”¨å</li>\n</ol>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 172.20.10.3<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 172.20.10.3<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">file-extension</span><span class=\"token punctuation\">:</span> yaml</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myNacos</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8081</span></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥éœ€è¦é…ç½®  <code>spring.application.name</code>  ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯æ„æˆ Nacos é…ç½®ç®¡ç†  <code>dataId</code>  å­—æ®µçš„ä¸€éƒ¨åˆ†ã€‚</p>\n<p>åœ¨ Nacos Spring Cloud ä¸­ï¼Œ <code>dataId</code>  çš„å®Œæ•´æ ¼å¼å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><figcaption data-lang=\"plain\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</pre></td></tr></table></figure><ul>\n<li><code>prefix</code>  é»˜è®¤ä¸º  <code>spring.application.name</code>  çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹  <code>spring.cloud.nacos.config.prefix</code>  æ¥é…ç½®ã€‚</li>\n<li><code>spring.profiles.active</code>  å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„ profileï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLnNwcmluZy5pby9zcHJpbmctYm9vdC9kb2NzL2N1cnJlbnQvcmVmZXJlbmNlL2h0bWwvYm9vdC1mZWF0dXJlcy1wcm9maWxlcy5odG1sI2Jvb3QtZmVhdHVyZXMtcHJvZmlsZXM=\">Spring Boot æ–‡æ¡£</span>ã€‚ <strong>æ³¨æ„ï¼šå½“  <code>spring.profiles.active</code>  ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„è¿æ¥ç¬¦  <code>-</code>  ä¹Ÿå°†ä¸å­˜åœ¨ï¼ŒdataId çš„æ‹¼æ¥æ ¼å¼å˜æˆ  <code>$&#123;prefix&#125;.$&#123;file-extension&#125;</code> </strong></li>\n<li><code>file-exetension</code>  ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹  <code>spring.cloud.nacos.config.file-extension</code>  æ¥é…ç½®ã€‚ç›®å‰åªæ”¯æŒ  <code>properties</code>  å’Œ  <code>yaml</code>  ç±»å‹ã€‚</li>\n</ul>\n<ol start=\"2\">\n<li>Controller</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>controller</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Value</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RefreshScope</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GetMapping</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RestController</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * @Description</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * @Author yuan199696@qq.com</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * @Date 2021-07-23 14:06</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Project alibaba-nacos</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token annotation punctuation\">@RestController</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">//  åœ¨ nacos æ§åˆ¶é¢æ¿ä¿®æ”¹é…ç½®åä¸éœ€è¦é‡å¯æœåŠ¡å°±å¯ä»¥è·å–æœ€æ–°çš„é…ç½®</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token annotation punctuation\">@RefreshScope</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainCotroller</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$&#123;xxoo&#125;\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> xxoo<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/xxoo\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">return</span> xxoo<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>@RefreshScope æ³¨è§£èƒ½å¸®åŠ©æˆ‘ä»¬åšå±€éƒ¨çš„å‚æ•°åˆ·æ–°ï¼Œä½†ä¾µå…¥æ€§è¾ƒå¼ºï¼Œéœ€è¦å¼€å‘é˜¶æ®µæå‰é¢„çŸ¥å¯èƒ½çš„åˆ·æ–°ç‚¹ï¼Œå¹¶ä¸”è¯¥æ³¨è§£åº•å±‚æ˜¯ä¾èµ–äº cglib è¿›è¡Œä»£ç†</p>\n<p>å¯åŠ¨ nacos æµ‹è¯•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210723145926812.png\" alt=\"image-20210723145926812\" /></p>\n<p>åªè¦é…ç½®ä¿®æ”¹å‘å¸ƒåå¯ä»¥ç«‹å³è·å–åˆ°æ›´æ–°åçš„é…ç½®ã€‚bootstrap.yml ä¸­é™¤äº† spring.cloud.nacos.config å’Œ spring.application.name å¤–å‡å¯ä»¥å°†é…ç½®æ”¾åœ¨ nacos é…ç½®ä¸­å¿ƒå®æ—¶å»ä¸‹å‘ç»™æœåŠ¡ï¼Œéƒ¨åˆ†é…ç½®çš„æ›´æ”¹éœ€è¦é‡å¯æœåŠ¡ï¼ˆå¦‚ç«¯å£çš„é…ç½®çš„æ›´æ”¹ï¼‰ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210723150028112.png\" alt=\"image-20210723150028112\" /></p>\n<h3 id=\"æœåŠ¡æ³¨å†Œå‘ç°\"><a class=\"anchor\" href=\"#æœåŠ¡æ³¨å†Œå‘ç°\">#</a> æœåŠ¡æ³¨å†Œå‘ç°</h3>\n<p>åŠ¨æ€æœåŠ¡å‘ç°å¯¹ä»¥æœåŠ¡ä¸ºä¸­å¿ƒçš„ï¼ˆä¾‹å¦‚å¾®æœåŠ¡å’Œäº‘åŸç”Ÿï¼‰åº”ç”¨æ¶æ„æ–¹å¼éå¸¸å…³é”®ã€‚Nacos æ”¯æŒ DNS-Based å’Œ RPC-Basedï¼ˆDubboã€gRPCï¼‰æ¨¡å¼çš„æœåŠ¡å‘ç°ã€‚Nacos ä¹Ÿæä¾›å®æ—¶å¥åº·æ£€æŸ¥ï¼Œä»¥é˜²æ­¢å°†è¯·æ±‚å‘å¾€ä¸å¥åº·çš„ä¸»æœºæˆ–æœåŠ¡å®ä¾‹ã€‚å€ŸåŠ© Nacosï¼Œæ‚¨å¯ä»¥æ›´å®¹æ˜“åœ°ä¸ºæ‚¨çš„æœåŠ¡å®ç°æ–­è·¯å™¨ã€‚</p>\n<h4 id=\"eurekaæ³¨å†Œä¸­å¿ƒ\"><a class=\"anchor\" href=\"#eurekaæ³¨å†Œä¸­å¿ƒ\">#</a> Eureka æ³¨å†Œä¸­å¿ƒ</h4>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/aaca0b10-36c0-11ea-83e2-610758492683\" alt=\"img\" /></p>\n<p>ç½‘ä¸Šå¾ˆå¤šäººè¯´ Eureka é—­æºï¼Œå…¶å®æ²¡æœ‰ï¼Œåªæ˜¯ Eurkea 2.x åˆ†æ”¯ä¸å†ç»´æŠ¤ï¼Œå®˜æ–¹ä¾ç„¶åœ¨ç§¯æåœ°ç»´æŠ¤ Eureka 1.xï¼ŒSpring Cloud è¿˜æ˜¯ä½¿ç”¨çš„ 1.x ç‰ˆæœ¬çš„ Eurekaã€‚</p>\n<h4 id=\"nacosæ³¨å†Œä¸­å¿ƒ\"><a class=\"anchor\" href=\"#nacosæ³¨å†Œä¸­å¿ƒ\">#</a> Nacos æ³¨å†Œä¸­å¿ƒ</h4>\n<p>ç±»ä¼¼ Eurekaã€ZooKeeperã€Consul ç­‰ç»„ä»¶ï¼Œæ—¢å¯ä»¥æ”¯æŒ HTTPã€https çš„æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼Œä¹Ÿå¯ä»¥æ”¯æŒ RPC çš„æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼Œæ¯”å¦‚ Dubboï¼Œä¹Ÿæ˜¯å‡ºè‡ªäºé˜¿é‡Œï¼Œå®Œå…¨å¯ä»¥æ›¿ä»£ Eurekaã€ZooKeeperã€Consulã€‚</p>\n<h3 id=\"ä¼ä¸šä¸­nacosä½¿ç”¨\"><a class=\"anchor\" href=\"#ä¼ä¸šä¸­nacosä½¿ç”¨\">#</a> ä¼ä¸šä¸­ nacos ä½¿ç”¨</h3>\n<p>ä¸€èˆ¬ç”¨ä½œé…ç½®æ–‡ä»¶çš„ä¸‹å‘</p>\n<h3 id=\"mysqlå­˜å‚¨é…ç½®\"><a class=\"anchor\" href=\"#mysqlå­˜å‚¨é…ç½®\">#</a> mysql å­˜å‚¨é…ç½®</h3>\n<h4 id=\"nacosé…ç½®\"><a class=\"anchor\" href=\"#nacosé…ç½®\">#</a> nacos é…ç½®</h4>\n<p>æ ¸å¿ƒé…ç½®ä½äº conf/application.propertiesã€‚nacos é…ç½®æ–‡ä»¶é»˜è®¤å­˜æ”¾äºå†…ç½®æ•°æ®åº“ derby ä¸­ï¼Œå¯ä»¥æ›´æ”¹ nacos é…ç½®æ¥ä½¿å¾—é…ç½®æ–‡ä»¶å­˜æ”¾äºå…¶ä»–æ•°æ®åº“ä¸­ï¼Œè¿™é‡Œä»¥ MySQL ä¸ºä¾‹ã€‚</p>\n<figure class=\"highlight properties\"><figcaption data-lang=\".properties\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Copyright 1999-2018 Alibaba Group Holding Ltd.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Licensed under the Apache License, Version 2.0 (the \"License\");</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># you may not use this file except in compliance with the License.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># You may obtain a copy of the License at</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#      http://www.apache.org/licenses/LICENSE-2.0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># Unless required by applicable law or agreed to in writing, software</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># distributed under the License is distributed on an \"AS IS\" BASIS,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># See the License for the specific language governing permissions and</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># limitations under the License.</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#*************** Spring Boot Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">### Default web context path:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token attr-name\">server.servlet.contextPath</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">/nacos</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">### Default web server port:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token attr-name\">server.port</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">8848</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#*************** Network Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">### If prefer hostname over ip for Nacos server addresses in cluster.conf:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># nacos.inetutils.prefer-hostname-over-ip=false</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">### Specify local server's IP:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># nacos.inetutils.ip-address=</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\"># ä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œå°†é…ç½®çš„æ›´æ”¹å†™å…¥ MySQL</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#*************** Config Module Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">### If use MySQL as datasource:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token attr-name\">spring.datasource.platform</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">mysql</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\"># å¯ä»¥æœ‰ä¸¤ä¸ªæ•°æ®åº“ï¼Œç›¸å½“äºä¸»ä»å¤‡ä»½</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">### Count of DB:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token attr-name\">db.num</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">1</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">### Connect URL of DB:</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token attr-name\">db.url.0</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token attr-name\">db.user.0</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">root</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token attr-name\">db.password.0</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">123456</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\">#æ•°æ®åº“è¿æ¥æ± </span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\">### Connection pool configuration: hikariCP</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token attr-name\">db.pool.config.connectionTimeout</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">30000</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token attr-name\">db.pool.config.validationTimeout</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">10000</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token attr-name\">db.pool.config.maximumPoolSize</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">20</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token attr-name\">db.pool.config.minimumIdle</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">2</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\">#*************** Naming Module Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">### Data dispatch task execution period in milliseconds: Will removed on v2.1.X, replace with nacos.core.protocol.distro.data.sync.delayMs</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token comment\"># nacos.naming.distro.taskDispatchPeriod=200</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token comment\">### Data count of batch sync task: Will removed on v2.1.X. Deprecated</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\"># nacos.naming.distro.batchSyncKeyCount=1000</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">### Retry delay in milliseconds if sync task failed: Will removed on v2.1.X, replace with nacos.core.protocol.distro.data.sync.retryDelayMs</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token comment\"># nacos.naming.distro.syncRetryDelay=5000</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token comment\">### If enable data warmup. If set to false, the server would accept request without local data preparation:</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token comment\"># nacos.naming.data.warmup=true</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token comment\">### If enable the instance auto expiration, kind like of health check of instance:</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token comment\"># nacos.naming.expireInstance=true</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\">### will be removed and replaced by `nacos.naming.clean` properties</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token attr-name\">nacos.naming.empty-service.auto-clean</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token attr-name\">nacos.naming.empty-service.clean.initial-delay-ms</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">50000</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token attr-name\">nacos.naming.empty-service.clean.period-time-ms</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">30000</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token comment\">### Add in 2.0.0</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token comment\">### The interval to clean empty service, unit: milliseconds.</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token comment\"># nacos.naming.clean.empty-service.interval=60000</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token comment\">### The expired time to clean empty service, unit: milliseconds.</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token comment\"># nacos.naming.clean.empty-service.expired-time=60000</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token comment\">### The interval to clean expired metadata, unit: milliseconds.</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token comment\"># nacos.naming.clean.expired-metadata.interval=5000</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token comment\">### The expired time to clean metadata, unit: milliseconds.</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token comment\"># nacos.naming.clean.expired-metadata.expired-time=60000</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token comment\">### The delay time before push task to execute from service changed, unit: milliseconds.</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token comment\"># nacos.naming.push.pushTaskDelay=500</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token comment\">### The timeout for push task execute, unit: milliseconds.</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token comment\"># nacos.naming.push.pushTaskTimeout=5000</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token comment\">### The delay time for retrying failed push task, unit: milliseconds.</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token comment\"># nacos.naming.push.pushTaskRetryDelay=1000</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre></pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token comment\">#æ”¯æŒ Configuration Manager Databaseï¼ˆç”¨äºä¼ä¸šçº§ it èµ„äº§ç®¡ç†ï¼ŒåŒ…æ‹¬ç¡¬ä»¶ï¼‰</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token comment\">#*************** CMDB Module Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre><span class=\"token comment\">### The interval to dump external CMDB in seconds:</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token comment\"># nacos.cmdb.dumpTaskInterval=3600</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token comment\">### The interval of polling data change event in seconds:</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token comment\"># nacos.cmdb.eventTaskInterval=10</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token comment\">### The interval of loading labels in seconds:</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token comment\"># nacos.cmdb.labelTaskInterval=300</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token comment\">### If turn on data loading task:</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token comment\"># nacos.cmdb.loadDataAtStart=false</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre></pre></td></tr><tr><td data-num=\"108\"></td><td><pre></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token comment\">#ç”¨äºç›‘æµ‹æœåŠ¡å¥åº·çŠ¶æ€å¹¶ä¸ŠæŠ¥åˆ° prometheus</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre><span class=\"token comment\">#*************** Metrics Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre><span class=\"token comment\">### Metrics for prometheus</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre><span class=\"token comment\">#management.endpoints.web.exposure.include=*</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre></pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token comment\">### Metrics for elastic search</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token attr-name\">management.metrics.export.elastic.enabled</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">false</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token comment\">#management.metrics.export.elastic.host=http://localhost:9200</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre></pre></td></tr><tr><td data-num=\"118\"></td><td><pre><span class=\"token comment\">### Metrics for influx</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token attr-name\">management.metrics.export.influx.enabled</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">false</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre><span class=\"token comment\">#management.metrics.export.influx.db=springboot</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre><span class=\"token comment\">#management.metrics.export.influx.uri=http://localhost:8086</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre><span class=\"token comment\">#management.metrics.export.influx.auto-create-db=true</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre><span class=\"token comment\">#management.metrics.export.influx.consistency=one</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre><span class=\"token comment\">#management.metrics.export.influx.compressed=true</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre></pre></td></tr><tr><td data-num=\"126\"></td><td><pre><span class=\"token comment\">#*************** Access Log Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre><span class=\"token comment\">### If turn on the access log:</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre><span class=\"token attr-name\">server.tomcat.accesslog.enabled</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre></pre></td></tr><tr><td data-num=\"130\"></td><td><pre><span class=\"token comment\">### The access log pattern:</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre><span class=\"token attr-name\">server.tomcat.accesslog.pattern</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">%h %l %u %t \"%r\" %s %b %D %&#123;User-Agent&#125;i %&#123;Request-Source&#125;i</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token comment\">### The directory of access log:</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre><span class=\"token attr-name\">server.tomcat.basedir</span><span class=\"token punctuation\">=</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre></pre></td></tr><tr><td data-num=\"136\"></td><td><pre><span class=\"token comment\">#*************** Access Control Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre><span class=\"token comment\">### If enable spring security, this option is deprecated in 1.2.0:</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre><span class=\"token comment\">#spring.security.enabled=false</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre></pre></td></tr><tr><td data-num=\"140\"></td><td><pre><span class=\"token comment\">### The ignore urls of auth, is deprecated in 1.2.0:</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre><span class=\"token attr-name\">nacos.security.ignore.urls</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">/,/error,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-ui/public/**,/v1/auth/**,/v1/console/health/**,/actuator/**,/v1/console/server/**</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre></pre></td></tr><tr><td data-num=\"143\"></td><td><pre><span class=\"token comment\">### The auth system to use, currently only 'nacos' and 'ldap' is supported:</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre><span class=\"token attr-name\">nacos.core.auth.system.type</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">nacos</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre></pre></td></tr><tr><td data-num=\"146\"></td><td><pre><span class=\"token comment\">### If turn on auth system:</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre><span class=\"token attr-name\">nacos.core.auth.enabled</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">false</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre></pre></td></tr><tr><td data-num=\"149\"></td><td><pre><span class=\"token comment\">### worked when nacos.core.auth.system.type=ldapï¼Œ&#123;0&#125; is Placeholder,replace login username</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre><span class=\"token comment\"># nacos.core.auth.ldap.url=ldap://localhost:389</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre><span class=\"token comment\"># nacos.core.auth.ldap.userdn=cn=&#123;0&#125;,ou=user,dc=company,dc=com</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre></pre></td></tr><tr><td data-num=\"153\"></td><td><pre><span class=\"token comment\">### The token expiration in seconds:</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre><span class=\"token attr-name\">nacos.core.auth.default.token.expire.seconds</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">18000</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre></pre></td></tr><tr><td data-num=\"156\"></td><td><pre><span class=\"token comment\">### The default token:</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre><span class=\"token attr-name\">nacos.core.auth.default.token.secret.key</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">SecretKey012345678901234567890123456789012345678901234567890123456789</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre></pre></td></tr><tr><td data-num=\"159\"></td><td><pre><span class=\"token comment\">### Turn on/off caching of auth information. By turning on this switch, the update of auth information would have a 15 seconds delay.</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre><span class=\"token attr-name\">nacos.core.auth.caching.enabled</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre></pre></td></tr><tr><td data-num=\"162\"></td><td><pre><span class=\"token comment\">### Since 1.4.1, Turn on/off white auth for user-agent: nacos-server, only for upgrade from old version.</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre><span class=\"token attr-name\">nacos.core.auth.enable.userAgentAuthWhite</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">false</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre></pre></td></tr><tr><td data-num=\"165\"></td><td><pre><span class=\"token comment\">### Since 1.4.1, worked when nacos.core.auth.enabled=true and nacos.core.auth.enable.userAgentAuthWhite=false.</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre><span class=\"token comment\">### The two properties is the white list for auth and used by identity the request from other server.</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre><span class=\"token attr-name\">nacos.core.auth.server.identity.key</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">serverIdentity</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre><span class=\"token attr-name\">nacos.core.auth.server.identity.value</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">security</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre></pre></td></tr><tr><td data-num=\"170\"></td><td><pre><span class=\"token comment\">#*************** Istio Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre><span class=\"token comment\">### If turn on the MCP server:</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre><span class=\"token attr-name\">nacos.istio.mcp.server.enabled</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">false</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre></pre></td></tr><tr><td data-num=\"174\"></td><td><pre><span class=\"token comment\">#*************** Core Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre></pre></td></tr><tr><td data-num=\"176\"></td><td><pre><span class=\"token comment\">### set the WorkerID manually</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre><span class=\"token comment\"># nacos.core.snowflake.worker-id=</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre></pre></td></tr><tr><td data-num=\"179\"></td><td><pre><span class=\"token comment\">### Member-MetaData</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre><span class=\"token comment\"># nacos.core.member.meta.site=</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre><span class=\"token comment\"># nacos.core.member.meta.adweight=</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre><span class=\"token comment\"># nacos.core.member.meta.weight=</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre></pre></td></tr><tr><td data-num=\"184\"></td><td><pre><span class=\"token comment\">### MemberLookup</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre><span class=\"token comment\">### Addressing pattern category, If set, the priority is highest</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre><span class=\"token comment\"># nacos.core.member.lookup.type=[file,address-server]</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre><span class=\"token comment\">## Set the cluster list with a configuration file or command-line argument</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre><span class=\"token comment\"># nacos.member.list=192.168.16.101:8847?raft_port=8807,192.168.16.101?raft_port=8808,192.168.16.101:8849?raft_port=8809</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre><span class=\"token comment\">## for AddressServerMemberLookup</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre><span class=\"token comment\"># Maximum number of retries to query the address server upon initialization</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre><span class=\"token comment\"># nacos.core.address-server.retry=5</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre><span class=\"token comment\">## Server domain name address of [address-server] mode</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre><span class=\"token comment\"># address.server.domain=jmenv.tbsite.net</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre><span class=\"token comment\">## Server port of [address-server] mode</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre><span class=\"token comment\"># address.server.port=8080</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre><span class=\"token comment\">## Request address of [address-server] mode</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre><span class=\"token comment\"># address.server.url=/nacos/serverlist</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre></pre></td></tr><tr><td data-num=\"199\"></td><td><pre><span class=\"token comment\">#*************** JRaft Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre></pre></td></tr><tr><td data-num=\"201\"></td><td><pre><span class=\"token comment\">### Sets the Raft cluster election timeout, default value is 5 second</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.raft.data.election_timeout_ms=5000</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre><span class=\"token comment\">### Sets the amount of time the Raft snapshot will execute periodically, default is 30 minute</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.raft.data.snapshot_interval_secs=30</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre><span class=\"token comment\">### raft internal worker threads</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.raft.data.core_thread_num=8</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre><span class=\"token comment\">### Number of threads required for raft business request processing</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.raft.data.cli_service_thread_num=4</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre><span class=\"token comment\">### raft linear read strategy. Safe linear reads are used by default, that is, the Leader tenure is confirmed by heartbeat</span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.raft.data.read_index_type=ReadOnlySafe</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre><span class=\"token comment\">### rpc request timeout, default 5 seconds</span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.raft.data.rpc_request_timeout_ms=5000</span></pre></td></tr><tr><td data-num=\"213\"></td><td><pre></pre></td></tr><tr><td data-num=\"214\"></td><td><pre><span class=\"token comment\">#*************** Distro Related Configurations ***************#</span></pre></td></tr><tr><td data-num=\"215\"></td><td><pre></pre></td></tr><tr><td data-num=\"216\"></td><td><pre><span class=\"token comment\">### Distro data sync delay time, when sync task delayed, task will be merged for same data key. Default 1 second.</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.distro.data.sync.delayMs=1000</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre></pre></td></tr><tr><td data-num=\"219\"></td><td><pre><span class=\"token comment\">### Distro data sync timeout for one sync data, default 3 seconds.</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.distro.data.sync.timeoutMs=3000</span></pre></td></tr><tr><td data-num=\"221\"></td><td><pre></pre></td></tr><tr><td data-num=\"222\"></td><td><pre><span class=\"token comment\">### Distro data sync retry delay time when sync data failed or timeout, same behavior with delayMs, default 3 seconds.</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.distro.data.sync.retryDelayMs=3000</span></pre></td></tr><tr><td data-num=\"224\"></td><td><pre></pre></td></tr><tr><td data-num=\"225\"></td><td><pre><span class=\"token comment\">### Distro data verify interval time, verify synced data whether expired for a interval. Default 5 seconds.</span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.distro.data.verify.intervalMs=5000</span></pre></td></tr><tr><td data-num=\"227\"></td><td><pre></pre></td></tr><tr><td data-num=\"228\"></td><td><pre><span class=\"token comment\">### Distro data verify timeout for one verify, default 3 seconds.</span></pre></td></tr><tr><td data-num=\"229\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.distro.data.verify.timeoutMs=3000</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre></pre></td></tr><tr><td data-num=\"231\"></td><td><pre><span class=\"token comment\">### Distro data load retry delay when load snapshot data failed, default 30 seconds.</span></pre></td></tr><tr><td data-num=\"232\"></td><td><pre><span class=\"token comment\"># nacos.core.protocol.distro.data.load.retryDelayMs=30000</span></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶åé‡å¯ nacosï¼Œæ–°å¢é…ç½®æ–‡ä»¶å¹¶æŸ¥çœ‹æ•°æ®åº“</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210723153956725.png\" alt=\"image-20210723153956725\" /></p>\n<p>æ­¤å¤–ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢å†å²ç‰ˆæœ¬çš„é…ç½®è¿›è¡Œå›æ»š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210723154647080.png\" alt=\"image-20210723154647080\" /></p>\n<h3 id=\"nacosé›†ç¾¤é…ç½®\"><a class=\"anchor\" href=\"#nacosé›†ç¾¤é…ç½®\">#</a> Nacos é›†ç¾¤é…ç½®</h3>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210723155011953.png\" alt=\"image-20210723155011953\" /></p>\n<p>Nacos æ”¯æŒä¸‰ç§éƒ¨ç½²æ¨¡å¼</p>\n<ul>\n<li>å•æœºæ¨¡å¼ - ç”¨äºæµ‹è¯•å’Œå•æœºè¯•ç”¨ã€‚</li>\n<li>é›†ç¾¤æ¨¡å¼ - ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿é«˜å¯ç”¨ã€‚</li>\n<li>å¤šé›†ç¾¤æ¨¡å¼ - ç”¨äºå¤šæ•°æ®ä¸­å¿ƒåœºæ™¯ã€‚</li>\n</ul>\n<p>window ä¸‹é»˜è®¤å¯åŠ¨è„šæœ¬ä¸ºå•æœºç‰ˆ</p>\n<p>ä¿®æ”¹ startup.cmdï¼Œæˆ–è€…åœ¨å¯åŠ¨æ—¶åŠ å‚æ•° startup.cmd -m cluster</p>\n<pre><code>set MODE=&quot;cluster&quot;\n</code></pre>\n<p>ä¿®æ”¹ conf/cluster.conf</p>\n<pre><code>172.20.10.3:8848\n172.20.10.3:8847\n172.20.10.3:8846\n</code></pre>\n<p>æ¥ä¸‹æ¥å¤åˆ¶ä¸‰åˆ† nacos å®‰è£…ç›®å½•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210723155851974.png\" alt=\"image-20210723155851974\" /></p>\n<p>æ›´æ”¹å¤åˆ¶å‡ºæ¥çš„ä¸¤ä»½ä¸­çš„ conf/application.properties ç«¯å£ä¸ºä»¥ä¸Šé›†ç¾¤é…ç½® conf/cluster.conf ä¸­é…ç½®çš„ç«¯å£ 8847ã€8846ï¼Œæœ€åä»¥é›†ç¾¤æ¨¡å¼å¯åŠ¨ã€‚åŒæ—¶éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†å…¶ä½™ä¸¤ä¸ª nacos çš„ ip åŠ å…¥</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 172.20.10.3<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span><span class=\"token punctuation\">,</span>172.20.10.3<span class=\"token punctuation\">:</span><span class=\"token number\">8847</span><span class=\"token punctuation\">,</span>172.20.10.3<span class=\"token punctuation\">:</span><span class=\"token number\">8846</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 172.20.10.3<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">file-extension</span><span class=\"token punctuation\">:</span> yaml</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myNacos</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8081</span></pre></td></tr></table></figure><p>å¯åŠ¨æ—¶æŠ¥é”™ï¼š</p>\n<pre><code class=\"language-cmd\">Error occurred during initialization of VM\nCould not reserve enough space for object heap\n</code></pre>\n<p>ä¿®æ”¹ bin/startup.cmd æ–‡ä»¶ï¼Œå°†å †å†…å­˜ - Xmx åŠ å¤§åˆ° 1024m</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> %MODE% <span class=\"token operator\">==</span> <span class=\"token string\">\"standalone\"</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"nacos is starting with standalone\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t  <span class=\"token builtin class-name\">set</span> <span class=\"token string\">\"NACOS_OPTS=-Dnacos.standalone=true\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token builtin class-name\">set</span> <span class=\"token string\">\"NACOS_JVM_OPTS=-Xms512m -Xmx1024m -Xmn256m\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>å¯åŠ¨åï¼ŒæŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ­¤æ—¶ï¼Œæ›´æ”¹ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„é…ç½®ä¼šå®æ—¶åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ä¸­</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210723164310450.png\" alt=\"image-20210723164310450\" /></p>\n<h3 id=\"åŠ¨æ€dnsæœåŠ¡\"><a class=\"anchor\" href=\"#åŠ¨æ€dnsæœåŠ¡\">#</a> åŠ¨æ€ DNS æœåŠ¡</h3>\n<p>é€šè¿‡æ”¯æŒæƒé‡è·¯ç”±ï¼ŒåŠ¨æ€ DNS æœåŠ¡èƒ½è®©æ‚¨è½»æ¾å®ç°ä¸­é—´å±‚è´Ÿè½½å‡è¡¡ã€æ›´çµæ´»çš„è·¯ç”±ç­–ç•¥ã€æµé‡æ§åˆ¶ä»¥åŠç®€å•æ•°æ®ä¸­å¿ƒå†…ç½‘çš„ç®€å• DNS è§£ææœåŠ¡ã€‚åŠ¨æ€ DNS æœåŠ¡è¿˜èƒ½è®©æ‚¨æ›´å®¹æ˜“åœ°å®ç°ä»¥ DNS åè®®ä¸ºåŸºç¡€çš„æœåŠ¡å‘ç°ï¼Œä»¥æ¶ˆé™¤è€¦åˆåˆ°å‚å•†ç§æœ‰æœåŠ¡å‘ç° API ä¸Šçš„é£é™©ã€‚</p>\n<h3 id=\"nacosæ•´åˆnginxè´Ÿè½½å‡è¡¡\"><a class=\"anchor\" href=\"#nacosæ•´åˆnginxè´Ÿè½½å‡è¡¡\">#</a> Nacos æ•´åˆ Nginx è´Ÿè½½å‡è¡¡</h3>\n<p>ä»¥ä¸Š nacos é›†ç¾¤å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œå®¢æˆ·ç«¯é…ç½®å¯èƒ½è´Ÿè½½ä¸å‡è¡¡ï¼Œåªå¾€ä¸€ä¸ªèŠ‚ç‚¹å†™é…ç½®ï¼Œå¯¼è‡´å…¶ä»–èŠ‚ç‚¹é—²ç½®ï¼Œä¸ºæ­¤å¯ä»¥ä½¿ç”¨ nginx åŠ ä¸€å±‚ä»£ç†åšè´Ÿè½½å‡è¡¡</p>\n<pre><code class=\"language-cmd\">    upstream nacos &#123;\n\tserver 172.20.10.3:8846;\n\tserver 172.20.10.3:8847;\n\tserver 172.20.10.3:8848;\n\n&#125;\nserver &#123;\n  listen       80;\n  server_name  localhost;\n\nlocation /&#123;\n\tproxy_pass http://nacos/;\n&#125;\n&#125;\n</code></pre>\n<p>è®¿é—®ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdC9uYWNvcy9pbmRleC5odG1s\">http://localhost/nacos/index.html</span></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210723174750144.png\" alt=\"image-20210723174750144\" /></p>\n<p>æ­¤æ—¶ï¼Œé…ç½®æ–‡ä»¶ä¹Ÿå¯ä»¥æ”¹ä¸º nginx ä»£ç†</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> 172.20.10.3<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">file-extension</span><span class=\"token punctuation\">:</span> yaml</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myNacos</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8081</span></pre></td></tr></table></figure><h3 id=\"nacoså¯†ç ä¿®æ”¹\"><a class=\"anchor\" href=\"#nacoså¯†ç ä¿®æ”¹\">#</a> Nacos å¯†ç ä¿®æ”¹</h3>\n<p>å¯ä»¥ç›´æ¥åœ¨ç•Œé¢ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ SpringSecurity æä¾›çš„ç±»ä¿®æ”¹</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">new</span> <span class=\"token class-name\">BCryptPasswordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token number\">111111</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"nacossync-è¿ç§»å…¶ä»–æ³¨å†Œä¸­å¿ƒçš„æ•°æ®\"><a class=\"anchor\" href=\"#nacossync-è¿ç§»å…¶ä»–æ³¨å†Œä¸­å¿ƒçš„æ•°æ®\">#</a> NacosSync è¿ç§»å…¶ä»–æ³¨å†Œä¸­å¿ƒçš„æ•°æ®</h3>\n<p>å®˜æ–¹æ–‡æ¡£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uYWNvcy5pby96aC1jbi9kb2NzL25hY29zLXN5bmMtdXNlLmh0bWw=\">https://nacos.io/zh-cn/docs/nacos-sync-use.html</span></p>\n<p>CMDB</p>\n<p>Nacos å®˜ç½‘æä¾›äº†ç»“åˆ Prometheus å’Œ Grafana å®ç° Metrics ç›‘æ§çš„ç¤ºä¾‹ã€‚</p>\n<h3 id=\"cap-å®šå¾‹\"><a class=\"anchor\" href=\"#cap-å®šå¾‹\">#</a> CAP å®šå¾‹</h3>\n<p>æ¨è DNS è§£æ Nacos åœ°å€ï¼Œæˆ–è€…ä½¿ç”¨ Nginx è¿›è¡Œ TCP å±‚ä»£ç†ï¼Œè¿™æ ·é…ç½®çš„ Nacos åœ°å€ä¿¡æ¯å°±ä¸ä¼šè·Ÿéš Nacos çš„ IP å˜åŒ–è€Œå˜åŒ–ã€‚Nacos çš„æ³¨å†Œä¸­å¿ƒçš„æŒä¹…åŒ–æ˜¯å­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„ï¼ŒMySQL å­˜å‚¨çš„æ˜¯é…ç½®ã€‚</p>\n<h3 id=\"raft-åè®®\"><a class=\"anchor\" href=\"#raft-åè®®\">#</a> Raft åè®®</h3>\n<h4 id=\"raft-å®ç°åŸç†\"><a class=\"anchor\" href=\"#raft-å®ç°åŸç†\">#</a> Raft å®ç°åŸç†</h4>\n<ol>\n<li>leader é€‰ä¸¾ï¼šé›†ç¾¤ä¸­å¿…é¡»å­˜åœ¨ä¸€ä¸ª leader èŠ‚ç‚¹ã€‚</li>\n<li>æ—¥å¿—å¤åˆ¶ï¼šleader èŠ‚ç‚¹æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å°†è¿™äº›åºåˆ—åŒ–æ—¥å¿—åŒæ­¥åˆ°å…¶å®ƒçš„èŠ‚ç‚¹ã€‚</li>\n<li>å®‰å…¨æ€§ï¼šå¦‚æœæŸä¸ªèŠ‚ç‚¹å·²ç»å°†ä¸€æ¡æäº¤è¿‡çš„æ•°æ®è¾“å…¥ Raft çŠ¶æ€æœºï¼Œå…¶ä»–èŠ‚ç‚¹ä¸èƒ½å°†ç›¸åŒç´¢å¼•çš„å¦ä¸€æ¡æ•°æ®è¾“å…¥åˆ° Raft çŠ¶æ€æœºä¸­æ‰§è¡Œã€‚</li>\n</ol>\n<p>åŠ¨ç”»å±•ç¤ºï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3RoZXNlY3JldGxpdmVzb2ZkYXRhLmNvbS9yYWZ0Lw==\">http://thesecretlivesofdata.com/raft/</span></p>\n<h3 id=\"mse\"><a class=\"anchor\" href=\"#mse\">#</a> MSE</h3>\n<p>é˜¿é‡Œäº‘æä¾›çš„å¾®æœåŠ¡å¼•æ“ï¼Œä¼ä¸šç‰ˆ Nacos</p>\n",
            "tags": [
                "Java",
                "å¾®æœåŠ¡",
                "Java",
                "é…ç½®ä¸­å¿ƒ",
                "æ³¨å†Œä¸­å¿ƒ",
                "SpringCloud",
                "å¾®æœåŠ¡",
                "Sentinel",
                "é™æµ",
                "ç†”æ–­",
                "Gateway",
                "Nacos",
                "Raftåè®®",
                "CAP",
                "Zuul",
                "Hystrix"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/JVM/JVM-GC/",
            "url": "https://baiyezi.vip/java/JVM/JVM-GC/",
            "title": "JVM-GC",
            "date_published": "2021-07-05T13:30:04.000Z",
            "content_html": "<h2 id=\"garbage-collector\"><a class=\"anchor\" href=\"#garbage-collector\">#</a> Garbage Collector</h2>\n<p>JVM ä¸­çš„åƒåœ¾æ˜¯æŒ‡ï¼šæ²¡æœ‰ä»»ä½•å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ŒJVM ä¼šè‡ªåŠ¨å¯¹è¿™äº›å¯¹è±¡è‡ªè¿›è¡Œå›æ”¶ï¼Œä»è€Œè¾¾åˆ°æ¸…ç†å†…å­˜çš„æ•ˆæœ</p>\n<h2 id=\"jvmå¯»æ‰¾åƒåœ¾\"><a class=\"anchor\" href=\"#jvmå¯»æ‰¾åƒåœ¾\">#</a> JVM å¯»æ‰¾åƒåœ¾</h2>\n<h3 id=\"å¼•ç”¨è®¡æ•°ç®—æ³•reference-count\"><a class=\"anchor\" href=\"#å¼•ç”¨è®¡æ•°ç®—æ³•reference-count\">#</a> å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆreference countï¼‰</h3>\n<p>å½“æœ‰å¼•ç”¨æŒ‡å‘å¯¹è±¡æ—¶ï¼Œé‚£ä¹ˆæŒ‡å‘è¯¥å¯¹è±¡çš„è®¡æ•°å°±åŠ  1ï¼Œå½“è®¡æ•°ä¸º 0 æ—¶å°±ä»£è¡¨æ²¡æœ‰å¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±æ˜¯å¯å›æ”¶çš„åƒåœ¾å¯¹è±¡ã€‚</p>\n<p>è¿™ç§ç®—æ³•æ— æ³•è§£å†³å¾ªåå¼•ç”¨å¯¹è±¡å˜ä¸ºåƒåœ¾æ—¶çš„å›æ”¶ï¼Œæ­¤æ—¶éœ€è¦æ ¹å¯è¾¾ç®—æ³•æ¥è§£å†³</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210308183607659.png\" alt=\"image-20210308183607659\" /></p>\n<h3 id=\"æ ¹å¯è¾¾æ€§ç®—æ³•root-searching\"><a class=\"anchor\" href=\"#æ ¹å¯è¾¾æ€§ç®—æ³•root-searching\">#</a> æ ¹å¯è¾¾æ€§ç®—æ³•ï¼ˆRoot Searchingï¼‰</h3>\n<p>ä¸æ ¹å¯¹è±¡æ— å…³çš„å¯¹è±¡å°±æ˜¯åƒåœ¾å¯¹è±¡</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210308183116456.png\" alt=\"image-20210308183116456\" /></p>\n<p>å“ªäº›æ˜¯æ ¹å¯¹è±¡ï¼Ÿ</p>\n<p>çº¿ç¨‹æ ˆå˜é‡ï¼šmain æ–¹æ³•ä¸­çš„å˜é‡</p>\n<p>å¸¸é‡æ± ï¼šå¸¸é‡æ± ä¸­çš„ç±»å¼•ç”¨å…¶ä»–ç±»çš„å¯¹è±¡</p>\n<p>JNI æŒ‡é’ˆï¼šC æˆ– C++ å†™çš„æœ¬åœ°æ–¹æ³•ä¸­çš„ç±»æˆ–å¯¹è±¡</p>\n<p>æ ¹å¯¹è±¡çš„ç‰¹ç‚¹å°±æ˜¯å½“ç¨‹åºå¯åŠ¨åç«‹å³åŠ è½½çš„å¯¹è±¡</p>\n<h2 id=\"gcå¸¸ç”¨æ¸…é™¤åƒåœ¾ç®—æ³•\"><a class=\"anchor\" href=\"#gcå¸¸ç”¨æ¸…é™¤åƒåœ¾ç®—æ³•\">#</a> GC å¸¸ç”¨æ¸…é™¤åƒåœ¾ç®—æ³•</h2>\n<h3 id=\"æ ‡è®°æ¸…é™¤ç®—æ³•mark-sweep\"><a class=\"anchor\" href=\"#æ ‡è®°æ¸…é™¤ç®—æ³•mark-sweep\">#</a> æ ‡è®°æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</h3>\n<p>æ‰¾åˆ°åƒåœ¾å¯¹è±¡åè¿›è¡Œæ ‡è®°æ¸…é™¤ï¼Œå­˜æ´»å¯¹è±¡æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹æ•ˆç‡è¾ƒé«˜ã€‚ç®—æ³•ä¸Šçœ‹æ˜¯ç»è¿‡äº†ä¸¤è¾¹æ‰«æï¼Œæ•ˆç‡åä½ï¼Œä¸€éæ‰«æç”¨äºæ ‡è®°ä¸å¯å›æ”¶çš„å¯¹è±¡ï¼ˆGC Roots å¯è¾¾çš„å¯¹è±¡æ ‡è®°ä¸ºå­˜æ´»çš„å¯¹è±¡ï¼‰ï¼Œç¬¬äºŒéæ‰«æç”¨äºæ¸…é™¤å¯å›æ”¶çš„å¯¹è±¡ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´ï¼Œç¢ç‰‡è¿‡å¤šä¼šå¯¼è‡´å¤§å¯¹è±¡æ— æ³•åˆ†é…åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜ï¼Œä»è€Œä¸å¾—ä¸æå‰è§¦å‘ GCï¼Œç”šè‡³ Stop The Worldã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210308185946936.png\" alt=\"image-20210308185946936\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210308190941445.png\" alt=\"image-20210308190941445\" /></p>\n<h3 id=\"æ‹·è´ç®—æ³•copying\"><a class=\"anchor\" href=\"#æ‹·è´ç®—æ³•copying\">#</a> æ‹·è´ç®—æ³•ï¼ˆCopyingï¼‰</h3>\n<p>å°†å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—å†…å­˜ï¼Œå½“å…¶ä¸­ä¸€å—å†…å­˜å¿«ç”¨å®Œçš„æ—¶å€™ï¼Œå°±å°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—å†…å­˜ï¼ˆå¯¹è±¡çš„å¼•ç”¨ä¹Ÿå°†å‘ç”Ÿå˜åŒ–ï¼‰ï¼Œç„¶åæ¸…ç†ä½¿ç”¨è¿‡çš„é‚£ä¸€å—å†…å­˜ï¼Œè¿™æ ·ä¸ä¼šæœ‰å†…å­˜ç¢ç‰‡ï¼Œé€‚åˆå­˜æ´»å¯¹è±¡è¾ƒå°‘ï¼ˆé€‚åˆ Eden åŒºï¼‰çš„æƒ…å†µã€‚ç¼ºç‚¹æ˜¯æµªè´¹ç©ºé—´ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210308192400614.png\" alt=\"image-20210308192400614\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210308203944.png\" alt=\"image-20210308203932923\" /></p>\n<h3 id=\"æ ‡è®°å‹ç¼©ç®—æ³•mark-compact\"><a class=\"anchor\" href=\"#æ ‡è®°å‹ç¼©ç®—æ³•mark-compact\">#</a> æ ‡è®°å‹ç¼©ç®—æ³•ï¼ˆMark-Compactï¼‰</h3>\n<p>æ ‡è®°å­˜æ´»çš„å¯¹è±¡ï¼Œå¹¶å°†å­˜æ´»çš„å¯¹è±¡ç§»åŠ¨åˆ°ä¸€ç«¯åå‹ç¼©åˆ°ä¸€å—è¿ç»­çš„å†…å­˜ï¼ˆæ‰€ä»¥ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼‰ï¼Œç„¶åç›´æ¥æ¸…é™¤ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ä¸­å¯å›æ”¶çš„å¯¹è±¡ï¼Œæ•ˆç‡åä½ï¼ˆä¸¤éæ‰«æï¼ŒæŒ‡é’ˆéœ€è¦è°ƒæ•´ï¼‰</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210308204841.png\" alt=\"image-20210308204441966\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210308204923.png\" alt=\"image-20210308204827254\" /></p>\n<h2 id=\"åˆ†ä»£ç®—æ³•\"><a class=\"anchor\" href=\"#åˆ†ä»£ç®—æ³•\">#</a> åˆ†ä»£ç®—æ³•</h2>\n<p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„åƒåœ¾å›æ”¶å™¨éƒ½æ˜¯åˆ†ä»£çš„ï¼Œé™¤ Epsilonã€ZGCã€Shenandoah ä¹‹å¤–çš„ GC éƒ½æ˜¯ä½¿ç”¨é€»è¾‘åˆ†ä»£æ¨¡å‹</p>\n<p>G1 æ˜¯é€»è¾‘åˆ†ä»£ï¼Œç‰©ç†ä¸åˆ†ä»£ï¼Œé™¤æ­¤ä¹‹å¤–çš„ GC ä¸ä»…é€»è¾‘åˆ†ä»£è€Œä¸”ç‰©ç†åˆ†ä»£ï¼ˆå†…å­˜ä¸Šåˆ†åŒºï¼‰</p>\n<h3 id=\"å †å†…é€»è¾‘åˆ†åŒº\"><a class=\"anchor\" href=\"#å †å†…é€»è¾‘åˆ†åŒº\">#</a> å †å†…é€»è¾‘åˆ†åŒº</h3>\n<p>ä¸é€‚ç”¨äºä¸åˆ†ä»£åƒåœ¾æ”¶é›†å™¨</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309113728879.png\" alt=\"image-20210309113728879\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309094353933.png\" alt=\"image-20210309094353933\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309094628428.png\" alt=\"image-20210309094628428\" /></p>\n<h3 id=\"æ–°ç”Ÿä»£young\"><a class=\"anchor\" href=\"#æ–°ç”Ÿä»£young\">#</a> æ–°ç”Ÿä»£ï¼ˆyoungï¼‰</h3>\n<p>æ–°åˆ›å»ºçš„å¯¹è±¡å¦‚æœæ— æ³•åœ¨æ ˆä¸­åˆ†é…ï¼Œé‚£ä¹ˆå°±ä¼šåˆ†é…ç»™æ–°ç”Ÿä»£åŒºï¼Œæ–°ç”Ÿä»£åˆ†ä¸º Eden åŒºå’Œä¸¤ä¸ª survivor åŒºï¼ˆs1 å’Œ s2ï¼Œç”¨äºå­˜æ”¾ GC åçš„å¯¹è±¡ï¼‰ï¼Œé»˜è®¤æ¯”ä¾‹æ˜¯ 8ï¼š1ï¼š1ã€‚å½“æ–°ç”Ÿä»£å†…å­˜è€—å°½æ—¶å°±ä¼šè§¦å‘æ–°ç”Ÿä»£ä¸­çš„åƒåœ¾å›æ”¶ï¼Œç§°ä¹‹ä¸º MinorGC/YGCã€‚å¯¹äºæ–°ç”Ÿä»£æ¥è¯´ï¼ŒGC ç®—æ³•ä¸­å¤åˆ¶ç®—æ³•æœ€ä¸ºåˆé€‚ï¼Œå› ä¸ºæ–°ç”Ÿä»£ GC åå­˜æ´»å¯¹è±¡æ¯”è¾ƒå°‘ï¼Œå¤åˆ¶å¯¹è±¡çš„æˆæœ¬è¾ƒä½ã€‚</p>\n<ol>\n<li>YGC å›æ”¶ä¹‹åï¼ŒEden å¤§å¤šæ•°çš„å¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œæ´»ç€çš„è¿›å…¥ s0</li>\n<li>å†æ¬¡ YGCï¼Œæ´»ç€çš„å¯¹è±¡ eden + s0 -&gt; s1</li>\n<li>å†æ¬¡ YGCï¼Œeden + s1 -&gt; s0</li>\n<li>å¹´é¾„è¶³å¤Ÿ -&gt; è€å¹´ä»£ ï¼ˆ15 CMS 6ï¼‰</li>\n<li>s åŒºè£…ä¸ä¸‹ -&gt; è€å¹´ä»£</li>\n</ol>\n<h3 id=\"è€å¹´ä»£old\"><a class=\"anchor\" href=\"#è€å¹´ä»£old\">#</a> è€å¹´ä»£ï¼ˆoldï¼‰</h3>\n<p>å½“æ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡åœ¨ survivor åŒºå­˜æ´»ä¸€å®šçš„å¹´é¾„æ—¶å°±ä¼šè¿›å…¥è€å¹´ä»£åŒºï¼Œå½“è€å¹´ä»£æ— æ³•ç»§ç»­åˆ†é…ç©ºé—´æ—¶å°±ä¼šè§¦å‘å¯¹äºè€å¹´ä»£çš„ç©ºé—´å›æ”¶ï¼Œç§°ä¹‹ä¸º MajorGC/FullGCã€‚å¯¹äºè€å¹´ä»£æ¥è¯´ï¼ŒGC ç®—æ³•ä¸­æ ‡è®°æ¸…é™¤æˆ–æ ‡è®°å‹ç¼©ç®—æ³•å‡é€‚ç”¨ã€‚</p>\n<ol>\n<li>é¡½å›ºåˆ†å­</li>\n<li>è€å¹´ä»£æ»¡äº† FGCï¼Œå³ Full GC</li>\n</ol>\n<h3 id=\"æ°¸ä¹…ä»£æ–¹æ³•åŒº\"><a class=\"anchor\" href=\"#æ°¸ä¹…ä»£æ–¹æ³•åŒº\">#</a> æ°¸ä¹…ä»£ï¼ˆæ–¹æ³•åŒºï¼‰</h3>\n<ol>\n<li>æ°¸ä¹…ä»£ å…ƒæ•°æ® - Class</li>\n<li>æ°¸ä¹…ä»£å¿…é¡»æŒ‡å®šå¤§å°é™åˆ¶ ï¼ˆä¸ä¼šåŠ¨æ€æ‰©å®¹ï¼Œå¯èƒ½å‘ç”Ÿå†…å­˜æº¢å‡ºï¼‰ï¼Œå…ƒæ•°æ®å¯ä»¥è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œæ— ä¸Šé™ï¼ˆå—é™äºç‰©ç†å†…å­˜ï¼‰</li>\n<li>å­—ç¬¦ä¸²å¸¸é‡ 1.7 - æ°¸ä¹…ä»£ï¼Œ1.8 - å †</li>\n<li>MethodAreaï¼ˆæ–¹æ³•åŒºï¼‰é€»è¾‘æ¦‚å¿µ - æ°¸ä¹…ä»£ã€å…ƒæ•°æ®</li>\n</ol>\n<h3 id=\"å¯¹è±¡ä½•æ—¶è¿›å…¥è€å¹´ä»£\"><a class=\"anchor\" href=\"#å¯¹è±¡ä½•æ—¶è¿›å…¥è€å¹´ä»£\">#</a> å¯¹è±¡ä½•æ—¶è¿›å…¥è€å¹´ä»£</h3>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309111544062.png\" alt=\"image-20210309111544062\" /></p>\n<ul>\n<li>åŠ¨æ€å¹´é¾„ï¼šå½“æ–°ç”Ÿä»£ GCï¼ˆYGCï¼‰åï¼ŒEden åŒºå’Œ S1 åŒºå­˜æ´»çš„å¯¹è±¡ä¼šè¢«å­˜æ”¾åˆ° S2 åŒºï¼Œå½“è¿™äº›å¯¹è±¡ï¼ˆä¸åŒå¹´é¾„ï¼‰å¤§å°è¶…è¿‡ S2 åŒºçš„ä¸€åŠå¤§å°æ—¶ï¼Œå¯¹è±¡ä¸­å¹´é¾„å¤§çš„å°±ä¼šç›´æ¥è¿›å…¥è€å¹´åŒº <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC85ODlkM2IwNmE0OWQ=\">å‚è€ƒ</span></li>\n<li>è¶…è¿‡ XX:MaxTenuringThreshold æŒ‡å®šçš„æ¬¡æ•°ï¼ˆYGC åå¯¹è±¡çš„å¹´é¾„ï¼‰æ—¶ï¼Œå¯¹è±¡å°±ä¼šè¿›å…¥è€å¹´ä»£ã€‚ä¸åŒåƒåœ¾å™¨çš„åˆ†ä»£å¹´é¾„ä¸åŒ</li>\n</ul>\n<h3 id=\"åˆ†é…æ‹…ä¿\"><a class=\"anchor\" href=\"#åˆ†é…æ‹…ä¿\">#</a> åˆ†é…æ‹…ä¿</h3>\n<p>YGC æœŸé—´ï¼Œå¦‚æœæœ‰æ–°çš„å¯¹è±¡è¢«åˆ†é…ï¼Œä¸” survivor åŒºç©ºé—´ä¸å¤Ÿçš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶å°±ä¼šé€šè¿‡ç©ºé—´æ‹…ä¿è®©å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xMDgyNzMw\">å‚è€ƒ</span></p>\n<h3 id=\"æ ˆä¸Šåˆ†é…å¯¹è±¡\"><a class=\"anchor\" href=\"#æ ˆä¸Šåˆ†é…å¯¹è±¡\">#</a> æ ˆä¸Šåˆ†é…å¯¹è±¡</h3>\n<ul>\n<li>\n<p>çº¿ç¨‹æœ¬åœ°åˆ†é… TLABï¼ˆThread Local Allocation Bufferï¼‰ï¼šæ¯ä¸ªçº¿ç¨‹å æœ‰ Eden åŒºçš„ 1% çš„ç©ºé—´ï¼Œçº¿ç¨‹ä¼˜å…ˆåœ¨å„è‡ªæŒæœ‰çš„ 1% çš„ç©ºé—´ä¸Šåˆ†é…å¯¹è±¡ï¼Œè¿™æ ·å°±ä¸ä¼šä¸å…¶ä»–çº¿ç¨‹äº‰ç”¨ç©ºé—´çš„ç°è±¡ï¼Œæé«˜äº†æ•ˆç‡ã€‚JVM è°ƒä¼˜æ—¶ä¸€èˆ¬æ— éœ€å¯¹è¯¥ç©ºé—´åšè°ƒæ•´ã€‚</p>\n</li>\n<li>\n<p>æ ˆä¸Šåˆ†é…ï¼šå¦‚æœæ˜¯çº¿ç¨‹ç§æœ‰çš„å°å¯¹è±¡ï¼ˆä¸”è¯¥å¯¹è±¡åªåœ¨æŸä¸€å—ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸ä¼šè¢«å¼•ç”¨ï¼ˆåŒ…æ‹¬ä¸ä¼šè¢«è‡ªèº«ç±»çš„å¯¹è±¡å¼•ç”¨ï¼‰ï¼‰ï¼Œé‚£ä¹ˆä¼˜å…ˆåœ¨æ ˆä¸Šåˆ†é…ã€‚JVM è°ƒä¼˜æ—¶ä¸€èˆ¬æ— éœ€å¯¹è¯¥ç©ºé—´åšè°ƒæ•´ã€‚æ ˆä¸Šåˆ†é…çš„æ•ˆç‡æ¯”å †ä¸Šåˆ†é…çš„æ•ˆç‡è¦é«˜ï¼Œä¸”æ ˆä¸Šåˆ†é…ä¸æ¶‰åŠ GCï¼Œåªéœ€è¦å°†å¯¹è±¡ pop å³å¯</p>\n</li>\n</ul>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309103441419.png\" alt=\"image-20210309103441419\" /></p>\n<p>æ— é€ƒé€¸ï¼šæŒ‡çš„æ˜¯å¯¹è±¡åªåœ¨æŸä¸€å—ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸ä¼šä»¥ä»»ä½•å½¢å¼è¢«å¼•ç”¨</p>\n<p>æ”¯æŒæ ‡é‡æ›¿æ¢ï¼šå¯ä»¥ç”¨å¯¹è±¡ä¸­çš„åŸºæœ¬ç±»å‹çš„å±æ€§ä»£æ›¿æ•´ä¸ªå¯¹è±¡</p>\n<p>ä»¥ä¸‹åšä¸€ä¸ªæµ‹è¯•ï¼šåˆ†åˆ«å…³é—­æ‰“å¼€æ ˆä¸Šåˆ†é…ä»¥åŠ TLAB æ—¶ç¨‹åºæ‰§è¡Œçš„æ•ˆç‡</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>gc</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @Author: fan</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * @DateTime: 2021-03-09 10:35</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// æµ‹è¯•æ—¶éœ€è¦ç»™ JVM åŠ ä¸Šä»¥ä¸‹å‚æ•°ï¼ˆå…³é—­æ ˆä¸Šåˆ†é…å’Œçº¿ç¨‹æœ¬åœ°åˆ†é…ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„ï¼‰</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// å»æ‰é€ƒé€¸åˆ†æ             å»æ‰æ ‡é‡æ›¿æ¢               å»æ‰ TLAB</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//-XX:-DoEscapeAnalysis -XX:-EliminateAllocations -XX:-UseTLAB</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// é€ƒé€¸åˆ†æ æ ‡é‡æ›¿æ¢ çº¿ç¨‹ä¸“æœ‰å¯¹è±¡åˆ†é…</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestTLAB</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">//User u;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token string\">\"name \"</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">//        u = new User (i, \"name\" + i); // è¿™æ ·å†™å°±ä»£è¡¨æœ‰é€ƒé€¸</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token class-name\">TestTLAB</span> t <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TestTLAB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">long</span> start <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">1000_0000</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> t<span class=\"token punctuation\">.</span><span class=\"token function\">alloc</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">long</span> end <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>end <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\">//for(;;);</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æœªå…³é—­æ ˆä¸Šåˆ†é…ä»¥åŠ TLAB æ—¶ï¼Œç¨‹åºæ‰§è¡Œæ—¶é—´ä¸º 400ms å·¦å³ã€‚</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309110819631.png\" alt=\"image-20210309110819631\" /></p>\n<p>ç°åœ¨å…³é—­æ ˆä¸Šåˆ†é…ä»¥åŠ TLABï¼š</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309110557258.png\" alt=\"image-20210309110557258\" /></p>\n<p>å…³é—­æ ˆä¸Šåˆ†é…ä»¥åŠ TLAB æ—¶ï¼Œç¨‹åºæ‰§è¡Œçš„æ—¶é—´ä¸º 900ms å·¦å³</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309110731337.png\" alt=\"image-20210309110731337\" /></p>\n<h2 id=\"å¯¹è±¡è¢«åˆ†é…çš„ä½ç½®\"><a class=\"anchor\" href=\"#å¯¹è±¡è¢«åˆ†é…çš„ä½ç½®\">#</a> å¯¹è±¡è¢«åˆ†é…çš„ä½ç½®</h2>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309113328218.png\" alt=\"image-20210309113328218\" /></p>\n<h2 id=\"å¸¸è§çš„åƒåœ¾å›æ”¶å™¨\"><a class=\"anchor\" href=\"#å¸¸è§çš„åƒåœ¾å›æ”¶å™¨\">#</a> å¸¸è§çš„åƒåœ¾å›æ”¶å™¨</h2>\n<p>JDK1.8 é»˜è®¤çš„åƒåœ¾å›æ”¶ï¼šParallel Scavenge + Parallel Old</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309134247791.png\" alt=\"image-20210309134247791\" /></p>\n<ol>\n<li>JDK è¯ç”Ÿåï¼Œç¬¬ä¸€ä¸ªåƒåœ¾å›æ”¶å™¨å°±æ˜¯ Serialï¼ŒSerial æ˜¯å•çº¿ç¨‹çš„ï¼Œåªèƒ½ç©¿è¡Œå›æ”¶ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œè¯ç”Ÿäº† PSï¼ˆParallel Scavengeï¼‰ï¼Œä¸ºäº†é…åˆ CMSï¼Œè¯ç”Ÿäº† PNï¼ˆParallel Newï¼‰ï¼ŒCMS æ˜¯ JDK1.4 ç‰ˆæœ¬åæœŸå¼•å…¥ï¼ŒCMS æ˜¯é‡Œç¨‹ç¢‘å¼çš„ GCï¼Œå®ƒå¼€å¯äº†å¹¶å‘å›æ”¶çš„è¿‡ç¨‹ï¼Œä½†æ˜¯ CMS æ¯›ç—…è¾ƒå¤šï¼Œå› æ­¤ç›®å‰æ²¡æœ‰ä»»ä½•ä¸€ä¸ª JDK ç‰ˆæœ¬é»˜è®¤æ˜¯ CMSã€‚å¹¶å‘åƒåœ¾å›æ”¶æ˜¯å› ä¸ºæ— æ³•å¿å— STWã€‚</li>\n<li>Serial å¹´è½»ä»£ ä¸²è¡Œå›æ”¶</li>\n<li>PS å¹´è½»ä»£ å¹¶è¡Œå›æ”¶</li>\n<li>ParNew å¹´è½»ä»£ é…åˆ CMS çš„å¹¶è¡Œå›æ”¶</li>\n<li>SerialOld</li>\n<li>ParallelOld</li>\n<li>ConcurrentMarkSweep è€å¹´ä»£ å¹¶å‘çš„ï¼Œ åƒåœ¾å›æ”¶å’Œåº”ç”¨ç¨‹åºåŒæ—¶è¿è¡Œï¼Œé™ä½ STW çš„æ—¶é—´ (200ms)<br />\n CMS é—®é¢˜æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ç°åœ¨æ²¡æœ‰ä¸€ä¸ªç‰ˆæœ¬é»˜è®¤æ˜¯ CMSï¼Œåªèƒ½æ‰‹å·¥æŒ‡å®š<br />\n CMS æ—¢ç„¶æ˜¯ MarkSweepï¼Œå°±ä¸€å®šä¼šæœ‰ç¢ç‰‡åŒ–çš„é—®é¢˜ï¼Œç¢ç‰‡åˆ°è¾¾ä¸€å®šç¨‹åº¦ï¼ŒCMS çš„è€å¹´ä»£åˆ†é…å¯¹è±¡åˆ†é…ä¸ä¸‹çš„æ—¶å€™ï¼Œä½¿ç”¨ SerialOld è¿›è¡Œè€å¹´ä»£å›æ”¶<br />\næƒ³è±¡ä¸€ä¸‹ï¼š<br />\nPS + PO -&gt; åŠ å†…å­˜ æ¢åƒåœ¾å›æ”¶å™¨ -&gt; PN + CMS + SerialOldï¼ˆå‡ ä¸ªå°æ—¶ - å‡ å¤©çš„ STWï¼‰<br />\nå‡ åä¸ª G çš„å†…å­˜ï¼Œå•çº¿ç¨‹å›æ”¶ -&gt; G1 + FGC å‡ åä¸ª G -&gt; ä¸Š T å†…å­˜çš„æœåŠ¡å™¨ ZGC<br />\n ç®—æ³•ï¼šä¸‰è‰²æ ‡è®° + Incremental Update</li>\n<li>G1(10ms)<br />\n ç®—æ³•ï¼šä¸‰è‰²æ ‡è®° + SATB</li>\n<li>ZGC (1ms) PK C++<br />\n ç®—æ³•ï¼šColoredPointers + LoadBarrier</li>\n<li>Shenandoah<br />\n ç®—æ³•ï¼šColoredPointers + WriteBarrier</li>\n<li>Eplison</li>\n<li>PS å’Œ PN åŒºåˆ«çš„å»¶ä¼¸é˜…è¯»ï¼š<br />\nâ–ª<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vZW4vamF2YS9qYXZhc2UvMTMvZ2N0dW5pbmcvZXJnb25vbWljcy5odG1s\">https://docs.oracle.com/en/java/javase/13/gctuning/ergonomics.html#GUID-3D0BB91E-9BFF-4EBB-B523-14493A860E73</span></li>\n<li>åƒåœ¾æ”¶é›†å™¨è·Ÿå†…å­˜å¤§å°çš„å…³ç³»\n<ol>\n<li>Serial å‡ åå…†</li>\n<li>PS ä¸Šç™¾å…† - å‡ ä¸ª G</li>\n<li>CMS - 20G</li>\n<li>G1 - ä¸Šç™¾ G</li>\n<li>ZGC - 4T - 16Tï¼ˆJDK13ï¼‰</li>\n</ol>\n</li>\n</ol>\n<p><strong>å…·ä½“è§£é‡Šï¼š</strong></p>\n<p>ç›®å‰æ‰€æœ‰åƒåœ¾å›æ”¶å™¨éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼ˆé™¤äº† CMS ä¹‹å¤–ï¼‰ï¼šåœ¨åƒåœ¾å›æ”¶æ—¶ä¼šåœæ­¢å½“å‰çš„å·¥ä½œçº¿ç¨‹ï¼Œå³ stop the worldï¼ˆSTWï¼‰ï¼Œåƒåœ¾æ¸…é™¤å®Œæˆä¹‹åå†ç»§ç»­å·¥ä½œ</p>\n<h3 id=\"serial\"><a class=\"anchor\" href=\"#serial\">#</a> Serial</h3>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309134907226.png\" alt=\"image-20210309134907226\" /></p>\n<p>æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„åƒåœ¾å›æ”¶å™¨ï¼Œé‡‡ç”¨äº†å¤åˆ¶ç®—æ³•ï¼Œç”¨åœ¨æ–°ç”Ÿä»£åŒºçš„åƒåœ¾å›æ”¶ã€‚å½“æ¸…ç†åƒåœ¾æ—¶ï¼Œä¼šæ‰¾åˆ°ä¸€ä¸ªå®‰å…¨ç‚¹æ¥åœæ­¢å½“å‰æ‰€æœ‰çš„å·¥ä½œï¼Œç­‰å¾…åƒåœ¾æ¸…ç†å®Œæˆåç»§ç»­ä»å®‰å…¨ç‚¹å¼€å§‹å·¥ä½œï¼Œ</p>\n<h3 id=\"serial-old\"><a class=\"anchor\" href=\"#serial-old\">#</a> Serial Old</h3>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309140524983.png\" alt=\"image-20210309140524983\" /></p>\n<p>å•çº¿ç¨‹çš„åƒåœ¾å›æ”¶å™¨ï¼Œé‡‡ç”¨äº†æ ‡è®°æ¸…é™¤ / æ ‡è®°å‹ç¼©ç®—æ³•ï¼Œç”¨äºè€å¹´åŒºçš„åƒåœ¾å›æ”¶ã€‚</p>\n<h3 id=\"paraller-scavenge\"><a class=\"anchor\" href=\"#paraller-scavenge\">#</a> Paraller Scavenge</h3>\n<p>å¹¶è¡Œæ¸…é™¤ï¼ˆæ³¨æ„å¹¶è¡Œä¸å¹¶å‘çš„åŒºåˆ†ï¼‰ï¼Œå³å¤šä¸ªçº¿ç¨‹åŒæ—¶æ¸…é™¤åƒåœ¾</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309141237986.png\" alt=\"image-20210309141237986\" /></p>\n<p>å¤šçº¿ç¨‹çš„åƒåœ¾å›æ”¶å™¨ï¼Œé‡‡ç”¨äº†å¤åˆ¶ç®—æ³•ï¼Œç”¨äºæ–°ç”Ÿä»£åŒºçš„åƒåœ¾å›æ”¶</p>\n<h3 id=\"parallel-old\"><a class=\"anchor\" href=\"#parallel-old\">#</a> Parallel Old</h3>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309142159515.png\" alt=\"image-20210309142159515\" /></p>\n<p>å¤šçº¿ç¨‹çš„åƒåœ¾å›æ”¶å™¨ï¼Œé‡‡ç”¨äº†æ•´ç†ï¼ˆå‹ç¼©ï¼‰ç®—æ³•ï¼Œç”¨äºè€å¹´ä»£åŒºçš„åƒåœ¾å›æ”¶</p>\n<h3 id=\"parnewparallel-new\"><a class=\"anchor\" href=\"#parnewparallel-new\">#</a> ParNewï¼ˆParallel Newï¼‰</h3>\n<p>Parallel Scavenge çš„æ–°ç‰ˆæœ¬ï¼Œåšäº†ä¸€äº›å¢å¼ºï¼Œä»¥ä¾¿èƒ½ä¸ CMS é…åˆä½¿ç”¨</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309142939221.png\" alt=\"image-20210309142939221\" /></p>\n<p>å¤šçº¿ç¨‹çš„åƒåœ¾å›æ”¶å™¨ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œç”¨äºæ–°ç”Ÿä»£åŒºçš„åƒåœ¾å›æ”¶</p>\n<h3 id=\"cmsconcurrent-mark-sweep\"><a class=\"anchor\" href=\"#cmsconcurrent-mark-sweep\">#</a> CMS(Concurrent Mark Sweep)</h3>\n<p>CMS æ˜¯ä¸€ä¸ªè€å¹´ä»£åŒºçš„åƒåœ¾å›æ”¶å™¨ï¼Œæ˜¯å¹¶å‘æ ‡è®°æ¸…ç†åƒåœ¾çš„ï¼Œå³å›æ”¶åƒåœ¾æ—¶ä¸éœ€è¦åœæ­¢æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼ˆSTWï¼‰ï¼Œå›æ”¶çº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹å¹¶å‘æ‰§è¡Œ</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309161623666.png\" alt=\"image-20210309161623666\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309162641292.png\" alt=\"image-20210309162641292\" /></p>\n<p>ä»¥ä¸Šè“è‰²ç®­å¤´ä»£è¡¨å·¥ä½œçº¿ç¨‹ï¼Œé»„è‰²ç®­å¤´ä»£è¡¨ gc çº¿ç¨‹</p>\n<ul>\n<li>\n<p>åˆå§‹æ ‡è®°ï¼šæ ‡è®°æ ¹å¯¹è±¡ï¼Œæ­¤æ—¶ä¼š STW</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309165607661.png\" alt=\"image-20210309165607661\" /></p>\n</li>\n<li>\n<p>å¹¶å‘æ ‡è®°ï¼šæ ‡è®°ä¸è·Ÿå¯¹è±¡ç›¸å…³çš„å¯¹è±¡ã€‚gc çš„ 80% çš„æ—¶é—´éƒ½æµªè´¹åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œæ‰€ä»¥å¹¶å‘æ ‡è®°çš„åŒæ—¶å¯ä»¥è®©å·¥ä½œçº¿ç¨‹ä¹Ÿä¸€èµ·å·¥ä½œ</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309165635223.png\" alt=\"image-20210309165635223\" /></p>\n</li>\n<li>\n<p>é‡æ–°æ ‡è®°ï¼šç”±äºåœ¨å¹¶å‘æ ‡è®°çš„åŒæ—¶ï¼Œå·¥ä½œçº¿ç¨‹ä¹Ÿåœ¨å·¥ä½œï¼Œæ‰€ä»¥å·¥ä½œçº¿ç¨‹åœ¨å¹¶å‘æ ‡è®°çš„åŒæ—¶ä¼šäº§ç”Ÿä¸€äº›åƒåœ¾å¯¹è±¡ï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦é‡æ–°æ ‡è®°æ–°äº§ç”Ÿçš„å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šæœ‰ STW</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309165800289.png\" alt=\"image-20210309165800289\" /></p>\n</li>\n<li>\n<p>å¹¶å‘æ¸…ç†ï¼šæ¸…ç†åƒåœ¾å¯¹è±¡çš„çº¿ç¨‹ä¸å·¥ä½œçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿä¼šäº§ç”Ÿæ–°çš„åƒåœ¾å¯¹è±¡ï¼Œè¿™äº›åƒåœ¾æˆä¸ºæµ®åŠ¨åƒåœ¾ï¼Œç­‰å¾… CMS ä¸‹æ¬¡å¼€å§‹è¿è¡Œåæ¸…é™¤è¿™äº›æµ®åŠ¨åƒåœ¾</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210309165842240.png\" alt=\"image-20210309165842240\" /></p>\n</li>\n</ul>\n<p><a href=\"%5Bhttps://docs.oracle.com/en/java/javase/13/gctuning/ergonomics.html#GUID-3D0BB91E-9BFF-4EBB-B523-14493A860E73%5D(https://docs.oracle.com/en/java/javase/13/gctuning/ergonomics.html)\">PS å’Œ PN åŒºåˆ«</a></p>\n<h3 id=\"g110ms\"><a class=\"anchor\" href=\"#g110ms\">#</a> G1ï¼ˆ10msï¼‰</h3>\n<p>G1 æ˜¯ JDK1.7 å¼€å§‹çš„ä½†ä¸ç¨³å®šï¼ŒJDK1.9 é»˜è®¤åƒåœ¾å›æ”¶å™¨ä¸º G1ã€‚é€»è¾‘åˆ†åŒºï¼Œç‰©ç†ä¸åˆ†åŒºã€‚</p>\n<p>ç®—æ³•ï¼šä¸‰è‰²æ ‡è®° + SATB</p>\n<h3 id=\"zgc1ms\"><a class=\"anchor\" href=\"#zgc1ms\">#</a> ZGC(1ms)</h3>\n<p>ä¸åˆ†åŒºï¼Œç›´æ¥åœ¨å†…å­˜ä¸Šå›æ”¶</p>\n<p>ç®—æ³•ï¼šColoredPointers + å†™å±éšœ</p>\n<h3 id=\"shenandoah\"><a class=\"anchor\" href=\"#shenandoah\">#</a> Shenandoah</h3>\n<p>ç®—æ³•ï¼šColoredPointers + è¯»å±éšœ</p>\n<h3 id=\"eplison\"><a class=\"anchor\" href=\"#eplison\">#</a> Eplison</h3>\n<h2 id=\"cms\"><a class=\"anchor\" href=\"#cms\">#</a> CMS</h2>\n<h3 id=\"cmsçš„é—®é¢˜\"><a class=\"anchor\" href=\"#cmsçš„é—®é¢˜\">#</a> CMS çš„é—®é¢˜</h3>\n<ol>\n<li>\n<p>Memory Fragmentationï¼šå†…å­˜ç¢ç‰‡åŒ–ï¼Œå› ä¸º CMS é‡‡ç”¨çš„åƒåœ¾å›æ”¶ç®—æ³•æ˜¯ Mark Sweepï¼ˆæ ‡è®°æ¸…é™¤ç®—æ³•ï¼‰ï¼Œè¯¥ç®—æ³•çš„ç¼ºç‚¹å°±æ˜¯ä¼šäº§ç”Ÿå¾ˆå¤šç¢ç‰‡åŒ–çš„å†…å­˜</p>\n<blockquote>\n<p>-XX:+UseCMSCompactAtFullCollection<br />\n-XX:CMSFullGCsBeforeCompaction é»˜è®¤ä¸º 0 æŒ‡çš„æ˜¯ç»è¿‡å¤šå°‘æ¬¡ FGC æ‰è¿›è¡Œå‹ç¼©</p>\n</blockquote>\n</li>\n<li>\n<p>Floating Garbageï¼šæµ®åŠ¨åƒåœ¾ï¼Œå¹¶å‘æ¸…ç†åƒåœ¾çš„åŒæ—¶ä¼šäº§ç”Ÿæ–°çš„åƒåœ¾å¯¹è±¡ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡ CMS è§£å†³ï¼Œä½†å¦‚æœæœ‰æ–°ç”Ÿä»£åŒºçš„å¯¹è±¡è¦è¿›å…¥è€å¹´ä»£åŒºæ—¶ï¼Œä¸”è€å¹´ä»£åŒºè‹¥æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å®¹çº³æ–°ç”Ÿä»£åŒºçš„å¯¹è±¡æ—¶å°±ä¼šè§¦å‘ Serial Old åƒåœ¾å›æ”¶å™¨ï¼Œè€Œ Serial Old æ˜¯å•çº¿ç¨‹æ¸…ç†åƒåœ¾ä¸”ä¼šåœæ­¢å½“å‰æ‰€æœ‰å·¥ä½œçº¿ç¨‹ç›´åˆ°åƒåœ¾æ¸…ç†å®Œæ¯•ï¼ˆSTPï¼‰ï¼Œè¿™æ ·ä¸€æ¥å°±ä¼šå¤§å¹…åº¦é™ä½ CMS æœ¬æ¥çš„æ•ˆç‡ã€‚æ‰€ä»¥ï¼ŒCMS é€‚åˆå†…å­˜ä¸å¤§çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼ˆä¸€èˆ¬æœ€å¤§ä¸º 20GBï¼‰ï¼Œå› ä¸ºè€å¹´ä»£å†…å­˜æ¯”è¾ƒå¤§çš„è¯ï¼Œæ‰§è¡Œä¸€æ¬¡ FGC ä¼šå¾ˆè€—æ—¶ï¼Œä½•å†µ CMS çš„å›æ”¶ç®—æ³•ï¼ˆæ ‡è®°æ¸…ç†ï¼‰ä¼šäº§ç”Ÿå¤šçš„å†…å­˜ç¢ç‰‡ï¼Œéšåéœ€è¦è¿›è¡Œå‹ç¼©å†…å­˜ç¢ç‰‡ä¸ºè¿ç»­å†…å­˜ã€‚</p>\n<blockquote>\n<p>Concurrent Mode Failure<br />\n äº§ç”Ÿï¼šif the concurrent collector is unable to finish reclaiming the unreachable objects before the tenured generation fills up, or if an allocation cannot be satisfiedwith the available free space blocks in the tenured generation, then theapplication is paused and the collection is completed with all the applicationthreads stopped</p>\n<p>è§£å†³æ–¹æ¡ˆï¼šé™ä½è§¦å‘ CMS çš„é˜ˆå€¼ï¼Œä½¿å¾—å‰©ä½™è¶³å¤Ÿçš„ç©ºé—´è®©æ–°ç”Ÿä»£å‡çº§ï¼ˆPromotionï¼‰ä»¥åŠæœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜æ”¾æµ®åŠ¨åƒåœ¾ï¼ˆç­‰å¾…ä¸‹ä¸€æ¬¡ CMS å›æ”¶ï¼‰ã€‚å³è°ƒæ•´å‚æ•°â€“XX:CMSInitiatingOccupancyFraction ï¼Œè¯¥å‚æ•°é»˜è®¤ä¸º 68%ï¼Œå³è€å¹´ä»£åŒºçš„å†…å­˜ä½¿ç”¨è¾¾åˆ° 68% æ—¶å°±è§¦å‘ FGCã€‚ä½†æ˜¯å¦‚æœå†…å­˜å¾ˆå¤§çš„è¯ï¼Œä¸€å‘³çš„é™ä½è¯¥å‚æ•°çš„å€¼ä¹Ÿæ˜¯æµªè´¹å†…å­˜ã€‚</p>\n</blockquote>\n</li>\n<li>\n<p>PromotionFailedï¼šæ–°ç”Ÿä»£å¯¹è±¡å‡çº§åˆ°è€å¹´ä»£å¯¹è±¡å¤±è´¥ï¼ŒåŸå› æ˜¯ï¼ŒCMS ä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•åœ¨è€å¹´ä»£å›æ”¶å¯¹è±¡çš„è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿå¾ˆå¤šç¢ç‰‡åŒ–çš„å†…å­˜ï¼Œå½“æ–°ç”Ÿä»£å¯¹è±¡è¯•å›¾è¿›å…¥è€å¹´ä»£åŒºæ—¶ï¼Œå‘ç°å†…å­˜éƒ½æ˜¯ç¢ç‰‡åŒ–çš„ï¼Œå¯¼è‡´æ— æ³•å­˜å‘æ–°ç”Ÿä»£çš„å¯¹è±¡ï¼Œæ‰€ä»¥è¿™äº›æ–°ç”Ÿä»£åŒºçš„å¯¹è±¡å°±æ— æ³•å‡çº§åˆ°è€å¹´ä»£åŒº</p>\n<blockquote>\n<p>è§£å†³æ–¹æ¡ˆç±»ä¼¼ï¼Œä¿æŒè€å¹´ä»£æœ‰è¶³å¤Ÿçš„ç©ºé—´</p>\n<p>â€“XX:CMSInitiatingOccupancyFraction å¯ä»¥é™ä½è¿™ä¸ªå€¼ï¼Œè®© CMS ä¿æŒè€å¹´ä»£è¶³å¤Ÿçš„ç©ºé—´</p>\n</blockquote>\n</li>\n</ol>\n<h3 id=\"å¹¶å‘æ ‡è®°ç®—æ³•\"><a class=\"anchor\" href=\"#å¹¶å‘æ ‡è®°ç®—æ³•\">#</a> å¹¶å‘æ ‡è®°ç®—æ³•</h3>\n<p>CMS çš„å…³é”®ä½ æ˜¯å¹¶å‘å¹¶å‘æ ‡è®°ç®—æ³•ï¼ŒCMS é‡‡ç”¨äº†ä¸‰è‰²æ ‡è®°ç®—æ³• + SATB ç®—æ³•</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/image-20210315141852950.png\" alt=\"image-20210315141852950\" /></p>\n<h2 id=\"åƒåœ¾æ”¶é›†å™¨å’Œå†…å­˜çš„å…³ç³»\"><a class=\"anchor\" href=\"#åƒåœ¾æ”¶é›†å™¨å’Œå†…å­˜çš„å…³ç³»\">#</a> åƒåœ¾æ”¶é›†å™¨å’Œå†…å­˜çš„å…³ç³»</h2>\n<ol>\n<li>Serial - å‡ åå…†</li>\n<li>Parallel Scavenge ä¸Šç™¾å…† - å‡ ä¸ª G</li>\n<li>CMS - 20G</li>\n<li>G1 - ä¸Šç™¾ G</li>\n<li>ZGC - 4T</li>\n</ol>\n<h2 id=\"å¸¸è§åƒåœ¾å›æ”¶å™¨ç»„åˆå‚æ•°è®¾å®š18\"><a class=\"anchor\" href=\"#å¸¸è§åƒåœ¾å›æ”¶å™¨ç»„åˆå‚æ•°è®¾å®š18\">#</a> å¸¸è§åƒåœ¾å›æ”¶å™¨ç»„åˆå‚æ•°è®¾å®šï¼š(1.8)</h2>\n<ul>\n<li>\n<p>-XX:+UseSerialGC = Serial New (DefNew) + Serial Old</p>\n<ul>\n<li>å°å‹ç¨‹åºã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šæ˜¯è¿™ç§é€‰é¡¹ï¼ŒHotSpot ä¼šæ ¹æ®è®¡ç®—åŠé…ç½®å’Œ JDK ç‰ˆæœ¬è‡ªåŠ¨é€‰æ‹©æ”¶é›†å™¨</li>\n</ul>\n</li>\n<li>\n<p>-XX:+UseParNewGC = ParNew + SerialOld</p>\n<ul>\n<li>è¿™ä¸ªç»„åˆå·²ç»å¾ˆå°‘ç”¨ï¼ˆåœ¨æŸäº›ç‰ˆæœ¬ä¸­å·²ç»åºŸå¼ƒï¼‰</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ5NjIyNTcvd2h5LXJlbW92ZS1zdXBwb3J0LWZvci1wYXJuZXdzZXJpYWxvbGQtYW5kZGVmbmV3Y21zLWluLXRoZS1mdXR1cmU=\">https://stackoverflow.com/questions/34962257/why-remove-support-for-parnewserialold-anddefnewcms-in-the-future</span></li>\n</ul>\n</li>\n<li>\n<p>-XX:+UseConc&lt;font color=red&gt;(urrent)&lt;/font&gt;MarkSweepGC = ParNew + CMS + Serial Old</p>\n</li>\n<li>\n<p>-XX:+UseParallelGC = Parallel Scavenge + Parallel Old (1.8 é»˜è®¤) ã€PS + SerialOldã€‘</p>\n</li>\n<li>\n<p>-XX:+UseParallelOldGC = Parallel Scavenge + Parallel Old</p>\n</li>\n<li>\n<p>-XX:+UseG1GC = G1</p>\n</li>\n<li>\n<p>Linux ä¸­æ²¡æ‰¾åˆ°é»˜è®¤ GC çš„æŸ¥çœ‹æ–¹æ³•ï¼Œè€Œ windows ä¸­ä¼šæ‰“å° UseParallelGC</p>\n<ul>\n<li>java +XX:+PrintCommandLineFlags -version</li>\n<li>é€šè¿‡ GC çš„æ—¥å¿—æ¥åˆ†è¾¨</li>\n</ul>\n</li>\n<li>\n<p>Linux ä¸‹ 1.8 ç‰ˆæœ¬é»˜è®¤çš„åƒåœ¾å›æ”¶å™¨åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<ul>\n<li>1.8.0_181 é»˜è®¤ï¼ˆçœ‹ä¸å‡ºæ¥ï¼‰Copy MarkCompact</li>\n<li>1.8.0_222 é»˜è®¤ PS + PO</li>\n</ul>\n</li>\n</ul>\n",
            "tags": [
                "Java",
                "Java",
                "JVM"
            ]
        },
        {
            "id": "https://baiyezi.vip/java/JVM/JVM-JVM%E8%B0%83%E4%BC%98/",
            "url": "https://baiyezi.vip/java/JVM/JVM-JVM%E8%B0%83%E4%BC%98/",
            "title": "JVM-JVMè°ƒä¼˜",
            "date_published": "2021-06-11T12:10:15.000Z",
            "content_html": "<p>JVM å‚æ•°æŸ¥çœ‹</p>\n<p>java -ï¼šæ ‡å‡†å‚æ•°ï¼Œæ¯ä¸ªç‰ˆæœ¬ä¸€æ ·çš„å‚æ•°</p>\n<p>java -Xï¼šéæ ‡å‡†å‚æ•°</p>\n<p>java -XXï¼šä¸ç¨³å®šå‚æ•°ï¼Œæ¯ä¸ªç‰ˆæœ¬å¯èƒ½ä¸åŒ</p>\n<p>java -XX:+PrintFlagsFinal -versionï¼šæ‰“å°æ‰€æœ‰å‚æ•°</p>\n<p>java -XX:+PrintFlagsFinal -version | grep Tenureï¼šæ‰“å°ä¸ Tenure å‚æ•°ï¼ˆæŸä¸€ä¸ªå‚æ•°ï¼‰ç›¸å…³çš„å‚æ•°</p>\n<p>ä¸åŒçš„ JVM çš„å‚æ•°ä¸ªæ•°ä¸åŒï¼Œå¦‚ G1 çš„å‚æ•°ä¸åˆ°ä¸€ç™¾ä¸ªï¼ŒCMS å‚æ•°æœ‰äºŒä¸‰ç™¾ä¸ªï¼ŒZing æ®è¯´åªæœ‰ä¸€ä¸ªå‚æ•°</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a class=\"anchor\" href=\"#å‚è€ƒèµ„æ–™\">#</a> å‚è€ƒèµ„æ–™</h2>\n<ol>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9ncy5vcmFjbGUuY29tL2pvbnRoZWNvbGxlY3Rvci9vdXItY29sbGVjdG9ycw==\">https://blogs.oracle.com/</span><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9ncy5vcmFjbGUuY29tL2pvbnRoZWNvbGxlY3Rvci9vdXItY29sbGVjdG9ycw==\">jonthecollector</span><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9ncy5vcmFjbGUuY29tL2pvbnRoZWNvbGxlY3Rvci9vdXItY29sbGVjdG9ycw==\">/our-collectors</span></li>\n<li>JVM çš„å‘½ä»¤è¡Œå‚æ•° <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vamF2YXNlLzgvZG9jcy90ZWNobm90ZXMvdG9vbHMvdW5peC9qYXZhLmh0bWw=\">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2phdmEuc3VuLmNvbS9qYXZhc2UvdGVjaG5vbG9naWVzL2hvdHNwb3Qvdm1vcHRpb25zLmpzcA==\">http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp</span></li>\n<li>JVM è°ƒä¼˜å‚è€ƒæ–‡æ¡£ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vZW4vamF2YS9qYXZhc2UvMTMvZ2N0dW5pbmcvaW50cm9kdWN0aW9uLWdhcmJhZ2UtY29sbGVjdGlvbi10dW5pbmcuaHRtbCNHVUlELThBNDQzMTg0LTdFMDctNEI3MS05Nzc3LTRGMTI5NDdDODE4NA==\">https://docs.oracle.com/en/java/javase/13/gctuning/introduction-garbage-collection-tuning.html#GUID-8A443184-7E07-4B71-9777-4F12947C8184</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbnhsaGVyby9wLzExNjYwODU0Lmh0bWw=\">https://www.cnblogs.com/nxlhero/p/11660854.html</span> åœ¨çº¿æ’æŸ¥å·¥å…·</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC81MDdmN2UwY2MzYTM=\">https://www.jianshu.com/p/507f7e0cc3a3</span> arthas å¸¸ç”¨å‘½ä»¤</li>\n<li>Arthas æ‰‹å†Œï¼š\n<ol>\n<li>å¯åŠ¨ arthas java -jar arthas-boot.jar</li>\n<li>ç»‘å®š java è¿›ç¨‹</li>\n<li>dashboard å‘½ä»¤è§‚å¯Ÿç³»ç»Ÿæ•´ä½“æƒ…å†µ</li>\n<li>help æŸ¥çœ‹å¸®åŠ©</li>\n<li>help xx æŸ¥çœ‹å…·ä½“å‘½ä»¤å¸®åŠ©</li>\n</ol>\n</li>\n<li>jmap å‘½ä»¤å‚è€ƒï¼š <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC81MDdmN2UwY2MzYTM=\">https://www.jianshu.com/p/507f7e0cc3a3</span>\n<ol>\n<li>jmap -heap pid</li>\n<li>jmap -histo pid</li>\n<li>jmap -clstats pid</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"ä¸€ä¸ªä¾‹å­\"><a class=\"anchor\" href=\"#ä¸€ä¸ªä¾‹å­\">#</a> ä¸€ä¸ªä¾‹å­</h2>\n<h3 id=\"jvmå¸¸ç”¨å‚æ•°\"><a class=\"anchor\" href=\"#jvmå¸¸ç”¨å‚æ•°\">#</a> JVM å¸¸ç”¨å‚æ•°</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaWJtLmNvbS9zdXBwb3J0L2tub3dsZWRnZWNlbnRlci96aC9TUzNKUk5fNy4yLjEvY29tLmlibS5pdG0uZG9jXzYuMy9pbnN0YWxsL3NhbmRwdHVuaW5nX3R3by5odG0=\">é»˜è®¤å †å¤§å°</span></p>\n<ol>\n<li>åŒºåˆ†æ¦‚å¿µï¼šå†…å­˜æ³„æ¼ memory leakï¼ˆå†…å­˜è¢«åƒåœ¾å¯¹è±¡å ç”¨ï¼Œä¸”æ— æ³•å›æ”¶ï¼‰ï¼Œå†…å­˜æº¢å‡º out of memoryï¼ˆä¸æ–­äº§ç”Ÿå¯¹è±¡ï¼Œå¯¼è‡´å†…å­˜ä¸å¤Ÿä½¿ç”¨ï¼‰</li>\n<li>java -XX:+PrintCommandLineFlags HelloGC</li>\n<li>java -Xmn10Mï¼ˆæ–°ç”Ÿä»£å¤§å°ï¼‰ -Xms40Mï¼ˆæœ€å°å †å¤§å°ï¼‰ -Xmx60Mï¼ˆæœ€å¤§å †å¤§å°ï¼‰ -XX:+PrintCommandLineFlags -XX:+PrintGCï¼ˆæ‰“å° GC ä¿¡æ¯ï¼‰  HelloGC<br />\n æ­¤å¤–ï¼ŒPrintGC è¿˜æœ‰å…¶ä»–å‚æ•°ï¼šPrintGCDetails PrintGCTimeStamps PrintGCCauses</li>\n<li>java -XX:+UseConcMarkSweepGCï¼ˆä½¿ç”¨ CMS åƒåœ¾å›æ”¶å™¨ï¼‰ -XX:+PrintCommandLineFlags HelloGC</li>\n<li>java -XX:+PrintFlagsInitial é»˜è®¤å‚æ•°å€¼</li>\n<li>java -XX:+PrintFlagsFinal æœ€ç»ˆå‚æ•°å€¼</li>\n<li>java -XX:+PrintFlagsFinal | grep xxx æ‰¾åˆ°å¯¹åº”çš„å‚æ•°</li>\n<li>java -XX:+PrintFlagsFinal -version |grep GC</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LinkedList</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloGC</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HelloGC!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">List</span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><pre><code class=\"language-cmd\">D:\\Do\\spring\\jvm\\jvm01\\out\\production\\jvm01&gt;java -XX:+PrintCommandLineFlags com.fan.gc.HelloGC\n\n-XX:InitialHeapSize=130856640ï¼ˆæœ€å°å †å¤§å°ï¼‰ -XX:MaxHeapSize=2093706240ï¼ˆæœ€å¤§å †å¤§å°ï¼‰ -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointersï¼ˆå¼€å¯ç±»æŒ‡é’ˆå‹ç¼©ï¼‰ -XX:+UseCompressedOopsï¼ˆå¼€å¯æ™®é€šå¯¹è±¡æŒ‡é’ˆå‹ç¼©ï¼‰ -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGCï¼ˆåƒåœ¾å›æ”¶å™¨ä¸ºParallelï¼‰\n</code></pre>\n<pre><code class=\"language-cmd\">D:\\Do\\spring\\jvm\\jvm01\\out\\production\\jvm01&gt;java -Xmn10M -Xms40M -Xmn1024M -XX:+PrintCommandLineFlags -XX:+PrintGC com.fan.gc.HelloGC\n\n-XX:InitialHeapSize=41943040 -XX:MaxHeapSize=2093706240 -XX:MaxNewSize=1073741824 -XX:NewSize=1073741824ï¼ˆæ–°ç”Ÿä»£å¤§å°ï¼‰ -XX:+PrintCommandLineFlags -XX:+PrintGC -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC\nHelloGC!\n[GC (Allocation Failure)  30546K-&gt;29536K(62464K), 0.0896619 secs]\n[Full GC (Ergonomics)  29536K-&gt;29304K(88576K), 0.0287968 secs]\n[GC (Allocation Failure)  59612K-&gt;59114K(118272K), 0.0208280 secs]\n[Full GC (Ergonomics)  59114K-&gt;59000K(150016K), 0.0262090 secs]\n[GC (Allocation Failure)  116441K-&gt;116527K(180736K), 0.0322102 secs]\n[Full GC (Ergonomics)  116527K-&gt;116346K(241152K), 0.0349488 secs]\n[GC (Allocation Failure)  177970K-&gt;177970K(263168K), 0.0365349 secs]\n[Full GC (Ergonomics)  177970K-&gt;177788K(338944K), 0.0130424 secs]\n[GC (Allocation Failure)  261341K-&gt;260915K(346624K), 0.0521528 secs]\n[Full GC (Ergonomics)  260915K-&gt;260736K(444928K), 0.0084799 secs]\n[GC (Allocation Failure)  344289K-&gt;343892K(538624K), 0.0492779 secs]\n[Full GC (Ergonomics)  343892K-&gt;343683K(627712K), 0.0486633 secs]\n[GC (Allocation Failure)  455431K-&gt;455556K(647168K), 0.0579904 secs]\n[Full GC (Ergonomics)  455556K-&gt;455303K(747008K), 0.0507343 secs]\n[GC (Allocation Failure)  567062K-&gt;567177K(814080K), 0.0651118 secs]\n[Full GC (Ergonomics)  567177K-&gt;566923K(915968K), 0.0595970 secs]\n[GC (Allocation Failure)  724619K-&gt;723854K(939008K), 0.0737379 secs]\n[Full GC (Ergonomics)  723854K-&gt;723601K(1038336K), 0.3017586 secs]\n[GC (Allocation Failure)  881297K-&gt;880531K(1092096K), 0.3059804 secs]\n[Full GC (Ergonomics)  880531K-&gt;880279K(1201152K), 0.1095388 secs]\n[GC (Allocation Failure)  1065170K-&gt;1064913K(1251840K), 0.1283588 secs]\n[Full GC (Ergonomics)  1064913K-&gt;1064606K(1371136K), 0.2394774 secs]\n[Full GC (Ergonomics)  1249495K-&gt;1248933K(1371136K), 0.9279972 secs]\n[Full GC (Allocation Failure)  1248933K-&gt;1248921K(1371136K), 1.7605059 secs]\nException in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space\n        at com.fan.gc.HelloGC.main(HelloGC.java:15)\n</code></pre>\n<pre><code class=\"language-cmd\">D:\\Do\\spring\\jvm\\jvm01\\out\\production\\jvm01&gt;java -XX:+UseConcMarkSweepGC -XX:+PrintCommandLineFlags -XX:+PrintGCDetails com.fan.gc.HelloGC\n\n\n-XX:InitialHeapSize=130856640 -XX:MaxHeapSize=2093706240 -XX:MaxNewSize=697655296 -XX:MaxTenuringThreshold=6 -XX:OldPLABSize=16 -XX:+PrintCommandLineFlags -XX:+PrintGCDetails -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseConcMarkSweepGC -XX:-UseLargePagesIndividualAllocation -XX:+UseParNewGC\nHelloGC!\n[GC (Allocation Failure) [ParNew: 33810K-&gt;3736K(38720K), 0.0822155 secs] 33810K-&gt;32415K(124736K), 0.1173799 secs] [Times: user=0.11 sys=0.00, real=0.12 secs]\n[GC (Allocation Failure) [ParNew: 37180K-&gt;4270K(38720K), 0.0260453 secs] 65858K-&gt;65339K(124736K), 0.0263542 secs] [Times: user=0.08 sys=0.02, real=0.03 secs]\n[GC (CMS Initial Mark) [1 CMS-initial-mark: 61069K(86016K)] 66363K(124736K), 0.0007145 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-mark-start]\n[CMS-concurrent-mark: 0.003/0.003 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-preclean-start]\n[GC (Allocation Failure) [ParNew: 37707K-&gt;4183K(38720K), 0.0230081 secs] 98776K-&gt;98021K(133988K), 0.0232160 secs] [Times: user=0.08 sys=0.06, real=0.02 secs]\n[CMS-concurrent-preclean: 0.025/0.025 secs] [Times: user=0.08 sys=0.06, real=0.03 secs]\n[CMS-concurrent-abortable-preclean-start]\n[GC (Allocation Failure) [ParNew: 37622K-&gt;4114K(38720K), 0.0237163 secs] 131461K-&gt;130722K(165856K), 0.0242994 secs] [Times: user=0.11 sys=0.05, real=0.03 secs]\n[CMS-concurrent-abortable-preclean: 0.002/0.031 secs] [Times: user=0.11 sys=0.05, real=0.03 secs]\n[GC (CMS Final Remark) [YG occupancy: 8882 K (38720 K)][Rescan (parallel) , 0.0005308 secs][weak refs processing, 0.0000917 secs][class unloading, 0.0014198 secs][scrub symbol table, 0.0005496 secs][scrub string table, 0.0001908 secs][1 CMS-remark: 126607K(127136K)] 135490K(165856K), 0.0038196 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-sweep-start]\n[CMS-concurrent-sweep: 0.002/0.002 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-reset-start]\n[GC (Allocation Failure) [ParNew: 37555K-&gt;4108K(38720K), 0.0250266 secs] 164161K-&gt;163484K(249732K), 0.0252999 secs] [Times: user=0.09 sys=0.02, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37549K-&gt;4104K(38720K), 0.0260556 secs] 196925K-&gt;196249K(249732K), 0.0264418 secs] [Times: user=0.11 sys=0.00, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37546K-&gt;4104K(38720K), 0.0252457 secs] 229691K-&gt;229018K(265152K), 0.0255272 secs] [Times: user=0.11 sys=0.00, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37546K-&gt;4102K(38720K), 0.0251384 secs] 262461K-&gt;261786K(297020K), 0.0253610 secs] [Times: user=0.06 sys=0.03, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37544K-&gt;4102K(38720K), 0.0274734 secs] 295228K-&gt;294555K(329916K), 0.0277400 secs] [Times: user=0.11 sys=0.06, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37545K-&gt;4102K(38720K), 0.0285399 secs] 327998K-&gt;327324K(362812K), 0.0287534 secs] [Times: user=0.13 sys=0.05, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37550K-&gt;4102K(38720K), 0.0262213 secs] 360772K-&gt;360093K(395708K), 0.0271539 secs] [Times: user=0.09 sys=0.00, real=0.03 secs]\n[CMS-concurrent-reset: 0.042/0.233 secs] [Times: user=0.80 sys=0.16, real=0.23 secs]\n[GC (Allocation Failure) [ParNew: 37548K-&gt;4106K(38720K), 0.0271220 secs] 393540K-&gt;392867K(428604K), 0.0283210 secs] [Times: user=0.06 sys=0.03, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37551K-&gt;4102K(38720K), 0.0328048 secs] 426312K-&gt;425632K(461500K), 0.0333511 secs] [Times: user=0.14 sys=0.03, real=0.03 secs]\n[GC (CMS Initial Mark) [1 CMS-initial-mark: 421530K(422780K)] 426656K(461500K), 0.0011249 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-mark-start]\n[GC (Allocation Failure) [ParNew: 37546K-&gt;4104K(38720K), 0.0255051 secs] 459076K-&gt;458403K(494396K), 0.0258942 secs] [Times: user=0.08 sys=0.01, real=0.03 secs]\n[CMS-concurrent-mark: 0.009/0.035 secs] [Times: user=0.16 sys=0.01, real=0.04 secs]\n[GC (Allocation Failure) [ParNew: 37548K-&gt;4104K(38720K), 0.0270089 secs] 491847K-&gt;491172K(527292K), 0.0276231 secs] [Times: user=0.06 sys=0.02, real=0.03 secs]\n[CMS-concurrent-preclean-start]\n[CMS-concurrent-preclean: 0.005/0.005 secs] [Times: user=0.00 sys=0.00, real=0.01 secs]\n[CMS-concurrent-abortable-preclean-start]\n[GC (Allocation Failure) [ParNew: 37547K-&gt;4100K(38720K), 0.0286575 secs] 524616K-&gt;523937K(560188K), 0.0292869 secs] [Times: user=0.13 sys=0.03, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37543K-&gt;4102K(38720K), 0.0288577 secs] 557381K-&gt;556709K(593084K), 0.0299351 secs] [Times: user=0.17 sys=0.02, real=0.03 secs]\n[CMS-concurrent-abortable-preclean: 0.033/0.066 secs] [Times: user=0.30 sys=0.05, real=0.07 secs]\n[GC (CMS Final Remark) [YG occupancy: 9897 K (38720 K)][Rescan (parallel) , 0.0006325 secs][weak refs processing, 0.0000372 secs][class unloading, 0.0006484 secs][scrub symbol table, 0.0009103 secs][scrub string table, 0.0009322 secs][1 CMS-remark: 552607K(554364K)] 562504K(593084K), 0.0043822 secs] [Times: user=0.02 sys=0.00, real=0.01 secs]\n[CMS-concurrent-sweep-start]\n[CMS-concurrent-sweep: 0.003/0.003 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-reset-start]\n[GC (Allocation Failure) [ParNew: 37545K-&gt;4106K(38720K), 0.0277160 secs] 590152K-&gt;589482K(959732K), 0.0280511 secs] [Times: user=0.14 sys=0.02, real=0.03 secs]\n[CMS-concurrent-reset: 0.005/0.033 secs] [Times: user=0.14 sys=0.02, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37549K-&gt;4102K(38720K), 0.0275422 secs] 622925K-&gt;622247K(959732K), 0.0277071 secs] [Times: user=0.08 sys=0.03, real=0.03 secs]\n[GC (CMS Initial Mark) [1 CMS-initial-mark: 618145K(921012K)] 623271K(959732K), 0.0003133 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-mark-start]\n[GC (Allocation Failure) [ParNew: 37545K-&gt;4104K(38720K), 0.0279225 secs] 655691K-&gt;655019K(959732K), 0.0291747 secs] [Times: user=0.16 sys=0.03, real=0.03 secs]\n[CMS-concurrent-mark: 0.009/0.039 secs] [Times: user=0.20 sys=0.03, real=0.04 secs]\n[GC (Allocation Failure) [ParNew: 37547K-&gt;4106K(38720K), 0.0267354 secs] 688462K-&gt;687790K(959732K), 0.0270388 secs] [Times: user=0.09 sys=0.06, real=0.03 secs]\n[CMS-concurrent-preclean-start]\n[CMS-concurrent-preclean: 0.005/0.005 secs][GC (Allocation Failure)  [Times: user=0.00 sys=0.00, real=0.01 secs]\n[ParNew: 37549K-&gt;4104K(38720K), 0.0270707 secs] 721233K-&gt;720557K(959732K), 0.0280226 secs] [Times: user=0.13 sys=0.06, real=0.03 secs]\n[GC (CMS Final Remark) [YG occupancy: 5128 K (38720 K)][Rescan (parallel) , 0.0008040 secs][weak refs processing, 0.0000480 secs][class unloading, 0.0003649 secs][scrub symbol table, 0.0014814 secs][scrub string table, 0.0007356 secs][1 CMS-remark: 716453K(921012K)] 721581K(959732K), 0.0045419 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-sweep-start]\n[CMS-concurrent-sweep: 0.004/0.004 secs] [Times: user=0.03 sys=0.00, real=0.00 secs]\n[CMS-concurrent-reset-start]\n[GC (Allocation Failure) [ParNew: 37547K-&gt;4106K(38720K), 0.0279713 secs] 754000K-&gt;753328K(1232812K), 0.0281267 secs] [Times: user=0.14 sys=0.05, real=0.03 secs]\n[CMS-concurrent-reset: 0.004/0.032 secs] [Times: user=0.14 sys=0.05, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37549K-&gt;4104K(38720K), 0.0274639 secs] 786772K-&gt;786096K(1232812K), 0.0276339 secs] [Times: user=0.14 sys=0.02, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37547K-&gt;4102K(38720K), 0.0250852 secs] 819539K-&gt;818863K(1232812K), 0.0254033 secs] [Times: user=0.11 sys=0.05, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37545K-&gt;4104K(38720K), 0.0258201 secs] 852306K-&gt;851634K(1232812K), 0.0261560 secs] [Times: user=0.20 sys=0.02, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37547K-&gt;4108K(38720K), 0.0228793 secs] 885077K-&gt;884407K(1232812K), 0.0230739 secs] [Times: user=0.25 sys=0.00, real=0.02 secs]\n[GC (Allocation Failure) [ParNew: 37551K-&gt;4100K(38720K), 0.0247890 secs] 917851K-&gt;917168K(1232812K), 0.0252483 secs] [Times: user=0.08 sys=0.03, real=0.03 secs]\n[GC (CMS Initial Mark) [1 CMS-initial-mark: 913068K(1194092K)] 918193K(1232812K), 0.0009598 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-mark-start]\n[GC (Allocation Failure) [ParNew: 37543K-&gt;4104K(38720K), 0.0216953 secs] 950612K-&gt;949942K(1232812K), 0.0218936 secs] [Times: user=0.11 sys=0.00, real=0.02 secs]\n[GC (Allocation Failure) [ParNew: 37547K-&gt;4102K(38720K), 0.0296214 secs] 983385K-&gt;982709K(1232812K), 0.0298997 secs] [Times: user=0.19 sys=0.02, real=0.03 secs]\n[CMS-concurrent-mark: 0.015/0.070 secs] [Times: user=0.34 sys=0.03, real=0.07 secs]\n[GC (Allocation Failure) [ParNew: 37545K-&gt;4102K(38720K), 0.0301351 secs] 1016152K-&gt;1015478K(1232812K), 0.0303364 secs] [Times: user=0.16 sys=0.01, real=0.03 secs]\n[CMS-concurrent-preclean-start]\n[CMS-concurrent-preclean: 0.006/0.006 secs][GC (Allocation Failure)  [Times: user=0.03 sys=0.00, real=0.01 secs]\n[ParNew: 37545K-&gt;4102K(38720K), 0.0261597 secs] 1048922K-&gt;1048248K(1232812K), 0.0269864 secs] [Times: user=0.09 sys=0.00, real=0.03 secs]\n[GC (CMS Final Remark) [YG occupancy: 5800 K (38720 K)][Rescan (parallel) , 0.0006522 secs][weak refs processing, 0.0000420 secs][class unloading, 0.0003094 secs][scrub symbol table, 0.0005387 secs][scrub string table, 0.0004087 secs][1 CMS-remark: 1044145K(1194092K)] 1049946K(1232812K), 0.0027323 secs] [Times: user=0.02 sys=0.00, real=0.00 secs]\n[CMS-concurrent-sweep-start]\n[GC (Allocation Failure) [ParNew: 37545K-&gt;4108K(38720K), 0.0251137 secs] 1081691K-&gt;1081023K(1232812K), 0.0254681 secs] [Times: user=0.16 sys=0.03, real=0.02 secs]\n[CMS-concurrent-sweep: 0.004/0.031 secs] [Times: user=0.16 sys=0.03, real=0.04 secs]\n[CMS-concurrent-reset-start]\n[GC (Allocation Failure) [ParNew: 37551K-&gt;4104K(38720K), 0.0295451 secs] 1114466K-&gt;1113788K(1403392K), 0.0297117 secs] [Times: user=0.09 sys=0.02, real=0.03 secs]\n[CMS-concurrent-reset: 0.005/0.035 secs] [Times: user=0.09 sys=0.02, real=0.04 secs]\n[GC (Allocation Failure) [ParNew: 37547K-&gt;4102K(38720K), 0.0288549 secs] 1147231K-&gt;1146555K(1403392K), 0.0290894 secs] [Times: user=0.11 sys=0.03, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37545K-&gt;4106K(38720K), 0.0302115 secs] 1179999K-&gt;1179329K(1403392K), 0.0307714 secs] [Times: user=0.06 sys=0.03, real=0.03 secs]\n[GC (CMS Initial Mark) [1 CMS-initial-mark: 1175222K(1364672K)] 1180353K(1403392K), 0.0004696 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-mark-start]\n[GC (Allocation Failure) [ParNew: 37549K-&gt;4102K(38720K), 0.0283055 secs] 1212772K-&gt;1212094K(1403392K), 0.0287325 secs] [Times: user=0.17 sys=0.03, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37545K-&gt;4104K(38720K), 0.0296743 secs] 1245537K-&gt;1244865K(1403392K), 0.0305795 secs] [Times: user=0.17 sys=0.03, real=0.03 secs]\n[GC (Allocation Failure) [ParNew: 37547K-&gt;4102K(38720K), 0.0265442 secs] 1278308K-&gt;1277632K(1403392K), 0.0289526 secs] [Times: user=0.16 sys=0.03, real=0.03 secs]\n[CMS-concurrent-mark: 0.018/0.109 secs] [Times: user=0.55 sys=0.09, real=0.11 secs]\n[CMS-concurrent-preclean-start]\n[GC (Allocation Failure) [ParNew: 37545K-&gt;4106K(38720K), 0.0243971 secs] 1311076K-&gt;1310406K(1403392K), 0.0250380 secs] [Times: user=0.19 sys=0.02, real=0.03 secs]\n[CMS-concurrent-preclean: 0.009/0.038 secs] [Times: user=0.20 sys=0.02, real=0.04 secs]\n[GC (Allocation Failure) [ParNew: 37549K-&gt;4102K(38720K), 0.0262650 secs] 1343849K-&gt;1343171K(1403392K), 0.0267596 secs] [Times: user=0.09 sys=0.00, real=0.03 secs]\n[GC (CMS Final Remark) [YG occupancy: 6824 K (38720 K)][Rescan (parallel) , 0.0012639 secs][weak refs processing, 0.0002055 secs][class unloading, 0.0023680 secs][scrub symbol table, 0.0012191 secs][scrub string table, 0.0002618 secs][1 CMS-remark: 1339069K(1364672K)] 1345894K(1403392K), 0.0064672 secs] [Times: user=0.00 sys=0.00, real=0.01 secs]\n[CMS-concurrent-sweep-start]\n[GC (Allocation Failure) [ParNew: 37545K-&gt;37545K(38720K), 0.0001400 secs][CMS[CMS-concurrent-sweep: 0.003/0.003 secs] [Times: user=0.02 sys=0.00, real=0.01 secs]\n (concurrent mode failure): 1339069K-&gt;1364653K(1364672K), 0.4676363 secs] 1376614K-&gt;1375918K(1403392K), [Metaspace: 2594K-&gt;2594K(1056768K)], 0.4728215 secs] [Times: user=0.47 sys=0.00, real=0.47 secs]\n[Full GC (Allocation Failure) [CMS: 1364653K-&gt;1364653K(1364672K), 0.1735066 secs] 1976433K-&gt;1976005K(1977856K), [Metaspace: 2594K-&gt;2594K(1056768K)], 0.1743198 secs] [Times: user=0.17 sys=0.00, real=0.17 secs]\n[GC (CMS Initial Mark) [1 CMS-initial-mark: 1364653K(1364672K)] 1977029K(1977856K), 0.0014778 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[CMS-concurrent-mark-start]\n[Full GC (Allocation Failure) [CMS[CMS-concurrent-mark: 0.007/0.008 secs] [Times: user=0.03 sys=0.00, real=0.01 secs]\n (concurrent mode failure): 1364653K-&gt;1364653K(1364672K), 0.0181630 secs] 1977326K-&gt;1977029K(1977856K), [Metaspace: 2594K-&gt;2594K(1056768K)], 0.0186337 secs] [Times: user=0.03 sys=0.00, real=0.02 secs]\n[Full GC (Allocation Failure) [CMS: 1364653K-&gt;1364641K(1364672K), 0.3564214 secs] 1977029K-&gt;1977017K(1977856K), [Metaspace: 2594K-&gt;2594K(1056768K)], 0.3570369 secs] [Times: user=0.36 sys=0.00, real=0.36 secs]\nException in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space\n        at com.fan.gc.HelloGC.main(HelloGC.java:15)\nHeap\n par new generation   total 613184K, used 612673K [0x0000000083200000, 0x00000000acb50000, 0x00000000acb50000)\n  eden space 545088K, 100% used [0x0000000083200000, 0x00000000a4650000, 0x00000000a4650000)\n  from space 68096K,  99% used [0x00000000a4650000, 0x00000000a88507a8, 0x00000000a88d0000)\n  to   space 68096K,   0% used [0x00000000a88d0000, 0x00000000a88d0000, 0x00000000acb50000)\n concurrent mark-sweep generation total 1364672K, used 1364641K [0x00000000acb50000, 0x0000000100000000, 0x0000000100000000)\n Metaspace       used 2624K, capacity 4486K, committed 4864K, reserved 1056768K\n  class space    used 288K, capacity 386K, committed 512K, reserved 1048576K\n</code></pre>\n<h2 id=\"gcæ—¥å¿—\"><a class=\"anchor\" href=\"#gcæ—¥å¿—\">#</a> GC æ—¥å¿—</h2>\n<pre><code class=\"language-cmd\">D:\\Do\\spring\\jvm\\jvm01\\out\\production\\jvm01&gt;java -Xmn10M -Xms40M -Xmx60M -XX:+PrintCommandLineFlags -XX:+PrintGCDetails com.fan.gc.HelloGC\n-XX:InitialHeapSize=41943040 -XX:MaxHeapSize=62914560 -XX:MaxNewSize=10485760 -XX:NewSize=10485760 -XX:+PrintCommandLineFlags -XX:+PrintGCDetails -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC\nHelloGC!\n#YGC   å›æ”¶åŸå›               åƒåœ¾å›æ”¶å™¨      å›æ”¶å‰å¹´è½»ä»£å¯¹è±¡æ‰€å å¤§å°-&gt;å›æ”¶åå¹´è½»ä»£å¯¹è±¡æ‰€å å¤§å°(å¹´è½»ä»£æ€»å¤§å°)   å›æ”¶å‰å †å¤§å°-&gt;å›æ”¶åå †å¤§å°(å †æ€»å¤§å°)\n[GC (Allocation Failure) [PSYoungGen: 7292K-&gt;720K(9216K)] 7292K-&gt;6872K(39936K), 0.0297667 secs] [Times: user=0.00 sys=0.00, real=0.03 secs]\n[GC (Allocation Failure) [PSYoungGen: 8048K-&gt;720K(9216K)] 14200K-&gt;14048K(39936K), 0.0021418 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[GC (Allocation Failure) [PSYoungGen: 8040K-&gt;720K(9216K)] 21369K-&gt;21216K(39936K), 0.0026219 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[GC (Allocation Failure) [PSYoungGen: 8043K-&gt;688K(9216K)] 28539K-&gt;28352K(39936K), 0.0020034 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[Full GC (Ergonomics) [PSYoungGen: 688K-&gt;0K(9216K)] [ParOldGen: 27664K-&gt;28291K(46080K)] 28352K-&gt;28291K(55296K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0109781 secs] [Times: user=0.02 sys=0.00, real=0.01 secs]\n[GC (Allocation Failure) [PSYoungGen: 7325K-&gt;128K(9216K)] 35616K-&gt;35587K(55296K), 0.0023654 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[GC (Allocation Failure) [PSYoungGen: 7446K-&gt;128K(9216K)] 42905K-&gt;42755K(55296K), 0.0021450 secs] [Times: user=0.05 sys=0.02, real=0.00 secs]\n[Full GC (Ergonomics) [PSYoungGen: 128K-&gt;0K(9216K)] [ParOldGen: 42627K-&gt;42627K(51200K)] 42755K-&gt;42627K(60416K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0030819 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[GC (Allocation Failure) [PSYoungGen: 7321K-&gt;128K(9216K)] 49949K-&gt;49923K(60416K), 0.0026320 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[Full GC (Ergonomics) [PSYoungGen: 128K-&gt;0K(9216K)] [ParOldGen: 49795K-&gt;49796K(51200K)] 49923K-&gt;49796K(60416K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0032270 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[Full GC (Ergonomics) [PSYoungGen: 7316K-&gt;6144K(9216K)] [ParOldGen: 49796K-&gt;50820K(51200K)] 57112K-&gt;56964K(60416K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0043314 secs] [Times: user=0.06 sys=0.00, real=0.00 secs]\n[Full GC (Ergonomics) [PSYoungGen: 7168K-&gt;7168K(9216K)] [ParOldGen: 50820K-&gt;50820K(51200K)] 57988K-&gt;57988K(60416K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0047029 secs] [Times: user=0.00 sys=0.00, real=0.00 secs]\n[Full GC (Allocation Failure) [PSYoungGen: 7168K-&gt;7168K(9216K)] [ParOldGen: 50820K-&gt;50808K(51200K)] 57988K-&gt;57976K(60416K), [Metaspace: 2679K-&gt;2679K(1056768K)], 0.0086502 secs] [Times: user=0.00 sys=0.00, real=0.01 secs]\nException in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space\n        at com.fan.gc.HelloGC.main(HelloGC.java:15)\nHeap\n PSYoungGen      total 9216K, used 7476K [0x00000000ff600000, 0x0000000100000000, 0x0000000100000000)\n  eden space 8192K, 91% used [0x00000000ff600000,0x00000000ffd4d3c0,0x00000000ffe00000)\n  from space 1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)\n  to   space 1024K, 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)\n ParOldGen       total 51200K, used 50808K [0x00000000fc400000, 0x00000000ff600000, 0x00000000ff600000)\n  object space 51200K, 99% used [0x00000000fc400000,0x00000000ff59e070,0x00000000ff600000)\n Metaspace       used 2709K, capacity 4486K, committed 4864K, reserved 1056768K\n  class space    used 293K, capacity 386K, committed 512K, reserved 1048576K\n</code></pre>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210316213356.png\" alt=\"GCæ—¥å¿—è¯¦è§£\" /></p>\n<p>heap dump éƒ¨åˆ†ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>eden space <span class=\"token number\">5632</span>K<span class=\"token punctuation\">,</span> <span class=\"token number\">94</span><span class=\"token operator\">%</span> used <span class=\"token punctuation\">[</span><span class=\"token number\">0x00000000ff980000</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x00000000ffeb3e28</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x00000000fff00000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>                            åé¢çš„å†…å­˜åœ°å€æŒ‡çš„æ˜¯ï¼Œèµ·å§‹åœ°å€ï¼Œä½¿ç”¨ç©ºé—´ç»“æŸåœ°å€ï¼Œæ•´ä½“ç©ºé—´ç»“æŸåœ°å€</pre></td></tr></table></figure><p><img data-src=\"D:%5Cfan%5Cblog%5Csource_posts%5Cjava%5CJVM%5CJVM-JVM%E8%B0%83%E4%BC%98.assets%5CGCHeapDump.png\" alt=\"GCHeapDump\" /></p>\n<p>total = eden + 1 ä¸ª survivor</p>\n<h2 id=\"jvmè°ƒä¼˜\"><a class=\"anchor\" href=\"#jvmè°ƒä¼˜\">#</a> JVM è°ƒä¼˜</h2>\n<h3 id=\"å‰ç½®çŸ¥è¯†\"><a class=\"anchor\" href=\"#å‰ç½®çŸ¥è¯†\">#</a> å‰ç½®çŸ¥è¯†</h3>\n<ol>\n<li>ååé‡ï¼šç”¨æˆ·ä»£ç æ—¶é—´ /ï¼ˆç”¨æˆ·ä»£ç æ‰§è¡Œæ—¶é—´ + åƒåœ¾å›æ”¶æ—¶é—´ï¼‰</li>\n<li>å“åº”æ—¶é—´ï¼šSTW è¶ŠçŸ­ï¼Œå“åº”æ—¶é—´è¶Šå¥½</li>\n</ol>\n<p>G1 çš„å“åº”æ—¶é—´ä¼˜äº CMSï¼Œä½†å…¶ååé‡æ¯” G1 å° 15% å·¦å³</p>\n<p>æ‰€è°“è°ƒä¼˜ï¼Œé¦–å…ˆç¡®å®šï¼Œè¿½æ±‚å•¥ï¼Ÿååé‡ä¼˜å…ˆï¼Œè¿˜æ˜¯å“åº”æ—¶é—´ä¼˜å…ˆï¼Ÿè¿˜æ˜¯åœ¨æ»¡è¶³ä¸€å®šçš„å“åº”æ—¶é—´çš„æƒ…å†µä¸‹ï¼Œè¦æ±‚è¾¾åˆ°å¤šå¤§çš„ååé‡...</p>\n<p>é—®é¢˜ï¼š</p>\n<p>ååé‡ï¼šç§‘å­¦è®¡ç®—ã€æ•°æ®æŒ–æ˜ã€‚ååé‡ä¼˜å…ˆçš„ä¸€èˆ¬ï¼šï¼ˆPS + POï¼‰</p>\n<p>å“åº”æ—¶é—´ï¼šç½‘ç«™ GUI API ã€‚å“åº”æ—¶é—´ä¼˜å…ˆçš„ä¸€èˆ¬ï¼šG1</p>\n<h3 id=\"è°ƒä¼˜çš„æ¦‚å¿µ\"><a class=\"anchor\" href=\"#è°ƒä¼˜çš„æ¦‚å¿µ\">#</a> è°ƒä¼˜çš„æ¦‚å¿µ</h3>\n<ol>\n<li>æ ¹æ®éœ€æ±‚è¿›è¡Œ JVM è§„åˆ’å’Œé¢„è°ƒä¼˜</li>\n<li>ä¼˜åŒ–è¿è¡Œ JVM è¿è¡Œç¯å¢ƒï¼ˆæ…¢ï¼Œå¡é¡¿ï¼‰</li>\n<li>è§£å†³ JVM è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°çš„å„ç§é—®é¢˜ (OOM)</li>\n</ol>\n<h3 id=\"è°ƒä¼˜è§„åˆ’\"><a class=\"anchor\" href=\"#è°ƒä¼˜è§„åˆ’\">#</a> è°ƒä¼˜è§„åˆ’</h3>\n<ul>\n<li>\n<p>è°ƒä¼˜ï¼Œä»ä¸šåŠ¡åœºæ™¯å¼€å§‹ï¼Œæ²¡æœ‰ä¸šåŠ¡åœºæ™¯çš„è°ƒä¼˜éƒ½æ˜¯è€æµæ°“</p>\n</li>\n<li>\n<p>æ— ç›‘æ§ï¼ˆå‹åŠ›æµ‹è¯•ï¼Œèƒ½çœ‹åˆ°ç»“æœï¼‰ï¼Œä¸è°ƒä¼˜</p>\n</li>\n<li>\n<p>æ­¥éª¤ï¼š</p>\n<ol>\n<li>\n<p>ç†Ÿæ‚‰ä¸šåŠ¡åœºæ™¯ï¼ˆæ²¡æœ‰æœ€å¥½çš„åƒåœ¾å›æ”¶å™¨ï¼Œåªæœ‰æœ€åˆé€‚çš„åƒåœ¾å›æ”¶å™¨ï¼‰</p>\n<ol>\n<li>å“åº”æ—¶é—´ã€åœé¡¿æ—¶é—´ [CMS G1 ZGC] ï¼ˆéœ€è¦ç»™ç”¨æˆ·ä½œå“åº”ï¼‰</li>\n<li>ååé‡ = ç”¨æˆ·æ—¶é—´ /(ç”¨æˆ·æ—¶é—´ + GC æ—¶é—´) [PS]</li>\n</ol>\n</li>\n<li>\n<p>é€‰æ‹©å›æ”¶å™¨ç»„åˆ</p>\n</li>\n<li>\n<p>è®¡ç®—å†…å­˜éœ€æ±‚ï¼ˆç»éªŒå€¼ 1.5G 16Gï¼‰</p>\n</li>\n<li>\n<p>é€‰å®š CPUï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰</p>\n</li>\n<li>\n<p>è®¾å®šå¹´ä»£å¤§å°ã€å‡çº§å¹´é¾„</p>\n</li>\n<li>\n<p>è®¾å®šæ—¥å¿—å‚æ•°</p>\n<ol>\n<li>\n<p>-Xloggc:/opt/xxx/logs/xxx-xxx-gc-%t.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=20M -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCCause</p>\n<p>å‚æ•°è§£é‡Šï¼šä»¥ç³»ç»Ÿæ—¶é—´ä¸ºåç¼€å‘½åæ—¥å¿—  å¾ªç¯äº§ç”Ÿ äº”ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆå½“äº”ä¸ªæ—¥å¿—éƒ½æ»¡äº†åå°±åˆ é™¤æœ€å¼€å§‹çš„é‚£ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œé‡æ–°å¼€å¯ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼‰ æ¯ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§ä¸º 20M æ‰“å°ä¸€äº› GC å‚æ•°</p>\n</li>\n<li>\n<p>æˆ–è€…æ¯å¤©äº§ç”Ÿä¸€ä¸ªæ—¥å¿—æ–‡ä»¶</p>\n</li>\n</ol>\n</li>\n<li>\n<p>è§‚å¯Ÿæ—¥å¿—æƒ…å†µ</p>\n</li>\n</ol>\n</li>\n<li>\n<p>æ¡ˆä¾‹ 1ï¼šå‚ç›´ç”µå•†ï¼Œæœ€é«˜æ¯æ—¥ç™¾ä¸‡è®¢å•ï¼Œå¤„ç†è®¢å•ç³»ç»Ÿéœ€è¦ä»€ä¹ˆæ ·çš„æœåŠ¡å™¨é…ç½®ï¼Ÿ</p>\n<blockquote>\n<p>è¿™ä¸ªé—®é¢˜æ¯”è¾ƒä¸šä½™ï¼Œå› ä¸ºå¾ˆå¤šä¸åŒçš„æœåŠ¡å™¨é…ç½®éƒ½èƒ½æ”¯æ’‘ (1.5G 16G)</p>\n<p>1 å°æ—¶ 360000 é›†ä¸­æ—¶é—´æ®µï¼Œ 100 ä¸ªè®¢å• / ç§’ï¼Œï¼ˆæ‰¾ä¸€å°æ—¶å†…çš„é«˜å³°æœŸï¼Œ1000 è®¢å• / ç§’ï¼‰</p>\n<p>ç»éªŒå€¼ï¼Œ</p>\n<p>éè¦è®¡ç®—ï¼šä¸€ä¸ªè®¢å•äº§ç”Ÿéœ€è¦å¤šå°‘å†…å­˜ï¼Ÿ512K * 1000 500M å†…å­˜</p>\n<p>ä¸“ä¸šä¸€ç‚¹å„¿é—®æ³•ï¼šè¦æ±‚å“åº”æ—¶é—´ 100ms</p>\n<p>å‹æµ‹ï¼</p>\n</blockquote>\n</li>\n<li>\n<p>æ¡ˆä¾‹ 2ï¼š12306 é­é‡æ˜¥èŠ‚å¤§è§„æ¨¡æŠ¢ç¥¨åº”è¯¥å¦‚ä½•æ”¯æ’‘ï¼Ÿ</p>\n<blockquote>\n<p>12306 åº”è¯¥æ˜¯ä¸­å›½å¹¶å‘é‡æœ€å¤§çš„ç§’æ€ç½‘ç«™ï¼š</p>\n<p>å·ç§°å¹¶å‘é‡ 100W æœ€é«˜</p>\n<p>CDN -&gt; LVS -&gt; NGINX -&gt; ä¸šåŠ¡ç³»ç»Ÿ -&gt; æ¯å°æœºå™¨ 1W å¹¶å‘ï¼ˆ10K é—®é¢˜ï¼‰ 100 å°æœºå™¨</p>\n<p>æ™®é€šç”µå•†è®¢å• -&gt; ä¸‹å• -&gt; è®¢å•ç³»ç»Ÿï¼ˆIOï¼‰å‡åº“å­˜ -&gt; ç­‰å¾…ç”¨æˆ·ä»˜æ¬¾</p>\n<p>12306 çš„ä¸€ç§å¯èƒ½çš„æ¨¡å‹ï¼š ä¸‹å• -&gt; å‡åº“å­˜ å’Œ è®¢å• (redis kafka) åŒæ—¶å¼‚æ­¥è¿›è¡Œ -&gt; ç­‰ä»˜æ¬¾</p>\n<p>å‡åº“å­˜æœ€åè¿˜ä¼šæŠŠå‹åŠ›å‹åˆ°ä¸€å°æœåŠ¡å™¨</p>\n<p>å¯ä»¥åšåˆ†å¸ƒå¼æœ¬åœ°åº“å­˜ + å•ç‹¬æœåŠ¡å™¨åšåº“å­˜å‡è¡¡</p>\n<p>å¤§æµé‡çš„å¤„ç†æ–¹æ³•ï¼šåˆ†è€Œæ²»ä¹‹</p>\n</blockquote>\n</li>\n<li>\n<p>æ€ä¹ˆå¾—åˆ°ä¸€ä¸ªäº‹åŠ¡ä¼šæ¶ˆè€—å¤šå°‘å†…å­˜ï¼Ÿ</p>\n<blockquote>\n<ol>\n<li>\n<p>å¼„å°æœºå™¨ï¼Œçœ‹èƒ½æ‰¿å—å¤šå°‘ TPSï¼Ÿæ˜¯ä¸æ˜¯è¾¾åˆ°ç›®æ ‡ï¼Ÿæ‰©å®¹æˆ–è°ƒä¼˜ï¼Œè®©å®ƒè¾¾åˆ°</p>\n</li>\n<li>\n<p>ç”¨å‹æµ‹æ¥ç¡®å®š</p>\n</li>\n</ol>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"ä¼˜åŒ–ç¯å¢ƒ\"><a class=\"anchor\" href=\"#ä¼˜åŒ–ç¯å¢ƒ\">#</a> ä¼˜åŒ–ç¯å¢ƒ</h3>\n<ol>\n<li>æœ‰ä¸€ä¸ª 50 ä¸‡ PV çš„èµ„æ–™ç±»ç½‘ç«™ï¼ˆä»ç£ç›˜æå–æ–‡æ¡£åˆ°å†…å­˜ï¼‰åŸæœåŠ¡å™¨ 32 ä½ï¼Œ1.5G<br />\n çš„å †ï¼Œç”¨æˆ·åé¦ˆç½‘ç«™æ¯”è¾ƒç¼“æ…¢ï¼Œå› æ­¤å…¬å¸å†³å®šå‡çº§ï¼Œæ–°çš„æœåŠ¡å™¨ä¸º 64 ä½ï¼Œ16G<br />\n çš„å †å†…å­˜ï¼Œç»“æœç”¨æˆ·åé¦ˆå¡é¡¿ååˆ†ä¸¥é‡ï¼Œåè€Œæ¯”ä»¥å‰æ•ˆç‡æ›´ä½äº†\n<ol>\n<li>ä¸ºä»€ä¹ˆåŸç½‘ç«™æ…¢ï¼Ÿ<br />\n å¾ˆå¤šç”¨æˆ·æµè§ˆæ•°æ®ï¼Œå¾ˆå¤šæ•°æ® load åˆ°å†…å­˜ï¼Œå†…å­˜ä¸è¶³ï¼Œé¢‘ç¹ GCï¼ŒSTW é•¿ï¼Œå“åº”æ—¶é—´å˜æ…¢</li>\n<li>ä¸ºä»€ä¹ˆä¼šæ›´å¡é¡¿ï¼Ÿ<br />\nå†…å­˜è¶Šå¤§ï¼ŒFGC æ—¶é—´è¶Šé•¿</li>\n<li>å’‹åŠï¼Ÿ<br />\nPS -&gt; PN + CMS æˆ–è€… G1</li>\n</ol>\n</li>\n<li>ç³»ç»Ÿ CPU ç»å¸¸ 100%ï¼Œå¦‚ä½•è°ƒä¼˜ï¼Ÿ(é¢è¯•é«˜é¢‘)<br />\n CPU100% é‚£ä¹ˆä¸€å®šæœ‰çº¿ç¨‹åœ¨å ç”¨ç³»ç»Ÿèµ„æºï¼Œ\n<ol>\n<li>æ‰¾å‡ºå“ªä¸ªè¿›ç¨‹ cpu é«˜ï¼ˆtopï¼‰</li>\n<li>è¯¥è¿›ç¨‹ä¸­çš„å“ªä¸ªçº¿ç¨‹ cpu é«˜ï¼ˆtop -Hpï¼‰</li>\n<li>å¯¼å‡ºè¯¥çº¿ç¨‹çš„å †æ ˆ (jstack)</li>\n<li>æŸ¥æ‰¾å“ªä¸ªæ–¹æ³•ï¼ˆæ ˆå¸§ï¼‰æ¶ˆè€—æ—¶é—´ (jstack)</li>\n<li>å·¥ä½œçº¿ç¨‹å æ¯”é«˜ | åƒåœ¾å›æ”¶çº¿ç¨‹å æ¯”é«˜</li>\n</ol>\n</li>\n<li>ç³»ç»Ÿå†…å­˜é£™é«˜ï¼Œå¦‚ä½•æŸ¥æ‰¾é—®é¢˜ï¼Ÿï¼ˆé¢è¯•é«˜é¢‘ï¼‰\n<ol>\n<li>å¯¼å‡ºå †å†…å­˜ (jmap)</li>\n<li>åˆ†æ (jhat jvisualvm mat jprofiler ...)</li>\n</ol>\n</li>\n<li>å¦‚ä½•ç›‘æ§ JVM\n<ol>\n<li>jstat jvisualvm jprofiler arthas top...</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"ç›‘æ§jjvmè¿è¡Œä¸­çš„é—®é¢˜\"><a class=\"anchor\" href=\"#ç›‘æ§jjvmè¿è¡Œä¸­çš„é—®é¢˜\">#</a> ç›‘æ§ jJVM è¿è¡Œä¸­çš„é—®é¢˜</h3>\n<p>æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹è§£æå¸¸ç”¨å·¥å…·</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>fan<span class=\"token punctuation\">.</span>gc</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>math<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BigDecimal</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ArrayList</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ScheduledThreadPoolExecutor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ThreadPoolExecutor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * ä½¿ç”¨ top å‘½ä»¤æŸ¥çœ‹ gc æƒ…å†µ</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> * @Description:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> * @Author: Fan</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * @Date: 2021/3/20 18:41</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * @Version 1.0</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> **/</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FullGC_Problem01</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CardInfo</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">BigDecimal</span> price <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigDecimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"å¼ ä¸‰\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">int</span> age <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">Date</span> birthdate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">m</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">ScheduledThreadPoolExecutor</span> executor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ScheduledThreadPoolExecutor</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadPoolExecutor<span class=\"token punctuation\">.</span>DiscardOldestPolicy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        executor<span class=\"token punctuation\">.</span><span class=\"token function\">setMaximumPoolSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token function\">modelFit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">modelFit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CardInfo</span><span class=\"token punctuation\">></span></span> taskList <span class=\"token operator\">=</span> <span class=\"token function\">getAllCardInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        taskList<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>info <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token comment\">// do something</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            executor<span class=\"token punctuation\">.</span><span class=\"token function\">scheduleWithFixedDelay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token comment\">//do sth with info</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                info<span class=\"token punctuation\">.</span><span class=\"token function\">m</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>SECONDS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CardInfo</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAllCardInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CardInfo</span><span class=\"token punctuation\">></span></span> taskList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            <span class=\"token class-name\">CardInfo</span> ci <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CardInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            taskList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ci<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token keyword\">return</span> taskList<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸Šä»£ç </p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿçš„å¯¹è±¡è¶Šæ¥è¶Šå¤šï¼Œä¸æ–­è§¦æ³• YGCï¼Œä¸” YGC æ¥ä¸åŠå›æ”¶åƒåœ¾å¯¹è±¡ï¼Œå¯¼è‡´å¯¹è±¡æ‰€å å †å†…å­˜è¶Šæ¥è¶Šå¤šï¼Œå½“è®¾ç½®çš„å †å†…å­˜ 200M ä½¿ç”¨å®Œåå‡ºå‘äº† FGC</p>\n<p>åŒæ—¶ï¼Œä½¿ç”¨ top å‘½ä»¤ï¼ˆæˆ–è€…ä½¿ç”¨ jps åªæŸ¥çœ‹ java ç›¸å…³çš„è¿›ç¨‹ï¼‰æŸ¥çœ‹è¿›ç¨‹ cpuã€å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ° java è¿›ç¨‹æ‰€å ç”¨çš„ CPU èµ„æºæœ€å¤š</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># top</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">top</span> - <span class=\"token number\">11</span>:49:19 up  <span class=\"token number\">4</span>:50,  <span class=\"token number\">7</span> users,  load average: <span class=\"token number\">0.17</span>, <span class=\"token number\">0.22</span>, <span class=\"token number\">0.12</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Tasks: <span class=\"token number\">277</span> total,   <span class=\"token number\">2</span> running, <span class=\"token number\">275</span> sleeping,   <span class=\"token number\">0</span> stopped,   <span class=\"token number\">0</span> zombie</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>%Cpu<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>: <span class=\"token number\">14.6</span> us,  <span class=\"token number\">1.7</span> sy,  <span class=\"token number\">0.0</span> ni, <span class=\"token number\">82.9</span> id,  <span class=\"token number\">0.0</span> wa,  <span class=\"token number\">0.7</span> hi,  <span class=\"token number\">0.0</span> si,  <span class=\"token number\">0.0</span> st</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>MiB Mem <span class=\"token builtin class-name\">:</span>   <span class=\"token number\">3758.6</span> total,   <span class=\"token number\">1360.8</span> free,   <span class=\"token number\">1380.9</span> used,   <span class=\"token number\">1016.9</span> buff/cache</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>MiB Swap:   <span class=\"token number\">2560.0</span> total,   <span class=\"token number\">2560.0</span> free,      <span class=\"token number\">0.0</span> used.   <span class=\"token number\">2114.2</span> avail Mem </pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   PID <span class=\"token environment constant\">USER</span>      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                                                               </pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token number\">42061</span> root      <span class=\"token number\">20</span>   <span class=\"token number\">0</span> <span class=\"token number\">2168892</span> <span class=\"token number\">222980</span>  <span class=\"token number\">17084</span> S  <span class=\"token number\">19.3</span>   <span class=\"token number\">5.8</span>   <span class=\"token number\">1</span>:12.45 java                                                                                  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token number\">910</span> root      <span class=\"token number\">20</span>   <span class=\"token number\">0</span>  <span class=\"token number\">402088</span>  <span class=\"token number\">30528</span>  <span class=\"token number\">14192</span> S   <span class=\"token number\">0.3</span>   <span class=\"token number\">0.8</span>   <span class=\"token number\">0</span>:02.34 tuned                                                                                 </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token number\">7480</span> root      <span class=\"token number\">20</span>   <span class=\"token number\">0</span>  <span class=\"token number\">177920</span>  <span class=\"token number\">29640</span>   <span class=\"token number\">8092</span> S   <span class=\"token number\">0.3</span>   <span class=\"token number\">0.8</span>   <span class=\"token number\">0</span>:20.88 sssd_kcm                                                                              </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token number\">7605</span> fan       <span class=\"token number\">20</span>   <span class=\"token number\">0</span>  <span class=\"token number\">549012</span>  <span class=\"token number\">39596</span>  <span class=\"token number\">32464</span> S   <span class=\"token number\">0.3</span>   <span class=\"token number\">1.0</span>   <span class=\"token number\">0</span>:16.84 vmtoolsd                                                                              </pre></td></tr><tr><td data-num=\"13\"></td><td><pre> <span class=\"token number\">42134</span> root      <span class=\"token number\">20</span>   <span class=\"token number\">0</span>   <span class=\"token number\">64220</span>   <span class=\"token number\">4908</span>   <span class=\"token number\">4032</span> R   <span class=\"token number\">0.3</span>   <span class=\"token number\">0.1</span>   <span class=\"token number\">0</span>:01.63 <span class=\"token function\">top</span>    </pre></td></tr><tr><td data-num=\"14\"></td><td><pre> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre> <span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># jps</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">42281</span> Jps</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">42061</span> FullGC_Problem01</pre></td></tr></table></figure><p>ä½¿ç”¨ jstack å‘½ä»¤æŸ¥çœ‹è¯¥ java è¿›ç¨‹ä¸‹æ‰€æœ‰çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># jstack 42061</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2021</span>-03-21 <span class=\"token number\">11</span>:40:54</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Full thread dump OpenJDK <span class=\"token number\">64</span>-Bit Server VM <span class=\"token punctuation\">(</span><span class=\"token number\">25.275</span>-b01 mixed mode<span class=\"token punctuation\">)</span>:</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token string\">\"Attach Listener\"</span> <span class=\"token comment\">#58 daemon prio=9 os_prio=0 tid=0x00007f8f1c005800 nid=0xa4b2 waiting on condition [0x0000000000000000]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   java.lang.Thread.State: RUNNABLE</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\"pool-1-thread-50\"</span> <span class=\"token comment\">#57 prio=5 os_prio=0 tid=0x00007f8f401e0800 nid=0xa488 waiting on condition [0x00007f8f10cb3000]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   java.lang.Thread.State: WAITING <span class=\"token punctuation\">(</span>parking<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tat sun.misc.Unsafe.park<span class=\"token punctuation\">(</span>Native Method<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t- parking to <span class=\"token function\">wait</span> <span class=\"token keyword\">for</span>  <span class=\"token operator\">&lt;</span>0x00000000f7419d5<span class=\"token operator\"><span class=\"token file-descriptor important\">8</span>></span> <span class=\"token punctuation\">(</span>a java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tat java.util.concurrent.locks.LockSupport.park<span class=\"token punctuation\">(</span>LockSupport.java:175<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tat java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span>.await<span class=\"token punctuation\">(</span>AbstractQueuedSynchronizer.java:2039<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tat java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$DelayedWorkQueue</span>.take<span class=\"token punctuation\">(</span>ScheduledThreadPoolExecutor.java:1088<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tat java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$DelayedWorkQueue</span>.take<span class=\"token punctuation\">(</span>ScheduledThreadPoolExecutor.java:809<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor.getTask<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:1074<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor.runWorker<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:1134<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor<span class=\"token variable\">$Worker</span>.run<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:624<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tat java.lang.Thread.run<span class=\"token punctuation\">(</span>Thread.java:748<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token string\">\"pool-1-thread-49\"</span> <span class=\"token comment\">#56 prio=5 os_prio=0 tid=0x00007f8f401de800 nid=0xa487 waiting on condition [0x00007f8f10db4000]</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   java.lang.Thread.State: WAITING <span class=\"token punctuation\">(</span>parking<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tat sun.misc.Unsafe.park<span class=\"token punctuation\">(</span>Native Method<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t- parking to <span class=\"token function\">wait</span> <span class=\"token keyword\">for</span>  <span class=\"token operator\">&lt;</span>0x00000000f7419d5<span class=\"token operator\"><span class=\"token file-descriptor important\">8</span>></span> <span class=\"token punctuation\">(</span>a java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tat java.util.concurrent.locks.LockSupport.park<span class=\"token punctuation\">(</span>LockSupport.java:175<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tat java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span>.await<span class=\"token punctuation\">(</span>AbstractQueuedSynchronizer.java:2039<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tat java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$DelayedWorkQueue</span>.take<span class=\"token punctuation\">(</span>ScheduledThreadPoolExecutor.java:1088<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tat java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$DelayedWorkQueue</span>.take<span class=\"token punctuation\">(</span>ScheduledThreadPoolExecutor.java:809<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor.getTask<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:1074<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor.runWorker<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:1134<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor<span class=\"token variable\">$Worker</span>.run<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:624<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tat java.lang.Thread.run<span class=\"token punctuation\">(</span>Thread.java:748<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token string\">\"pool-1-thread-48\"</span> <span class=\"token comment\">#55 prio=5 os_prio=0 tid=0x00007f8f401dc800 nid=0xa486 waiting on condition [0x00007f8f10eb5000]</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>   java.lang.Thread.State: WAITING <span class=\"token punctuation\">(</span>parking<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\tat sun.misc.Unsafe.park<span class=\"token punctuation\">(</span>Native Method<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t- parking to <span class=\"token function\">wait</span> <span class=\"token keyword\">for</span>  <span class=\"token operator\">&lt;</span>0x00000000f7419d5<span class=\"token operator\"><span class=\"token file-descriptor important\">8</span>></span> <span class=\"token punctuation\">(</span>a java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\tat java.util.concurrent.locks.LockSupport.park<span class=\"token punctuation\">(</span>LockSupport.java:175<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\tat java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span>.await<span class=\"token punctuation\">(</span>AbstractQueuedSynchronizer.java:2039<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\tat java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$DelayedWorkQueue</span>.take<span class=\"token punctuation\">(</span>ScheduledThreadPoolExecutor.java:1088<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\tat java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$DelayedWorkQueue</span>.take<span class=\"token punctuation\">(</span>ScheduledThreadPoolExecutor.java:809<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor.getTask<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:1074<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor.runWorker<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:1134<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor<span class=\"token variable\">$Worker</span>.run<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:624<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\tat java.lang.Thread.run<span class=\"token punctuation\">(</span>Thread.java:748<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token string\">\"pool-1-thread-47\"</span> <span class=\"token comment\">#54 prio=5 os_prio=0 tid=0x00007f8f401da800 nid=0xa485 waiting on condition [0x00007f8f10fb6000]</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>   java.lang.Thread.State: WAITING <span class=\"token punctuation\">(</span>parking<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\tat sun.misc.Unsafe.park<span class=\"token punctuation\">(</span>Native Method<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t- parking to <span class=\"token function\">wait</span> <span class=\"token keyword\">for</span>  <span class=\"token operator\">&lt;</span>0x00000000f7419d5<span class=\"token operator\"><span class=\"token file-descriptor important\">8</span>></span> <span class=\"token punctuation\">(</span>a java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\tat java.util.concurrent.locks.LockSupport.park<span class=\"token punctuation\">(</span>LockSupport.java:175<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\tat java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span>.await<span class=\"token punctuation\">(</span>AbstractQueuedSynchronizer.java:2039<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\tat java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$DelayedWorkQueue</span>.take<span class=\"token punctuation\">(</span>ScheduledThreadPoolExecutor.java:1088<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\tat java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$DelayedWorkQueue</span>.take<span class=\"token punctuation\">(</span>ScheduledThreadPoolExecutor.java:809<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor.getTask<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:1074<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor.runWorker<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:1134<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\tat java.util.concurrent.ThreadPoolExecutor<span class=\"token variable\">$Worker</span>.run<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:624<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\tat java.lang.Thread.run<span class=\"token punctuation\">(</span>Thread.java:748<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¯¥ java è¿›ç¨‹ä¸­å¾ˆå¤šçº¿ç¨‹å¤„äº WAITING çŠ¶æ€ï¼Œæ‰€ä»¥è¯¥ java ç¨‹åºæœ‰é—®é¢˜ã€‚</p>\n<p>æ¥ç€ç»§ç»­ä½¿ç”¨ jmap æŸ¥çœ‹å„ä¸ªç±»åˆ›å»ºçš„å¯¹åƒçš„æƒ…å†µ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost java<span class=\"token punctuation\">]</span><span class=\"token comment\"># jmap -histo 47568</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> num     <span class=\"token comment\">#instances         #bytes  class name</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>----------------------------------------------</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token number\">1</span>:           <span class=\"token number\">370</span>       <span class=\"token number\">21870976</span>  <span class=\"token punctuation\">[</span>I</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token number\">2</span>:        <span class=\"token number\">284882</span>        <span class=\"token number\">9116224</span>  java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$Node</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token number\">3</span>:         <span class=\"token number\">86500</span>        <span class=\"token number\">6228000</span>  java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$ScheduledFutureTask</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token number\">4</span>:         <span class=\"token number\">86526</span>        <span class=\"token number\">3461040</span>  java.math.BigDecimal</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token number\">5</span>:         <span class=\"token number\">86500</span>        <span class=\"token number\">2768000</span>  FullGC_Problem01<span class=\"token variable\">$CardInfo</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token number\">6</span>:         <span class=\"token number\">86500</span>        <span class=\"token number\">2076000</span>  java.util.Date</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token number\">7</span>:         <span class=\"token number\">86500</span>        <span class=\"token number\">2076000</span>  java.util.concurrent.Executors<span class=\"token variable\">$RunnableAdapter</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token number\">8</span>:            <span class=\"token number\">10</span>        <span class=\"token number\">1395688</span>  <span class=\"token punctuation\">[</span>Ljava.util.concurrent.RunnableScheduledFuture<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token number\">9</span>:         <span class=\"token number\">86500</span>        <span class=\"token number\">1384000</span>  FullGC_Problem01<span class=\"token variable\">$$</span>Lambda<span class=\"token variable\">$2</span>/1044036744</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token number\">10</span>:          <span class=\"token number\">6734</span>        <span class=\"token number\">1196120</span>  <span class=\"token punctuation\">[</span>Ljava.lang.Object<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token number\">11</span>:          <span class=\"token number\">1865</span>         <span class=\"token number\">147440</span>  <span class=\"token punctuation\">[</span>C</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token number\">12</span>:           <span class=\"token number\">738</span>          <span class=\"token number\">84984</span>  java.lang.Class</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token number\">13</span>:          <span class=\"token number\">1844</span>          <span class=\"token number\">44256</span>  java.lang.String</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token number\">14</span>:            <span class=\"token number\">50</span>          <span class=\"token number\">26816</span>  <span class=\"token punctuation\">[</span>B</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token number\">15</span>:            <span class=\"token number\">56</span>          <span class=\"token number\">21056</span>  java.lang.Thread</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token number\">16</span>:           <span class=\"token number\">848</span>          <span class=\"token number\">20352</span>  java.util.ArrayList</pre></td></tr></table></figure><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå®šä½é—®é¢˜æ­¥éª¤ï¼š</p>\n<ol>\n<li>\n<p>java -Xms200M -Xmx200M -XX:+PrintGC com.mashibing.jvm.gc.T15_FullGC_Problem01</p>\n</li>\n<li>\n<p>ä¸€èˆ¬æ˜¯è¿ç»´å›¢é˜Ÿé¦–å…ˆå—åˆ°æŠ¥è­¦ä¿¡æ¯ï¼ˆCPU Memoryï¼‰</p>\n</li>\n<li>\n<p>top å‘½ä»¤è§‚å¯Ÿåˆ°é—®é¢˜ï¼šå†…å­˜ä¸æ–­å¢é•¿ CPU å ç”¨ç‡å±…é«˜ä¸ä¸‹</p>\n</li>\n<li>\n<p>top -Hp è¿›ç¨‹å·ï¼Œè§‚å¯Ÿè¿›ç¨‹ä¸­çš„çº¿ç¨‹ï¼Œå“ªä¸ªçº¿ç¨‹ CPU å’Œå†…å­˜å æ¯”é«˜</p>\n</li>\n<li>\n<p>jps å®šä½å…·ä½“ java è¿›ç¨‹<br />\n jstack å®šä½çº¿ç¨‹çŠ¶å†µï¼Œé‡ç‚¹å…³æ³¨ï¼šWAITING ã€BLOCKED<br />\neg.<br />\nwaiting on &lt;0x0000000088ca3310&gt; (a java.lang.Object)<br />\n å‡å¦‚æœ‰ä¸€ä¸ªè¿›ç¨‹ä¸­ 100 ä¸ªçº¿ç¨‹ï¼Œå¾ˆå¤šçº¿ç¨‹éƒ½åœ¨ waiting on &lt;xx&gt; ï¼Œä¸€å®šè¦æ‰¾åˆ°æ˜¯å“ªä¸ªçº¿ç¨‹æŒæœ‰è¿™æŠŠé”<br />\næ€ä¹ˆæ‰¾ï¼Ÿæœç´¢ jstack dump çš„ä¿¡æ¯ï¼Œæ‰¾ &lt;xx&gt; ï¼Œçœ‹å“ªä¸ªçº¿ç¨‹æŒæœ‰è¿™æŠŠé” RUNNABLE<br />\n ä½œä¸šï¼š1ï¼šå†™ä¸€ä¸ªæ­»é”ç¨‹åºï¼Œç”¨ jstack è§‚å¯Ÿ 2 ï¼šå†™ä¸€ä¸ªç¨‹åºï¼Œä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ä¸é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…</p>\n</li>\n<li>\n<p>ä¸ºä»€ä¹ˆé˜¿é‡Œè§„èŒƒé‡Œè§„å®šï¼Œçº¿ç¨‹çš„åç§°ï¼ˆå°¤å…¶æ˜¯çº¿ç¨‹æ± ï¼‰éƒ½è¦å†™æœ‰æ„ä¹‰çš„åç§°<br />\næ€ä¹ˆæ ·è‡ªå®šä¹‰çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹åç§°ï¼Ÿï¼ˆè‡ªå®šä¹‰ ThreadFactoryï¼‰</p>\n</li>\n<li>\n<p>jinfo pid</p>\n</li>\n<li>\n<p>jstat -gc åŠ¨æ€è§‚å¯Ÿ gc æƒ…å†µ / é˜…è¯» GC æ—¥å¿—å‘ç°é¢‘ç¹ GC /arthas è§‚å¯Ÿ /jconsole/jvisualVM/ Jprofilerï¼ˆæœ€å¥½ç”¨ï¼‰<br />\njstat -gc 4655 500 : æ¯ä¸ª 500 ä¸ªæ¯«ç§’æ‰“å°è¿›ç¨‹ä¸º 4655 çš„ GC çš„æƒ…å†µ<br />\nå¦‚æœé¢è¯•å®˜é—®ä½ æ˜¯æ€ä¹ˆå®šä½ OOM é—®é¢˜çš„ï¼Ÿå¦‚æœä½ å›ç­”ç”¨å›¾å½¢ç•Œé¢ï¼ˆé”™è¯¯ï¼‰ï¼Œå› ä¸ºéœ€è¦å¼€å¯ jmxï¼Œè€Œ jmx ä¼šè€—è´¹ CPU èµ„æºï¼Œå½±å“åŸæ¥åº”ç”¨ç¨‹åºçš„æ€§èƒ½<br />\n 1ï¼šå·²ç»ä¸Šçº¿çš„ç³»ç»Ÿä¸ç”¨å›¾å½¢ç•Œé¢ç”¨ä»€ä¹ˆï¼Ÿï¼ˆä½¿ç”¨å‘½ä»¤è¡Œæˆ–åœ¨çº¿å®šä½ arthas ç­‰ï¼‰<br />\n2ï¼šå›¾å½¢ç•Œé¢åˆ°åº•ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿæµ‹è¯•ï¼æµ‹è¯•çš„æ—¶å€™è¿›è¡Œç›‘æ§ï¼ï¼ˆå‹æµ‹è§‚å¯Ÿï¼‰</p>\n</li>\n<li>\n<p>jmap - histo 4655 | head -20ï¼ŒæŸ¥æ‰¾æœ‰å¤šå°‘å¯¹è±¡äº§ç”Ÿï¼Œå¯ä»¥å®šä½ OOM é—®é¢˜</p>\n</li>\n<li>\n<p>jmap -dump:format=b,file=xxx pid</p>\n<p>çº¿ä¸Šç³»ç»Ÿï¼Œå†…å­˜ç‰¹åˆ«å¤§ï¼Œè¯¥å‘½ä»¤æ‰§è¡ŒæœŸé—´ä¼šå¯¹è¿›ç¨‹äº§ç”Ÿå¾ˆå¤§å½±å“ï¼Œç”šè‡³å¡é¡¿ï¼ˆç”µå•†ä¸é€‚åˆï¼‰<br />\n1ï¼šè®¾å®šäº†å‚æ•° HeapDumpï¼ŒOOM çš„æ—¶å€™ä¼šè‡ªåŠ¨äº§ç”Ÿå †è½¬å‚¨æ–‡ä»¶<br />\n 2ï¼š&lt;font color='red'&gt; å¾ˆå¤šæœåŠ¡å™¨å¤‡ä»½ï¼ˆé«˜å¯ç”¨ï¼‰ï¼Œåœæ‰è¿™å°æœåŠ¡å™¨å¯¹å…¶ä»–æœåŠ¡å™¨ä¸å½±å“ &lt;/font&gt;<br />\n3ï¼šåœ¨çº¿å®šä½ (ä¸€èˆ¬å°ç‚¹å„¿å…¬å¸ç”¨ä¸åˆ°)</p>\n</li>\n<li>\n<p>java -Xms20M -Xmx20M -XX:+UseParallelGC -XX:+HeapDumpOnOutOfMemoryError com.fan.gc.FullGC_Problem01</p>\n</li>\n<li>\n<p>ä½¿ç”¨ MAT /jhat/jvisualvm è¿›è¡Œ dump æ–‡ä»¶åˆ†æ<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYmFpaHVpdGVzdHNvZnR3YXJlL2FydGljbGVzLzY0MDYyNzEuaHRtbA==\"> https://www.cnblogs.com/baihuitestsoftware/articles/6406271.html</span><br />\njhat -J-mx512M xxx.dump<br />\n<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTcuMTE6NzAwMA==\">http://192.168.17.11:7000</span><br />\n æ‹‰åˆ°æœ€åï¼šæ‰¾åˆ°å¯¹åº”é“¾æ¥<br />\nå¯ä»¥ä½¿ç”¨ OQL æŸ¥æ‰¾ç‰¹å®šé—®é¢˜å¯¹è±¡</p>\n</li>\n<li>\n<p>æ‰¾åˆ°ä»£ç çš„é—®é¢˜</p>\n</li>\n<li>\n<p>ç¨‹åºå¯åŠ¨åŠ å…¥å‚æ•°ï¼š</p>\n<blockquote>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>java -Djava.rmi.server.hostname<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.17.11 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port<span class=\"token operator\">=</span><span class=\"token number\">11111</span> -Dcom.sun.management.jmxremote.authenticate<span class=\"token operator\">=</span>false -Dcom.sun.management.jmxremote.ssl<span class=\"token operator\">=</span>false  -Xms20M -Xmx20M  -XX:+PrintGC  FullGC_Problem01</pre></td></tr></table></figure></blockquote>\n</li>\n<li>\n<p>å¦‚æœé­é‡ Local host name unknownï¼šXXX çš„é”™è¯¯ï¼Œä¿®æ”¹ /etc/hosts æ–‡ä»¶ï¼ŒæŠŠ XXX åŠ å…¥è¿›å»</p>\n<blockquote>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">192.168</span><span class=\"token number\">.17</span><span class=\"token number\">.11</span> basic localhost localhost<span class=\"token punctuation\">.</span>localdomain localhost4 localhost4<span class=\"token punctuation\">.</span>localdomain4</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">::</span><span class=\"token number\">1</span>         localhost localhost<span class=\"token punctuation\">.</span>localdomain localhost6 localhost6<span class=\"token punctuation\">.</span>localdomain6</pre></td></tr></table></figure></blockquote>\n</li>\n<li>\n<p>å…³é—­ linux é˜²ç«å¢™ï¼ˆå®æˆ˜ä¸­åº”è¯¥æ‰“å¼€å¯¹åº”ç«¯å£ï¼‰</p>\n<blockquote>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">service</span> iptables stop</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">chkconfig</span> iptables off <span class=\"token comment\">#æ°¸ä¹…å…³é—­</span></pre></td></tr></table></figure></blockquote>\n</li>\n<li>\n<p>windows ä¸Šæ‰“å¼€ jconsole è¿œç¨‹è¿æ¥ 192.168.17.11:11111</p>\n</li>\n</ol>\n<h4 id=\"jvisualvmè¿œç¨‹è¿æ¥\"><a class=\"anchor\" href=\"#jvisualvmè¿œç¨‹è¿æ¥\">#</a> jvisualvm è¿œç¨‹è¿æ¥</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbGl1Z2gvcC83NjIwMzM2Lmh0bWw=\">https://www.cnblogs.com/liugh/p/7620336.html</span> ï¼ˆç®€å•åšæ³•ï¼‰</p>\n<h4 id=\"jprofiler-æ”¶è´¹\"><a class=\"anchor\" href=\"#jprofiler-æ”¶è´¹\">#</a> jprofiler (æ”¶è´¹)</h4>\n<h4 id=\"arthasåœ¨çº¿æ’æŸ¥å·¥å…·\"><a class=\"anchor\" href=\"#arthasåœ¨çº¿æ’æŸ¥å·¥å…·\">#</a> arthas åœ¨çº¿æ’æŸ¥å·¥å…·</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcnRoYXMuYWxpeXVuLmNvbS9kb2MvaW5zdGFsbC1kZXRhaWwuaHRtbA==\">arthas å®˜æ–¹æ–‡æ¡£</span></p>\n<ul>\n<li>ä¸ºä»€ä¹ˆéœ€è¦åœ¨çº¿æ’æŸ¥ï¼Ÿ<br />\nåœ¨ç”Ÿäº§ä¸Šæˆ‘ä»¬ç»å¸¸ä¼šç¢°åˆ°ä¸€äº›ä¸å¥½æ’æŸ¥çš„é—®é¢˜ï¼Œä¾‹å¦‚çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œç”¨æœ€ç®€å•çš„ threaddump æˆ–è€… heapdump ä¸å¥½æŸ¥åˆ°é—®é¢˜åŸå› ã€‚ä¸ºäº†æ’æŸ¥è¿™äº›é—®é¢˜ï¼Œæœ‰æ—¶æˆ‘ä»¬ä¼šä¸´æ—¶åŠ ä¸€äº›æ—¥å¿—ï¼Œæ¯”å¦‚åœ¨ä¸€äº›å…³é”®çš„å‡½æ•°é‡Œæ‰“å°å‡ºå…¥å‚ï¼Œç„¶åé‡æ–°æ‰“åŒ…å‘å¸ƒï¼Œå¦‚æœæ‰“äº†æ—¥å¿—è¿˜æ˜¯æ²¡æ‰¾åˆ°é—®é¢˜ï¼Œç»§ç»­åŠ æ—¥å¿—ï¼Œé‡æ–°æ‰“åŒ…å‘å¸ƒã€‚å¯¹äºä¸Šçº¿æµç¨‹å¤æ‚è€Œä¸”å®¡æ ¸æ¯”è¾ƒä¸¥çš„å…¬å¸ï¼Œä»æ”¹ä»£ç åˆ°ä¸Šçº¿éœ€è¦å±‚å±‚çš„æµè½¬ï¼Œä¼šå¤§å¤§å½±å“é—®é¢˜æ’æŸ¥çš„è¿›åº¦ã€‚</li>\n<li>jvm è§‚å¯Ÿ jvm ä¿¡æ¯</li>\n<li>thread å®šä½çº¿ç¨‹é—®é¢˜</li>\n<li>dashboard è§‚å¯Ÿç³»ç»Ÿæƒ…å†µ</li>\n<li>heapdump + jhat åˆ†æ</li>\n<li>jad åç¼–è¯‘<br />\nåŠ¨æ€ä»£ç†ç”Ÿæˆç±»çš„é—®é¢˜å®šä½<br />\nç¬¬ä¸‰æ–¹çš„ç±»ï¼ˆè§‚å¯Ÿä»£ç ï¼‰<br />\nç‰ˆæœ¬é—®é¢˜ï¼ˆç¡®å®šè‡ªå·±æœ€æ–°æäº¤çš„ç‰ˆæœ¬æ˜¯ä¸æ˜¯è¢«ä½¿ç”¨ï¼‰</li>\n<li>redefine çƒ­æ›¿æ¢<br />\nç›®å‰æœ‰äº›é™åˆ¶æ¡ä»¶ï¼šåªèƒ½æ”¹æ–¹æ³•å®ç°ï¼ˆæ–¹æ³•å·²ç»è¿è¡Œå®Œæˆï¼‰ï¼Œä¸èƒ½æ”¹æ–¹æ³•åï¼Œ ä¸èƒ½æ”¹å±æ€§<br />\n m () -&gt; mm ()</li>\n<li>sc  - search class</li>\n<li>watch  - watch method</li>\n<li>æ²¡æœ‰åŒ…å«çš„åŠŸèƒ½ï¼šjmap</li>\n</ul>\n<h4 id=\"arthasä½¿ç”¨\"><a class=\"anchor\" href=\"#arthasä½¿ç”¨\">#</a> arthas ä½¿ç”¨</h4>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># ä¸‹è½½ arthas</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># curl -O https://arthas.aliyun.com/arthas-boot.jar</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                                 Dload  Upload   Total   Spent    Left  Speed</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">100</span>  137k  <span class=\"token number\">100</span>  137k    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>  <span class=\"token number\">78138</span>      <span class=\"token number\">0</span>  <span class=\"token number\">0</span>:00:01  <span class=\"token number\">0</span>:00:01 --:--:-- <span class=\"token number\">78138</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> anaconda-ks.cfg  <span class=\"token string\">'index.html?id=498903'</span>   java                                         redis-6.0.9.tar.gz</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> arthas-boot.jar   initial-setup-ks.cfg    mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz   <span class=\"token builtin class-name\">test</span></pre></td></tr></table></figure><p>åœ¨å¦ä¸€ä¸ªçª—å£å¯åŠ¨è¦æ‰§è¡Œçš„ java ç¨‹åº</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /root/java</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost java<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token string\">'FullGC_Problem01$1.class'</span>  <span class=\"token string\">'FullGC_Problem01$CardInfo.class'</span>   FullGC_Problem01.class   FullGC_Problem01.java</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost java<span class=\"token punctuation\">]</span><span class=\"token comment\"># java -Xms200M -Xmx200M -XX:+PrintGC FullGC_Problem01 </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>GC <span class=\"token punctuation\">(</span>Allocation Failure<span class=\"token punctuation\">)</span>  54656K-<span class=\"token operator\">></span>1147K<span class=\"token punctuation\">(</span>198016K<span class=\"token punctuation\">)</span>, <span class=\"token number\">0.0028642</span> secs<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>GC <span class=\"token punctuation\">(</span>Allocation Failure<span class=\"token punctuation\">)</span>  55795K-<span class=\"token operator\">></span>13171K<span class=\"token punctuation\">(</span>198016K<span class=\"token punctuation\">)</span>, <span class=\"token number\">0.0352064</span> secs<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨ arthas çš„ jar åŒ…</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># java -jar arthas-boot.jar </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> arthas-boot version: <span class=\"token number\">3.5</span>.0</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> Found existing java process, please choose one and input the serial number of the process, eg <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>. Then hit ENTER.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>* <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>: <span class=\"token number\">46140</span> FullGC_Problem01</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">1</span>  <span class=\"token comment\">#é€‰æ‹©è¦ç›‘æ§çš„ java è¿›ç¨‹åå›è½¦ï¼Œå†™è¿›ç¨‹å‰é¢çš„åºå·å³å¯</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#ä¼šè‡ªåŠ¨ä¸‹è½½ arthas æ‰€éœ€å…¶ä»–ä¾èµ–</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> Start download arthas from remote server: https://arthas.aliyun.com/download/3.5.0?mirror<span class=\"token operator\">=</span>aliyun</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">484.89</span> KB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">1.60</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">3.14</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">3.47</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">3.74</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">4.06</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">4.48</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">4.58</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">4.84</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">5.27</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">7.10</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">9.68</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">9.99</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">10.27</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">10.47</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">10.81</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">11.08</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">11.51</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> File size: <span class=\"token number\">12.22</span> MB, downloaded size: <span class=\"token number\">11.84</span> MB, downloading <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> Download arthas success.</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> arthas home: /root/.arthas/lib/3.5.0/arthas  <span class=\"token comment\">#ä¸‹è½½çš„ arthas å­˜æ”¾çš„ç›®å½•</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> Try to attach process <span class=\"token number\">46140</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> Attach process <span class=\"token number\">46140</span> success.  <span class=\"token comment\"># æˆåŠŸæŒ‚è½½åˆ°ä¹‹å‰çš„ java è¿›ç¨‹</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> arthas-client connect <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">3658</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.                           </pre></td></tr><tr><td data-num=\"33\"></td><td><pre> /  O  <span class=\"token punctuation\">\\</span> <span class=\"token operator\">|</span>  .--. <span class=\"token string\">''</span>--.  .--<span class=\"token string\">'|  '</span>--<span class=\"token string\">'  | /  O  \\ '</span>   .-<span class=\"token string\">'                          </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>|  .-.  ||  '</span>--<span class=\"token string\">'.'</span>   <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>   <span class=\"token operator\">|</span>  .--.  <span class=\"token operator\">||</span>  .-.  <span class=\"token operator\">|</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token builtin class-name\">.</span>  <span class=\"token variable\">`</span></span>-.                          </pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token operator\">|</span>  <span class=\"token operator\">|</span> <span class=\"token operator\">|</span>  <span class=\"token operator\">||</span>  <span class=\"token operator\">|</span><span class=\"token punctuation\">\\</span>  <span class=\"token punctuation\">\\</span>    <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>   <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>  <span class=\"token operator\">||</span>  <span class=\"token operator\">|</span> <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>.-<span class=\"token string\">'    |                         </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>`--'</span> <span class=\"token variable\"><span class=\"token variable\">`</span>--'<span class=\"token variable\">`</span></span>--<span class=\"token string\">' '</span>--<span class=\"token string\">'   `--'</span>   <span class=\"token variable\"><span class=\"token variable\">`</span>--'  <span class=\"token variable\">`</span></span>--<span class=\"token string\">'`--'</span> <span class=\"token variable\"><span class=\"token variable\">`</span>--'<span class=\"token variable\">`</span></span>-----'                          </pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                                                                                </pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>wiki       https://arthas.aliyun.com/doc                                        </pre></td></tr><tr><td data-num=\"40\"></td><td><pre>tutorials  https://arthas.aliyun.com/doc/arthas-tutorials.html                  </pre></td></tr><tr><td data-num=\"41\"></td><td><pre>version    <span class=\"token number\">3.5</span>.0                                                                </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>main_class                                                                      </pre></td></tr><tr><td data-num=\"43\"></td><td><pre>pid        <span class=\"token number\">46140</span>                                                                </pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token function\">time</span>       <span class=\"token number\">2021</span>-03-21 <span class=\"token number\">20</span>:56:23</pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ arthas çš„ä¸€äº›å‘½ä»¤æ¥ç›‘æ§æ­£åœ¨æ‰§è¡Œçš„ java è¿›ç¨‹äº†</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹ arthas çš„å…¨éƒ¨å‘½ä»¤</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>arthas@46140<span class=\"token punctuation\">]</span>$ <span class=\"token builtin class-name\">help</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> NAME         DESCRIPTION                                                                                                                                    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre> <span class=\"token builtin class-name\">help</span>         Display Arthas Help                                                                                                                            </pre></td></tr><tr><td data-num=\"5\"></td><td><pre> auth         Authenticates the current session                                                                                                              </pre></td></tr><tr><td data-num=\"6\"></td><td><pre> keymap       Display all the available keymap <span class=\"token keyword\">for</span> the specified connection.                                                                                 </pre></td></tr><tr><td data-num=\"7\"></td><td><pre> sc           Search all the classes loaded by JVM                                                                                                           </pre></td></tr><tr><td data-num=\"8\"></td><td><pre> sm           Search the method of classes loaded by JVM                                                                                                     </pre></td></tr><tr><td data-num=\"9\"></td><td><pre> classloader  Show classloader info                                                                                                                          </pre></td></tr><tr><td data-num=\"10\"></td><td><pre> jad          Decompile class                                                                                                                                </pre></td></tr><tr><td data-num=\"11\"></td><td><pre> getstatic    Show the static field of a class                                                                                                               </pre></td></tr><tr><td data-num=\"12\"></td><td><pre> monitor      Monitor method execution statistics, e.g. total/success/failure count, average rt, fail rate, etc.                                             </pre></td></tr><tr><td data-num=\"13\"></td><td><pre> stack        Display the stack trace <span class=\"token keyword\">for</span> the specified class and method                                                                                     </pre></td></tr><tr><td data-num=\"14\"></td><td><pre> thread       Display thread info, thread stack                                                                                                              </pre></td></tr><tr><td data-num=\"15\"></td><td><pre> trace        Trace the execution <span class=\"token function\">time</span> of specified method invocation.                                                                                       </pre></td></tr><tr><td data-num=\"16\"></td><td><pre> <span class=\"token function\">watch</span>        Display the input/output parameter, <span class=\"token builtin class-name\">return</span> object, and thrown exception of specified method invocation                                         </pre></td></tr><tr><td data-num=\"17\"></td><td><pre> tt           Time Tunnel                                                                                                                                    </pre></td></tr><tr><td data-num=\"18\"></td><td><pre> jvm          Display the target JVM information                                                                                                             </pre></td></tr><tr><td data-num=\"19\"></td><td><pre> perfcounter  Display the perf counter information.                                                                                                          </pre></td></tr><tr><td data-num=\"20\"></td><td><pre> ognl         Execute ognl expression.                                                                                                                       </pre></td></tr><tr><td data-num=\"21\"></td><td><pre> <span class=\"token function\">mc</span>           Memory compiler, compiles java files into bytecode and class files <span class=\"token keyword\">in</span> memory.                                                                  </pre></td></tr><tr><td data-num=\"22\"></td><td><pre> redefine     Redefine classes. @see Instrumentation<span class=\"token comment\">#redefineClasses(ClassDefinition...)                                                                     </span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> retransform  Retransform classes. @see Instrumentation<span class=\"token comment\">#retransformClasses(Class...)                                                                         </span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre> dashboard    Overview of target jvm's thread, memory, gc, vm, tomcat info.                                                                                  </pre></td></tr><tr><td data-num=\"25\"></td><td><pre> dump         Dump class byte array from JVM                                                                                                                 </pre></td></tr><tr><td data-num=\"26\"></td><td><pre> heapdump     Heap dump                                                                                                                                      </pre></td></tr><tr><td data-num=\"27\"></td><td><pre> options      View and change various Arthas options                                                                                                         </pre></td></tr><tr><td data-num=\"28\"></td><td><pre> cls          Clear the <span class=\"token function\">screen</span>                                                                                                                               </pre></td></tr><tr><td data-num=\"29\"></td><td><pre> reset        Reset all the enhanced classes                                                                                                                 </pre></td></tr><tr><td data-num=\"30\"></td><td><pre> version      Display Arthas version                                                                                                                         </pre></td></tr><tr><td data-num=\"31\"></td><td><pre> session      Display current session information                                                                                                            </pre></td></tr><tr><td data-num=\"32\"></td><td><pre> sysprop      Display, and change the system properties.                                                                                                     </pre></td></tr><tr><td data-num=\"33\"></td><td><pre> sysenv       Display the system env.                                                                                                                        </pre></td></tr><tr><td data-num=\"34\"></td><td><pre> vmoption     Display, and update the vm diagnostic options.                                                                                                 </pre></td></tr><tr><td data-num=\"35\"></td><td><pre> logger       Print logger info, and update the logger level                                                                                                 </pre></td></tr><tr><td data-num=\"36\"></td><td><pre> <span class=\"token function\">history</span>      Display <span class=\"token builtin class-name\">command</span> <span class=\"token function\">history</span>                                                                                                                        </pre></td></tr><tr><td data-num=\"37\"></td><td><pre> <span class=\"token function\">cat</span>          Concatenate and print files                                                                                                                    </pre></td></tr><tr><td data-num=\"38\"></td><td><pre> base64       Encode and decode using Base64 representation                                                                                                  </pre></td></tr><tr><td data-num=\"39\"></td><td><pre> <span class=\"token builtin class-name\">echo</span>         <span class=\"token function\">write</span> arguments to the standard output                                                                                                         </pre></td></tr><tr><td data-num=\"40\"></td><td><pre> <span class=\"token builtin class-name\">pwd</span>          Return working directory name                                                                                                                  </pre></td></tr><tr><td data-num=\"41\"></td><td><pre> mbean        Display the mbean information                                                                                                                  </pre></td></tr><tr><td data-num=\"42\"></td><td><pre> <span class=\"token function\">grep</span>         <span class=\"token function\">grep</span> <span class=\"token builtin class-name\">command</span> <span class=\"token keyword\">for</span> pipes.                                                                                                                        </pre></td></tr><tr><td data-num=\"43\"></td><td><pre> <span class=\"token function\">tee</span>          <span class=\"token function\">tee</span> <span class=\"token builtin class-name\">command</span> <span class=\"token keyword\">for</span> pipes.                                                                                                                         </pre></td></tr><tr><td data-num=\"44\"></td><td><pre> profiler     Async Profiler. https://github.com/jvm-profiling-tools/async-profiler                                                                          </pre></td></tr><tr><td data-num=\"45\"></td><td><pre> stop         Stop/Shutdown Arthas server and <span class=\"token builtin class-name\">exit</span> the console.</pre></td></tr></table></figure><figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹ç›‘æ§çš„ java è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>arthas@46906<span class=\"token punctuation\">]</span>$ thread</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Threads Total: <span class=\"token number\">69</span>, NEW: <span class=\"token number\">0</span>, RUNNABLE: <span class=\"token number\">7</span>, BLOCKED: <span class=\"token number\">0</span>, WAITING: <span class=\"token number\">53</span>, TIMED_WAITING: <span class=\"token number\">4</span>, TERMINATED: <span class=\"token number\">0</span>, Internal threads: <span class=\"token number\">5</span>                                        </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ID     NAME                                   GROUP              PRIORITY      STATE        %CPU         DELTA_TIME   TIME         INTERRUPTED  DAEMON       </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>-1     C2 CompilerThread0                     -                  -1            -            <span class=\"token number\">5.05</span>         <span class=\"token number\">0.010</span>        <span class=\"token number\">0</span>:1.063      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">true</span>         </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">8</span>      pool-1-thread-1                        main               <span class=\"token number\">5</span>             TIMED_WAITIN <span class=\"token number\">2.37</span>         <span class=\"token number\">0.004</span>        <span class=\"token number\">0</span>:1.757      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">71</span>     arthas-command-execute                 system             <span class=\"token number\">5</span>             RUNNABLE     <span class=\"token number\">0.65</span>         <span class=\"token number\">0.001</span>        <span class=\"token number\">0</span>:0.056      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">true</span>         </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>-1     C1 CompilerThread1                     -                  -1            -            <span class=\"token number\">0.51</span>         <span class=\"token number\">0.001</span>        <span class=\"token number\">0</span>:0.631      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">true</span>         </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">10</span>     pool-1-thread-3                        main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.18</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.059      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>-1     VM Periodic Task Thread                -                  -1            -            <span class=\"token number\">0.14</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.065      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">true</span>         </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">12</span>     pool-1-thread-5                        main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.09</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.066      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">14</span>     pool-1-thread-7                        main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.07</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.062      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">19</span>     pool-1-thread-12                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.07</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.065      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">34</span>     pool-1-thread-27                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.07</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.060      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">55</span>     pool-1-thread-48                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.06</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.058      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">33</span>     pool-1-thread-26                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.05</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.062      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">26</span>     pool-1-thread-19                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.05</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.066      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">18</span>     pool-1-thread-11                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.05</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.062      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">32</span>     pool-1-thread-25                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.05</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.070      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">9</span>      pool-1-thread-2                        main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.05</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.067      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">21</span>     pool-1-thread-14                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.05</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.070      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">23</span>     pool-1-thread-16                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.05</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.077      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token number\">51</span>     pool-1-thread-44                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.061      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token number\">15</span>     pool-1-thread-8                        main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.064      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">17</span>     pool-1-thread-10                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.064      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">35</span>     pool-1-thread-28                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.066      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">43</span>     pool-1-thread-36                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.067      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token number\">41</span>     pool-1-thread-34                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.061      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">31</span>     pool-1-thread-24                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.064      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">16</span>     pool-1-thread-9                        main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.064      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token number\">49</span>     pool-1-thread-42                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.067      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token number\">44</span>     pool-1-thread-37                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.075      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token number\">50</span>     pool-1-thread-43                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.04</span>         <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.064      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>    </pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">#æŸ¥çœ‹æŸä¸ªå…·ä½“çº¿ç¨‹çš„å †æ ˆè°ƒç”¨æƒ…å†µ</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">[</span>arthas@46906<span class=\"token punctuation\">]</span>$ thread <span class=\"token number\">43</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token string\">\"pool-1-thread-36\"</span> <span class=\"token assign-left variable\">Id</span><span class=\"token operator\">=</span><span class=\"token number\">43</span> WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span>@14f8bb89</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    at sun.misc.Unsafe.park<span class=\"token punctuation\">(</span>Native Method<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    -  waiting on java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span>@14f8bb89</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    at java.util.concurrent.locks.LockSupport.park<span class=\"token punctuation\">(</span>LockSupport.java:175<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    at java.util.concurrent.locks.AbstractQueuedSynchronizer<span class=\"token variable\">$ConditionObject</span>.await<span class=\"token punctuation\">(</span>AbstractQueuedSynchronizer.java:2039<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    at java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$DelayedWorkQueue</span>.take<span class=\"token punctuation\">(</span>ScheduledThreadPoolExecutor.java:1088<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    at java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token variable\">$DelayedWorkQueue</span>.take<span class=\"token punctuation\">(</span>ScheduledThreadPoolExecutor.java:809<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    at java.util.concurrent.ThreadPoolExecutor.getTask<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:1074<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    at java.util.concurrent.ThreadPoolExecutor.runWorker<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:1134<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    at java.util.concurrent.ThreadPoolExecutor<span class=\"token variable\">$Worker</span>.run<span class=\"token punctuation\">(</span>ThreadPoolExecutor.java:624<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    at java.lang.Thread.run<span class=\"token punctuation\">(</span>Thread.java:748<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token comment\">#æŸ¥çœ‹å †å†…å­˜ä»¥åŠ CPU ä½¿ç”¨æƒ…å†µï¼Œä¼šåŠæ—¶åˆ·æ–°</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token punctuation\">[</span>arthas@46906<span class=\"token punctuation\">]</span>$ dashboard </pre></td></tr><tr><td data-num=\"52\"></td><td><pre>ID     NAME                                   GROUP              PRIORITY      STATE        %CPU         DELTA_TIME   TIME         INTERRUPTED  DAEMON       </pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token number\">43</span>     pool-1-thread-36                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:9.489      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token number\">8</span>      pool-1-thread-1                        main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:7.428      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token number\">41</span>     pool-1-thread-34                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:2.155      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token number\">27</span>     pool-1-thread-20                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:1.559      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token number\">51</span>     pool-1-thread-44                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:1.196      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"58\"></td><td><pre>-1     C2 CompilerThread0                     -                  -1            -            <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:1.128      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">true</span>         </pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token number\">32</span>     pool-1-thread-25                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.733      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token number\">38</span>     pool-1-thread-31                       main               <span class=\"token number\">5</span>             TIMED_WAITIN <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.672      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"61\"></td><td><pre>-1     C1 CompilerThread1                     -                  -1            -            <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.669      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">true</span>         </pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token number\">1</span>      main                                   main               <span class=\"token number\">5</span>             TIMED_WAITIN <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.441      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token number\">31</span>     pool-1-thread-24                       main               <span class=\"token number\">5</span>             WAITING      <span class=\"token number\">0.0</span>          <span class=\"token number\">0.000</span>        <span class=\"token number\">0</span>:0.439      <span class=\"token boolean\">false</span>        <span class=\"token boolean\">false</span>        </pre></td></tr><tr><td data-num=\"64\"></td><td><pre>Memory                            used       total      max         usage      GC                                                                            </pre></td></tr><tr><td data-num=\"65\"></td><td><pre>heap                              121M       193M       193M        <span class=\"token number\">62.82</span>%     gc.copy.count                          <span class=\"token number\">6</span>                                      </pre></td></tr><tr><td data-num=\"66\"></td><td><pre>eden_space                        36M        53M        53M         <span class=\"token number\">67.69</span>%     gc.copy.time<span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>                       <span class=\"token number\">306</span>                                    </pre></td></tr><tr><td data-num=\"67\"></td><td><pre>survivor_space                    6M         6M         6M          <span class=\"token number\">100.00</span>%    gc.marksweepcompact.count              <span class=\"token number\">1</span>                                      </pre></td></tr><tr><td data-num=\"68\"></td><td><pre>tenured_gen                       78M        133M       133M        <span class=\"token number\">59.04</span>%     gc.marksweepcompact.time<span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>           <span class=\"token number\">37</span>                                     </pre></td></tr><tr><td data-num=\"69\"></td><td><pre>nonheap                           29M        31M        -1          <span class=\"token number\">95.83</span>%                                                                                   </pre></td></tr><tr><td data-num=\"70\"></td><td><pre>code_cache                        4M         5M         240M        <span class=\"token number\">2.01</span>%                                                                                    </pre></td></tr><tr><td data-num=\"71\"></td><td><pre>metaspace                         22M        23M        -1          <span class=\"token number\">97.57</span>%                                                                                   </pre></td></tr><tr><td data-num=\"72\"></td><td><pre>compressed_class_space            2M         2M         1024M       <span class=\"token number\">0.26</span>%                                                                                    </pre></td></tr><tr><td data-num=\"73\"></td><td><pre>direct                            8K         8K         -           <span class=\"token number\">100.01</span>%                                                                                  </pre></td></tr><tr><td data-num=\"74\"></td><td><pre>mapped                            0K         0K         -           <span class=\"token number\">0.00</span>%                                                                                    </pre></td></tr><tr><td data-num=\"75\"></td><td><pre>Runtime                                                                                                                                                      </pre></td></tr><tr><td data-num=\"76\"></td><td><pre>os.name                                                                        Linux                                                                         </pre></td></tr><tr><td data-num=\"77\"></td><td><pre>os.version                                                                     <span class=\"token number\">4.18</span>.0-80.el8.x86_64                                                          </pre></td></tr><tr><td data-num=\"78\"></td><td><pre>java.version                                                                   <span class=\"token number\">1.8</span>.0_275                                                                     </pre></td></tr><tr><td data-num=\"79\"></td><td><pre>java.home                                                                      /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.275.b01-1.el8_3.x86_64/jre              </pre></td></tr><tr><td data-num=\"80\"></td><td><pre>systemload.average                                                             <span class=\"token number\">0.31</span>                                                                          </pre></td></tr><tr><td data-num=\"81\"></td><td><pre>processors                                                                     <span class=\"token number\">1</span>                                                                             </pre></td></tr><tr><td data-num=\"82\"></td><td><pre>timestamp/uptime                                                               Sun Mar <span class=\"token number\">21</span> <span class=\"token number\">21</span>:26:44 CST <span class=\"token number\">2021</span>/411s            </pre></td></tr><tr><td data-num=\"83\"></td><td><pre></pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token comment\"># å¯¼å‡ºå †çš„ä½¿ç”¨æƒ…å†µåˆ°æŒ‡å®šç›®å½•</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token punctuation\">[</span>arthas@46906<span class=\"token punctuation\">]</span>$ heapdump /root/java/20210321.hprof</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>Dumping heap to /root/java/20210321.hprof <span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>Heap dump <span class=\"token function\">file</span> created</pre></td></tr><tr><td data-num=\"89\"></td><td><pre></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token comment\">#ä½¿ç”¨ jdk è‡ªå¸¦çš„ jhat å‘½ä»¤åˆ†æä»¥ä¸Šå¯¼å‡ºçš„å †æ–‡ä»¶ã€‚ -J-mx1024M æŒ‡å®š jhat åˆ†æè¯¥æ–‡ä»¶æ—¶æ‰€å çš„å †å¤§å°ï¼Œå¦‚æœè¿‡å°çš„è¯ä¼šæŠ¥é”™ OOM</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost java<span class=\"token punctuation\">]</span><span class=\"token comment\"># jhat -J-mx1024M 20210321.hprof </span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>Reading from <span class=\"token number\">20210321</span>.hprof<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"93\"></td><td><pre>Dump <span class=\"token function\">file</span> created Sun Mar <span class=\"token number\">21</span> <span class=\"token number\">21</span>:32:05 CST <span class=\"token number\">2021</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>Snapshot read, resolving<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"95\"></td><td><pre>Resolving <span class=\"token number\">4438864</span> objects<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>Chasing references, <span class=\"token function\">expect</span> <span class=\"token number\">887</span> dots<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>Eliminating duplicate references<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>Snapshot resolved.</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>Started HTTP server on port <span class=\"token number\">7000</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>Server is ready.</pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä»¥ä¸Š jhat æ‰§è¡Œå®Œæˆåå¼€äº†ä¸€ä¸ª http æœåŠ¡ï¼Œç«¯å£ä¸º 7000ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨æ¥æŸ¥çœ‹ jhat åˆ†æçš„ç»“æœ</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210321214908.png\" alt=\"image-20210321214906322\" /></p>\n<p>æŸ¥çœ‹æ‰€åˆ†æçš„ java è¿›ç¨‹äº§ç”Ÿçš„æ‰€æœ‰å¯¹è±¡</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210321220126.png\" alt=\"image-20210321220125381\" /></p>\n<p>å¯ä»¥é€šè¿‡æŸ¥è¯¢æ‰€åˆ†æçš„ java è¿›ç¨‹ä¸­ç›¸å…³ç±»åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡ï¼Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°æŸä¸ªå¯¹è±¡å¤§å°</p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210321220158.png\" alt=\"image-20210321220154829\" /></p>\n<p><img data-src=\"https://gitee.com/bfanfanfan/img/raw/master/docsify/20210321220231.png\" alt=\"image-20210321220229221\" /></p>\n<h5 id=\"åç¼–è¯‘\"><a class=\"anchor\" href=\"#åç¼–è¯‘\">#</a> åç¼–è¯‘</h5>\n<p>arthas è¿˜æœ‰ä¸¤ä¸ªå¼ºå¤§çš„åŠŸèƒ½å°±æ˜¯åç¼–è¯‘å’Œçƒ­æ›¿æ¢ï¼Œå…ˆçœ‹åç¼–è¯‘</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>arthas@50291<span class=\"token punctuation\">]</span>$ jad FullGC_Problem01</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ClassLoader:                                                                                                                                                 </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>+-sun.misc.Launcher<span class=\"token variable\">$AppClassLoader</span>@4e0e2f2a                                                                                                                  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  +-sun.misc.Launcher<span class=\"token variable\">$ExtClassLoader</span>@75668b9d                                                                                                                </pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Location:                                                                                                                                                    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>/root/java/                                                                                                                                                  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>       /*</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        * Decompiled with CFR.</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        */</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>       <span class=\"token function\">import</span> java.math.BigDecimal<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>       <span class=\"token function\">import</span> java.util.ArrayList<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>       <span class=\"token function\">import</span> java.util.Date<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>       <span class=\"token function\">import</span> java.util.List<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>       <span class=\"token function\">import</span> java.util.concurrent.ScheduledThreadPoolExecutor<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>       <span class=\"token function\">import</span> java.util.concurrent.ThreadPoolExecutor<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>       <span class=\"token function\">import</span> java.util.concurrent.TimeUnit<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>       </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>       public class FullGC_Problem01 <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>           private static ScheduledThreadPoolExecutor executor <span class=\"token operator\">=</span> new ScheduledThreadPoolExecutor<span class=\"token punctuation\">(</span><span class=\"token number\">50</span>, new ThreadPoolExecutor.DiscardOldestPolicy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">))</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>       </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>           private static List<span class=\"token operator\">&lt;</span>CardInfo<span class=\"token operator\">></span> <span class=\"token function-name function\">getAllCardInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>               ArrayList<span class=\"token operator\">&lt;</span>CardInfo<span class=\"token operator\">></span> arrayList <span class=\"token operator\">=</span> new ArrayList<span class=\"token operator\">&lt;</span>CardInfo<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>/*55*/         <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>int i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span> ++i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                   CardInfo cardInfo <span class=\"token operator\">=</span> new CardInfo<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>/*57*/             arrayList.add<span class=\"token punctuation\">(</span>cardInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>               <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>/*60*/         <span class=\"token builtin class-name\">return</span> arrayList<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>           <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>       </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>           private static void <span class=\"token function-name function\">modelFit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>/*41*/         List<span class=\"token operator\">&lt;</span>CardInfo<span class=\"token operator\">></span> list <span class=\"token operator\">=</span> FullGC_Problem01.getAllCardInfo<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>               list.forEach<span class=\"token punctuation\">(</span>cardInfo -<span class=\"token operator\">></span> executor.scheduleWithFixedDelay<span class=\"token variable\"><span class=\"token punctuation\">((</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> cardInfo.m<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span>L<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span>L<span class=\"token punctuation\">,</span> TimeUnit.SECONDS<span class=\"token punctuation\">))</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>           <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>       </pre></td></tr><tr><td data-num=\"38\"></td><td><pre>           public static void main<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> stringArray<span class=\"token punctuation\">)</span> throws Exception <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>/*32*/         executor.setMaximumPoolSize<span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>               <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>/*35*/             FullGC_Problem01.modelFit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>/*36*/             Thread.sleep<span class=\"token punctuation\">(</span>100L<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>               <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>           <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>       </pre></td></tr><tr><td data-num=\"46\"></td><td><pre>           private static class CardInfo <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>               BigDecimal price <span class=\"token operator\">=</span> new BigDecimal<span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>               String name <span class=\"token operator\">=</span> <span class=\"token string\">\"å¼ ä¸‰\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>               int age <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>               Date birthdate <span class=\"token operator\">=</span> new Date<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>       </pre></td></tr><tr><td data-num=\"52\"></td><td><pre>               private <span class=\"token function-name function\">CardInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>               <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>       </pre></td></tr><tr><td data-num=\"55\"></td><td><pre>               public void <span class=\"token function-name function\">m</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>               <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>           <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>       <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>Affect<span class=\"token punctuation\">(</span>row-cnt:3<span class=\"token punctuation\">)</span> cost <span class=\"token keyword\">in</span> <span class=\"token number\">5494</span> ms.</pre></td></tr></table></figure><h5 id=\"çƒ­æ›¿æ¢\"><a class=\"anchor\" href=\"#çƒ­æ›¿æ¢\">#</a> çƒ­æ›¿æ¢</h5>\n<p>æ¥ä¸‹æ¥çœ‹ arthas çš„çƒ­æ›¿æ¢åŠŸèƒ½</p>\n<p>æ–°å»º T.javaï¼ŒåŠŸèƒ½æ˜¯é€šè¿‡é”®ç›˜è¾“å…¥ä»»ä½•å€¼å°±ä¼šè°ƒç”¨ TT å¯¹è±¡çš„ m æ–¹æ³•è¾“å‡º 1ï¼Œç°åœ¨è¦å®ç°åœ¨ä¸åœæ­¢è¯¥ java è¿›ç¨‹çš„æƒ…å†µä¸‹æ›¿æ¢ TT å¯¹è±¡çš„ m æ–¹æ³•çš„è¾“å‡º 2</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost java<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim T.java</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>public class T <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        public static void main<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> throws Exception<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                for<span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                 System.in.read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                 new TT<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.m<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ–°å»º TT.java</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost java<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim TT.java</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>public class TT<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        public void <span class=\"token function-name function\">m</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         System.out.println<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>å¯åŠ¨ T.java</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost java<span class=\"token punctuation\">]</span><span class=\"token comment\"># java T</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr></table></figure><p>å¼€å¯ arthas</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># java -jar arthas-boot.jar </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> arthas-boot version: <span class=\"token number\">3.5</span>.0</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> Found existing java process, please choose one and input the serial number of the process, eg <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>. Then hit ENTER.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>* <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>: <span class=\"token number\">50966</span> T</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> arthas home: /root/.arthas/lib/3.5.0/arthas</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> Try to attach process <span class=\"token number\">50966</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> Attach process <span class=\"token number\">50966</span> success.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>INFO<span class=\"token punctuation\">]</span> arthas-client connect <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">3658</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.                           </pre></td></tr><tr><td data-num=\"11\"></td><td><pre> /  O  <span class=\"token punctuation\">\\</span> <span class=\"token operator\">|</span>  .--. <span class=\"token string\">''</span>--.  .--<span class=\"token string\">'|  '</span>--<span class=\"token string\">'  | /  O  \\ '</span>   .-<span class=\"token string\">'                          </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>|  .-.  ||  '</span>--<span class=\"token string\">'.'</span>   <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>   <span class=\"token operator\">|</span>  .--.  <span class=\"token operator\">||</span>  .-.  <span class=\"token operator\">|</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token builtin class-name\">.</span>  <span class=\"token variable\">`</span></span>-.                          </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">|</span>  <span class=\"token operator\">|</span> <span class=\"token operator\">|</span>  <span class=\"token operator\">||</span>  <span class=\"token operator\">|</span><span class=\"token punctuation\">\\</span>  <span class=\"token punctuation\">\\</span>    <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>   <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>  <span class=\"token operator\">||</span>  <span class=\"token operator\">|</span> <span class=\"token operator\">|</span>  <span class=\"token operator\">|</span>.-<span class=\"token string\">'    |                         </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>`--'</span> <span class=\"token variable\"><span class=\"token variable\">`</span>--'<span class=\"token variable\">`</span></span>--<span class=\"token string\">' '</span>--<span class=\"token string\">'   `--'</span>   <span class=\"token variable\"><span class=\"token variable\">`</span>--'  <span class=\"token variable\">`</span></span>--<span class=\"token string\">'`--'</span> <span class=\"token variable\"><span class=\"token variable\">`</span>--'<span class=\"token variable\">`</span></span>-----'                          </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                                                                                </pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>wiki       https://arthas.aliyun.com/doc                                        </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>tutorials  https://arthas.aliyun.com/doc/arthas-tutorials.html                  </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>version    <span class=\"token number\">3.5</span>.0                                                                </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>main_class                                                                      </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>pid        <span class=\"token number\">50966</span>                                                                </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token function\">time</span>       <span class=\"token number\">2021</span>-03-22 <span class=\"token number\">23</span>:30:11                                                  </pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>arthas@50966<span class=\"token punctuation\">]</span>$</pre></td></tr></table></figure><p>ä¿®æ”¹ TT.java å¹¶ç¼–è¯‘</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost java<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim TT.java</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>public class TT<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        public void <span class=\"token function-name function\">m</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         System.out.println<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost java<span class=\"token punctuation\">]</span><span class=\"token comment\"># javac TT.java</span></pre></td></tr></table></figure><p>ä½¿ç”¨ arthas çš„çƒ­æ›¿æ¢å‘½ä»¤ä½¿å¾—åˆšæ‰ä¿®æ”¹çš„ TT.java ç”Ÿæ•ˆ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>arthas@50966<span class=\"token punctuation\">]</span>$ redefine /root/java/TT.class</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>redefine success, size: <span class=\"token number\">1</span>, classes:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>TT</pre></td></tr></table></figure><p>å†æ¬¡æµ‹è¯• T.java è¾“å‡º</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost java<span class=\"token punctuation\">]</span><span class=\"token comment\"># java T</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>a</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2</span></pre></td></tr></table></figure>",
            "tags": [
                "Java",
                "Java",
                "JVM"
            ]
        }
    ]
}